<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GPGPU-Sim: v3.x/src/intersim2/networks/network.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_c934b74ccb33d6b9bfd1e576787940d8.html">v3.x</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_da58ad9beee6988f697f1a76e412a52a.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_7e44b91c2d8bca2324eb4df0ed8bb374.html">intersim2</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_775dcafec0a961b10f24f646adb1c103.html">networks</a>
  </div>
</div>
<div class="contents">
<h1>network.cpp</h1><a href="_2networks_2network_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// $Id: network.cpp 5188 2012-08-30 00:31:31Z dub $</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">/*</span>
<a name="l00004"></a>00004 <span class="comment"> Copyright (c) 2007-2012, Trustees of The Leland Stanford Junior University</span>
<a name="l00005"></a>00005 <span class="comment"> All rights reserved.</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment"> Redistribution and use in source and binary forms, with or without</span>
<a name="l00008"></a>00008 <span class="comment"> modification, are permitted provided that the following conditions are met:</span>
<a name="l00009"></a>00009 <span class="comment"></span>
<a name="l00010"></a>00010 <span class="comment"> Redistributions of source code must retain the above copyright notice, this </span>
<a name="l00011"></a>00011 <span class="comment"> list of conditions and the following disclaimer.</span>
<a name="l00012"></a>00012 <span class="comment"> Redistributions in binary form must reproduce the above copyright notice, this</span>
<a name="l00013"></a>00013 <span class="comment"> list of conditions and the following disclaimer in the documentation and/or</span>
<a name="l00014"></a>00014 <span class="comment"> other materials provided with the distribution.</span>
<a name="l00015"></a>00015 <span class="comment"></span>
<a name="l00016"></a>00016 <span class="comment"> THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND</span>
<a name="l00017"></a>00017 <span class="comment"> ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span>
<a name="l00018"></a>00018 <span class="comment"> WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE </span>
<a name="l00019"></a>00019 <span class="comment"> DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR</span>
<a name="l00020"></a>00020 <span class="comment"> ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<a name="l00021"></a>00021 <span class="comment"> (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span>
<a name="l00022"></a>00022 <span class="comment"> LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON</span>
<a name="l00023"></a>00023 <span class="comment"> ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00024"></a>00024 <span class="comment"> (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<a name="l00025"></a>00025 <span class="comment"> SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00026"></a>00026 <span class="comment">*/</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="comment">/*network.cpp</span>
<a name="l00029"></a>00029 <span class="comment"> *</span>
<a name="l00030"></a>00030 <span class="comment"> *This class is the basis of the entire network, it contains, all the routers</span>
<a name="l00031"></a>00031 <span class="comment"> *channels in the network, and is extended by all the network topologies</span>
<a name="l00032"></a>00032 <span class="comment"> *</span>
<a name="l00033"></a>00033 <span class="comment"> */</span>
<a name="l00034"></a>00034 
<a name="l00035"></a>00035 <span class="preprocessor">#include &lt;cassert&gt;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;booksim.hpp&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;network.hpp&quot;</span>
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;kncube.hpp&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;fly.hpp&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="cmesh_8hpp.html">cmesh.hpp</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &quot;<a class="code" href="flatfly__onchip_8hpp.html">flatfly_onchip.hpp</a>&quot;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="qtree_8hpp.html">qtree.hpp</a>&quot;</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="tree4_8hpp.html">tree4.hpp</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="fattree_8hpp.html">fattree.hpp</a>&quot;</span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="anynet_8hpp.html">anynet.hpp</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="dragonfly_8hpp.html">dragonfly.hpp</a>&quot;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="classNetwork.html#a5210ee4c1a148e7f61b7cfec45ada00b">00052</a> <a class="code" href="classNetwork.html#aa26e2c740edb38bd226ec4292c625e57">Network::Network</a>( <span class="keyword">const</span> <a class="code" href="classConfiguration.html">Configuration</a> &amp;config, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; name ) :
<a name="l00053"></a>00053   <a class="code" href="classTimedModule.html">TimedModule</a>( 0, name )
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055   <a class="code" href="classNetwork.html#a56daf3677029ca295cfd5208978ffb35">_size</a>     = -1; 
<a name="l00056"></a>00056   <a class="code" href="classNetwork.html#abe0e51c8228a2b087e7510d0bf58be62">_nodes</a>    = -1; 
<a name="l00057"></a>00057   <a class="code" href="classNetwork.html#a22420a8913a2f0ca47ade9a21ca8b3aa">_channels</a> = -1;
<a name="l00058"></a>00058   <a class="code" href="classNetwork.html#a45a90da4c4479d1695e4f92129804c93">_classes</a>  = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;classes&quot;</span>);
<a name="l00059"></a>00059 }
<a name="l00060"></a>00060 
<a name="l00061"></a>00061 <a class="code" href="classNetwork.html#a7a4e19cdb4bf0c7ecf82baa643831492">Network::~Network</a>( )
<a name="l00062"></a>00062 {
<a name="l00063"></a>00063   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> r = 0; r &lt; <a class="code" href="classNetwork.html#a56daf3677029ca295cfd5208978ffb35">_size</a>; ++r ) {
<a name="l00064"></a>00064     <span class="keywordflow">if</span> ( <a class="code" href="classNetwork.html#a0a8954720a663b1e3bf345b675c193a8">_routers</a>[r] ) <span class="keyword">delete</span> <a class="code" href="classNetwork.html#a0a8954720a663b1e3bf345b675c193a8">_routers</a>[r];
<a name="l00065"></a>00065   }
<a name="l00066"></a>00066   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> s = 0; s &lt; <a class="code" href="classNetwork.html#abe0e51c8228a2b087e7510d0bf58be62">_nodes</a>; ++s ) {
<a name="l00067"></a>00067     <span class="keywordflow">if</span> ( <a class="code" href="classNetwork.html#aaf7264c1c2799f5d124a6465a8b1d1a7">_inject</a>[s] ) <span class="keyword">delete</span> <a class="code" href="classNetwork.html#aaf7264c1c2799f5d124a6465a8b1d1a7">_inject</a>[s];
<a name="l00068"></a>00068     <span class="keywordflow">if</span> ( <a class="code" href="classNetwork.html#a96784b21ef9427a7ad929360c76655af">_inject_cred</a>[s] ) <span class="keyword">delete</span> <a class="code" href="classNetwork.html#a96784b21ef9427a7ad929360c76655af">_inject_cred</a>[s];
<a name="l00069"></a>00069   }
<a name="l00070"></a>00070   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> d = 0; d &lt; _nodes; ++d ) {
<a name="l00071"></a>00071     <span class="keywordflow">if</span> ( <a class="code" href="classNetwork.html#a7989751e88c72dd50d3338c00e75b3a3">_eject</a>[d] ) <span class="keyword">delete</span> <a class="code" href="classNetwork.html#a7989751e88c72dd50d3338c00e75b3a3">_eject</a>[d];
<a name="l00072"></a>00072     <span class="keywordflow">if</span> ( <a class="code" href="classNetwork.html#a5c1cb580f89433cf57ffeb777e888554">_eject_cred</a>[d] ) <span class="keyword">delete</span> <a class="code" href="classNetwork.html#a5c1cb580f89433cf57ffeb777e888554">_eject_cred</a>[d];
<a name="l00073"></a>00073   }
<a name="l00074"></a>00074   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> c = 0; c &lt; <a class="code" href="classNetwork.html#a22420a8913a2f0ca47ade9a21ca8b3aa">_channels</a>; ++c ) {
<a name="l00075"></a>00075     <span class="keywordflow">if</span> ( <a class="code" href="classNetwork.html#a3f899622f7411eec1ac0ddd00e6ee819">_chan</a>[c] ) <span class="keyword">delete</span> <a class="code" href="classNetwork.html#a3f899622f7411eec1ac0ddd00e6ee819">_chan</a>[c];
<a name="l00076"></a>00076     <span class="keywordflow">if</span> ( <a class="code" href="classNetwork.html#aa56aa08c3897e0fa5c9d2f3be3fd5416">_chan_cred</a>[c] ) <span class="keyword">delete</span> <a class="code" href="classNetwork.html#aa56aa08c3897e0fa5c9d2f3be3fd5416">_chan_cred</a>[c];
<a name="l00077"></a>00077   }
<a name="l00078"></a>00078 }
<a name="l00079"></a>00079 
<a name="l00080"></a><a class="code" href="classNetwork.html#a03fed00ad801a375bc4909e6e72d8bff">00080</a> <a class="code" href="classNetwork.html">Network</a> * <a class="code" href="classNetwork.html#a03fed00ad801a375bc4909e6e72d8bff">Network::New</a>(<span class="keyword">const</span> <a class="code" href="classConfiguration.html">Configuration</a> &amp; config, <span class="keyword">const</span> <span class="keywordtype">string</span> &amp; name)
<a name="l00081"></a>00081 {
<a name="l00082"></a>00082   <span class="keyword">const</span> <span class="keywordtype">string</span> topo = config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>( <span class="stringliteral">&quot;topology&quot;</span> );
<a name="l00083"></a>00083   <a class="code" href="classNetwork.html">Network</a> * <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> = NULL;
<a name="l00084"></a>00084   <span class="keywordflow">if</span> ( topo == <span class="stringliteral">&quot;torus&quot;</span> ) {
<a name="l00085"></a>00085     <a class="code" href="classKNCube.html#a2279a25151b5173b4601ae2d8f5a7c79">KNCube::RegisterRoutingFunctions</a>() ;
<a name="l00086"></a>00086     n = <span class="keyword">new</span> <a class="code" href="classKNCube.html">KNCube</a>( config, name, <span class="keyword">false</span> );
<a name="l00087"></a>00087   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( topo == <span class="stringliteral">&quot;mesh&quot;</span> ) {
<a name="l00088"></a>00088     <a class="code" href="classKNCube.html#a2279a25151b5173b4601ae2d8f5a7c79">KNCube::RegisterRoutingFunctions</a>() ;
<a name="l00089"></a>00089     n = <span class="keyword">new</span> <a class="code" href="classKNCube.html">KNCube</a>( config, name, <span class="keyword">true</span> );
<a name="l00090"></a>00090   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( topo == <span class="stringliteral">&quot;cmesh&quot;</span> ) {
<a name="l00091"></a>00091     <a class="code" href="classCMesh.html#a8536dc55e9b2f206ec3e2f1440b67d28">CMesh::RegisterRoutingFunctions</a>() ;
<a name="l00092"></a>00092     n = <span class="keyword">new</span> <a class="code" href="classCMesh.html">CMesh</a>( config, name );
<a name="l00093"></a>00093   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( topo == <span class="stringliteral">&quot;fly&quot;</span> ) {
<a name="l00094"></a>00094     <a class="code" href="classKNFly.html#a8d51c4c017a8a4af020e082f279972ab">KNFly::RegisterRoutingFunctions</a>() ;
<a name="l00095"></a>00095     n = <span class="keyword">new</span> <a class="code" href="classKNFly.html">KNFly</a>( config, name );
<a name="l00096"></a>00096   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( topo == <span class="stringliteral">&quot;qtree&quot;</span> ) {
<a name="l00097"></a>00097     <a class="code" href="classQTree.html#a6b4a11e108ef2f097bc160491b58ee87">QTree::RegisterRoutingFunctions</a>() ;
<a name="l00098"></a>00098     n = <span class="keyword">new</span> <a class="code" href="classQTree.html">QTree</a>( config, name );
<a name="l00099"></a>00099   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( topo == <span class="stringliteral">&quot;tree4&quot;</span> ) {
<a name="l00100"></a>00100     <a class="code" href="classTree4.html#a5a2e45945e37b529b6412738adee68d8">Tree4::RegisterRoutingFunctions</a>() ;
<a name="l00101"></a>00101     n = <span class="keyword">new</span> <a class="code" href="classTree4.html">Tree4</a>( config, name );
<a name="l00102"></a>00102   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( topo == <span class="stringliteral">&quot;fattree&quot;</span> ) {
<a name="l00103"></a>00103     <a class="code" href="classFatTree.html#acd4e82883eca6b749d0c7ab10afec0bd">FatTree::RegisterRoutingFunctions</a>() ;
<a name="l00104"></a>00104     n = <span class="keyword">new</span> <a class="code" href="classFatTree.html">FatTree</a>( config, name );
<a name="l00105"></a>00105   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( topo == <span class="stringliteral">&quot;flatfly&quot;</span> ) {
<a name="l00106"></a>00106     <a class="code" href="classFlatFlyOnChip.html#a9bd6fccf7f6b6612cc8724a4c960faf9">FlatFlyOnChip::RegisterRoutingFunctions</a>() ;
<a name="l00107"></a>00107     n = <span class="keyword">new</span> <a class="code" href="classFlatFlyOnChip.html">FlatFlyOnChip</a>( config, name );
<a name="l00108"></a>00108   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( topo == <span class="stringliteral">&quot;anynet&quot;</span>){
<a name="l00109"></a>00109     <a class="code" href="classAnyNet.html#aa41898434b8333f791460b49048bd546">AnyNet::RegisterRoutingFunctions</a>() ;
<a name="l00110"></a>00110     n = <span class="keyword">new</span> <a class="code" href="classAnyNet.html">AnyNet</a>(config, name);
<a name="l00111"></a>00111   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( topo == <span class="stringliteral">&quot;dragonflynew&quot;</span>){
<a name="l00112"></a>00112     <a class="code" href="classDragonFlyNew.html#ae6e95638a5299298548a865d4c7b14a2">DragonFlyNew::RegisterRoutingFunctions</a>() ;
<a name="l00113"></a>00113     n = <span class="keyword">new</span> <a class="code" href="classDragonFlyNew.html">DragonFlyNew</a>(config, name);
<a name="l00114"></a>00114   } <span class="keywordflow">else</span> {
<a name="l00115"></a>00115     cerr &lt;&lt; <span class="stringliteral">&quot;Unknown topology: &quot;</span> &lt;&lt; topo &lt;&lt; endl;
<a name="l00116"></a>00116   }
<a name="l00117"></a>00117   
<a name="l00118"></a>00118   <span class="comment">/*legacy code that insert random faults in the networks</span>
<a name="l00119"></a>00119 <span class="comment">   *not sure how to use this</span>
<a name="l00120"></a>00120 <span class="comment">   */</span>
<a name="l00121"></a>00121   <span class="keywordflow">if</span> ( n &amp;&amp; ( config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>( <span class="stringliteral">&quot;link_failures&quot;</span> ) &gt; 0 ) ) {
<a name="l00122"></a>00122     n-&gt;<a class="code" href="classNetwork.html#abf4dfbd8ac6e30fd510087a476fa5c0d">InsertRandomFaults</a>( config );
<a name="l00123"></a>00123   }
<a name="l00124"></a>00124   <span class="keywordflow">return</span> n;
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127 <span class="keywordtype">void</span> <a class="code" href="classNetwork.html#ab384d48c72bae0e48f5efd3f7065399f">Network::_Alloc</a>( )
<a name="l00128"></a>00128 {
<a name="l00129"></a>00129   assert( ( _size != -1 ) &amp;&amp; 
<a name="l00130"></a>00130       ( _nodes != -1 ) &amp;&amp; 
<a name="l00131"></a>00131       ( _channels != -1 ) );
<a name="l00132"></a>00132 
<a name="l00133"></a>00133   <a class="code" href="classNetwork.html#a0a8954720a663b1e3bf345b675c193a8">_routers</a>.resize(_size);
<a name="l00134"></a>00134   <a class="code" href="network_8cpp.html#a80c1fabb28e8cab3a93b41ff8465f625">gNodes</a> = _nodes;
<a name="l00135"></a>00135 
<a name="l00136"></a>00136   <span class="comment">/*booksim used arrays of flits as the channels which makes have capacity of</span>
<a name="l00137"></a>00137 <span class="comment">   *one. To simulate channel latency, flitchannel class has been added</span>
<a name="l00138"></a>00138 <span class="comment">   *which are fifos with depth = channel latency and each cycle the channel</span>
<a name="l00139"></a>00139 <span class="comment">   *shifts by one</span>
<a name="l00140"></a>00140 <span class="comment">   *credit channels are the necessary counter part</span>
<a name="l00141"></a>00141 <span class="comment">   */</span>
<a name="l00142"></a>00142   <a class="code" href="classNetwork.html#aaf7264c1c2799f5d124a6465a8b1d1a7">_inject</a>.resize(_nodes);
<a name="l00143"></a>00143   <a class="code" href="classNetwork.html#a96784b21ef9427a7ad929360c76655af">_inject_cred</a>.resize(_nodes);
<a name="l00144"></a>00144   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> s = 0; s &lt; _nodes; ++s ) {
<a name="l00145"></a>00145     ostringstream name;
<a name="l00146"></a>00146     name &lt;&lt; <a class="code" href="classModule.html#ababdfe2adbbb2eee3b91a40859b9f641">Name</a>() &lt;&lt; <span class="stringliteral">&quot;_fchan_ingress&quot;</span> &lt;&lt; s;
<a name="l00147"></a>00147     <a class="code" href="classNetwork.html#aaf7264c1c2799f5d124a6465a8b1d1a7">_inject</a>[s] = <span class="keyword">new</span> <a class="code" href="classFlitChannel.html">FlitChannel</a>(<span class="keyword">this</span>, name.str(), <a class="code" href="classNetwork.html#a45a90da4c4479d1695e4f92129804c93">_classes</a>);
<a name="l00148"></a>00148     <a class="code" href="classNetwork.html#aaf7264c1c2799f5d124a6465a8b1d1a7">_inject</a>[s]-&gt;SetSource(NULL, s);
<a name="l00149"></a>00149     <a class="code" href="classNetwork.html#ab4858ae56a0d081d1f44b488b909393b">_timed_modules</a>.push_back(<a class="code" href="classNetwork.html#aaf7264c1c2799f5d124a6465a8b1d1a7">_inject</a>[s]);
<a name="l00150"></a>00150     name.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00151"></a>00151     name &lt;&lt; <a class="code" href="classModule.html#ababdfe2adbbb2eee3b91a40859b9f641">Name</a>() &lt;&lt; <span class="stringliteral">&quot;_cchan_ingress&quot;</span> &lt;&lt; s;
<a name="l00152"></a>00152     <a class="code" href="classNetwork.html#a96784b21ef9427a7ad929360c76655af">_inject_cred</a>[s] = <span class="keyword">new</span> <a class="code" href="_2networks_2network_8hpp.html#a5515cd796c7a0a96461d221288328f5d">CreditChannel</a>(<span class="keyword">this</span>, name.str());
<a name="l00153"></a>00153     <a class="code" href="classNetwork.html#ab4858ae56a0d081d1f44b488b909393b">_timed_modules</a>.push_back(<a class="code" href="classNetwork.html#a96784b21ef9427a7ad929360c76655af">_inject_cred</a>[s]);
<a name="l00154"></a>00154   }
<a name="l00155"></a>00155   <a class="code" href="classNetwork.html#a7989751e88c72dd50d3338c00e75b3a3">_eject</a>.resize(_nodes);
<a name="l00156"></a>00156   <a class="code" href="classNetwork.html#a5c1cb580f89433cf57ffeb777e888554">_eject_cred</a>.resize(_nodes);
<a name="l00157"></a>00157   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> d = 0; d &lt; _nodes; ++d ) {
<a name="l00158"></a>00158     ostringstream name;
<a name="l00159"></a>00159     name &lt;&lt; <a class="code" href="classModule.html#ababdfe2adbbb2eee3b91a40859b9f641">Name</a>() &lt;&lt; <span class="stringliteral">&quot;_fchan_egress&quot;</span> &lt;&lt; d;
<a name="l00160"></a>00160     <a class="code" href="classNetwork.html#a7989751e88c72dd50d3338c00e75b3a3">_eject</a>[d] = <span class="keyword">new</span> <a class="code" href="classFlitChannel.html">FlitChannel</a>(<span class="keyword">this</span>, name.str(), <a class="code" href="classNetwork.html#a45a90da4c4479d1695e4f92129804c93">_classes</a>);
<a name="l00161"></a>00161     <a class="code" href="classNetwork.html#a7989751e88c72dd50d3338c00e75b3a3">_eject</a>[d]-&gt;SetSink(NULL, d);
<a name="l00162"></a>00162     <a class="code" href="classNetwork.html#ab4858ae56a0d081d1f44b488b909393b">_timed_modules</a>.push_back(<a class="code" href="classNetwork.html#a7989751e88c72dd50d3338c00e75b3a3">_eject</a>[d]);
<a name="l00163"></a>00163     name.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00164"></a>00164     name &lt;&lt; <a class="code" href="classModule.html#ababdfe2adbbb2eee3b91a40859b9f641">Name</a>() &lt;&lt; <span class="stringliteral">&quot;_cchan_egress&quot;</span> &lt;&lt; d;
<a name="l00165"></a>00165     <a class="code" href="classNetwork.html#a5c1cb580f89433cf57ffeb777e888554">_eject_cred</a>[d] = <span class="keyword">new</span> <a class="code" href="_2networks_2network_8hpp.html#a5515cd796c7a0a96461d221288328f5d">CreditChannel</a>(<span class="keyword">this</span>, name.str());
<a name="l00166"></a>00166     <a class="code" href="classNetwork.html#ab4858ae56a0d081d1f44b488b909393b">_timed_modules</a>.push_back(<a class="code" href="classNetwork.html#a5c1cb580f89433cf57ffeb777e888554">_eject_cred</a>[d]);
<a name="l00167"></a>00167   }
<a name="l00168"></a>00168   <a class="code" href="classNetwork.html#a3f899622f7411eec1ac0ddd00e6ee819">_chan</a>.resize(_channels);
<a name="l00169"></a>00169   <a class="code" href="classNetwork.html#aa56aa08c3897e0fa5c9d2f3be3fd5416">_chan_cred</a>.resize(_channels);
<a name="l00170"></a>00170   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> c = 0; c &lt; _channels; ++c ) {
<a name="l00171"></a>00171     ostringstream name;
<a name="l00172"></a>00172     name &lt;&lt; <a class="code" href="classModule.html#ababdfe2adbbb2eee3b91a40859b9f641">Name</a>() &lt;&lt; <span class="stringliteral">&quot;_fchan_&quot;</span> &lt;&lt; c;
<a name="l00173"></a>00173     <a class="code" href="classNetwork.html#a3f899622f7411eec1ac0ddd00e6ee819">_chan</a>[c] = <span class="keyword">new</span> <a class="code" href="classFlitChannel.html">FlitChannel</a>(<span class="keyword">this</span>, name.str(), <a class="code" href="classNetwork.html#a45a90da4c4479d1695e4f92129804c93">_classes</a>);
<a name="l00174"></a>00174     <a class="code" href="classNetwork.html#ab4858ae56a0d081d1f44b488b909393b">_timed_modules</a>.push_back(<a class="code" href="classNetwork.html#a3f899622f7411eec1ac0ddd00e6ee819">_chan</a>[c]);
<a name="l00175"></a>00175     name.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00176"></a>00176     name &lt;&lt; <a class="code" href="classModule.html#ababdfe2adbbb2eee3b91a40859b9f641">Name</a>() &lt;&lt; <span class="stringliteral">&quot;_cchan_&quot;</span> &lt;&lt; c;
<a name="l00177"></a>00177     <a class="code" href="classNetwork.html#aa56aa08c3897e0fa5c9d2f3be3fd5416">_chan_cred</a>[c] = <span class="keyword">new</span> <a class="code" href="_2networks_2network_8hpp.html#a5515cd796c7a0a96461d221288328f5d">CreditChannel</a>(<span class="keyword">this</span>, name.str());
<a name="l00178"></a>00178     <a class="code" href="classNetwork.html#ab4858ae56a0d081d1f44b488b909393b">_timed_modules</a>.push_back(<a class="code" href="classNetwork.html#aa56aa08c3897e0fa5c9d2f3be3fd5416">_chan_cred</a>[c]);
<a name="l00179"></a>00179   }
<a name="l00180"></a>00180 }
<a name="l00181"></a>00181 
<a name="l00182"></a>00182 <span class="keywordtype">void</span> <a class="code" href="classNetwork.html#afdb3b2cb6e0270fbd6b7acf5f5e4b28e">Network::ReadInputs</a>( )
<a name="l00183"></a>00183 {
<a name="l00184"></a>00184   <span class="keywordflow">for</span>(deque&lt;TimedModule *&gt;::const_iterator iter = <a class="code" href="classNetwork.html#ab4858ae56a0d081d1f44b488b909393b">_timed_modules</a>.begin();
<a name="l00185"></a>00185       iter != <a class="code" href="classNetwork.html#ab4858ae56a0d081d1f44b488b909393b">_timed_modules</a>.end();
<a name="l00186"></a>00186       ++iter) {
<a name="l00187"></a>00187     (*iter)-&gt;ReadInputs( );
<a name="l00188"></a>00188   }
<a name="l00189"></a>00189 }
<a name="l00190"></a>00190 
<a name="l00191"></a><a class="code" href="classNetwork.html#a7c07ce3ba986fa4ece480d69e77bc306">00191</a> <span class="keywordtype">void</span> <a class="code" href="classNetwork.html#a7c07ce3ba986fa4ece480d69e77bc306">Network::Evaluate</a>( )
<a name="l00192"></a>00192 {
<a name="l00193"></a>00193   <span class="keywordflow">for</span>(deque&lt;TimedModule *&gt;::const_iterator iter = <a class="code" href="classNetwork.html#ab4858ae56a0d081d1f44b488b909393b">_timed_modules</a>.begin();
<a name="l00194"></a>00194       iter != <a class="code" href="classNetwork.html#ab4858ae56a0d081d1f44b488b909393b">_timed_modules</a>.end();
<a name="l00195"></a>00195       ++iter) {
<a name="l00196"></a>00196     (*iter)-&gt;Evaluate( );
<a name="l00197"></a>00197   }
<a name="l00198"></a>00198 }
<a name="l00199"></a>00199 
<a name="l00200"></a>00200 <span class="keywordtype">void</span> <a class="code" href="classNetwork.html#a263b74ad4788388f53820a69633f0e24">Network::WriteOutputs</a>( )
<a name="l00201"></a>00201 {
<a name="l00202"></a>00202   <span class="keywordflow">for</span>(deque&lt;TimedModule *&gt;::const_iterator iter = <a class="code" href="classNetwork.html#ab4858ae56a0d081d1f44b488b909393b">_timed_modules</a>.begin();
<a name="l00203"></a>00203       iter != <a class="code" href="classNetwork.html#ab4858ae56a0d081d1f44b488b909393b">_timed_modules</a>.end();
<a name="l00204"></a>00204       ++iter) {
<a name="l00205"></a>00205     (*iter)-&gt;WriteOutputs( );
<a name="l00206"></a>00206   }
<a name="l00207"></a>00207 }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209 <span class="keywordtype">void</span> <a class="code" href="classNetwork.html#a6ae45fa6d6fb4a0c8bdd7f31436ead11">Network::WriteFlit</a>( <a class="code" href="structFlit.html">Flit</a> *f, <span class="keywordtype">int</span> source )
<a name="l00210"></a>00210 {
<a name="l00211"></a>00211   assert( ( source &gt;= 0 ) &amp;&amp; ( source &lt; _nodes ) );
<a name="l00212"></a>00212   <a class="code" href="classNetwork.html#aaf7264c1c2799f5d124a6465a8b1d1a7">_inject</a>[source]-&gt;Send(f);
<a name="l00213"></a>00213 }
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 <a class="code" href="structFlit.html">Flit</a> *<a class="code" href="classNetwork.html#abfe9bacf0de4b89c0f5d05b93bf11471">Network::ReadFlit</a>( <span class="keywordtype">int</span> dest )
<a name="l00216"></a>00216 {
<a name="l00217"></a>00217   assert( ( dest &gt;= 0 ) &amp;&amp; ( dest &lt; _nodes ) );
<a name="l00218"></a>00218   <span class="keywordflow">return</span> <a class="code" href="classNetwork.html#a7989751e88c72dd50d3338c00e75b3a3">_eject</a>[dest]-&gt;Receive();
<a name="l00219"></a>00219 }
<a name="l00220"></a>00220 
<a name="l00221"></a>00221 <span class="keywordtype">void</span> <a class="code" href="classNetwork.html#a29ed2215fd1bb54fa20e9429804a460f">Network::WriteCredit</a>( <a class="code" href="classCredit.html">Credit</a> *c, <span class="keywordtype">int</span> dest )
<a name="l00222"></a>00222 {
<a name="l00223"></a>00223   assert( ( dest &gt;= 0 ) &amp;&amp; ( dest &lt; _nodes ) );
<a name="l00224"></a>00224   <a class="code" href="classNetwork.html#a5c1cb580f89433cf57ffeb777e888554">_eject_cred</a>[dest]-&gt;Send(c);
<a name="l00225"></a>00225 }
<a name="l00226"></a>00226 
<a name="l00227"></a>00227 <a class="code" href="classCredit.html">Credit</a> *<a class="code" href="classNetwork.html#a785ec4155e91008c7e0ade24d86536ca">Network::ReadCredit</a>( <span class="keywordtype">int</span> source )
<a name="l00228"></a>00228 {
<a name="l00229"></a>00229   assert( ( source &gt;= 0 ) &amp;&amp; ( source &lt; _nodes ) );
<a name="l00230"></a>00230   <span class="keywordflow">return</span> <a class="code" href="classNetwork.html#a96784b21ef9427a7ad929360c76655af">_inject_cred</a>[source]-&gt;Receive();
<a name="l00231"></a>00231 }
<a name="l00232"></a>00232 
<a name="l00233"></a>00233 <span class="keywordtype">void</span> <a class="code" href="classNetwork.html#abf4dfbd8ac6e30fd510087a476fa5c0d">Network::InsertRandomFaults</a>( <span class="keyword">const</span> <a class="code" href="classConfiguration.html">Configuration</a> &amp;config )
<a name="l00234"></a>00234 {
<a name="l00235"></a>00235   <a class="code" href="classModule.html#acfa9d0dc518853045e0d2356d138717f">Error</a>( <span class="stringliteral">&quot;InsertRandomFaults not implemented for this topology!&quot;</span> );
<a name="l00236"></a>00236 }
<a name="l00237"></a>00237 
<a name="l00238"></a>00238 <span class="keywordtype">void</span> <a class="code" href="classNetwork.html#aa958de6d428eeb7216e6f426c45e12cb">Network::OutChannelFault</a>( <span class="keywordtype">int</span> r, <span class="keywordtype">int</span> c, <span class="keywordtype">bool</span> fault )
<a name="l00239"></a>00239 {
<a name="l00240"></a>00240   assert( ( r &gt;= 0 ) &amp;&amp; ( r &lt; _size ) );
<a name="l00241"></a>00241   <a class="code" href="classNetwork.html#a0a8954720a663b1e3bf345b675c193a8">_routers</a>[r]-&gt;<a class="code" href="classRouter.html#a594c2d03b2d96895cb9f724653426a2c">OutChannelFault</a>( c, fault );
<a name="l00242"></a>00242 }
<a name="l00243"></a>00243 
<a name="l00244"></a>00244 <span class="keywordtype">double</span> <a class="code" href="classNetwork.html#a0fb43ebc83aa75aba1f0d3c33cdedeee">Network::Capacity</a>( )<span class="keyword"> const</span>
<a name="l00245"></a>00245 <span class="keyword"></span>{
<a name="l00246"></a>00246   <span class="keywordflow">return</span> 1.0;
<a name="l00247"></a>00247 }
<a name="l00248"></a>00248 
<a name="l00249"></a>00249 <span class="comment">/* this function can be heavily modified to display any information</span>
<a name="l00250"></a>00250 <span class="comment"> * neceesary of the network, by default, call display on each router</span>
<a name="l00251"></a>00251 <span class="comment"> * and display the channel utilization rate</span>
<a name="l00252"></a>00252 <span class="comment"> */</span>
<a name="l00253"></a><a class="code" href="classNetwork.html#af0f01363a5576c94948b3c533ad39ed1">00253</a> <span class="keywordtype">void</span> <a class="code" href="classNetwork.html#a0254df99f73eaa3f355bf1f45a7626b4">Network::Display</a>( ostream &amp; os )<span class="keyword"> const</span>
<a name="l00254"></a>00254 <span class="keyword"></span>{
<a name="l00255"></a>00255   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> r = 0; r &lt; _size; ++r ) {
<a name="l00256"></a>00256     <a class="code" href="classNetwork.html#a0a8954720a663b1e3bf345b675c193a8">_routers</a>[r]-&gt;<a class="code" href="classModule.html#a5b60d01e0acb197d8da540e1fc7c385f">Display</a>( os );
<a name="l00257"></a>00257   }
<a name="l00258"></a>00258 }
<a name="l00259"></a>00259 
<a name="l00260"></a><a class="code" href="classNetwork.html#a69cb379eb6fee9462fe9faab8622d3a0">00260</a> <span class="keywordtype">void</span> <a class="code" href="classNetwork.html#a69cb379eb6fee9462fe9faab8622d3a0">Network::DumpChannelMap</a>( ostream &amp; os, <span class="keywordtype">string</span> <span class="keyword">const</span> &amp; prefix )<span class="keyword"> const</span>
<a name="l00261"></a>00261 <span class="keyword"></span>{
<a name="l00262"></a>00262   os &lt;&lt; prefix &lt;&lt; <span class="stringliteral">&quot;source_router,source_port,dest_router,dest_port&quot;</span> &lt;&lt; endl;
<a name="l00263"></a>00263   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; _nodes; ++c)
<a name="l00264"></a>00264     os &lt;&lt; prefix
<a name="l00265"></a>00265        &lt;&lt; <span class="stringliteral">&quot;-1,&quot;</span> 
<a name="l00266"></a>00266        &lt;&lt; <a class="code" href="classNetwork.html#aaf7264c1c2799f5d124a6465a8b1d1a7">_inject</a>[c]-&gt;GetSourcePort() &lt;&lt; <span class="charliteral">&apos;,&apos;</span> 
<a name="l00267"></a>00267        &lt;&lt; <a class="code" href="classNetwork.html#aaf7264c1c2799f5d124a6465a8b1d1a7">_inject</a>[c]-&gt;GetSink()-&gt;GetID() &lt;&lt; <span class="charliteral">&apos;,&apos;</span> 
<a name="l00268"></a>00268        &lt;&lt; <a class="code" href="classNetwork.html#aaf7264c1c2799f5d124a6465a8b1d1a7">_inject</a>[c]-&gt;GetSinkPort() &lt;&lt; endl;
<a name="l00269"></a>00269   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; _channels; ++c)
<a name="l00270"></a>00270     os &lt;&lt; prefix
<a name="l00271"></a>00271        &lt;&lt; <a class="code" href="classNetwork.html#a3f899622f7411eec1ac0ddd00e6ee819">_chan</a>[c]-&gt;GetSource()-&gt;GetID() &lt;&lt; <span class="charliteral">&apos;,&apos;</span> 
<a name="l00272"></a>00272        &lt;&lt; <a class="code" href="classNetwork.html#a3f899622f7411eec1ac0ddd00e6ee819">_chan</a>[c]-&gt;GetSourcePort() &lt;&lt; <span class="charliteral">&apos;,&apos;</span> 
<a name="l00273"></a>00273        &lt;&lt; <a class="code" href="classNetwork.html#a3f899622f7411eec1ac0ddd00e6ee819">_chan</a>[c]-&gt;GetSink()-&gt;GetID() &lt;&lt; <span class="charliteral">&apos;,&apos;</span> 
<a name="l00274"></a>00274        &lt;&lt; <a class="code" href="classNetwork.html#a3f899622f7411eec1ac0ddd00e6ee819">_chan</a>[c]-&gt;GetSinkPort() &lt;&lt; endl;
<a name="l00275"></a>00275   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; _nodes; ++c)
<a name="l00276"></a>00276     os &lt;&lt; prefix
<a name="l00277"></a>00277        &lt;&lt; <a class="code" href="classNetwork.html#a7989751e88c72dd50d3338c00e75b3a3">_eject</a>[c]-&gt;GetSource()-&gt;GetID() &lt;&lt; <span class="charliteral">&apos;,&apos;</span> 
<a name="l00278"></a>00278        &lt;&lt; <a class="code" href="classNetwork.html#a7989751e88c72dd50d3338c00e75b3a3">_eject</a>[c]-&gt;GetSourcePort() &lt;&lt; <span class="charliteral">&apos;,&apos;</span> 
<a name="l00279"></a>00279        &lt;&lt; <span class="stringliteral">&quot;-1,&quot;</span> 
<a name="l00280"></a>00280        &lt;&lt; <a class="code" href="classNetwork.html#a7989751e88c72dd50d3338c00e75b3a3">_eject</a>[c]-&gt;GetSinkPort() &lt;&lt; endl;
<a name="l00281"></a>00281 }
<a name="l00282"></a>00282 
<a name="l00283"></a><a class="code" href="classNetwork.html#a920e6567587981e1ecd5f666eb597349">00283</a> <span class="keywordtype">void</span> <a class="code" href="classNetwork.html#a920e6567587981e1ecd5f666eb597349">Network::DumpNodeMap</a>( ostream &amp; os, <span class="keywordtype">string</span> <span class="keyword">const</span> &amp; prefix )<span class="keyword"> const</span>
<a name="l00284"></a>00284 <span class="keyword"></span>{
<a name="l00285"></a>00285   os &lt;&lt; prefix &lt;&lt; <span class="stringliteral">&quot;source_router,dest_router&quot;</span> &lt;&lt; endl;
<a name="l00286"></a>00286   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s = 0; s &lt; _nodes; ++s)
<a name="l00287"></a>00287     os &lt;&lt; prefix
<a name="l00288"></a>00288        &lt;&lt; <a class="code" href="classNetwork.html#a7989751e88c72dd50d3338c00e75b3a3">_eject</a>[s]-&gt;GetSource()-&gt;GetID() &lt;&lt; <span class="charliteral">&apos;,&apos;</span>
<a name="l00289"></a>00289        &lt;&lt; <a class="code" href="classNetwork.html#aaf7264c1c2799f5d124a6465a8b1d1a7">_inject</a>[s]-&gt;GetSink()-&gt;GetID() &lt;&lt; endl;
<a name="l00290"></a>00290 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 13 May 2014 for GPGPU-Sim by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
