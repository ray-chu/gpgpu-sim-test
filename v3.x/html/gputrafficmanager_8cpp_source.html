<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GPGPU-Sim: v3.x/src/intersim2/gputrafficmanager.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_c934b74ccb33d6b9bfd1e576787940d8.html">v3.x</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_da58ad9beee6988f697f1a76e412a52a.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_7e44b91c2d8bca2324eb4df0ed8bb374.html">intersim2</a>
  </div>
</div>
<div class="contents">
<h1>gputrafficmanager.cpp</h1><a href="gputrafficmanager_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// Copyright (c) 2009-2013, Tor M. Aamodt, Dongdong Li, Ali Bakhoda</span>
<a name="l00002"></a>00002 <span class="comment">// The University of British Columbia</span>
<a name="l00003"></a>00003 <span class="comment">// All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">// Redistribution and use in source and binary forms, with or without</span>
<a name="l00006"></a>00006 <span class="comment">// modification, are permitted provided that the following conditions are met:</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// Redistributions of source code must retain the above copyright notice, this</span>
<a name="l00009"></a>00009 <span class="comment">// list of conditions and the following disclaimer.</span>
<a name="l00010"></a>00010 <span class="comment">// Redistributions in binary form must reproduce the above copyright notice, this</span>
<a name="l00011"></a>00011 <span class="comment">// list of conditions and the following disclaimer in the documentation and/or</span>
<a name="l00012"></a>00012 <span class="comment">// other materials provided with the distribution.</span>
<a name="l00013"></a>00013 <span class="comment">// Neither the name of The University of British Columbia nor the names of its</span>
<a name="l00014"></a>00014 <span class="comment">// contributors may be used to endorse or promote products derived from this</span>
<a name="l00015"></a>00015 <span class="comment">// software without specific prior written permission.</span>
<a name="l00016"></a>00016 <span class="comment">//</span>
<a name="l00017"></a>00017 <span class="comment">// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND</span>
<a name="l00018"></a>00018 <span class="comment">// ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span>
<a name="l00019"></a>00019 <span class="comment">// WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<a name="l00020"></a>00020 <span class="comment">// DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE</span>
<a name="l00021"></a>00021 <span class="comment">// FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<a name="l00022"></a>00022 <span class="comment">// DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<a name="l00023"></a>00023 <span class="comment">// SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<a name="l00024"></a>00024 <span class="comment">// CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
<a name="l00025"></a>00025 <span class="comment">// OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00026"></a>00026 <span class="comment">// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;limits&gt;</span> 
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="preprocessor">#include &quot;<a class="code" href="gputrafficmanager_8hpp.html">gputrafficmanager.hpp</a>&quot;</span>
<a name="l00033"></a>00033 <span class="preprocessor">#include &quot;<a class="code" href="interconnect__interface_8hpp.html">interconnect_interface.hpp</a>&quot;</span>
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="globals_8hpp.html">globals.hpp</a>&quot;</span>
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="classGPUTrafficManager.html#a935b1823164401e61d8e82fab4c8ddfc">00037</a> <a class="code" href="classGPUTrafficManager.html#a935b1823164401e61d8e82fab4c8ddfc">GPUTrafficManager::GPUTrafficManager</a>( <span class="keyword">const</span> <a class="code" href="classConfiguration.html">Configuration</a> &amp;config, <span class="keyword">const</span> vector&lt;Network *&gt; &amp;net)
<a name="l00038"></a>00038 :<a class="code" href="classTrafficManager.html">TrafficManager</a>(config, net)
<a name="l00039"></a>00039 {
<a name="l00040"></a>00040   <span class="comment">// The total simulations equal to number of kernels</span>
<a name="l00041"></a>00041   <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> = 0;
<a name="l00042"></a>00042   
<a name="l00043"></a>00043   <a class="code" href="classGPUTrafficManager.html#a19ac7a6c5e1be84c2a31530b900c0d58">_input_queue</a>.resize(<a class="code" href="classTrafficManager.html#adf0cc5d3d2377007a9471f73b1cf137a">_subnets</a>);
<a name="l00044"></a>00044   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> subnet = 0; subnet &lt; <a class="code" href="classTrafficManager.html#adf0cc5d3d2377007a9471f73b1cf137a">_subnets</a>; ++subnet) {
<a name="l00045"></a>00045     <a class="code" href="classGPUTrafficManager.html#a19ac7a6c5e1be84c2a31530b900c0d58">_input_queue</a>[subnet].resize(<a class="code" href="classTrafficManager.html#a61ed65da53f0d0dac14cdf619e2d95af">_nodes</a>);
<a name="l00046"></a>00046     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> node = 0; node &lt; <a class="code" href="classTrafficManager.html#a61ed65da53f0d0dac14cdf619e2d95af">_nodes</a>; ++node ) {
<a name="l00047"></a>00047       <a class="code" href="classGPUTrafficManager.html#a19ac7a6c5e1be84c2a31530b900c0d58">_input_queue</a>[subnet][node].resize(<a class="code" href="classTrafficManager.html#a9394ae83257275a40a9e1b62eb3a6247">_classes</a>);
<a name="l00048"></a>00048     }
<a name="l00049"></a>00049   }
<a name="l00050"></a>00050 }
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="classGPUTrafficManager.html#a7d35cc9fe087b2734a6292efa1e0cda8">00052</a> <a class="code" href="classGPUTrafficManager.html#a7d35cc9fe087b2734a6292efa1e0cda8">GPUTrafficManager::~GPUTrafficManager</a>()
<a name="l00053"></a>00053 {
<a name="l00054"></a>00054 }
<a name="l00055"></a>00055 
<a name="l00056"></a><a class="code" href="classGPUTrafficManager.html#a847cc14a9dd2a2fe033f0d5c3960281e">00056</a> <span class="keywordtype">void</span> <a class="code" href="classGPUTrafficManager.html#a847cc14a9dd2a2fe033f0d5c3960281e">GPUTrafficManager::Init</a>()
<a name="l00057"></a>00057 {
<a name="l00058"></a>00058   <a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a> = 0;
<a name="l00059"></a>00059   <a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> = <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a45cd3e451a01f617c16a995cb7c6c9ac">running</a>;
<a name="l00060"></a>00060   <a class="code" href="classTrafficManager.html#a4c41f2d968cd1a84e4cc63dc32fb7d88">_ClearStats</a>( );
<a name="l00061"></a>00061   
<a name="l00062"></a>00062 }
<a name="l00063"></a>00063 
<a name="l00064"></a><a class="code" href="classGPUTrafficManager.html#ac7932e4da1eb3c786c69e1d1941ffeba">00064</a> <span class="keywordtype">void</span> <a class="code" href="classGPUTrafficManager.html#ac7932e4da1eb3c786c69e1d1941ffeba">GPUTrafficManager::_RetireFlit</a>( <a class="code" href="structFlit.html">Flit</a> *f, <span class="keywordtype">int</span> dest )
<a name="l00065"></a>00065 {
<a name="l00066"></a>00066   <a class="code" href="classTrafficManager.html#ab18f0d948c1a197663dee3c75429b9c8">_deadlock_timer</a> = 0;
<a name="l00067"></a>00067   
<a name="l00068"></a>00068   assert(<a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].count(f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>) &gt; 0);
<a name="l00069"></a>00069   <a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].erase(f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>);
<a name="l00070"></a>00070   
<a name="l00071"></a>00071   <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#a1fe2bb19983ae1ada717e13cd27efd3b">record</a>) {
<a name="l00072"></a>00072     assert(<a class="code" href="classTrafficManager.html#ab3f440b8929d778298a078fff4fe492f">_measured_in_flight_flits</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].count(f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>) &gt; 0);
<a name="l00073"></a>00073     <a class="code" href="classTrafficManager.html#ab3f440b8929d778298a078fff4fe492f">_measured_in_flight_flits</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].erase(f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>);
<a name="l00074"></a>00074   }
<a name="l00075"></a>00075   
<a name="l00076"></a>00076   <span class="keywordflow">if</span> ( f-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a> ) {
<a name="l00077"></a>00077     *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00078"></a>00078     &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; dest &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00079"></a>00079     &lt;&lt; <span class="stringliteral">&quot;Retiring flit &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l00080"></a>00080     &lt;&lt; <span class="stringliteral">&quot; (packet &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a8e105235b0116073df1d2d133f68c12a">pid</a>
<a name="l00081"></a>00081     &lt;&lt; <span class="stringliteral">&quot;, src = &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#afab57916724fd9bd87f2450f571a855f">src</a>
<a name="l00082"></a>00082     &lt;&lt; <span class="stringliteral">&quot;, dest = &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a89d05814b6f9dcd035ec002a7ea00c57">dest</a>
<a name="l00083"></a>00083     &lt;&lt; <span class="stringliteral">&quot;, hops = &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#aef504aeca60e130f76a997b6384ab8c7">hops</a>
<a name="l00084"></a>00084     &lt;&lt; <span class="stringliteral">&quot;, flat = &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - f-&gt;<a class="code" href="structFlit.html#ad021c9f024c254122d90482fafae5b0c">itime</a>
<a name="l00085"></a>00085     &lt;&lt; <span class="stringliteral">&quot;).&quot;</span> &lt;&lt; endl;
<a name="l00086"></a>00086   }
<a name="l00087"></a>00087   
<a name="l00088"></a>00088   <span class="keywordflow">if</span> ( f-&gt;<a class="code" href="structFlit.html#a784a6bcb041646c2b8c068b7de4bdc9a">head</a> &amp;&amp; ( f-&gt;<a class="code" href="structFlit.html#a89d05814b6f9dcd035ec002a7ea00c57">dest</a> != dest ) ) {
<a name="l00089"></a>00089     ostringstream err;
<a name="l00090"></a>00090     err &lt;&lt; <span class="stringliteral">&quot;Flit &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a> &lt;&lt; <span class="stringliteral">&quot; arrived at incorrect output &quot;</span> &lt;&lt; dest;
<a name="l00091"></a>00091     <a class="code" href="classModule.html#acfa9d0dc518853045e0d2356d138717f">Error</a>( err.str( ) );
<a name="l00092"></a>00092   }
<a name="l00093"></a>00093   
<a name="l00094"></a>00094   <span class="keywordflow">if</span>((<a class="code" href="classTrafficManager.html#a4a883d0cafe388d38cbe80a40509a23c">_slowest_flit</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>] &lt; 0) ||
<a name="l00095"></a>00095      (<a class="code" href="classTrafficManager.html#ab435afa5236277ff8d6a1991860cf546">_flat_stats</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>]-&gt;Max() &lt; (f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - f-&gt;<a class="code" href="structFlit.html#ad021c9f024c254122d90482fafae5b0c">itime</a>)))
<a name="l00096"></a>00096     <a class="code" href="classTrafficManager.html#a4a883d0cafe388d38cbe80a40509a23c">_slowest_flit</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>] = f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>;
<a name="l00097"></a>00097   
<a name="l00098"></a>00098   <a class="code" href="classTrafficManager.html#ab435afa5236277ff8d6a1991860cf546">_flat_stats</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>]-&gt;AddSample( f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - f-&gt;<a class="code" href="structFlit.html#ad021c9f024c254122d90482fafae5b0c">itime</a>);
<a name="l00099"></a>00099   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#adf6295f17ea12f4e88790d2debdbc4d5">_pair_stats</a>){
<a name="l00100"></a>00100     <a class="code" href="classTrafficManager.html#a353557bf34f140be9b12f9e92c9f4006">_pair_flat</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>][f-&gt;<a class="code" href="structFlit.html#afab57916724fd9bd87f2450f571a855f">src</a>*<a class="code" href="classTrafficManager.html#a61ed65da53f0d0dac14cdf619e2d95af">_nodes</a>+dest]-&gt;AddSample( f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - f-&gt;<a class="code" href="structFlit.html#ad021c9f024c254122d90482fafae5b0c">itime</a> );
<a name="l00101"></a>00101   }
<a name="l00102"></a>00102   
<a name="l00103"></a>00103   <span class="keywordflow">if</span> ( f-&gt;<a class="code" href="structFlit.html#aa0f32295d57acd313ddf257127b5c850">tail</a> ) {
<a name="l00104"></a>00104     <a class="code" href="structFlit.html">Flit</a> * head;
<a name="l00105"></a>00105     <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#a784a6bcb041646c2b8c068b7de4bdc9a">head</a>) {
<a name="l00106"></a>00106       head = f;
<a name="l00107"></a>00107     } <span class="keywordflow">else</span> {
<a name="l00108"></a>00108       map&lt;int, Flit *&gt;::iterator iter = <a class="code" href="classTrafficManager.html#a66c40be042f5d5b3e5a35a441e4e4e60">_retired_packets</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].find(f-&gt;<a class="code" href="structFlit.html#a8e105235b0116073df1d2d133f68c12a">pid</a>);
<a name="l00109"></a>00109       assert(iter != <a class="code" href="classTrafficManager.html#a66c40be042f5d5b3e5a35a441e4e4e60">_retired_packets</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].end());
<a name="l00110"></a>00110       head = iter-&gt;second;
<a name="l00111"></a>00111       <a class="code" href="classTrafficManager.html#a66c40be042f5d5b3e5a35a441e4e4e60">_retired_packets</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].erase(iter);
<a name="l00112"></a>00112       assert(head-&gt;head);
<a name="l00113"></a>00113       assert(f-&gt;<a class="code" href="structFlit.html#a8e105235b0116073df1d2d133f68c12a">pid</a> == head-&gt;pid);
<a name="l00114"></a>00114     }
<a name="l00115"></a>00115     <span class="keywordflow">if</span> ( f-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a> ) {
<a name="l00116"></a>00116       *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00117"></a>00117       &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; dest &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00118"></a>00118       &lt;&lt; <span class="stringliteral">&quot;Retiring packet &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a8e105235b0116073df1d2d133f68c12a">pid</a>
<a name="l00119"></a>00119       &lt;&lt; <span class="stringliteral">&quot; (plat = &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - head-&gt;<a class="code" href="structFlit.html#a79051233092c355b8d01f2e5914c8eb0">ctime</a>
<a name="l00120"></a>00120       &lt;&lt; <span class="stringliteral">&quot;, nlat = &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - head-&gt;<a class="code" href="structFlit.html#ad021c9f024c254122d90482fafae5b0c">itime</a>
<a name="l00121"></a>00121       &lt;&lt; <span class="stringliteral">&quot;, frag = &quot;</span> &lt;&lt; (f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - head-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a>) - (f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a> - head-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>) <span class="comment">// NB: In the spirit of solving problems using ugly hacks, we compute the packet length by taking advantage of the fact that the IDs of flits within a packet are contiguous.</span>
<a name="l00122"></a>00122       &lt;&lt; <span class="stringliteral">&quot;, src = &quot;</span> &lt;&lt; head-&gt;<a class="code" href="structFlit.html#afab57916724fd9bd87f2450f571a855f">src</a>
<a name="l00123"></a>00123       &lt;&lt; <span class="stringliteral">&quot;, dest = &quot;</span> &lt;&lt; head-&gt;<a class="code" href="structFlit.html#a89d05814b6f9dcd035ec002a7ea00c57">dest</a>
<a name="l00124"></a>00124       &lt;&lt; <span class="stringliteral">&quot;).&quot;</span> &lt;&lt; endl;
<a name="l00125"></a>00125     }
<a name="l00126"></a>00126    
<a name="l00127"></a>00127 <span class="comment">// GPGPUSim: Memory will handle reply, do not need this</span>
<a name="l00128"></a>00128 <span class="preprocessor">#if 0</span>
<a name="l00129"></a>00129 <span class="preprocessor"></span>    <span class="comment">//code the source of request, look carefully, its tricky ;)</span>
<a name="l00130"></a>00130     <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structFlit.html#a4f56cca863f428c79260a517cadc244a">type</a> == <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81ad47b8edbc7a6c26a34d782af584eeab0">Flit::READ_REQUEST</a> || f-&gt;<a class="code" href="structFlit.html#a4f56cca863f428c79260a517cadc244a">type</a> == <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81a74c1c54b3ebc54205b6a3e160ac2d0da">Flit::WRITE_REQUEST</a>) {
<a name="l00131"></a>00131       <a class="code" href="classPacketReplyInfo.html">PacketReplyInfo</a>* rinfo = <a class="code" href="classTrafficManager.html#ae5023ac53f1deb85540abe79a174db26">PacketReplyInfo::New</a>();
<a name="l00132"></a>00132       rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#ad078088b08b123253f9e709a7a7308a2">source</a> = f-&gt;<a class="code" href="structFlit.html#afab57916724fd9bd87f2450f571a855f">src</a>;
<a name="l00133"></a>00133       rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#a36cbf988a3b1035871a18ace110df950">time</a> = f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a>;
<a name="l00134"></a>00134       rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#afa1849fb7eaf4d7d23114dfc625a0636">record</a> = f-&gt;<a class="code" href="structFlit.html#a1fe2bb19983ae1ada717e13cd27efd3b">record</a>;
<a name="l00135"></a>00135       rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#a2e6b5a03ba103ea139fe652943a147d4">type</a> = f-&gt;<a class="code" href="structFlit.html#a4f56cca863f428c79260a517cadc244a">type</a>;
<a name="l00136"></a>00136       <a class="code" href="classTrafficManager.html#ae50acf81b3471ea19042d408d8c326db">_repliesPending</a>[dest].push_back(rinfo);
<a name="l00137"></a>00137     } <span class="keywordflow">else</span> {
<a name="l00138"></a>00138       <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#a4f56cca863f428c79260a517cadc244a">type</a> == <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81a18d4c2af84d9556279434e5134b6c0bf">Flit::READ_REPLY</a> || f-&gt;<a class="code" href="structFlit.html#a4f56cca863f428c79260a517cadc244a">type</a> == <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81ae6c1481b97213d1e4476cbc48d40f615">Flit::WRITE_REPLY</a>  ){
<a name="l00139"></a>00139         <a class="code" href="classTrafficManager.html#a1f014156c3e0c4d7531e3ec9f5204dc0">_requestsOutstanding</a>[dest]--;
<a name="l00140"></a>00140       } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#a4f56cca863f428c79260a517cadc244a">type</a> == <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81ac8c04d812bdd08d5facd1ed16e194bdb">Flit::ANY_TYPE</a>) {
<a name="l00141"></a>00141         <a class="code" href="classTrafficManager.html#a1f014156c3e0c4d7531e3ec9f5204dc0">_requestsOutstanding</a>[f-&gt;<a class="code" href="structFlit.html#afab57916724fd9bd87f2450f571a855f">src</a>]--;
<a name="l00142"></a>00142       }
<a name="l00143"></a>00143       
<a name="l00144"></a>00144     }
<a name="l00145"></a>00145 <span class="preprocessor">#endif</span>
<a name="l00146"></a>00146 <span class="preprocessor"></span>
<a name="l00147"></a>00147     <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#a4f56cca863f428c79260a517cadc244a">type</a> == <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81a18d4c2af84d9556279434e5134b6c0bf">Flit::READ_REPLY</a> || f-&gt;<a class="code" href="structFlit.html#a4f56cca863f428c79260a517cadc244a">type</a> == <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81ae6c1481b97213d1e4476cbc48d40f615">Flit::WRITE_REPLY</a>  ){
<a name="l00148"></a>00148       <a class="code" href="classTrafficManager.html#a1f014156c3e0c4d7531e3ec9f5204dc0">_requestsOutstanding</a>[dest]--;
<a name="l00149"></a>00149     } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#a4f56cca863f428c79260a517cadc244a">type</a> == <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81ac8c04d812bdd08d5facd1ed16e194bdb">Flit::ANY_TYPE</a>) {
<a name="l00150"></a>00150       ostringstream err;
<a name="l00151"></a>00151       err &lt;&lt; <span class="stringliteral">&quot;Flit &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a> &lt;&lt; <span class="stringliteral">&quot; cannot be ANY_TYPE&quot;</span> ;
<a name="l00152"></a>00152       <a class="code" href="classModule.html#acfa9d0dc518853045e0d2356d138717f">Error</a>( err.str( ) );
<a name="l00153"></a>00153     }
<a name="l00154"></a>00154     
<a name="l00155"></a>00155     <span class="comment">// Only record statistics once per packet (at tail)</span>
<a name="l00156"></a>00156     <span class="comment">// and based on the simulation state</span>
<a name="l00157"></a>00157     <span class="keywordflow">if</span> ( ( <a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a0e1683a4848299c524150f6e6c7f6930">warming_up</a> ) || f-&gt;<a class="code" href="structFlit.html#a1fe2bb19983ae1ada717e13cd27efd3b">record</a> ) {
<a name="l00158"></a>00158       
<a name="l00159"></a>00159       <a class="code" href="classTrafficManager.html#ac9385813fa2b42c908cdf532ec9405c6">_hop_stats</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>]-&gt;<a class="code" href="classStats.html#a1812bcfd436f0975ed02f4a2ba2e9acf">AddSample</a>( f-&gt;<a class="code" href="structFlit.html#aef504aeca60e130f76a997b6384ab8c7">hops</a> );
<a name="l00160"></a>00160       
<a name="l00161"></a>00161       <span class="keywordflow">if</span>((<a class="code" href="classTrafficManager.html#abd64d715d45401f6306d9f512d50ae66">_slowest_packet</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>] &lt; 0) ||
<a name="l00162"></a>00162          (<a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>]-&gt;Max() &lt; (f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - head-&gt;<a class="code" href="structFlit.html#ad021c9f024c254122d90482fafae5b0c">itime</a>)))
<a name="l00163"></a>00163         <a class="code" href="classTrafficManager.html#abd64d715d45401f6306d9f512d50ae66">_slowest_packet</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>] = f-&gt;<a class="code" href="structFlit.html#a8e105235b0116073df1d2d133f68c12a">pid</a>;
<a name="l00164"></a>00164       <a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>]-&gt;AddSample( f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - head-&gt;<a class="code" href="structFlit.html#a79051233092c355b8d01f2e5914c8eb0">ctime</a>);
<a name="l00165"></a>00165       <a class="code" href="classTrafficManager.html#a9180e022d85c6388bfd7e58cbfc10b47">_nlat_stats</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>]-&gt;AddSample( f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - head-&gt;<a class="code" href="structFlit.html#ad021c9f024c254122d90482fafae5b0c">itime</a>);
<a name="l00166"></a>00166       <a class="code" href="classTrafficManager.html#a7f160ac254d3ceabd825f1c59f42b179">_frag_stats</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>]-&gt;AddSample( (f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - head-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a>) - (f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a> - head-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>) );
<a name="l00167"></a>00167       
<a name="l00168"></a>00168       <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#adf6295f17ea12f4e88790d2debdbc4d5">_pair_stats</a>){
<a name="l00169"></a>00169         <a class="code" href="classTrafficManager.html#a4e8c501fc2d871203dc729ecea28b9bd">_pair_plat</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>][f-&gt;<a class="code" href="structFlit.html#afab57916724fd9bd87f2450f571a855f">src</a>*<a class="code" href="classTrafficManager.html#a61ed65da53f0d0dac14cdf619e2d95af">_nodes</a>+dest]-&gt;AddSample( f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - head-&gt;<a class="code" href="structFlit.html#a79051233092c355b8d01f2e5914c8eb0">ctime</a> );
<a name="l00170"></a>00170         <a class="code" href="classTrafficManager.html#a03c78594e1d4a1145ea27816ef786bde">_pair_nlat</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>][f-&gt;<a class="code" href="structFlit.html#afab57916724fd9bd87f2450f571a855f">src</a>*<a class="code" href="classTrafficManager.html#a61ed65da53f0d0dac14cdf619e2d95af">_nodes</a>+dest]-&gt;AddSample( f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - head-&gt;<a class="code" href="structFlit.html#ad021c9f024c254122d90482fafae5b0c">itime</a> );
<a name="l00171"></a>00171       }
<a name="l00172"></a>00172     }
<a name="l00173"></a>00173     
<a name="l00174"></a>00174     <span class="keywordflow">if</span>(f != head) {
<a name="l00175"></a>00175       head-&gt;<a class="code" href="structFlit.html#a53a3cb2df0d0913870099df51e3d9adb">Free</a>();
<a name="l00176"></a>00176     }
<a name="l00177"></a>00177     
<a name="l00178"></a>00178   }
<a name="l00179"></a>00179   
<a name="l00180"></a>00180   <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#a784a6bcb041646c2b8c068b7de4bdc9a">head</a> &amp;&amp; !f-&gt;<a class="code" href="structFlit.html#aa0f32295d57acd313ddf257127b5c850">tail</a>) {
<a name="l00181"></a>00181     <a class="code" href="classTrafficManager.html#a66c40be042f5d5b3e5a35a441e4e4e60">_retired_packets</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].insert(make_pair(f-&gt;<a class="code" href="structFlit.html#a8e105235b0116073df1d2d133f68c12a">pid</a>, f));
<a name="l00182"></a>00182   } <span class="keywordflow">else</span> {
<a name="l00183"></a>00183     f-&gt;<a class="code" href="structFlit.html#a53a3cb2df0d0913870099df51e3d9adb">Free</a>();
<a name="l00184"></a>00184   }
<a name="l00185"></a>00185 }
<a name="l00186"></a><a class="code" href="classGPUTrafficManager.html#a2728e95570c9aefc7ee2074502bc4a63">00186</a> <span class="keywordtype">int</span>  <a class="code" href="classGPUTrafficManager.html#a2728e95570c9aefc7ee2074502bc4a63">GPUTrafficManager::_IssuePacket</a>( <span class="keywordtype">int</span> source, <span class="keywordtype">int</span> cl )
<a name="l00187"></a>00187 {
<a name="l00188"></a>00188   <span class="keywordflow">return</span> 0;
<a name="l00189"></a>00189 }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 <span class="comment">//TODO: Remove stype?</span>
<a name="l00192"></a><a class="code" href="classGPUTrafficManager.html#a6440b065ea4f74c76414ac7540b3aa96">00192</a> <span class="keywordtype">void</span> <a class="code" href="classGPUTrafficManager.html#a6440b065ea4f74c76414ac7540b3aa96">GPUTrafficManager::_GeneratePacket</a>(<span class="keywordtype">int</span> source, <span class="keywordtype">int</span> stype, <span class="keywordtype">int</span> cl, <span class="keywordtype">int</span> time, <span class="keywordtype">int</span> subnet, <span class="keywordtype">int</span> packet_size, <span class="keyword">const</span> <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81">Flit::FlitType</a>&amp; packet_type, <span class="keywordtype">void</span>* <span class="keyword">const</span> data, <span class="keywordtype">int</span> dest)
<a name="l00193"></a>00193 {
<a name="l00194"></a>00194   assert(stype!=0);
<a name="l00195"></a>00195   
<a name="l00196"></a>00196   <span class="comment">//  Flit::FlitType packet_type = Flit::ANY_TYPE;</span>
<a name="l00197"></a>00197   <span class="keywordtype">int</span> size = packet_size; <span class="comment">//input size</span>
<a name="l00198"></a>00198   <span class="keywordtype">int</span> pid = <a class="code" href="classTrafficManager.html#aeab72f243f41009035b007fc42d00e21">_cur_pid</a>++;
<a name="l00199"></a>00199   assert(<a class="code" href="classTrafficManager.html#aeab72f243f41009035b007fc42d00e21">_cur_pid</a>);
<a name="l00200"></a>00200   <span class="keywordtype">int</span> packet_destination = dest;
<a name="l00201"></a>00201   <span class="keywordtype">bool</span> record = <span class="keyword">false</span>;
<a name="l00202"></a>00202   <span class="keywordtype">bool</span> watch = <a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &amp;&amp; (<a class="code" href="classTrafficManager.html#af31f34fb4c338c9e27864d44f3abf3ea">_packets_to_watch</a>.count(pid) &gt; 0);
<a name="l00203"></a>00203   
<a name="l00204"></a>00204   <span class="comment">// In GPGPUSim, the core specified the packet_type and size</span>
<a name="l00205"></a>00205   
<a name="l00206"></a>00206 <span class="preprocessor">#if 0</span>
<a name="l00207"></a>00207 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#adfe9e24ec927025a9f94e55cba8516f5">_use_read_write</a>[cl]){
<a name="l00208"></a>00208     <span class="keywordflow">if</span>(stype &gt; 0) {
<a name="l00209"></a>00209       <span class="keywordflow">if</span> (stype == 1) {
<a name="l00210"></a>00210         packet_type = <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81ad47b8edbc7a6c26a34d782af584eeab0">Flit::READ_REQUEST</a>;
<a name="l00211"></a>00211         size = <a class="code" href="classTrafficManager.html#a87535b1fdae24ddd88e7806c591cd124">_read_request_size</a>[cl];
<a name="l00212"></a>00212       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stype == 2) {
<a name="l00213"></a>00213         packet_type = <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81a74c1c54b3ebc54205b6a3e160ac2d0da">Flit::WRITE_REQUEST</a>;
<a name="l00214"></a>00214         size = <a class="code" href="classTrafficManager.html#a08692b9e9fc3303cf35b9d4a7ea92370">_write_request_size</a>[cl];
<a name="l00215"></a>00215       } <span class="keywordflow">else</span> {
<a name="l00216"></a>00216         ostringstream err;
<a name="l00217"></a>00217         err &lt;&lt; <span class="stringliteral">&quot;Invalid packet type: &quot;</span> &lt;&lt; packet_type;
<a name="l00218"></a>00218         <a class="code" href="classModule.html#acfa9d0dc518853045e0d2356d138717f">Error</a>( err.str( ) );
<a name="l00219"></a>00219       }
<a name="l00220"></a>00220     } <span class="keywordflow">else</span> {
<a name="l00221"></a>00221       <a class="code" href="classPacketReplyInfo.html">PacketReplyInfo</a>* rinfo = <a class="code" href="classTrafficManager.html#ae50acf81b3471ea19042d408d8c326db">_repliesPending</a>[source].front();
<a name="l00222"></a>00222       <span class="keywordflow">if</span> (rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#a2e6b5a03ba103ea139fe652943a147d4">type</a> == <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81ad47b8edbc7a6c26a34d782af584eeab0">Flit::READ_REQUEST</a>) {<span class="comment">//read reply</span>
<a name="l00223"></a>00223         size = <a class="code" href="classTrafficManager.html#a9666144e4145b07dd1a1c48d77eadb65">_read_reply_size</a>[cl];
<a name="l00224"></a>00224         packet_type = <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81a18d4c2af84d9556279434e5134b6c0bf">Flit::READ_REPLY</a>;
<a name="l00225"></a>00225       } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#a2e6b5a03ba103ea139fe652943a147d4">type</a> == <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81a74c1c54b3ebc54205b6a3e160ac2d0da">Flit::WRITE_REQUEST</a>) {  <span class="comment">//write reply</span>
<a name="l00226"></a>00226         size = <a class="code" href="classTrafficManager.html#a26e3fea3ea43158bc6488e84393ff7db">_write_reply_size</a>[cl];
<a name="l00227"></a>00227         packet_type = <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81ae6c1481b97213d1e4476cbc48d40f615">Flit::WRITE_REPLY</a>;
<a name="l00228"></a>00228       } <span class="keywordflow">else</span> {
<a name="l00229"></a>00229         ostringstream err;
<a name="l00230"></a>00230         err &lt;&lt; <span class="stringliteral">&quot;Invalid packet type: &quot;</span> &lt;&lt; rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#a2e6b5a03ba103ea139fe652943a147d4">type</a>;
<a name="l00231"></a>00231         <a class="code" href="classModule.html#acfa9d0dc518853045e0d2356d138717f">Error</a>( err.str( ) );
<a name="l00232"></a>00232       }
<a name="l00233"></a>00233       packet_destination = rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#ad078088b08b123253f9e709a7a7308a2">source</a>;
<a name="l00234"></a>00234       time = rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#a36cbf988a3b1035871a18ace110df950">time</a>;
<a name="l00235"></a>00235       record = rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#afa1849fb7eaf4d7d23114dfc625a0636">record</a>;
<a name="l00236"></a>00236       <a class="code" href="classTrafficManager.html#ae50acf81b3471ea19042d408d8c326db">_repliesPending</a>[source].pop_front();
<a name="l00237"></a>00237       rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#a87f80ba63bfd8b6fb12705dc85c7fe99">Free</a>();
<a name="l00238"></a>00238     }
<a name="l00239"></a>00239   }
<a name="l00240"></a>00240 <span class="preprocessor">#endif</span>
<a name="l00241"></a>00241 <span class="preprocessor"></span>  
<a name="l00242"></a>00242   <span class="keywordflow">if</span> ((packet_destination &lt;0) || (packet_destination &gt;= <a class="code" href="classTrafficManager.html#a61ed65da53f0d0dac14cdf619e2d95af">_nodes</a>)) {
<a name="l00243"></a>00243     ostringstream err;
<a name="l00244"></a>00244     err &lt;&lt; <span class="stringliteral">&quot;Incorrect packet destination &quot;</span> &lt;&lt; packet_destination
<a name="l00245"></a>00245     &lt;&lt; <span class="stringliteral">&quot; for stype &quot;</span> &lt;&lt; packet_type;
<a name="l00246"></a>00246     <a class="code" href="classModule.html#acfa9d0dc518853045e0d2356d138717f">Error</a>( err.str( ) );
<a name="l00247"></a>00247   }
<a name="l00248"></a>00248   
<a name="l00249"></a>00249   <span class="keywordflow">if</span> ( ( <a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a45cd3e451a01f617c16a995cb7c6c9ac">running</a> ) ||
<a name="l00250"></a>00250       ( ( <a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a8fb168e417269911be683171fd918af3">draining</a> ) &amp;&amp; ( time &lt; <a class="code" href="classTrafficManager.html#ad9fa73d16a3cb111fc593970370deaa6">_drain_time</a> ) ) ) {
<a name="l00251"></a>00251     record = <a class="code" href="classTrafficManager.html#a549fe0af403657daf47db078f7f1814a">_measure_stats</a>[cl];
<a name="l00252"></a>00252   }
<a name="l00253"></a>00253   
<a name="l00254"></a>00254   <span class="keywordtype">int</span> subnetwork = subnet;
<a name="l00255"></a>00255   <span class="comment">//                ((packet_type == Flit::ANY_TYPE) ?</span>
<a name="l00256"></a>00256   <span class="comment">//                    RandomInt(_subnets-1) :</span>
<a name="l00257"></a>00257   <span class="comment">//                    _subnet[packet_type]);</span>
<a name="l00258"></a>00258   
<a name="l00259"></a>00259   <span class="keywordflow">if</span> ( watch ) {
<a name="l00260"></a>00260     *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00261"></a>00261     &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; source &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00262"></a>00262     &lt;&lt; <span class="stringliteral">&quot;Enqueuing packet &quot;</span> &lt;&lt; pid
<a name="l00263"></a>00263     &lt;&lt; <span class="stringliteral">&quot; at time &quot;</span> &lt;&lt; time
<a name="l00264"></a>00264     &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l00265"></a>00265   }
<a name="l00266"></a>00266   
<a name="l00267"></a>00267   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; size; ++i ) {
<a name="l00268"></a>00268     <a class="code" href="structFlit.html">Flit</a> * f  = <a class="code" href="classTrafficManager.html#ae5023ac53f1deb85540abe79a174db26">Flit::New</a>();
<a name="l00269"></a>00269     f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>     = <a class="code" href="classTrafficManager.html#adffda813e3742e357301b3fa142751cf">_cur_id</a>++;
<a name="l00270"></a>00270     assert(<a class="code" href="classTrafficManager.html#adffda813e3742e357301b3fa142751cf">_cur_id</a>);
<a name="l00271"></a>00271     f-&gt;<a class="code" href="structFlit.html#a8e105235b0116073df1d2d133f68c12a">pid</a>    = pid;
<a name="l00272"></a>00272     f-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>  = watch | (<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &amp;&amp; (<a class="code" href="classTrafficManager.html#a58a8ea82d95bf82f0309d5f9ecda2e34">_flits_to_watch</a>.count(f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>) &gt; 0));
<a name="l00273"></a>00273     f-&gt;<a class="code" href="structFlit.html#adb2b8310c7a44302a1ab07f4f7bec2a5">subnetwork</a> = subnetwork;
<a name="l00274"></a>00274     f-&gt;<a class="code" href="structFlit.html#afab57916724fd9bd87f2450f571a855f">src</a>    = source;
<a name="l00275"></a>00275     f-&gt;<a class="code" href="structFlit.html#a79051233092c355b8d01f2e5914c8eb0">ctime</a>  = time;
<a name="l00276"></a>00276     f-&gt;<a class="code" href="structFlit.html#a1fe2bb19983ae1ada717e13cd27efd3b">record</a> = record;
<a name="l00277"></a>00277     f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>     = cl;
<a name="l00278"></a>00278     f-&gt;<a class="code" href="structFlit.html#a7dc89003b27149a895ca7a7eace54e83">data</a> = data;
<a name="l00279"></a>00279     
<a name="l00280"></a>00280     <a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].insert(make_pair(f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>, f));
<a name="l00281"></a>00281     <span class="keywordflow">if</span>(record) {
<a name="l00282"></a>00282       <a class="code" href="classTrafficManager.html#ab3f440b8929d778298a078fff4fe492f">_measured_in_flight_flits</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].insert(make_pair(f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>, f));
<a name="l00283"></a>00283     }
<a name="l00284"></a>00284     
<a name="l00285"></a>00285     <span class="keywordflow">if</span>(<a class="code" href="globals_8hpp.html#a35b664146e55660800a67a648cf6748d">gTrace</a>){
<a name="l00286"></a>00286       cout&lt;&lt;<span class="stringliteral">&quot;New Flit &quot;</span>&lt;&lt;f-&gt;<a class="code" href="structFlit.html#afab57916724fd9bd87f2450f571a855f">src</a>&lt;&lt;endl;
<a name="l00287"></a>00287     }
<a name="l00288"></a>00288     f-&gt;<a class="code" href="structFlit.html#a4f56cca863f428c79260a517cadc244a">type</a> = packet_type;
<a name="l00289"></a>00289     
<a name="l00290"></a>00290     <span class="keywordflow">if</span> ( i == 0 ) { <span class="comment">// Head flit</span>
<a name="l00291"></a>00291       f-&gt;<a class="code" href="structFlit.html#a784a6bcb041646c2b8c068b7de4bdc9a">head</a> = <span class="keyword">true</span>;
<a name="l00292"></a>00292       <span class="comment">//packets are only generated to nodes smaller or equal to limit</span>
<a name="l00293"></a>00293       f-&gt;<a class="code" href="structFlit.html#a89d05814b6f9dcd035ec002a7ea00c57">dest</a> = packet_destination;
<a name="l00294"></a>00294     } <span class="keywordflow">else</span> {
<a name="l00295"></a>00295       f-&gt;<a class="code" href="structFlit.html#a784a6bcb041646c2b8c068b7de4bdc9a">head</a> = <span class="keyword">false</span>;
<a name="l00296"></a>00296       f-&gt;<a class="code" href="structFlit.html#a89d05814b6f9dcd035ec002a7ea00c57">dest</a> = -1;
<a name="l00297"></a>00297     }
<a name="l00298"></a>00298     <span class="keywordflow">switch</span>( <a class="code" href="classTrafficManager.html#a23397b6a37ec6aab95391d2a6299b6b1">_pri_type</a> ) {
<a name="l00299"></a>00299       <span class="keywordflow">case</span> <a class="code" href="classTrafficManager.html#ac706e7c128918cbe8dc015ca03c1a26da16fc1195598ced8197e9cf718ec9298b">class_based</a>:
<a name="l00300"></a>00300         f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> = <a class="code" href="classTrafficManager.html#a4320e8a49ac25608ddaca297a99d8459">_class_priority</a>[cl];
<a name="l00301"></a>00301         assert(f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> &gt;= 0);
<a name="l00302"></a>00302         <span class="keywordflow">break</span>;
<a name="l00303"></a>00303       <span class="keywordflow">case</span> <a class="code" href="classTrafficManager.html#ac706e7c128918cbe8dc015ca03c1a26daeda65575e2897f1be6462df7a45e21ad">age_based</a>:
<a name="l00304"></a>00304         f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> = numeric_limits&lt;int&gt;::max() - time;
<a name="l00305"></a>00305         assert(f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> &gt;= 0);
<a name="l00306"></a>00306         <span class="keywordflow">break</span>;
<a name="l00307"></a>00307       <span class="keywordflow">case</span> <a class="code" href="classTrafficManager.html#ac706e7c128918cbe8dc015ca03c1a26daa39a63afb93d7581b7ebc66932653aaa">sequence_based</a>:
<a name="l00308"></a>00308         f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> = numeric_limits&lt;int&gt;::max() - <a class="code" href="classTrafficManager.html#a4eabe4de474fc72131dd443509f364b8">_packet_seq_no</a>[source];
<a name="l00309"></a>00309         assert(f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> &gt;= 0);
<a name="l00310"></a>00310         <span class="keywordflow">break</span>;
<a name="l00311"></a>00311       <span class="keywordflow">default</span>:
<a name="l00312"></a>00312         f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> = 0;
<a name="l00313"></a>00313     }
<a name="l00314"></a>00314     <span class="keywordflow">if</span> ( i == ( size - 1 ) ) { <span class="comment">// Tail flit</span>
<a name="l00315"></a>00315       f-&gt;<a class="code" href="structFlit.html#aa0f32295d57acd313ddf257127b5c850">tail</a> = <span class="keyword">true</span>;
<a name="l00316"></a>00316     } <span class="keywordflow">else</span> {
<a name="l00317"></a>00317       f-&gt;<a class="code" href="structFlit.html#aa0f32295d57acd313ddf257127b5c850">tail</a> = <span class="keyword">false</span>;
<a name="l00318"></a>00318     }
<a name="l00319"></a>00319     
<a name="l00320"></a>00320     f-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>  = -1;
<a name="l00321"></a>00321     
<a name="l00322"></a>00322     <span class="keywordflow">if</span> ( f-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a> ) {
<a name="l00323"></a>00323       *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00324"></a>00324       &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; source &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00325"></a>00325       &lt;&lt; <span class="stringliteral">&quot;Enqueuing flit &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l00326"></a>00326       &lt;&lt; <span class="stringliteral">&quot; (packet &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a8e105235b0116073df1d2d133f68c12a">pid</a>
<a name="l00327"></a>00327       &lt;&lt; <span class="stringliteral">&quot;) at time &quot;</span> &lt;&lt; time
<a name="l00328"></a>00328       &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l00329"></a>00329     }
<a name="l00330"></a>00330     
<a name="l00331"></a>00331     <a class="code" href="classGPUTrafficManager.html#a19ac7a6c5e1be84c2a31530b900c0d58">_input_queue</a>[subnet][source][cl].push_back( f );
<a name="l00332"></a>00332   }
<a name="l00333"></a>00333 }
<a name="l00334"></a>00334 
<a name="l00335"></a><a class="code" href="classGPUTrafficManager.html#a319a9eef2aad1a711eb0f6790c908f84">00335</a> <span class="keywordtype">void</span> <a class="code" href="classGPUTrafficManager.html#a319a9eef2aad1a711eb0f6790c908f84">GPUTrafficManager::_Step</a>()
<a name="l00336"></a>00336 {
<a name="l00337"></a>00337   <span class="keywordtype">bool</span> flits_in_flight = <span class="keyword">false</span>;
<a name="l00338"></a>00338   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; <a class="code" href="classTrafficManager.html#a9394ae83257275a40a9e1b62eb3a6247">_classes</a>; ++c) {
<a name="l00339"></a>00339     flits_in_flight |= !<a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>[c].empty();
<a name="l00340"></a>00340   }
<a name="l00341"></a>00341   <span class="keywordflow">if</span>(flits_in_flight &amp;&amp; (<a class="code" href="classTrafficManager.html#ab18f0d948c1a197663dee3c75429b9c8">_deadlock_timer</a>++ &gt;= <a class="code" href="classTrafficManager.html#af80003752f7d8fceb5e542fc86bc56c8">_deadlock_warn_timeout</a>)){
<a name="l00342"></a>00342     <a class="code" href="classTrafficManager.html#ab18f0d948c1a197663dee3c75429b9c8">_deadlock_timer</a> = 0;
<a name="l00343"></a>00343     cout &lt;&lt; <span class="stringliteral">&quot;WARNING: Possible network deadlock.\n&quot;</span>;
<a name="l00344"></a>00344   }
<a name="l00345"></a>00345   
<a name="l00346"></a>00346   vector&lt;map&lt;int, Flit *&gt; &gt; flits(<a class="code" href="classTrafficManager.html#adf0cc5d3d2377007a9471f73b1cf137a">_subnets</a>);
<a name="l00347"></a>00347   
<a name="l00348"></a>00348   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> subnet = 0; subnet &lt; <a class="code" href="classTrafficManager.html#adf0cc5d3d2377007a9471f73b1cf137a">_subnets</a>; ++subnet ) {
<a name="l00349"></a>00349     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> = 0; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt; <a class="code" href="classTrafficManager.html#a61ed65da53f0d0dac14cdf619e2d95af">_nodes</a>; ++<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> ) {
<a name="l00350"></a>00350       <a class="code" href="structFlit.html">Flit</a> * <span class="keyword">const</span> f = <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#abfe9bacf0de4b89c0f5d05b93bf11471">ReadFlit</a>( <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> );
<a name="l00351"></a>00351       <span class="keywordflow">if</span> ( f ) {
<a name="l00352"></a>00352         <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l00353"></a>00353           *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00354"></a>00354           &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00355"></a>00355           &lt;&lt; <span class="stringliteral">&quot;Ejecting flit &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l00356"></a>00356           &lt;&lt; <span class="stringliteral">&quot; (packet &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a8e105235b0116073df1d2d133f68c12a">pid</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>
<a name="l00357"></a>00357           &lt;&lt; <span class="stringliteral">&quot; from VC &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>
<a name="l00358"></a>00358           &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l00359"></a>00359         }
<a name="l00360"></a>00360         <a class="code" href="globals_8hpp.html#a159272d2497484e0fe30afd042ff59fe">g_icnt_interface</a>-&gt;<a class="code" href="classInterconnectInterface.html#adb4818527d7958fcc54513e5789e29c8">WriteOutBuffer</a>(subnet, <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, f);
<a name="l00361"></a>00361       }
<a name="l00362"></a>00362       
<a name="l00363"></a>00363       <a class="code" href="globals_8hpp.html#a159272d2497484e0fe30afd042ff59fe">g_icnt_interface</a>-&gt;<a class="code" href="classInterconnectInterface.html#a047164a109f35dda193c06f14dfda3ce">Transfer2BoundaryBuffer</a>(subnet, <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l00364"></a>00364       <a class="code" href="structFlit.html">Flit</a>* <span class="keyword">const</span> ejected_flit = <a class="code" href="globals_8hpp.html#a159272d2497484e0fe30afd042ff59fe">g_icnt_interface</a>-&gt;<a class="code" href="classInterconnectInterface.html#a6e226c231636b856b0fbec056ed40da8">GetEjectedFlit</a>(subnet, <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l00365"></a>00365       <span class="keywordflow">if</span> (ejected_flit) {
<a name="l00366"></a>00366         <span class="keywordflow">if</span>(ejected_flit-&gt;<a class="code" href="structFlit.html#a784a6bcb041646c2b8c068b7de4bdc9a">head</a>)
<a name="l00367"></a>00367           assert(ejected_flit-&gt;<a class="code" href="structFlit.html#a89d05814b6f9dcd035ec002a7ea00c57">dest</a> == <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l00368"></a>00368         <span class="keywordflow">if</span>(ejected_flit-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l00369"></a>00369           *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00370"></a>00370           &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00371"></a>00371           &lt;&lt; <span class="stringliteral">&quot;Ejected flit &quot;</span> &lt;&lt; ejected_flit-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l00372"></a>00372           &lt;&lt; <span class="stringliteral">&quot; (packet &quot;</span> &lt;&lt; ejected_flit-&gt;<a class="code" href="structFlit.html#a8e105235b0116073df1d2d133f68c12a">pid</a>
<a name="l00373"></a>00373           &lt;&lt; <span class="stringliteral">&quot; VC &quot;</span> &lt;&lt; ejected_flit-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>
<a name="l00374"></a>00374           &lt;&lt; <span class="stringliteral">&quot;from ejection buffer.&quot;</span> &lt;&lt; endl;
<a name="l00375"></a>00375         }
<a name="l00376"></a>00376         flits[subnet].insert(make_pair(<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, ejected_flit));
<a name="l00377"></a>00377         <span class="keywordflow">if</span>((<a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a0e1683a4848299c524150f6e6c7f6930">warming_up</a>) || (<a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a45cd3e451a01f617c16a995cb7c6c9ac">running</a>)) {
<a name="l00378"></a>00378           ++<a class="code" href="classTrafficManager.html#a089e444802486d4e5092066d4c357c30">_accepted_flits</a>[ejected_flit-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>];
<a name="l00379"></a>00379           <span class="keywordflow">if</span>(ejected_flit-&gt;<a class="code" href="structFlit.html#aa0f32295d57acd313ddf257127b5c850">tail</a>) {
<a name="l00380"></a>00380             ++<a class="code" href="classTrafficManager.html#acec4c1294844394b7bf8008f5b920593">_accepted_packets</a>[ejected_flit-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>];
<a name="l00381"></a>00381           }
<a name="l00382"></a>00382         }
<a name="l00383"></a>00383       }
<a name="l00384"></a>00384     
<a name="l00385"></a>00385       <span class="comment">// Processing the credit From the network</span>
<a name="l00386"></a>00386       <a class="code" href="classCredit.html">Credit</a> * <span class="keyword">const</span> c = <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#a785ec4155e91008c7e0ade24d86536ca">ReadCredit</a>( <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> );
<a name="l00387"></a>00387       <span class="keywordflow">if</span> ( c ) {
<a name="l00388"></a>00388 <span class="preprocessor">#ifdef TRACK_FLOWS</span>
<a name="l00389"></a>00389 <span class="preprocessor"></span>        <span class="keywordflow">for</span>(set&lt;int&gt;::const_iterator iter = c-&gt;<a class="code" href="classCredit.html#af7898eb802885a65e5270096e0595abe">vc</a>.begin(); iter != c-&gt;<a class="code" href="classCredit.html#af7898eb802885a65e5270096e0595abe">vc</a>.end(); ++iter) {
<a name="l00390"></a>00390           <span class="keywordtype">int</span> <span class="keyword">const</span> vc = *iter;
<a name="l00391"></a>00391           assert(!<a class="code" href="classTrafficManager.html#a35866d4b27b9edc686f0e94d3810c8ee">_outstanding_classes</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet][vc].empty());
<a name="l00392"></a>00392           <span class="keywordtype">int</span> cl = <a class="code" href="classTrafficManager.html#a35866d4b27b9edc686f0e94d3810c8ee">_outstanding_classes</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet][vc].front();
<a name="l00393"></a>00393           <a class="code" href="classTrafficManager.html#a35866d4b27b9edc686f0e94d3810c8ee">_outstanding_classes</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet][vc].pop();
<a name="l00394"></a>00394           assert(<a class="code" href="classTrafficManager.html#a5d2d639d839c07d750bc632b85a304c6">_outstanding_credits</a>[cl][subnet][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>] &gt; 0);
<a name="l00395"></a>00395           --<a class="code" href="classTrafficManager.html#a5d2d639d839c07d750bc632b85a304c6">_outstanding_credits</a>[cl][subnet][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>];
<a name="l00396"></a>00396         }
<a name="l00397"></a>00397 <span class="preprocessor">#endif</span>
<a name="l00398"></a>00398 <span class="preprocessor"></span>        <a class="code" href="classTrafficManager.html#a26909b743654d9b10f7aedd16421506c">_buf_states</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet]-&gt;<a class="code" href="classBufferState.html#a4826b739959cb1a59dbe57a308f2cb61">ProcessCredit</a>(c);
<a name="l00399"></a>00399         c-&gt;<a class="code" href="classCredit.html#a59c66f81e134f42283da1690dc41bfea">Free</a>();
<a name="l00400"></a>00400       }
<a name="l00401"></a>00401     }
<a name="l00402"></a>00402     <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#afdb3b2cb6e0270fbd6b7acf5f5e4b28e">ReadInputs</a>( );
<a name="l00403"></a>00403   }
<a name="l00404"></a>00404 
<a name="l00405"></a>00405 <span class="comment">// GPGPUSim will generate/inject packets from interconnection interface</span>
<a name="l00406"></a>00406 <span class="preprocessor">#if 0</span>
<a name="l00407"></a>00407 <span class="preprocessor"></span>  <span class="keywordflow">if</span> ( !<a class="code" href="classTrafficManager.html#abeecbfb35b96c5e7bcf603fbda0d6e5c">_empty_network</a> ) {
<a name="l00408"></a>00408     <a class="code" href="classTrafficManager.html#a61907c4a95eae350a20af03fb8dbcd03">_Inject</a>();
<a name="l00409"></a>00409   }
<a name="l00410"></a>00410 <span class="preprocessor">#endif</span>
<a name="l00411"></a>00411 <span class="preprocessor"></span>  
<a name="l00412"></a>00412   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> subnet = 0; subnet &lt; _subnets; ++subnet) {
<a name="l00413"></a>00413     
<a name="l00414"></a>00414     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> = 0; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt; <a class="code" href="classTrafficManager.html#a61ed65da53f0d0dac14cdf619e2d95af">_nodes</a>; ++<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) {
<a name="l00415"></a>00415       
<a name="l00416"></a>00416       <a class="code" href="structFlit.html">Flit</a> * f = NULL;
<a name="l00417"></a>00417       
<a name="l00418"></a>00418       <a class="code" href="classBufferState.html">BufferState</a> * <span class="keyword">const</span> dest_buf = <a class="code" href="classTrafficManager.html#a26909b743654d9b10f7aedd16421506c">_buf_states</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet];
<a name="l00419"></a>00419       
<a name="l00420"></a>00420       <span class="keywordtype">int</span> <span class="keyword">const</span> last_class = <a class="code" href="classTrafficManager.html#a6105ccff8bfd383dea19a3f8403e263f">_last_class</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet];
<a name="l00421"></a>00421       
<a name="l00422"></a>00422       <span class="keywordtype">int</span> class_limit = _classes;
<a name="l00423"></a>00423       
<a name="l00424"></a>00424       <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a0310eaec5c862d3be54fa4987fdc1601">_hold_switch_for_packet</a>) {
<a name="l00425"></a>00425         list&lt;Flit *&gt; <span class="keyword">const</span> &amp; pp = <a class="code" href="classGPUTrafficManager.html#a19ac7a6c5e1be84c2a31530b900c0d58">_input_queue</a>[subnet][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][last_class];
<a name="l00426"></a>00426         <span class="keywordflow">if</span>(!pp.empty() &amp;&amp; !pp.front()-&gt;head &amp;&amp;
<a name="l00427"></a>00427            !dest_buf-&gt;<a class="code" href="classBufferState.html#a394b0fa81be8085b291b2768c487fafa">IsFullFor</a>(pp.front()-&gt;vc)) {
<a name="l00428"></a>00428           f = pp.front();
<a name="l00429"></a>00429           assert(f-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a> == <a class="code" href="classTrafficManager.html#aa7d75937add38ae15463b43499993725">_last_vc</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet][last_class]);
<a name="l00430"></a>00430           
<a name="l00431"></a>00431           <span class="comment">// if we&apos;re holding the connection, we don&apos;t need to check that class</span>
<a name="l00432"></a>00432           <span class="comment">// again in the for loop</span>
<a name="l00433"></a>00433           --class_limit;
<a name="l00434"></a>00434         }
<a name="l00435"></a>00435       }
<a name="l00436"></a>00436       
<a name="l00437"></a>00437       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt;= class_limit; ++i) {
<a name="l00438"></a>00438         
<a name="l00439"></a>00439         <span class="keywordtype">int</span> <span class="keyword">const</span> c = (last_class + i) % _classes;
<a name="l00440"></a>00440         
<a name="l00441"></a>00441         list&lt;Flit *&gt; <span class="keyword">const</span> &amp; pp = <a class="code" href="classGPUTrafficManager.html#a19ac7a6c5e1be84c2a31530b900c0d58">_input_queue</a>[subnet][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][c];
<a name="l00442"></a>00442         
<a name="l00443"></a>00443         <span class="keywordflow">if</span>(pp.empty()) {
<a name="l00444"></a>00444           <span class="keywordflow">continue</span>;
<a name="l00445"></a>00445         }
<a name="l00446"></a>00446         
<a name="l00447"></a>00447         <a class="code" href="structFlit.html">Flit</a> * <span class="keyword">const</span> cf = pp.front();
<a name="l00448"></a>00448         assert(cf);
<a name="l00449"></a>00449         assert(cf-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a> == c);
<a name="l00450"></a>00450         
<a name="l00451"></a>00451         assert(cf-&gt;<a class="code" href="structFlit.html#adb2b8310c7a44302a1ab07f4f7bec2a5">subnetwork</a> == subnet);
<a name="l00452"></a>00452         
<a name="l00453"></a>00453         <span class="keywordflow">if</span>(f &amp;&amp; (f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> &gt;= cf-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a>)) {
<a name="l00454"></a>00454           <span class="keywordflow">continue</span>;
<a name="l00455"></a>00455         }
<a name="l00456"></a>00456         
<a name="l00457"></a>00457         <span class="keywordflow">if</span>(cf-&gt;<a class="code" href="structFlit.html#a784a6bcb041646c2b8c068b7de4bdc9a">head</a> &amp;&amp; cf-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a> == -1) { <span class="comment">// Find first available VC</span>
<a name="l00458"></a>00458           
<a name="l00459"></a>00459           <a class="code" href="classOutputSet.html">OutputSet</a> route_set;
<a name="l00460"></a>00460           <a class="code" href="classTrafficManager.html#a2d1cccd0f50ec0972bdb666e9b234b72">_rf</a>(NULL, cf, -1, &amp;route_set, <span class="keyword">true</span>);
<a name="l00461"></a>00461           set&lt;OutputSet::sSetElement&gt; <span class="keyword">const</span> &amp; os = route_set.<a class="code" href="classOutputSet.html#aa9c96e3c171ac83d22a67d2ae9eef1c3">GetSet</a>();
<a name="l00462"></a>00462           assert(os.size() == 1);
<a name="l00463"></a>00463           <a class="code" href="structOutputSet_1_1sSetElement.html">OutputSet::sSetElement</a> <span class="keyword">const</span> &amp; se = *os.begin();
<a name="l00464"></a>00464           assert(se.output_port == -1);
<a name="l00465"></a>00465           <span class="keywordtype">int</span> vc_start = se.vc_start;
<a name="l00466"></a>00466           <span class="keywordtype">int</span> vc_end = se.vc_end;
<a name="l00467"></a>00467           <span class="keywordtype">int</span> vc_count = vc_end - vc_start + 1;
<a name="l00468"></a>00468           <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a7d1ae95f37124ebfdd8f16613c207543">_noq</a>) {
<a name="l00469"></a>00469             assert(<a class="code" href="classTrafficManager.html#a91a6036667c1793b9af0885329d4711d">_lookahead_routing</a>);
<a name="l00470"></a>00470             <span class="keyword">const</span> <a class="code" href="classFlitChannel.html">FlitChannel</a> * inject = <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#a3a1288b1369386753eccb1e00dbf8661">GetInject</a>(<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l00471"></a>00471             <span class="keyword">const</span> <a class="code" href="classRouter.html">Router</a> * router = inject-&gt;<a class="code" href="classFlitChannel.html#aebe1f93809d4b635f765e6aa0ed9e5e6">GetSink</a>();
<a name="l00472"></a>00472             assert(router);
<a name="l00473"></a>00473             <span class="keywordtype">int</span> in_channel = inject-&gt;<a class="code" href="classFlitChannel.html#af2750ab732b47425865e409ba149f1e5">GetSinkPort</a>();
<a name="l00474"></a>00474             
<a name="l00475"></a>00475             <span class="comment">// NOTE: Because the lookahead is not for injection, but for the</span>
<a name="l00476"></a>00476             <span class="comment">// first hop, we have to temporarily set cf&apos;s VC to be non-negative</span>
<a name="l00477"></a>00477             <span class="comment">// in order to avoid seting of an assertion in the routing function.</span>
<a name="l00478"></a>00478             cf-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a> = vc_start;
<a name="l00479"></a>00479             <a class="code" href="classTrafficManager.html#a2d1cccd0f50ec0972bdb666e9b234b72">_rf</a>(router, cf, in_channel, &amp;cf-&gt;<a class="code" href="structFlit.html#a165c0bf438da93ef32850f4d3c4e9a1c">la_route_set</a>, <span class="keyword">false</span>);
<a name="l00480"></a>00480             cf-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a> = -1;
<a name="l00481"></a>00481             
<a name="l00482"></a>00482             <span class="keywordflow">if</span>(cf-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l00483"></a>00483               *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00484"></a>00484               &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00485"></a>00485               &lt;&lt; <span class="stringliteral">&quot;Generating lookahead routing info for flit &quot;</span> &lt;&lt; cf-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l00486"></a>00486               &lt;&lt; <span class="stringliteral">&quot; (NOQ).&quot;</span> &lt;&lt; endl;
<a name="l00487"></a>00487             }
<a name="l00488"></a>00488             set&lt;OutputSet::sSetElement&gt; <span class="keyword">const</span> sl = cf-&gt;<a class="code" href="structFlit.html#a165c0bf438da93ef32850f4d3c4e9a1c">la_route_set</a>.<a class="code" href="classOutputSet.html#aa9c96e3c171ac83d22a67d2ae9eef1c3">GetSet</a>();
<a name="l00489"></a>00489             assert(sl.size() == 1);
<a name="l00490"></a>00490             <span class="keywordtype">int</span> next_output = sl.begin()-&gt;output_port;
<a name="l00491"></a>00491             vc_count /= router-&gt;<a class="code" href="classRouter.html#a02767ebb82a06ee4eb9f91c09d7b001d">NumOutputs</a>();
<a name="l00492"></a>00492             vc_start += next_output * vc_count;
<a name="l00493"></a>00493             vc_end = vc_start + vc_count - 1;
<a name="l00494"></a>00494             assert(vc_start &gt;= se.vc_start &amp;&amp; vc_start &lt;= se.vc_end);
<a name="l00495"></a>00495             assert(vc_end &gt;= se.vc_start &amp;&amp; vc_end &lt;= se.vc_end);
<a name="l00496"></a>00496             assert(vc_start &lt;= vc_end);
<a name="l00497"></a>00497           }
<a name="l00498"></a>00498           <span class="keywordflow">if</span>(cf-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l00499"></a>00499             *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; <a class="code" href="classModule.html#a0eeaa2b9a7d2ba88ab05682444898b08">FullName</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00500"></a>00500             &lt;&lt; <span class="stringliteral">&quot;Finding output VC for flit &quot;</span> &lt;&lt; cf-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l00501"></a>00501             &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; endl;
<a name="l00502"></a>00502           }
<a name="l00503"></a>00503           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt;= vc_count; ++i) {
<a name="l00504"></a>00504             <span class="keywordtype">int</span> <span class="keyword">const</span> lvc = <a class="code" href="classTrafficManager.html#aa7d75937add38ae15463b43499993725">_last_vc</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet][c];
<a name="l00505"></a>00505             <span class="keywordtype">int</span> <span class="keyword">const</span> vc =
<a name="l00506"></a>00506             (lvc &lt; vc_start || lvc &gt; vc_end) ?
<a name="l00507"></a>00507             vc_start :
<a name="l00508"></a>00508             (vc_start + (lvc - vc_start + i) % vc_count);
<a name="l00509"></a>00509             assert((vc &gt;= vc_start) &amp;&amp; (vc &lt;= vc_end));
<a name="l00510"></a>00510             <span class="keywordflow">if</span>(!dest_buf-&gt;<a class="code" href="classBufferState.html#a4c32e440044fa0b238342278b69c8ee2">IsAvailableFor</a>(vc)) {
<a name="l00511"></a>00511               <span class="keywordflow">if</span>(cf-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l00512"></a>00512                 *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; <a class="code" href="classModule.html#a0eeaa2b9a7d2ba88ab05682444898b08">FullName</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00513"></a>00513                 &lt;&lt; <span class="stringliteral">&quot;  Output VC &quot;</span> &lt;&lt; vc &lt;&lt; <span class="stringliteral">&quot; is busy.&quot;</span> &lt;&lt; endl;
<a name="l00514"></a>00514               }
<a name="l00515"></a>00515             } <span class="keywordflow">else</span> {
<a name="l00516"></a>00516               <span class="keywordflow">if</span>(dest_buf-&gt;<a class="code" href="classBufferState.html#a394b0fa81be8085b291b2768c487fafa">IsFullFor</a>(vc)) {
<a name="l00517"></a>00517                 <span class="keywordflow">if</span>(cf-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l00518"></a>00518                   *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; <a class="code" href="classModule.html#a0eeaa2b9a7d2ba88ab05682444898b08">FullName</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00519"></a>00519                   &lt;&lt; <span class="stringliteral">&quot;  Output VC &quot;</span> &lt;&lt; vc &lt;&lt; <span class="stringliteral">&quot; is full.&quot;</span> &lt;&lt; endl;
<a name="l00520"></a>00520                 }
<a name="l00521"></a>00521               } <span class="keywordflow">else</span> {
<a name="l00522"></a>00522                 <span class="keywordflow">if</span>(cf-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l00523"></a>00523                   *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; <a class="code" href="classModule.html#a0eeaa2b9a7d2ba88ab05682444898b08">FullName</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00524"></a>00524                   &lt;&lt; <span class="stringliteral">&quot;  Selected output VC &quot;</span> &lt;&lt; vc &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l00525"></a>00525                 }
<a name="l00526"></a>00526                 cf-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a> = vc;
<a name="l00527"></a>00527                 <span class="keywordflow">break</span>;
<a name="l00528"></a>00528               }
<a name="l00529"></a>00529             }
<a name="l00530"></a>00530           }
<a name="l00531"></a>00531         }
<a name="l00532"></a>00532         
<a name="l00533"></a>00533         <span class="keywordflow">if</span>(cf-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a> == -1) {
<a name="l00534"></a>00534           <span class="keywordflow">if</span>(cf-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l00535"></a>00535             *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; <a class="code" href="classModule.html#a0eeaa2b9a7d2ba88ab05682444898b08">FullName</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00536"></a>00536             &lt;&lt; <span class="stringliteral">&quot;No output VC found for flit &quot;</span> &lt;&lt; cf-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l00537"></a>00537             &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l00538"></a>00538           }
<a name="l00539"></a>00539         } <span class="keywordflow">else</span> {
<a name="l00540"></a>00540           <span class="keywordflow">if</span>(dest_buf-&gt;<a class="code" href="classBufferState.html#a394b0fa81be8085b291b2768c487fafa">IsFullFor</a>(cf-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>)) {
<a name="l00541"></a>00541             <span class="keywordflow">if</span>(cf-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l00542"></a>00542               *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; <a class="code" href="classModule.html#a0eeaa2b9a7d2ba88ab05682444898b08">FullName</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00543"></a>00543               &lt;&lt; <span class="stringliteral">&quot;Selected output VC &quot;</span> &lt;&lt; cf-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>
<a name="l00544"></a>00544               &lt;&lt; <span class="stringliteral">&quot; is full for flit &quot;</span> &lt;&lt; cf-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l00545"></a>00545               &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l00546"></a>00546             }
<a name="l00547"></a>00547           } <span class="keywordflow">else</span> {
<a name="l00548"></a>00548             f = cf;
<a name="l00549"></a>00549           }
<a name="l00550"></a>00550         }
<a name="l00551"></a>00551       }
<a name="l00552"></a>00552       
<a name="l00553"></a>00553       <span class="keywordflow">if</span>(f) {
<a name="l00554"></a>00554         
<a name="l00555"></a>00555         assert(f-&gt;<a class="code" href="structFlit.html#adb2b8310c7a44302a1ab07f4f7bec2a5">subnetwork</a> == subnet);
<a name="l00556"></a>00556         
<a name="l00557"></a>00557         <span class="keywordtype">int</span> <span class="keyword">const</span> c = f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>;
<a name="l00558"></a>00558         
<a name="l00559"></a>00559         <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#a784a6bcb041646c2b8c068b7de4bdc9a">head</a>) {
<a name="l00560"></a>00560           
<a name="l00561"></a>00561           <span class="keywordflow">if</span> (<a class="code" href="classTrafficManager.html#a91a6036667c1793b9af0885329d4711d">_lookahead_routing</a>) {
<a name="l00562"></a>00562             <span class="keywordflow">if</span>(!<a class="code" href="classTrafficManager.html#a7d1ae95f37124ebfdd8f16613c207543">_noq</a>) {
<a name="l00563"></a>00563               <span class="keyword">const</span> <a class="code" href="classFlitChannel.html">FlitChannel</a> * inject = <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#a3a1288b1369386753eccb1e00dbf8661">GetInject</a>(<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l00564"></a>00564               <span class="keyword">const</span> <a class="code" href="classRouter.html">Router</a> * router = inject-&gt;<a class="code" href="classFlitChannel.html#aebe1f93809d4b635f765e6aa0ed9e5e6">GetSink</a>();
<a name="l00565"></a>00565               assert(router);
<a name="l00566"></a>00566               <span class="keywordtype">int</span> in_channel = inject-&gt;<a class="code" href="classFlitChannel.html#af2750ab732b47425865e409ba149f1e5">GetSinkPort</a>();
<a name="l00567"></a>00567               <a class="code" href="classTrafficManager.html#a2d1cccd0f50ec0972bdb666e9b234b72">_rf</a>(router, f, in_channel, &amp;f-&gt;<a class="code" href="structFlit.html#a165c0bf438da93ef32850f4d3c4e9a1c">la_route_set</a>, <span class="keyword">false</span>);
<a name="l00568"></a>00568               <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l00569"></a>00569                 *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00570"></a>00570                 &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00571"></a>00571                 &lt;&lt; <span class="stringliteral">&quot;Generating lookahead routing info for flit &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l00572"></a>00572                 &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l00573"></a>00573               }
<a name="l00574"></a>00574             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l00575"></a>00575               *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00576"></a>00576               &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00577"></a>00577               &lt;&lt; <span class="stringliteral">&quot;Already generated lookahead routing info for flit &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l00578"></a>00578               &lt;&lt; <span class="stringliteral">&quot; (NOQ).&quot;</span> &lt;&lt; endl;
<a name="l00579"></a>00579             }
<a name="l00580"></a>00580           } <span class="keywordflow">else</span> {
<a name="l00581"></a>00581             f-&gt;<a class="code" href="structFlit.html#a165c0bf438da93ef32850f4d3c4e9a1c">la_route_set</a>.<a class="code" href="classOutputSet.html#a6bfd3bb1f62d8fe65b981e6bc25fd241">Clear</a>();
<a name="l00582"></a>00582           }
<a name="l00583"></a>00583           
<a name="l00584"></a>00584           dest_buf-&gt;<a class="code" href="classBufferState.html#a8715055b64af2cb8fef29488ae5888a9">TakeBuffer</a>(f-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>);
<a name="l00585"></a>00585           <a class="code" href="classTrafficManager.html#aa7d75937add38ae15463b43499993725">_last_vc</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet][c] = f-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>;
<a name="l00586"></a>00586         }
<a name="l00587"></a>00587         
<a name="l00588"></a>00588         <a class="code" href="classTrafficManager.html#a6105ccff8bfd383dea19a3f8403e263f">_last_class</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet] = c;
<a name="l00589"></a>00589         
<a name="l00590"></a>00590         <a class="code" href="classGPUTrafficManager.html#a19ac7a6c5e1be84c2a31530b900c0d58">_input_queue</a>[subnet][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][c].pop_front();
<a name="l00591"></a>00591         
<a name="l00592"></a>00592 <span class="preprocessor">#ifdef TRACK_FLOWS</span>
<a name="l00593"></a>00593 <span class="preprocessor"></span>        ++<a class="code" href="classTrafficManager.html#a5d2d639d839c07d750bc632b85a304c6">_outstanding_credits</a>[c][subnet][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>];
<a name="l00594"></a>00594         <a class="code" href="classTrafficManager.html#a35866d4b27b9edc686f0e94d3810c8ee">_outstanding_classes</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet][f-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>].push(c);
<a name="l00595"></a>00595 <span class="preprocessor">#endif</span>
<a name="l00596"></a>00596 <span class="preprocessor"></span>        
<a name="l00597"></a>00597         dest_buf-&gt;<a class="code" href="classBufferState.html#a1d09d10fe55b796a83839cb18df0c982">SendingFlit</a>(f);
<a name="l00598"></a>00598         
<a name="l00599"></a>00599         <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a23397b6a37ec6aab95391d2a6299b6b1">_pri_type</a> == <a class="code" href="classTrafficManager.html#ac706e7c128918cbe8dc015ca03c1a26da94465a3b3fa9a118ff7ba49ee559adc0">network_age_based</a>) {
<a name="l00600"></a>00600           f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> = numeric_limits&lt;int&gt;::max() - <a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a>;
<a name="l00601"></a>00601           assert(f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> &gt;= 0);
<a name="l00602"></a>00602         }
<a name="l00603"></a>00603         
<a name="l00604"></a>00604         <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l00605"></a>00605           *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00606"></a>00606           &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00607"></a>00607           &lt;&lt; <span class="stringliteral">&quot;Injecting flit &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l00608"></a>00608           &lt;&lt; <span class="stringliteral">&quot; into subnet &quot;</span> &lt;&lt; subnet
<a name="l00609"></a>00609           &lt;&lt; <span class="stringliteral">&quot; at time &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a>
<a name="l00610"></a>00610           &lt;&lt; <span class="stringliteral">&quot; with priority &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a>
<a name="l00611"></a>00611           &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l00612"></a>00612         }
<a name="l00613"></a>00613         f-&gt;<a class="code" href="structFlit.html#ad021c9f024c254122d90482fafae5b0c">itime</a> = <a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a>;
<a name="l00614"></a>00614         
<a name="l00615"></a>00615         <span class="comment">// Pass VC &quot;back&quot;</span>
<a name="l00616"></a>00616         <span class="keywordflow">if</span>(!<a class="code" href="classGPUTrafficManager.html#a19ac7a6c5e1be84c2a31530b900c0d58">_input_queue</a>[subnet][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][c].empty() &amp;&amp; !f-&gt;<a class="code" href="structFlit.html#aa0f32295d57acd313ddf257127b5c850">tail</a>) {
<a name="l00617"></a>00617           <a class="code" href="structFlit.html">Flit</a> * <span class="keyword">const</span> nf = <a class="code" href="classGPUTrafficManager.html#a19ac7a6c5e1be84c2a31530b900c0d58">_input_queue</a>[subnet][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][c].front();
<a name="l00618"></a>00618           nf-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a> = f-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>;
<a name="l00619"></a>00619         }
<a name="l00620"></a>00620         
<a name="l00621"></a>00621         <span class="keywordflow">if</span>((<a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a0e1683a4848299c524150f6e6c7f6930">warming_up</a>) || (<a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a45cd3e451a01f617c16a995cb7c6c9ac">running</a>)) {
<a name="l00622"></a>00622           ++<a class="code" href="classTrafficManager.html#a62c2881d71bd8a580c008cebf2753012">_sent_flits</a>[c][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>];
<a name="l00623"></a>00623           <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#a784a6bcb041646c2b8c068b7de4bdc9a">head</a>) {
<a name="l00624"></a>00624             ++<a class="code" href="classTrafficManager.html#a552ccfae3f5aad4c71b188d97614012d">_sent_packets</a>[c][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>];
<a name="l00625"></a>00625           }
<a name="l00626"></a>00626         }
<a name="l00627"></a>00627         
<a name="l00628"></a>00628 <span class="preprocessor">#ifdef TRACK_FLOWS</span>
<a name="l00629"></a>00629 <span class="preprocessor"></span>        ++<a class="code" href="classTrafficManager.html#ab399ac65874834ae1ad6ce99939dfbea">_injected_flits</a>[c][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>];
<a name="l00630"></a>00630 <span class="preprocessor">#endif</span>
<a name="l00631"></a>00631 <span class="preprocessor"></span>        
<a name="l00632"></a>00632         <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#a6ae45fa6d6fb4a0c8bdd7f31436ead11">WriteFlit</a>(f, <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l00633"></a>00633         
<a name="l00634"></a>00634       }
<a name="l00635"></a>00635     }
<a name="l00636"></a>00636   }
<a name="l00637"></a>00637   <span class="comment">//Send the credit To the network</span>
<a name="l00638"></a>00638   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> subnet = 0; subnet &lt; _subnets; ++subnet) {
<a name="l00639"></a>00639     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> = 0; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt; <a class="code" href="classTrafficManager.html#a61ed65da53f0d0dac14cdf619e2d95af">_nodes</a>; ++<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) {
<a name="l00640"></a>00640       map&lt;int, Flit *&gt;::const_iterator iter = flits[subnet].find(<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l00641"></a>00641       <span class="keywordflow">if</span>(iter != flits[subnet].end()) {
<a name="l00642"></a>00642         <a class="code" href="structFlit.html">Flit</a> * <span class="keyword">const</span> f = iter-&gt;second;
<a name="l00643"></a>00643 
<a name="l00644"></a>00644         f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> = <a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a>;
<a name="l00645"></a>00645         <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l00646"></a>00646           *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00647"></a>00647           &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00648"></a>00648           &lt;&lt; <span class="stringliteral">&quot;Injecting credit for VC &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>
<a name="l00649"></a>00649           &lt;&lt; <span class="stringliteral">&quot; into subnet &quot;</span> &lt;&lt; subnet
<a name="l00650"></a>00650           &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l00651"></a>00651         }
<a name="l00652"></a>00652         <a class="code" href="classCredit.html">Credit</a> * <span class="keyword">const</span> c = <a class="code" href="classTrafficManager.html#ae5023ac53f1deb85540abe79a174db26">Credit::New</a>();
<a name="l00653"></a>00653         c-&gt;<a class="code" href="classCredit.html#af7898eb802885a65e5270096e0595abe">vc</a>.insert(f-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>);
<a name="l00654"></a>00654         <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#a29ed2215fd1bb54fa20e9429804a460f">WriteCredit</a>(c, <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l00655"></a>00655         
<a name="l00656"></a>00656 <span class="preprocessor">#ifdef TRACK_FLOWS</span>
<a name="l00657"></a>00657 <span class="preprocessor"></span>        ++<a class="code" href="classTrafficManager.html#a5750805ce26dfd96ae787a67886705e3">_ejected_flits</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>];
<a name="l00658"></a>00658 <span class="preprocessor">#endif</span>
<a name="l00659"></a>00659 <span class="preprocessor"></span>        
<a name="l00660"></a>00660         <a class="code" href="classGPUTrafficManager.html#ac7932e4da1eb3c786c69e1d1941ffeba">_RetireFlit</a>(f, <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l00661"></a>00661       }
<a name="l00662"></a>00662     }
<a name="l00663"></a>00663     flits[subnet].clear();
<a name="l00664"></a>00664     <span class="comment">// _InteralStep here</span>
<a name="l00665"></a>00665     <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#a7c07ce3ba986fa4ece480d69e77bc306">Evaluate</a>( );
<a name="l00666"></a>00666     <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#a263b74ad4788388f53820a69633f0e24">WriteOutputs</a>( );
<a name="l00667"></a>00667   }
<a name="l00668"></a>00668   
<a name="l00669"></a>00669   ++<a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a>;
<a name="l00670"></a>00670   assert(<a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a>);
<a name="l00671"></a>00671   <span class="keywordflow">if</span>(<a class="code" href="globals_8hpp.html#a35b664146e55660800a67a648cf6748d">gTrace</a>){
<a name="l00672"></a>00672     cout&lt;&lt;<span class="stringliteral">&quot;TIME &quot;</span>&lt;&lt;<a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a>&lt;&lt;endl;
<a name="l00673"></a>00673   }
<a name="l00674"></a>00674   
<a name="l00675"></a>00675 }
<a name="l00676"></a>00676 
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 13 May 2014 for GPGPU-Sim by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
