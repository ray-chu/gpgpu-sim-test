<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GPGPU-Sim: v3.x/src/gpuwattch/cacti/nuca.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_c934b74ccb33d6b9bfd1e576787940d8.html">v3.x</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_da58ad9beee6988f697f1a76e412a52a.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_e4ac30e7c77047a48208b8444737dc6a.html">gpuwattch</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_9c4b365597bf32c8652137a0e3833a05.html">cacti</a>
  </div>
</div>
<div class="contents">
<h1>nuca.cc</h1><a href="nuca_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*****************************************************************************</span>
<a name="l00002"></a>00002 <span class="comment"> *                                McPAT/CACTI</span>
<a name="l00003"></a>00003 <span class="comment"> *                      SOFTWARE LICENSE AGREEMENT</span>
<a name="l00004"></a>00004 <span class="comment"> *            Copyright 2012 Hewlett-Packard Development Company, L.P.</span>
<a name="l00005"></a>00005 <span class="comment"> *                          All Rights Reserved</span>
<a name="l00006"></a>00006 <span class="comment"> *</span>
<a name="l00007"></a>00007 <span class="comment"> * Redistribution and use in source and binary forms, with or without</span>
<a name="l00008"></a>00008 <span class="comment"> * modification, are permitted provided that the following conditions are</span>
<a name="l00009"></a>00009 <span class="comment"> * met: redistributions of source code must retain the above copyright</span>
<a name="l00010"></a>00010 <span class="comment"> * notice, this list of conditions and the following disclaimer;</span>
<a name="l00011"></a>00011 <span class="comment"> * redistributions in binary form must reproduce the above copyright</span>
<a name="l00012"></a>00012 <span class="comment"> * notice, this list of conditions and the following disclaimer in the</span>
<a name="l00013"></a>00013 <span class="comment"> * documentation and/or other materials provided with the distribution;</span>
<a name="l00014"></a>00014 <span class="comment"> * neither the name of the copyright holders nor the names of its</span>
<a name="l00015"></a>00015 <span class="comment"> * contributors may be used to endorse or promote products derived from</span>
<a name="l00016"></a>00016 <span class="comment"> * this software without specific prior written permission.</span>
<a name="l00017"></a>00017 <span class="comment"></span>
<a name="l00018"></a>00018 <span class="comment"> * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS</span>
<a name="l00019"></a>00019 <span class="comment"> * &quot;AS IS&quot; AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT</span>
<a name="l00020"></a>00020 <span class="comment"> * LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR</span>
<a name="l00021"></a>00021 <span class="comment"> * A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT</span>
<a name="l00022"></a>00022 <span class="comment"> * OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,</span>
<a name="l00023"></a>00023 <span class="comment"> * SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT</span>
<a name="l00024"></a>00024 <span class="comment"> * LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,</span>
<a name="l00025"></a>00025 <span class="comment"> * DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY</span>
<a name="l00026"></a>00026 <span class="comment"> * THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00027"></a>00027 <span class="comment"> * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00028"></a>00028 <span class="comment"> * OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.‚Äù</span>
<a name="l00029"></a>00029 <span class="comment"> *</span>
<a name="l00030"></a>00030 <span class="comment"> ***************************************************************************/</span>
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;<a class="code" href="nuca_8h.html">nuca.h</a>&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;<a class="code" href="Ucache_8h.html">Ucache.h</a>&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00037"></a>00037 
<a name="l00038"></a><a class="code" href="nuca_8cc.html#a72d046cd8758221d9091d0886bf65c66">00038</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="nuca_8cc.html#a72d046cd8758221d9091d0886bf65c66">MIN_BANKSIZE</a>=65536;
<a name="l00039"></a>00039 <span class="preprocessor">#define FIXED_OVERHEAD 55e-12 </span><span class="comment">/* clock skew and jitter in s. Ref: Hrishikesh et al ISCA 01 */</span>
<a name="l00040"></a>00040 <span class="preprocessor">#define LATCH_DELAY 28e-12 </span><span class="comment">/* latch delay in s (later should use FO4 TODO) */</span>
<a name="l00041"></a>00041 <span class="preprocessor">#define CONTR_2_BANK_LAT 0</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span>
<a name="l00043"></a><a class="code" href="nuca_8cc.html#a2cc6d5da4ffdd7c9b91b622a0ed9cdd4">00043</a> <span class="keywordtype">int</span> <a class="code" href="nuca_8cc.html#a2cc6d5da4ffdd7c9b91b622a0ed9cdd4">cont_stats</a>[2 <span class="comment">/*l2 or l3*/</span>][5<span class="comment">/* cores */</span>][ROUTER_TYPES][7 <span class="comment">/*banks*/</span>][8 <span class="comment">/* cycle time */</span>];
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="classNuca.html#a7525d93e8a1bf0ab6104aabd06261cce">00045</a>   <a class="code" href="classNuca.html#a7525d93e8a1bf0ab6104aabd06261cce">Nuca::Nuca</a>(
<a name="l00046"></a>00046       <a class="code" href="classTechnologyParameter_1_1DeviceType.html">TechnologyParameter::DeviceType</a> *dt = &amp;(<a class="code" href="parameter_8cc.html#a68cc17910d7f6b81503127badecd0133">g_tp</a>.<a class="code" href="classTechnologyParameter.html#a806839383c23ee93df12e0cbf1b77a02">peri_global</a>)
<a name="l00047"></a>00047       ):deviceType(dt)
<a name="l00048"></a>00048 {
<a name="l00049"></a>00049   <a class="code" href="classNuca.html#ab93f015fe6ae4bdca76f2cdadfe1fc46">init_cont</a>();
<a name="l00050"></a>00050 }
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="keywordtype">void</span>
<a name="l00053"></a><a class="code" href="classNuca.html#ab93f015fe6ae4bdca76f2cdadfe1fc46">00053</a> <a class="code" href="classNuca.html#ab93f015fe6ae4bdca76f2cdadfe1fc46">Nuca::init_cont</a>()
<a name="l00054"></a>00054 {
<a name="l00055"></a>00055   FILE *cont;
<a name="l00056"></a>00056   <span class="keywordtype">char</span> line[5000];
<a name="l00057"></a>00057   <span class="keywordtype">char</span> jk[5000];
<a name="l00058"></a>00058   cont = fopen(<span class="stringliteral">&quot;contention.dat&quot;</span>, <span class="stringliteral">&quot;r&quot;</span>);
<a name="l00059"></a>00059   <span class="keywordflow">if</span> (!cont) {
<a name="l00060"></a>00060     cout &lt;&lt; <span class="stringliteral">&quot;contention.dat file is missing!\n&quot;</span>;
<a name="l00061"></a>00061     exit(0);
<a name="l00062"></a>00062   }
<a name="l00063"></a>00063 
<a name="l00064"></a>00064   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;2; i++) {
<a name="l00065"></a>00065     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=2; j&lt;5; j++) {
<a name="l00066"></a>00066       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;ROUTER_TYPES; k++) {
<a name="l00067"></a>00067         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l=0;l&lt;7; l++) {
<a name="l00068"></a>00068           <span class="keywordtype">int</span> *temp = cont_stats[i<span class="comment">/*l2 or l3*/</span>][j<span class="comment">/*core*/</span>][k<span class="comment">/*64 or 128 or 256 link bw*/</span>][l <span class="comment">/* no banks*/</span>];
<a name="l00069"></a>00069           assert(fscanf(cont, <span class="stringliteral">&quot;%[^\n]\n&quot;</span>, line) != EOF);
<a name="l00070"></a>00070           sscanf(line, <span class="stringliteral">&quot;%[^:]: %d %d %d %d %d %d %d %d&quot;</span>,jk, &amp;temp[0], &amp;temp[1], &amp;temp[2], &amp;temp[3],
<a name="l00071"></a>00071               &amp;temp[4], &amp;temp[5], &amp;temp[6], &amp;temp[7]);
<a name="l00072"></a>00072         }
<a name="l00073"></a>00073       }
<a name="l00074"></a>00074     }
<a name="l00075"></a>00075   }
<a name="l00076"></a>00076   fclose(cont);
<a name="l00077"></a>00077 }
<a name="l00078"></a>00078 
<a name="l00079"></a>00079   <span class="keywordtype">void</span>
<a name="l00080"></a><a class="code" href="classNuca.html#aaaccd5669b1b2b4f3f4972b3106c6d77">00080</a> <a class="code" href="classNuca.html#aaaccd5669b1b2b4f3f4972b3106c6d77">Nuca::print_cont_stats</a>()
<a name="l00081"></a>00081 {
<a name="l00082"></a>00082   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i&lt;2; i++) {
<a name="l00083"></a>00083     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j=2; j&lt;5; j++) {
<a name="l00084"></a>00084       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> k=0; k&lt;ROUTER_TYPES; k++) {
<a name="l00085"></a>00085         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> l=0;l&lt;7; l++) {
<a name="l00086"></a>00086           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> m=0;l&lt;7; l++) {
<a name="l00087"></a>00087             cout &lt;&lt; cont_stats[i][j][k][l][m] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l00088"></a>00088           }
<a name="l00089"></a>00089           cout &lt;&lt; endl;
<a name="l00090"></a>00090         }
<a name="l00091"></a>00091       }
<a name="l00092"></a>00092     }
<a name="l00093"></a>00093   }
<a name="l00094"></a>00094   cout &lt;&lt; endl;
<a name="l00095"></a>00095 }
<a name="l00096"></a>00096 
<a name="l00097"></a><a class="code" href="classNuca.html#a7aaedc1384074609fb9a42de5351dba3">00097</a> <a class="code" href="classNuca.html#a7aaedc1384074609fb9a42de5351dba3">Nuca::~Nuca</a>(){
<a name="l00098"></a>00098   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = <a class="code" href="classNuca.html#aa6b6091b0187d94d0588b95e2adaef40">wt_min</a>; i &lt;= <a class="code" href="classNuca.html#a67f895a5e60db16a929cc7d94b73d52b">wt_max</a>; i++) {
<a name="l00099"></a>00099     <span class="keyword">delete</span> <a class="code" href="classNuca.html#a5a468a0d77d375fd22e85cbebc81fa13">wire_vertical</a>[i];
<a name="l00100"></a>00100     <span class="keyword">delete</span> <a class="code" href="classNuca.html#a1bf0886ab1b4aaa76fd89c59a97a664b">wire_horizontal</a>[i];
<a name="l00101"></a>00101   }
<a name="l00102"></a>00102 }
<a name="l00103"></a>00103 
<a name="l00104"></a>00104 <span class="comment">/* converts latency (in s) to cycles depending upon the FREQUENCY (in GHz) */</span>
<a name="l00105"></a>00105   <span class="keywordtype">int</span>
<a name="l00106"></a><a class="code" href="classNuca.html#a1b6a92b1c0d51edf6238065d2c7ecb2c">00106</a> <a class="code" href="classNuca.html#a1b6a92b1c0d51edf6238065d2c7ecb2c">Nuca::calc_cycles</a>(<span class="keywordtype">double</span> lat, <span class="keywordtype">double</span> oper_freq)
<a name="l00107"></a>00107 {
<a name="l00108"></a>00108   <span class="comment">//TODO: convert latch delay to FO4 */</span>
<a name="l00109"></a>00109   <span class="keywordtype">double</span> <a class="code" href="classComponent.html#abf1cc962a87f9dc7c8f04af980674c20">cycle_time</a> = (1.0/(oper_freq*1e9)); <span class="comment">/*s*/</span>
<a name="l00110"></a>00110   cycle_time -= LATCH_DELAY;
<a name="l00111"></a>00111   cycle_time -= FIXED_OVERHEAD;
<a name="l00112"></a>00112 
<a name="l00113"></a>00113   <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)ceil(lat/cycle_time);
<a name="l00114"></a>00114 }
<a name="l00115"></a>00115 
<a name="l00116"></a>00116 
<a name="l00117"></a><a class="code" href="classnuca__org__t.html#a6d702941dd52b9fe369239b3e95cd397">00117</a> <a class="code" href="classnuca__org__t.html#a6d702941dd52b9fe369239b3e95cd397">nuca_org_t::~nuca_org_t</a>() {
<a name="l00118"></a>00118   <span class="comment">// if(h_wire) delete h_wire;</span>
<a name="l00119"></a>00119   <span class="comment">// if(v_wire) delete v_wire;</span>
<a name="l00120"></a>00120   <span class="comment">// if(router) delete router;</span>
<a name="l00121"></a>00121 }
<a name="l00122"></a>00122 
<a name="l00123"></a>00123 <span class="comment">/*</span>
<a name="l00124"></a>00124 <span class="comment"> * Version - 6.0</span>
<a name="l00125"></a>00125 <span class="comment"> *</span>
<a name="l00126"></a>00126 <span class="comment"> * Perform exhaustive search across different bank organizatons,</span>
<a name="l00127"></a>00127 <span class="comment"> * router configurations, grid organizations, and wire models and</span>
<a name="l00128"></a>00128 <span class="comment"> * find an optimal NUCA organization</span>
<a name="l00129"></a>00129 <span class="comment"> * For different bank count values</span>
<a name="l00130"></a>00130 <span class="comment"> * 1. Optimal bank organization is calculated</span>
<a name="l00131"></a>00131 <span class="comment"> * 2. For each bank organization, find different NUCA organizations</span>
<a name="l00132"></a>00132 <span class="comment"> *    using various router configurations, grid organizations,</span>
<a name="l00133"></a>00133 <span class="comment"> *    and wire models.</span>
<a name="l00134"></a>00134 <span class="comment"> * 3. NUCA model with the least cost is picked for</span>
<a name="l00135"></a>00135 <span class="comment"> *    this particular bank count</span>
<a name="l00136"></a>00136 <span class="comment"> * Finally include contention statistics and find the optimal</span>
<a name="l00137"></a>00137 <span class="comment"> *    NUCA configuration</span>
<a name="l00138"></a>00138 <span class="comment"> */</span>
<a name="l00139"></a>00139   <span class="keywordtype">void</span>
<a name="l00140"></a><a class="code" href="classNuca.html#a6f96e7d3b43146913e3055a8e9250a7c">00140</a> <a class="code" href="classNuca.html#a6f96e7d3b43146913e3055a8e9250a7c">Nuca::sim_nuca</a>()
<a name="l00141"></a>00141 {
<a name="l00142"></a>00142   <span class="comment">/* temp variables */</span>
<a name="l00143"></a>00143   <span class="keywordtype">int</span> it, ro, wr;
<a name="l00144"></a>00144   <span class="keywordtype">int</span> num_cyc;
<a name="l00145"></a>00145   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i, j;
<a name="l00146"></a>00146   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> r, c;
<a name="l00147"></a>00147   <span class="keywordtype">int</span> l2_c;
<a name="l00148"></a>00148   <span class="keywordtype">int</span> bank_count = 0;
<a name="l00149"></a>00149   <a class="code" href="classuca__org__t.html">uca_org_t</a> ures;
<a name="l00150"></a>00150   <a class="code" href="classnuca__org__t.html">nuca_org_t</a> *opt_n;
<a name="l00151"></a>00151   <a class="code" href="classmem__array.html">mem_array</a> tag, data;
<a name="l00152"></a>00152   list&lt;nuca_org_t *&gt; nuca_list;
<a name="l00153"></a>00153   <a class="code" href="classMCPAT__Router.html">MCPAT_Router</a> *router_s[ROUTER_TYPES];
<a name="l00154"></a>00154   router_s[0] = <span class="keyword">new</span> <a class="code" href="classMCPAT__Router.html">MCPAT_Router</a>(64.0, 8, 4, &amp;(<a class="code" href="parameter_8cc.html#a68cc17910d7f6b81503127badecd0133">g_tp</a>.<a class="code" href="classTechnologyParameter.html#a806839383c23ee93df12e0cbf1b77a02">peri_global</a>));
<a name="l00155"></a>00155   router_s[0]-&gt;<a class="code" href="classMCPAT__Router.html#a9d8a6098aeabde540b2a956529e171db">print_router</a>();
<a name="l00156"></a>00156   router_s[1] = <span class="keyword">new</span> <a class="code" href="classMCPAT__Router.html">MCPAT_Router</a>(128.0, 8, 4, &amp;(<a class="code" href="parameter_8cc.html#a68cc17910d7f6b81503127badecd0133">g_tp</a>.<a class="code" href="classTechnologyParameter.html#a806839383c23ee93df12e0cbf1b77a02">peri_global</a>));
<a name="l00157"></a>00157   router_s[1]-&gt;<a class="code" href="classMCPAT__Router.html#a9d8a6098aeabde540b2a956529e171db">print_router</a>();
<a name="l00158"></a>00158   router_s[2] = <span class="keyword">new</span> <a class="code" href="classMCPAT__Router.html">MCPAT_Router</a>(256.0, 8, 4, &amp;(<a class="code" href="parameter_8cc.html#a68cc17910d7f6b81503127badecd0133">g_tp</a>.<a class="code" href="classTechnologyParameter.html#a806839383c23ee93df12e0cbf1b77a02">peri_global</a>));
<a name="l00159"></a>00159   router_s[2]-&gt;<a class="code" href="classMCPAT__Router.html#a9d8a6098aeabde540b2a956529e171db">print_router</a>();
<a name="l00160"></a>00160 
<a name="l00161"></a>00161   <span class="keywordtype">int</span> core_in; <span class="comment">// to store no. of cores</span>
<a name="l00162"></a>00162 
<a name="l00163"></a>00163   <span class="comment">/* to search diff grid organizations */</span>
<a name="l00164"></a>00164   <span class="keywordtype">double</span> curr_hop, totno_hops, totno_hhops, totno_vhops, tot_lat,
<a name="l00165"></a>00165          curr_acclat;
<a name="l00166"></a>00166   <span class="keywordtype">double</span> avg_lat, avg_hop, avg_hhop, avg_vhop, avg_dyn_power,
<a name="l00167"></a>00167          avg_leakage_power;
<a name="l00168"></a>00168 
<a name="l00169"></a>00169   <span class="keywordtype">double</span> opt_acclat = INF;
<a name="l00170"></a>00170   <span class="keywordtype">int</span> opt_rows = 0;
<a name="l00171"></a>00171   <span class="keywordtype">int</span> opt_columns = 0;
<a name="l00172"></a>00172   <span class="keywordtype">double</span> opt_avg_hop = 0;
<a name="l00173"></a>00173   <span class="keywordtype">double</span> opt_dyn_power = 0, opt_leakage_power = 0;
<a name="l00174"></a>00174   <a class="code" href="classmin__values__t.html">min_values_t</a> minval;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176   <span class="keywordtype">int</span> bank_start = 0;
<a name="l00177"></a>00177 
<a name="l00178"></a>00178   <span class="keywordtype">int</span> flit_width = 0;
<a name="l00179"></a>00179 
<a name="l00180"></a>00180   <span class="comment">/* vertical and horizontal hop latency values */</span>
<a name="l00181"></a>00181   <span class="keywordtype">int</span> ver_hop_lat, hor_hop_lat; <span class="comment">/* in cycles */</span>
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 
<a name="l00184"></a>00184   <span class="comment">/* no. of different bank sizes to consider */</span>
<a name="l00185"></a>00185   <span class="keywordtype">int</span> iterations;
<a name="l00186"></a>00186 
<a name="l00187"></a>00187 
<a name="l00188"></a>00188   <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#af02b11bf2855b293ee3787846cc82238">nuca_cache_sz</a> = <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a1de1de88d834a69b8a4e003a12ccf077">cache_sz</a>;
<a name="l00189"></a>00189   nuca_list.push_back(<span class="keyword">new</span> <a class="code" href="classnuca__org__t.html">nuca_org_t</a>());
<a name="l00190"></a>00190 
<a name="l00191"></a>00191   <span class="keywordflow">if</span> (<a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#ac808842cdacdb4ccd3e0903006cba978">cache_level</a> == 0) l2_c = 1;
<a name="l00192"></a>00192   <span class="keywordflow">else</span> l2_c = 0;
<a name="l00193"></a>00193 
<a name="l00194"></a>00194   <span class="keywordflow">if</span> (<a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a50b9d8b2f895564fc308630718e39e75">cores</a> &lt;= 4) core_in = 2;
<a name="l00195"></a>00195   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a50b9d8b2f895564fc308630718e39e75">cores</a> &lt;= 8) core_in = 3;
<a name="l00196"></a>00196   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a50b9d8b2f895564fc308630718e39e75">cores</a> &lt;= 16) core_in = 4;
<a name="l00197"></a>00197   <span class="keywordflow">else</span> {cout &lt;&lt; <span class="stringliteral">&quot;Number of cores should be &lt;= 16!\n&quot;</span>; exit(0);}
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 
<a name="l00200"></a>00200   <span class="comment">// set the lower bound to an appropriate value. this depends on cache associativity</span>
<a name="l00201"></a>00201   <span class="keywordflow">if</span> (<a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a6393d1eb526068c199dffca0696eed27">assoc</a> &gt; 2) {
<a name="l00202"></a>00202     i = 2;
<a name="l00203"></a>00203     <span class="keywordflow">while</span> (i != <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a6393d1eb526068c199dffca0696eed27">assoc</a>) {
<a name="l00204"></a>00204       <a class="code" href="nuca_8cc.html#a72d046cd8758221d9091d0886bf65c66">MIN_BANKSIZE</a> *= 2;
<a name="l00205"></a>00205       i *= 2;
<a name="l00206"></a>00206     }
<a name="l00207"></a>00207   }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209   iterations = (<a class="code" href="classint.html">int</a>)<a class="code" href="basic__circuit_8cc.html#a87cb8f676713a61c83b8672ec16508f4">logtwo</a>((<span class="keywordtype">int</span>)<a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a1de1de88d834a69b8a4e003a12ccf077">cache_sz</a>/<a class="code" href="nuca_8cc.html#a72d046cd8758221d9091d0886bf65c66">MIN_BANKSIZE</a>);
<a name="l00210"></a>00210 
<a name="l00211"></a>00211   <span class="keywordflow">if</span> (<a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a26d50cc6944de7ca1d1a73eea4e16484">force_wiretype</a>)
<a name="l00212"></a>00212   {
<a name="l00213"></a>00213     <span class="keywordflow">if</span> (<a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a5024da486a66b224dadb4b2ed9e251f3">wt</a> == <a class="code" href="cacti__interface_8h.html#a0d0a6912be8bcbfb10f9bfea163e0432a22e0066214db4f2450dfe98e2f942160">Low_swing</a>) {
<a name="l00214"></a>00214       <a class="code" href="classNuca.html#aa6b6091b0187d94d0588b95e2adaef40">wt_min</a> = <a class="code" href="cacti__interface_8h.html#a0d0a6912be8bcbfb10f9bfea163e0432a22e0066214db4f2450dfe98e2f942160">Low_swing</a>;
<a name="l00215"></a>00215       <a class="code" href="classNuca.html#a67f895a5e60db16a929cc7d94b73d52b">wt_max</a> = <a class="code" href="cacti__interface_8h.html#a0d0a6912be8bcbfb10f9bfea163e0432a22e0066214db4f2450dfe98e2f942160">Low_swing</a>;
<a name="l00216"></a>00216     }
<a name="l00217"></a>00217     <span class="keywordflow">else</span> {
<a name="l00218"></a>00218       <a class="code" href="classNuca.html#aa6b6091b0187d94d0588b95e2adaef40">wt_min</a> = <a class="code" href="cacti__interface_8h.html#a0d0a6912be8bcbfb10f9bfea163e0432a03ddcda8467f404189c984dc13409aa8">Global</a>;
<a name="l00219"></a>00219       <a class="code" href="classNuca.html#a67f895a5e60db16a929cc7d94b73d52b">wt_max</a> = <a class="code" href="cacti__interface_8h.html#a0d0a6912be8bcbfb10f9bfea163e0432a22e0066214db4f2450dfe98e2f942160">Low_swing</a>-1;
<a name="l00220"></a>00220     }
<a name="l00221"></a>00221   }
<a name="l00222"></a>00222   <span class="keywordflow">else</span> {
<a name="l00223"></a>00223     <a class="code" href="classNuca.html#aa6b6091b0187d94d0588b95e2adaef40">wt_min</a> = <a class="code" href="cacti__interface_8h.html#a0d0a6912be8bcbfb10f9bfea163e0432a03ddcda8467f404189c984dc13409aa8">Global</a>;
<a name="l00224"></a>00224     <a class="code" href="classNuca.html#a67f895a5e60db16a929cc7d94b73d52b">wt_max</a> = <a class="code" href="cacti__interface_8h.html#a0d0a6912be8bcbfb10f9bfea163e0432a22e0066214db4f2450dfe98e2f942160">Low_swing</a>;
<a name="l00225"></a>00225   }
<a name="l00226"></a>00226   <span class="keywordflow">if</span> (<a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#ac644e18424c7f81de6937f450183f1e1">nuca_bank_count</a> != 0) { <span class="comment">// simulate just one bank</span>
<a name="l00227"></a>00227     <span class="keywordflow">if</span> (<a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#ac644e18424c7f81de6937f450183f1e1">nuca_bank_count</a> != 2 &amp;&amp; <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#ac644e18424c7f81de6937f450183f1e1">nuca_bank_count</a> != 4 &amp;&amp;
<a name="l00228"></a>00228         <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#ac644e18424c7f81de6937f450183f1e1">nuca_bank_count</a> != 8 &amp;&amp; <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#ac644e18424c7f81de6937f450183f1e1">nuca_bank_count</a> != 16 &amp;&amp;
<a name="l00229"></a>00229         <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#ac644e18424c7f81de6937f450183f1e1">nuca_bank_count</a> != 32 &amp;&amp; <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#ac644e18424c7f81de6937f450183f1e1">nuca_bank_count</a> != 64) {
<a name="l00230"></a>00230       fprintf(stderr,<span class="stringliteral">&quot;Incorrect bank count value! Please fix the value in cache.cfg\n&quot;</span>);
<a name="l00231"></a>00231     }
<a name="l00232"></a>00232     bank_start = (<a class="code" href="classint.html">int</a>)<a class="code" href="basic__circuit_8cc.html#a87cb8f676713a61c83b8672ec16508f4">logtwo</a>((<span class="keywordtype">double</span>)<a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#ac644e18424c7f81de6937f450183f1e1">nuca_bank_count</a>);
<a name="l00233"></a>00233     iterations = bank_start+1;
<a name="l00234"></a>00234     <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a1de1de88d834a69b8a4e003a12ccf077">cache_sz</a> = <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a1de1de88d834a69b8a4e003a12ccf077">cache_sz</a>/<a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#ac644e18424c7f81de6937f450183f1e1">nuca_bank_count</a>;
<a name="l00235"></a>00235   }
<a name="l00236"></a>00236   cout &lt;&lt; <span class="stringliteral">&quot;Simulating various NUCA configurations\n&quot;</span>;
<a name="l00237"></a>00237   <span class="keywordflow">for</span> (it=bank_start; it&lt;iterations; it++) { <span class="comment">/* different bank count values */</span>
<a name="l00238"></a>00238     ures.<a class="code" href="classuca__org__t.html#a3a5e6aab9d0554e5642903d975086540">tag_array2</a> = &amp;tag;
<a name="l00239"></a>00239     ures.<a class="code" href="classuca__org__t.html#a3f1e06fc538edaf77f5ba58d3e3059a6">data_array2</a> = &amp;data;
<a name="l00240"></a>00240     <span class="comment">/*</span>
<a name="l00241"></a>00241 <span class="comment">     * find the optimal bank organization</span>
<a name="l00242"></a>00242 <span class="comment">     */</span>
<a name="l00243"></a>00243     <a class="code" href="Ucache_8cc.html#a9c5a822280caa234c5c1fbf3b978500a">solve</a>(&amp;ures);
<a name="l00244"></a>00244 <span class="comment">//    output_UCA(&amp;ures);</span>
<a name="l00245"></a>00245     bank_count = <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#af02b11bf2855b293ee3787846cc82238">nuca_cache_sz</a>/<a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a1de1de88d834a69b8a4e003a12ccf077">cache_sz</a>;
<a name="l00246"></a>00246     cout &lt;&lt; <span class="stringliteral">&quot;====&quot;</span> &lt;&lt;  <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a1de1de88d834a69b8a4e003a12ccf077">cache_sz</a> &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00247"></a>00247 
<a name="l00248"></a>00248     <span class="keywordflow">for</span> (wr=<a class="code" href="classNuca.html#aa6b6091b0187d94d0588b95e2adaef40">wt_min</a>; wr&lt;=<a class="code" href="classNuca.html#a67f895a5e60db16a929cc7d94b73d52b">wt_max</a>; wr++) {
<a name="l00249"></a>00249 
<a name="l00250"></a>00250       <span class="keywordflow">for</span> (ro=0; ro&lt;ROUTER_TYPES; ro++)
<a name="l00251"></a>00251       {
<a name="l00252"></a>00252         flit_width = (<a class="code" href="classint.html">int</a>) router_s[ro]-&gt;flit_size; <span class="comment">//initialize router</span>
<a name="l00253"></a>00253         nuca_list.back()-&gt;nuca_pda.<a class="code" href="classMCPAT__Router.html#a5a1caa68dbfee44430dd0d27497b05ba">cycle_time</a> = router_s[ro]-&gt;<a class="code" href="classMCPAT__Router.html#a5a1caa68dbfee44430dd0d27497b05ba">cycle_time</a>;
<a name="l00254"></a>00254 
<a name="l00255"></a>00255         <span class="comment">/* calculate router and wire parameters */</span>
<a name="l00256"></a>00256 
<a name="l00257"></a>00257         <span class="keywordtype">double</span> vlength = ures.<a class="code" href="classuca__org__t.html#a198b601387c5cb5849ea3cda2186c1b4">cache_ht</a>; <span class="comment">/* length of the wire (u)*/</span>
<a name="l00258"></a>00258         <span class="keywordtype">double</span> hlength = ures.<a class="code" href="classuca__org__t.html#a4428db1051154f0109d206f5fe0913ef">cache_len</a>; <span class="comment">// u</span>
<a name="l00259"></a>00259 
<a name="l00260"></a>00260         <span class="comment">/* find delay, area, and power for wires */</span>
<a name="l00261"></a>00261         <a class="code" href="classNuca.html#a5a468a0d77d375fd22e85cbebc81fa13">wire_vertical</a>[wr] = <span class="keyword">new</span> <a class="code" href="classWire.html">Wire</a>((<span class="keyword">enum</span> <a class="code" href="cacti__interface_8h.html#a0d0a6912be8bcbfb10f9bfea163e0432">Wire_type</a>) wr, vlength);
<a name="l00262"></a>00262         <a class="code" href="classNuca.html#a1bf0886ab1b4aaa76fd89c59a97a664b">wire_horizontal</a>[wr] = <span class="keyword">new</span> <a class="code" href="classWire.html">Wire</a>((<span class="keyword">enum</span> <a class="code" href="cacti__interface_8h.html#a0d0a6912be8bcbfb10f9bfea163e0432">Wire_type</a>) wr, hlength);
<a name="l00263"></a>00263 
<a name="l00264"></a>00264 
<a name="l00265"></a>00265         hor_hop_lat = <a class="code" href="classNuca.html#a1b6a92b1c0d51edf6238065d2c7ecb2c">calc_cycles</a>(<a class="code" href="classNuca.html#a1bf0886ab1b4aaa76fd89c59a97a664b">wire_horizontal</a>[wr]-&gt;<a class="code" href="classComponent.html#ada6524bc83a57cbaf53b78a459cef86b">delay</a>,
<a name="l00266"></a>00266             1/(nuca_list.back()-&gt;nuca_pda.cycle_time*.001));
<a name="l00267"></a>00267         ver_hop_lat = <a class="code" href="classNuca.html#a1b6a92b1c0d51edf6238065d2c7ecb2c">calc_cycles</a>(<a class="code" href="classNuca.html#a5a468a0d77d375fd22e85cbebc81fa13">wire_vertical</a>[wr]-&gt;<a class="code" href="classComponent.html#ada6524bc83a57cbaf53b78a459cef86b">delay</a>,
<a name="l00268"></a>00268             1/(nuca_list.back()-&gt;nuca_pda.cycle_time*.001));
<a name="l00269"></a>00269 
<a name="l00270"></a>00270         <span class="comment">/*</span>
<a name="l00271"></a>00271 <span class="comment">         * assume a grid like topology and explore for optimal network</span>
<a name="l00272"></a>00272 <span class="comment">         * configuration using different row and column count values.</span>
<a name="l00273"></a>00273 <span class="comment">         */</span>
<a name="l00274"></a>00274         <span class="keywordflow">for</span> (c=1; c&lt;=(<span class="keywordtype">unsigned</span> <a class="code" href="classint.html">int</a>)bank_count; c++) {
<a name="l00275"></a>00275           <span class="keywordflow">while</span> (bank_count%c != 0) c++;
<a name="l00276"></a>00276           r = bank_count/c;
<a name="l00277"></a>00277 
<a name="l00278"></a>00278           <span class="comment">/*</span>
<a name="l00279"></a>00279 <span class="comment">           * to find the avg access latency of a NUCA cache, uncontended</span>
<a name="l00280"></a>00280 <span class="comment">           * access time to each bank from the</span>
<a name="l00281"></a>00281 <span class="comment">           * cache controller is calculated.</span>
<a name="l00282"></a>00282 <span class="comment">           * avg latency =</span>
<a name="l00283"></a>00283 <span class="comment">           * sum of the access latencies to individual banks)/bank</span>
<a name="l00284"></a>00284 <span class="comment">           * count value.</span>
<a name="l00285"></a>00285 <span class="comment">           */</span>
<a name="l00286"></a>00286           totno_hops = totno_hhops = totno_vhops = tot_lat = 0;
<a name="l00287"></a>00287           
<a name="l00288"></a>00288           <span class="keywordflow">for</span> (i=0; i&lt;r; i++) {
<a name="l00289"></a>00289             <span class="keywordflow">for</span> (j=0; j&lt;c; j++) {
<a name="l00290"></a>00290               <span class="comment">/*</span>
<a name="l00291"></a>00291 <span class="comment">               * vertical hops including the</span>
<a name="l00292"></a>00292 <span class="comment">               * first hop from the cache controller</span>
<a name="l00293"></a>00293 <span class="comment">               */</span>
<a name="l00294"></a>00294               curr_hop = i + 1;
<a name="l00295"></a>00295               curr_hop += j; <span class="comment">/* horizontal hops */</span>
<a name="l00296"></a>00296               totno_hhops += j;
<a name="l00297"></a>00297               totno_vhops += (i+1);
<a name="l00298"></a>00298               curr_acclat = (i * ver_hop_lat + CONTR_2_BANK_LAT +
<a name="l00299"></a>00299                   j * hor_hop_lat);
<a name="l00300"></a>00300 
<a name="l00301"></a>00301               tot_lat += curr_acclat;
<a name="l00302"></a>00302               totno_hops += curr_hop;
<a name="l00303"></a>00303             }
<a name="l00304"></a>00304           }
<a name="l00305"></a>00305           avg_lat = tot_lat/bank_count;
<a name="l00306"></a>00306           avg_hop = totno_hops/bank_count;
<a name="l00307"></a>00307           avg_hhop = totno_hhops/bank_count;
<a name="l00308"></a>00308           avg_vhop = totno_vhops/bank_count;
<a name="l00309"></a>00309 
<a name="l00310"></a>00310           <span class="comment">/* net access latency */</span>
<a name="l00311"></a>00311           curr_acclat = 2*avg_lat + 2*(router_s[ro]-&gt;<a class="code" href="classComponent.html#ada6524bc83a57cbaf53b78a459cef86b">delay</a>*avg_hop) +
<a name="l00312"></a>00312             <a class="code" href="classNuca.html#a1b6a92b1c0d51edf6238065d2c7ecb2c">calc_cycles</a>(ures.<a class="code" href="classuca__org__t.html#a1828396d50a278088a7bac0878bd25dd">access_time</a>,
<a name="l00313"></a>00313                 1/(nuca_list.back()-&gt;nuca_pda.cycle_time*.001));
<a name="l00314"></a>00314 
<a name="l00315"></a>00315           <span class="comment">/* avg access lat of nuca */</span>
<a name="l00316"></a>00316           avg_dyn_power =
<a name="l00317"></a>00317             avg_hop *
<a name="l00318"></a>00318             (router_s[ro]-&gt;<a class="code" href="classComponent.html#a78cbcea978fe7b69afafed36179f38ac">power</a>.<a class="code" href="classpowerDef.html#ab80f3c788fda52adc2265f931add66d7">readOp</a>.<a class="code" href="classpowerComponents.html#adbc9cc35c7bd7abc39074f473d653343">dynamic</a>) + avg_hhop *
<a name="l00319"></a>00319             (<a class="code" href="classNuca.html#a1bf0886ab1b4aaa76fd89c59a97a664b">wire_horizontal</a>[wr]-&gt;<a class="code" href="classComponent.html#a78cbcea978fe7b69afafed36179f38ac">power</a>.<a class="code" href="classpowerDef.html#ab80f3c788fda52adc2265f931add66d7">readOp</a>.<a class="code" href="classpowerComponents.html#adbc9cc35c7bd7abc39074f473d653343">dynamic</a>) *
<a name="l00320"></a>00320             (<a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#ac6f9b0ee091744a5a4c27f7c66c10d97">block_sz</a>*8 + 64) + avg_vhop *
<a name="l00321"></a>00321             (<a class="code" href="classNuca.html#a5a468a0d77d375fd22e85cbebc81fa13">wire_vertical</a>[wr]-&gt;<a class="code" href="classComponent.html#a78cbcea978fe7b69afafed36179f38ac">power</a>.<a class="code" href="classpowerDef.html#ab80f3c788fda52adc2265f931add66d7">readOp</a>.<a class="code" href="classpowerComponents.html#adbc9cc35c7bd7abc39074f473d653343">dynamic</a>) *
<a name="l00322"></a>00322             (<a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#ac6f9b0ee091744a5a4c27f7c66c10d97">block_sz</a>*8 + 64) + ures.<a class="code" href="classuca__org__t.html#a5758451e3b486d6ba00844e69cc89e7d">power</a>.<a class="code" href="classpowerDef.html#ab80f3c788fda52adc2265f931add66d7">readOp</a>.<a class="code" href="classpowerComponents.html#adbc9cc35c7bd7abc39074f473d653343">dynamic</a>;
<a name="l00323"></a>00323 
<a name="l00324"></a>00324           avg_leakage_power =
<a name="l00325"></a>00325             bank_count * router_s[ro]-&gt;<a class="code" href="classComponent.html#a78cbcea978fe7b69afafed36179f38ac">power</a>.<a class="code" href="classpowerDef.html#ab80f3c788fda52adc2265f931add66d7">readOp</a>.<a class="code" href="classpowerComponents.html#aad6331445a7b816dbe209e93869a0e23">leakage</a> +
<a name="l00326"></a>00326             avg_hhop * (<a class="code" href="classNuca.html#a1bf0886ab1b4aaa76fd89c59a97a664b">wire_horizontal</a>[wr]-&gt;<a class="code" href="classComponent.html#a78cbcea978fe7b69afafed36179f38ac">power</a>.<a class="code" href="classpowerDef.html#ab80f3c788fda52adc2265f931add66d7">readOp</a>.<a class="code" href="classpowerComponents.html#aad6331445a7b816dbe209e93869a0e23">leakage</a>*
<a name="l00327"></a>00327                 <a class="code" href="classNuca.html#a1bf0886ab1b4aaa76fd89c59a97a664b">wire_horizontal</a>[wr]-&gt;<a class="code" href="classComponent.html#ada6524bc83a57cbaf53b78a459cef86b">delay</a>) * flit_width +
<a name="l00328"></a>00328             avg_vhop * (<a class="code" href="classNuca.html#a5a468a0d77d375fd22e85cbebc81fa13">wire_vertical</a>[wr]-&gt;<a class="code" href="classComponent.html#a78cbcea978fe7b69afafed36179f38ac">power</a>.<a class="code" href="classpowerDef.html#ab80f3c788fda52adc2265f931add66d7">readOp</a>.<a class="code" href="classpowerComponents.html#aad6331445a7b816dbe209e93869a0e23">leakage</a> *
<a name="l00329"></a>00329                 <a class="code" href="classNuca.html#a1bf0886ab1b4aaa76fd89c59a97a664b">wire_horizontal</a>[wr]-&gt;<a class="code" href="classComponent.html#ada6524bc83a57cbaf53b78a459cef86b">delay</a>);
<a name="l00330"></a>00330 
<a name="l00331"></a>00331           <span class="keywordflow">if</span> (curr_acclat &lt; opt_acclat) {
<a name="l00332"></a>00332             opt_acclat = curr_acclat;
<a name="l00333"></a>00333             opt_avg_hop = avg_hop;
<a name="l00334"></a>00334             opt_rows = r;
<a name="l00335"></a>00335             opt_columns = c;
<a name="l00336"></a>00336             opt_dyn_power = avg_dyn_power;
<a name="l00337"></a>00337             opt_leakage_power = avg_leakage_power;
<a name="l00338"></a>00338           }
<a name="l00339"></a>00339           totno_hops = 0;
<a name="l00340"></a>00340           tot_lat = 0;
<a name="l00341"></a>00341           totno_hhops = 0;
<a name="l00342"></a>00342           totno_vhops = 0;
<a name="l00343"></a>00343         }
<a name="l00344"></a>00344         nuca_list.back()-&gt;wire_pda.power.readOp.dynamic =
<a name="l00345"></a>00345           opt_avg_hop * flit_width *
<a name="l00346"></a>00346           (<a class="code" href="classNuca.html#a1bf0886ab1b4aaa76fd89c59a97a664b">wire_horizontal</a>[wr]-&gt;<a class="code" href="classComponent.html#a78cbcea978fe7b69afafed36179f38ac">power</a>.<a class="code" href="classpowerDef.html#ab80f3c788fda52adc2265f931add66d7">readOp</a>.<a class="code" href="classpowerComponents.html#adbc9cc35c7bd7abc39074f473d653343">dynamic</a> +
<a name="l00347"></a>00347            <a class="code" href="classNuca.html#a5a468a0d77d375fd22e85cbebc81fa13">wire_vertical</a>[wr]-&gt;<a class="code" href="classComponent.html#a78cbcea978fe7b69afafed36179f38ac">power</a>.<a class="code" href="classpowerDef.html#ab80f3c788fda52adc2265f931add66d7">readOp</a>.<a class="code" href="classpowerComponents.html#adbc9cc35c7bd7abc39074f473d653343">dynamic</a>);
<a name="l00348"></a>00348         nuca_list.back()-&gt;avg_hops = opt_avg_hop;
<a name="l00349"></a>00349         <span class="comment">/* network delay/power */</span>
<a name="l00350"></a>00350         nuca_list.back()-&gt;h_wire = <a class="code" href="classNuca.html#a1bf0886ab1b4aaa76fd89c59a97a664b">wire_horizontal</a>[wr];
<a name="l00351"></a>00351         nuca_list.back()-&gt;v_wire = <a class="code" href="classNuca.html#a5a468a0d77d375fd22e85cbebc81fa13">wire_vertical</a>[wr];
<a name="l00352"></a>00352         nuca_list.back()-&gt;router = router_s[ro];
<a name="l00353"></a>00353         <span class="comment">/* bank delay/power */</span>
<a name="l00354"></a>00354 
<a name="l00355"></a>00355         nuca_list.back()-&gt;bank_pda.<a class="code" href="classComponent.html#ada6524bc83a57cbaf53b78a459cef86b">delay</a> = ures.<a class="code" href="classuca__org__t.html#a1828396d50a278088a7bac0878bd25dd">access_time</a>;
<a name="l00356"></a>00356         nuca_list.back()-&gt;bank_pda.power = ures.<a class="code" href="classuca__org__t.html#a5758451e3b486d6ba00844e69cc89e7d">power</a>;
<a name="l00357"></a>00357         nuca_list.back()-&gt;bank_pda.area.h = ures.<a class="code" href="classuca__org__t.html#a198b601387c5cb5849ea3cda2186c1b4">cache_ht</a>;
<a name="l00358"></a>00358         nuca_list.back()-&gt;bank_pda.area.w = ures.<a class="code" href="classuca__org__t.html#a4428db1051154f0109d206f5fe0913ef">cache_len</a>;
<a name="l00359"></a>00359         nuca_list.back()-&gt;bank_pda.cycle_time = ures.<a class="code" href="classuca__org__t.html#ae9e1345b0931c4cebecf2c5dea6194a5">cycle_time</a>;
<a name="l00360"></a>00360 
<a name="l00361"></a>00361         num_cyc = <a class="code" href="classNuca.html#a1b6a92b1c0d51edf6238065d2c7ecb2c">calc_cycles</a>(nuca_list.back()-&gt;bank_pda.delay <span class="comment">/*s*/</span>,
<a name="l00362"></a>00362             1/(nuca_list.back()-&gt;nuca_pda.cycle_time*.001<span class="comment">/*GHz*/</span>));
<a name="l00363"></a>00363         <span class="keywordflow">if</span>(num_cyc%2 != 0) num_cyc++;
<a name="l00364"></a>00364         <span class="keywordflow">if</span> (num_cyc &gt; 16) num_cyc = 16; <span class="comment">// we have data only up to 16 cycles</span>
<a name="l00365"></a>00365 
<a name="l00366"></a>00366         <span class="keywordflow">if</span> (it &lt; 7) {
<a name="l00367"></a>00367           nuca_list.back()-&gt;nuca_pda.delay = opt_acclat +
<a name="l00368"></a>00368             cont_stats[l2_c][core_in][ro][it][num_cyc/2-1];
<a name="l00369"></a>00369           nuca_list.back()-&gt;contention =
<a name="l00370"></a>00370             cont_stats[l2_c][core_in][ro][it][num_cyc/2-1];
<a name="l00371"></a>00371         }
<a name="l00372"></a>00372         <span class="keywordflow">else</span> {
<a name="l00373"></a>00373           nuca_list.back()-&gt;nuca_pda.delay = opt_acclat +
<a name="l00374"></a>00374             cont_stats[l2_c][core_in][ro][7][num_cyc/2-1];
<a name="l00375"></a>00375           nuca_list.back()-&gt;contention =
<a name="l00376"></a>00376             cont_stats[l2_c][core_in][ro][7][num_cyc/2-1];
<a name="l00377"></a>00377         }
<a name="l00378"></a>00378         nuca_list.back()-&gt;nuca_pda.power.readOp.dynamic = opt_dyn_power;
<a name="l00379"></a>00379         nuca_list.back()-&gt;nuca_pda.power.readOp.leakage = opt_leakage_power;
<a name="l00380"></a>00380 
<a name="l00381"></a>00381         <span class="comment">/* array organization */</span>
<a name="l00382"></a>00382         nuca_list.back()-&gt;bank_count = bank_count;
<a name="l00383"></a>00383         nuca_list.back()-&gt;rows = opt_rows;
<a name="l00384"></a>00384         nuca_list.back()-&gt;columns = opt_columns;
<a name="l00385"></a>00385         <a class="code" href="classNuca.html#aabbc351d21236286d9e306e547039ba3">calculate_nuca_area</a> (nuca_list.back());
<a name="l00386"></a>00386 
<a name="l00387"></a>00387         minval.<a class="code" href="classmin__values__t.html#afb1d99c3bb357e21e9589060f395091a">update_min_values</a>(nuca_list.back());
<a name="l00388"></a>00388         nuca_list.push_back(<span class="keyword">new</span> <a class="code" href="classnuca__org__t.html">nuca_org_t</a>());
<a name="l00389"></a>00389         opt_acclat = BIGNUM;
<a name="l00390"></a>00390 
<a name="l00391"></a>00391       }
<a name="l00392"></a>00392     }
<a name="l00393"></a>00393     <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a1de1de88d834a69b8a4e003a12ccf077">cache_sz</a> /= 2;
<a name="l00394"></a>00394   }
<a name="l00395"></a>00395 
<a name="l00396"></a>00396   <span class="keyword">delete</span>(nuca_list.back());
<a name="l00397"></a>00397   nuca_list.pop_back();
<a name="l00398"></a>00398   opt_n = <a class="code" href="classNuca.html#a24c04037a9167ece6cbcef5b5c32312f">find_optimal_nuca</a>(&amp;nuca_list, &amp;minval);
<a name="l00399"></a>00399   <a class="code" href="classNuca.html#a705020687469adf0757f78915a5c774c">print_nuca</a>(opt_n);
<a name="l00400"></a>00400   <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a1de1de88d834a69b8a4e003a12ccf077">cache_sz</a> = <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#af02b11bf2855b293ee3787846cc82238">nuca_cache_sz</a>/opt_n-&gt;<a class="code" href="classnuca__org__t.html#a20e94a3b5c39771ab2b9d6a5844c55a1">bank_count</a>;
<a name="l00401"></a>00401 
<a name="l00402"></a>00402   list&lt;nuca_org_t *&gt;::iterator niter;
<a name="l00403"></a>00403   <span class="keywordflow">for</span> (niter = nuca_list.begin(); niter != nuca_list.end(); ++niter)
<a name="l00404"></a>00404   {
<a name="l00405"></a>00405     <span class="keyword">delete</span> *niter;
<a name="l00406"></a>00406   }
<a name="l00407"></a>00407   nuca_list.clear();
<a name="l00408"></a>00408 
<a name="l00409"></a>00409   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=0; i &lt; ROUTER_TYPES; i++)
<a name="l00410"></a>00410   {
<a name="l00411"></a>00411     <span class="keyword">delete</span> router_s[i];
<a name="l00412"></a>00412   }
<a name="l00413"></a>00413   <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#aaebf82d7dd3919ae6980b18081b8df77">display_ip</a>();
<a name="l00414"></a>00414   <span class="comment">//  g_ip-&gt;force_cache_config = true;</span>
<a name="l00415"></a>00415   <span class="comment">//  g_ip-&gt;ndwl = 8;</span>
<a name="l00416"></a>00416   <span class="comment">//  g_ip-&gt;ndbl = 16;</span>
<a name="l00417"></a>00417   <span class="comment">//  g_ip-&gt;nspd = 4;</span>
<a name="l00418"></a>00418   <span class="comment">//  g_ip-&gt;ndcm = 1;</span>
<a name="l00419"></a>00419   <span class="comment">//  g_ip-&gt;ndsam1 = 8;</span>
<a name="l00420"></a>00420   <span class="comment">//  g_ip-&gt;ndsam2 = 32;</span>
<a name="l00421"></a>00421 
<a name="l00422"></a>00422 }
<a name="l00423"></a>00423 
<a name="l00424"></a>00424 
<a name="l00425"></a>00425   <span class="keywordtype">void</span>
<a name="l00426"></a><a class="code" href="classNuca.html#a705020687469adf0757f78915a5c774c">00426</a> <a class="code" href="classNuca.html#a705020687469adf0757f78915a5c774c">Nuca::print_nuca</a> (<a class="code" href="classnuca__org__t.html">nuca_org_t</a> *fr)
<a name="l00427"></a>00427 {
<a name="l00428"></a>00428   printf(<span class="stringliteral">&quot;\n---------- CACTI version 6.5, Non-uniform Cache Access &quot;</span>
<a name="l00429"></a>00429       <span class="stringliteral">&quot;----------\n\n&quot;</span>);
<a name="l00430"></a>00430   printf(<span class="stringliteral">&quot;Optimal number of banks - %d\n&quot;</span>, fr-&gt;<a class="code" href="classnuca__org__t.html#a20e94a3b5c39771ab2b9d6a5844c55a1">bank_count</a>);
<a name="l00431"></a>00431   printf(<span class="stringliteral">&quot;Grid organization rows x columns - %d x %d\n&quot;</span>,
<a name="l00432"></a>00432       fr-&gt;<a class="code" href="classnuca__org__t.html#a79afa5807f4906fb37ce41cd2b4a0a04">rows</a>, fr-&gt;<a class="code" href="classnuca__org__t.html#a4ef3b88d56b85910342465c55c6e2f9c">columns</a>);
<a name="l00433"></a>00433   printf(<span class="stringliteral">&quot;Network frequency - %g GHz\n&quot;</span>,
<a name="l00434"></a>00434       (1/fr-&gt;<a class="code" href="classnuca__org__t.html#adfbf859ff66fb9a8578756074f7394c4">nuca_pda</a>.<a class="code" href="classComponent.html#abf1cc962a87f9dc7c8f04af980674c20">cycle_time</a>)*1e3);
<a name="l00435"></a>00435   printf(<span class="stringliteral">&quot;Cache dimension (mm x mm) - %g x %g\n&quot;</span>,
<a name="l00436"></a>00436       fr-&gt;<a class="code" href="classnuca__org__t.html#adfbf859ff66fb9a8578756074f7394c4">nuca_pda</a>.<a class="code" href="classComponent.html#ab49a784742db060f4127df4459205e3f">area</a>.<a class="code" href="classArea.html#acaf29e1b1248af18823cd02aa4396d6e">h</a>,
<a name="l00437"></a>00437       fr-&gt;<a class="code" href="classnuca__org__t.html#adfbf859ff66fb9a8578756074f7394c4">nuca_pda</a>.<a class="code" href="classComponent.html#ab49a784742db060f4127df4459205e3f">area</a>.<a class="code" href="classArea.html#a924ebcc555467c49cb26b546e9dea27b">w</a>);
<a name="l00438"></a>00438 
<a name="l00439"></a>00439   fr-&gt;<a class="code" href="classnuca__org__t.html#a5c28dc23f75d9007525c6cadd5545fb7">router</a>-&gt;<a class="code" href="classMCPAT__Router.html#a9d8a6098aeabde540b2a956529e171db">print_router</a>();
<a name="l00440"></a>00440 
<a name="l00441"></a>00441   printf(<span class="stringliteral">&quot;\n\nWire stats:\n&quot;</span>);
<a name="l00442"></a>00442   <span class="keywordflow">if</span> (fr-&gt;<a class="code" href="classnuca__org__t.html#a730486a25e927078267d3fa2fe657b13">h_wire</a>-&gt;<a class="code" href="classWire.html#a2c8ffc5d174daceeca6e809270f930b2">wt</a> == <a class="code" href="cacti__interface_8h.html#a0d0a6912be8bcbfb10f9bfea163e0432a03ddcda8467f404189c984dc13409aa8">Global</a>) {
<a name="l00443"></a>00443     printf(<span class="stringliteral">&quot;\tWire type - Full swing global wires with least &quot;</span>
<a name="l00444"></a>00444         <span class="stringliteral">&quot;possible delay\n&quot;</span>);
<a name="l00445"></a>00445   }
<a name="l00446"></a>00446   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fr-&gt;<a class="code" href="classnuca__org__t.html#a730486a25e927078267d3fa2fe657b13">h_wire</a>-&gt;<a class="code" href="classWire.html#a2c8ffc5d174daceeca6e809270f930b2">wt</a> == <a class="code" href="cacti__interface_8h.html#a0d0a6912be8bcbfb10f9bfea163e0432acb9fa8154bfb9575fac65f5a59b29209">Global_5</a>) {
<a name="l00447"></a>00447     printf(<span class="stringliteral">&quot;\tWire type - Full swing global wires with &quot;</span>
<a name="l00448"></a>00448         <span class="stringliteral">&quot;5%% delay penalty\n&quot;</span>);
<a name="l00449"></a>00449   }
<a name="l00450"></a>00450   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fr-&gt;<a class="code" href="classnuca__org__t.html#a730486a25e927078267d3fa2fe657b13">h_wire</a>-&gt;<a class="code" href="classWire.html#a2c8ffc5d174daceeca6e809270f930b2">wt</a> == <a class="code" href="cacti__interface_8h.html#a0d0a6912be8bcbfb10f9bfea163e0432ad2fa25995ace4728ab603ca298e58f25">Global_10</a>) {
<a name="l00451"></a>00451     printf(<span class="stringliteral">&quot;\tWire type - Full swing global wires with &quot;</span>
<a name="l00452"></a>00452         <span class="stringliteral">&quot;10%% delay penalty\n&quot;</span>);
<a name="l00453"></a>00453   }
<a name="l00454"></a>00454   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fr-&gt;<a class="code" href="classnuca__org__t.html#a730486a25e927078267d3fa2fe657b13">h_wire</a>-&gt;<a class="code" href="classWire.html#a2c8ffc5d174daceeca6e809270f930b2">wt</a> == <a class="code" href="cacti__interface_8h.html#a0d0a6912be8bcbfb10f9bfea163e0432af628ec84eedd1959c8a677781116eb97">Global_20</a>) {
<a name="l00455"></a>00455     printf(<span class="stringliteral">&quot;\tWire type - Full swing global wires with &quot;</span>
<a name="l00456"></a>00456         <span class="stringliteral">&quot;20%% delay penalty\n&quot;</span>);
<a name="l00457"></a>00457   }
<a name="l00458"></a>00458   <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fr-&gt;<a class="code" href="classnuca__org__t.html#a730486a25e927078267d3fa2fe657b13">h_wire</a>-&gt;<a class="code" href="classWire.html#a2c8ffc5d174daceeca6e809270f930b2">wt</a> == <a class="code" href="cacti__interface_8h.html#a0d0a6912be8bcbfb10f9bfea163e0432a3917b7e15073f1d7071eebbab5432569">Global_30</a>) {
<a name="l00459"></a>00459     printf(<span class="stringliteral">&quot;\tWire type - Full swing global wires with &quot;</span>
<a name="l00460"></a>00460         <span class="stringliteral">&quot;30%% delay penalty\n&quot;</span>);
<a name="l00461"></a>00461   }
<a name="l00462"></a>00462   <span class="keywordflow">else</span> <span class="keywordflow">if</span>(fr-&gt;<a class="code" href="classnuca__org__t.html#a730486a25e927078267d3fa2fe657b13">h_wire</a>-&gt;<a class="code" href="classWire.html#a2c8ffc5d174daceeca6e809270f930b2">wt</a> == <a class="code" href="cacti__interface_8h.html#a0d0a6912be8bcbfb10f9bfea163e0432a22e0066214db4f2450dfe98e2f942160">Low_swing</a>) {
<a name="l00463"></a>00463     printf(<span class="stringliteral">&quot;\tWire type - Low swing wires\n&quot;</span>);
<a name="l00464"></a>00464   }
<a name="l00465"></a>00465 
<a name="l00466"></a>00466   printf(<span class="stringliteral">&quot;\tHorizontal link delay - %g (ns)\n&quot;</span>,
<a name="l00467"></a>00467       fr-&gt;<a class="code" href="classnuca__org__t.html#a730486a25e927078267d3fa2fe657b13">h_wire</a>-&gt;<a class="code" href="classComponent.html#ada6524bc83a57cbaf53b78a459cef86b">delay</a>*1e9);
<a name="l00468"></a>00468   printf(<span class="stringliteral">&quot;\tVertical link delay - %g (ns)\n&quot;</span>,
<a name="l00469"></a>00469       fr-&gt;<a class="code" href="classnuca__org__t.html#aca31b7a014ae3277915506673045a144">v_wire</a>-&gt;<a class="code" href="classComponent.html#ada6524bc83a57cbaf53b78a459cef86b">delay</a>*1e9);
<a name="l00470"></a>00470   printf(<span class="stringliteral">&quot;\tDelay/length - %g (ns/mm)\n&quot;</span>,
<a name="l00471"></a>00471       fr-&gt;<a class="code" href="classnuca__org__t.html#a730486a25e927078267d3fa2fe657b13">h_wire</a>-&gt;<a class="code" href="classComponent.html#ada6524bc83a57cbaf53b78a459cef86b">delay</a>*1e9/fr-&gt;<a class="code" href="classnuca__org__t.html#aa2f6bd00819018d674014548726737a0">bank_pda</a>.<a class="code" href="classComponent.html#ab49a784742db060f4127df4459205e3f">area</a>.<a class="code" href="classArea.html#a924ebcc555467c49cb26b546e9dea27b">w</a>);
<a name="l00472"></a>00472   printf(<span class="stringliteral">&quot;\tHorizontal link energy -dynamic/access %g (nJ)\n&quot;</span>
<a name="l00473"></a>00473       <span class="stringliteral">&quot;\t                       -leakage %g (nW)\n\n&quot;</span>,
<a name="l00474"></a>00474       fr-&gt;<a class="code" href="classnuca__org__t.html#a730486a25e927078267d3fa2fe657b13">h_wire</a>-&gt;<a class="code" href="classComponent.html#a78cbcea978fe7b69afafed36179f38ac">power</a>.<a class="code" href="classpowerDef.html#ab80f3c788fda52adc2265f931add66d7">readOp</a>.<a class="code" href="classpowerComponents.html#adbc9cc35c7bd7abc39074f473d653343">dynamic</a>*1e9,
<a name="l00475"></a>00475       fr-&gt;<a class="code" href="classnuca__org__t.html#a730486a25e927078267d3fa2fe657b13">h_wire</a>-&gt;<a class="code" href="classComponent.html#a78cbcea978fe7b69afafed36179f38ac">power</a>.<a class="code" href="classpowerDef.html#ab80f3c788fda52adc2265f931add66d7">readOp</a>.<a class="code" href="classpowerComponents.html#aad6331445a7b816dbe209e93869a0e23">leakage</a>*1e9);
<a name="l00476"></a>00476   printf(<span class="stringliteral">&quot;\tVertical link energy -dynamic/access %g (nJ)\n&quot;</span>
<a name="l00477"></a>00477       <span class="stringliteral">&quot;\t                     -leakage %g (nW)\n\n&quot;</span>,
<a name="l00478"></a>00478       fr-&gt;<a class="code" href="classnuca__org__t.html#aca31b7a014ae3277915506673045a144">v_wire</a>-&gt;<a class="code" href="classComponent.html#a78cbcea978fe7b69afafed36179f38ac">power</a>.<a class="code" href="classpowerDef.html#ab80f3c788fda52adc2265f931add66d7">readOp</a>.<a class="code" href="classpowerComponents.html#adbc9cc35c7bd7abc39074f473d653343">dynamic</a>*1e9,
<a name="l00479"></a>00479       fr-&gt;<a class="code" href="classnuca__org__t.html#aca31b7a014ae3277915506673045a144">v_wire</a>-&gt;<a class="code" href="classComponent.html#a78cbcea978fe7b69afafed36179f38ac">power</a>.<a class="code" href="classpowerDef.html#ab80f3c788fda52adc2265f931add66d7">readOp</a>.<a class="code" href="classpowerComponents.html#aad6331445a7b816dbe209e93869a0e23">leakage</a>*1e9);
<a name="l00480"></a>00480   printf(<span class="stringliteral">&quot;\n\n&quot;</span>);
<a name="l00481"></a>00481   fr-&gt;<a class="code" href="classnuca__org__t.html#aca31b7a014ae3277915506673045a144">v_wire</a>-&gt;<a class="code" href="classWire.html#a8a7a1456ca215c4ecc8ec6837d0df017">print_wire</a>();
<a name="l00482"></a>00482   printf(<span class="stringliteral">&quot;\n\nBank stats:\n&quot;</span>);
<a name="l00483"></a>00483 }
<a name="l00484"></a>00484 
<a name="l00485"></a>00485 
<a name="l00486"></a>00486   <a class="code" href="classnuca__org__t.html">nuca_org_t</a> *
<a name="l00487"></a><a class="code" href="classNuca.html#a24c04037a9167ece6cbcef5b5c32312f">00487</a> <a class="code" href="classNuca.html#a24c04037a9167ece6cbcef5b5c32312f">Nuca::find_optimal_nuca</a> (list&lt;nuca_org_t *&gt; *<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, <a class="code" href="classmin__values__t.html">min_values_t</a> *minval)
<a name="l00488"></a>00488 {
<a name="l00489"></a>00489   <span class="keywordtype">double</span> cost = 0;
<a name="l00490"></a>00490   <span class="keywordtype">double</span> min_cost = BIGNUM;
<a name="l00491"></a>00491   <a class="code" href="classnuca__org__t.html">nuca_org_t</a> *res = NULL;
<a name="l00492"></a>00492   <span class="keywordtype">float</span> d, a, dp, lp, c;
<a name="l00493"></a>00493   <span class="keywordtype">int</span> v;
<a name="l00494"></a>00494   dp = <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a47a7e43439c86ee6de644c538f09fa58">dynamic_power_wt_nuca</a>;
<a name="l00495"></a>00495   lp = <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a509d64c1a5b55631be0fe6eb057f43a2">leakage_power_wt_nuca</a>;
<a name="l00496"></a>00496   a = <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#aa52595d77c7cf5e11615537533a0f2c2">area_wt_nuca</a>;
<a name="l00497"></a>00497   d = <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a291a3977058804e9a18cd4adcb81f8a0">delay_wt_nuca</a>;
<a name="l00498"></a>00498   c = <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a15d3aa08c62456fe7acfa5467bb80227">cycle_time_wt_nuca</a>;
<a name="l00499"></a>00499 
<a name="l00500"></a>00500   list&lt;nuca_org_t *&gt;::iterator niter;
<a name="l00501"></a>00501 
<a name="l00502"></a>00502 
<a name="l00503"></a>00503   <span class="keywordflow">for</span> (niter = n-&gt;begin(); niter != n-&gt;end(); niter++) {
<a name="l00504"></a>00504     fprintf(stderr, <span class="stringliteral">&quot;\n-----------------------------&quot;</span>
<a name="l00505"></a>00505         <span class="stringliteral">&quot;---------------\n&quot;</span>);
<a name="l00506"></a>00506 
<a name="l00507"></a>00507 
<a name="l00508"></a>00508     printf(<span class="stringliteral">&quot;NUCA___stats %d \tbankcount: lat = %g \tdynP = %g \twt = %d\t &quot;</span>
<a name="l00509"></a>00509         <span class="stringliteral">&quot;bank_dpower = %g \tleak = %g \tcycle = %g\n&quot;</span>,
<a name="l00510"></a>00510         (*niter)-&gt;bank_count,
<a name="l00511"></a>00511         (*niter)-&gt;nuca_pda.delay,
<a name="l00512"></a>00512         (*niter)-&gt;nuca_pda.power.readOp.dynamic,
<a name="l00513"></a>00513         (*niter)-&gt;h_wire-&gt;wt,
<a name="l00514"></a>00514         (*niter)-&gt;bank_pda.power.readOp.dynamic,
<a name="l00515"></a>00515         (*niter)-&gt;nuca_pda.power.readOp.leakage,
<a name="l00516"></a>00516         (*niter)-&gt;nuca_pda.cycle_time);
<a name="l00517"></a>00517 
<a name="l00518"></a>00518 
<a name="l00519"></a>00519     <span class="keywordflow">if</span> (<a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a6d9c98da8597cfd3fcb0692058fd45d5">ed</a> == 1) {
<a name="l00520"></a>00520       cost = ((*niter)-&gt;nuca_pda.delay/minval-&gt;<a class="code" href="classmin__values__t.html#ab16da7a3fc27664c3725a2d06cbfe2d4">min_delay</a>)*
<a name="l00521"></a>00521         ((*niter)-&gt;nuca_pda.power.readOp.dynamic/minval-&gt;<a class="code" href="classmin__values__t.html#a867a584f3d18d915426b0152684e5f57">min_dyn</a>);
<a name="l00522"></a>00522       <span class="keywordflow">if</span> (min_cost &gt; cost) {
<a name="l00523"></a>00523         min_cost = cost;
<a name="l00524"></a>00524         res = ((*niter));
<a name="l00525"></a>00525       }
<a name="l00526"></a>00526     }
<a name="l00527"></a>00527     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a6d9c98da8597cfd3fcb0692058fd45d5">ed</a> == 2) {
<a name="l00528"></a>00528       cost = ((*niter)-&gt;nuca_pda.delay/minval-&gt;<a class="code" href="classmin__values__t.html#ab16da7a3fc27664c3725a2d06cbfe2d4">min_delay</a>)*
<a name="l00529"></a>00529         ((*niter)-&gt;nuca_pda.delay/minval-&gt;<a class="code" href="classmin__values__t.html#ab16da7a3fc27664c3725a2d06cbfe2d4">min_delay</a>)*
<a name="l00530"></a>00530         ((*niter)-&gt;nuca_pda.power.readOp.dynamic/minval-&gt;<a class="code" href="classmin__values__t.html#a867a584f3d18d915426b0152684e5f57">min_dyn</a>);
<a name="l00531"></a>00531       <span class="keywordflow">if</span> (min_cost &gt; cost) {
<a name="l00532"></a>00532         min_cost = cost;
<a name="l00533"></a>00533         res = ((*niter));
<a name="l00534"></a>00534       }
<a name="l00535"></a>00535     }
<a name="l00536"></a>00536     <span class="keywordflow">else</span> {
<a name="l00537"></a>00537       <span class="comment">/*</span>
<a name="l00538"></a>00538 <span class="comment">       * check whether the current organization</span>
<a name="l00539"></a>00539 <span class="comment">       * meets the input deviation constraints</span>
<a name="l00540"></a>00540 <span class="comment">       */</span>
<a name="l00541"></a>00541       v = <a class="code" href="classNuca.html#a36bdb223bc1d7b46c28a9310fbd343f5">check_nuca_org</a>((*niter), minval);
<a name="l00542"></a>00542       <span class="keywordflow">if</span> (minval-&gt;<a class="code" href="classmin__values__t.html#abeef132ff17ce810df3687ceba1c5695">min_leakage</a> == 0) minval-&gt;<a class="code" href="classmin__values__t.html#abeef132ff17ce810df3687ceba1c5695">min_leakage</a> = 0.1; <span class="comment">//FIXME remove this after leakage modeling</span>
<a name="l00543"></a>00543 
<a name="l00544"></a>00544       <span class="keywordflow">if</span> (v) {
<a name="l00545"></a>00545         cost = (d  * ((*niter)-&gt;nuca_pda.delay/minval-&gt;<a class="code" href="classmin__values__t.html#ab16da7a3fc27664c3725a2d06cbfe2d4">min_delay</a>) +
<a name="l00546"></a>00546             c  * ((*niter)-&gt;nuca_pda.cycle_time/minval-&gt;<a class="code" href="classmin__values__t.html#af98a6a821fccf5cb0fb30307d75f2742">min_cyc</a>) +
<a name="l00547"></a>00547             dp * ((*niter)-&gt;nuca_pda.power.readOp.dynamic/minval-&gt;<a class="code" href="classmin__values__t.html#a867a584f3d18d915426b0152684e5f57">min_dyn</a>) +
<a name="l00548"></a>00548             lp * ((*niter)-&gt;nuca_pda.power.readOp.leakage/minval-&gt;<a class="code" href="classmin__values__t.html#abeef132ff17ce810df3687ceba1c5695">min_leakage</a>) +
<a name="l00549"></a>00549             a  * ((*niter)-&gt;nuca_pda.area.get_area()/minval-&gt;<a class="code" href="classmin__values__t.html#ad86f16930983b246e53f1284299f7206">min_area</a>));
<a name="l00550"></a>00550         fprintf(stderr, <span class="stringliteral">&quot;cost = %g\n&quot;</span>, cost);
<a name="l00551"></a>00551 
<a name="l00552"></a>00552         <span class="keywordflow">if</span> (min_cost &gt; cost) {
<a name="l00553"></a>00553           min_cost = cost;
<a name="l00554"></a>00554           res = ((*niter));
<a name="l00555"></a>00555         }
<a name="l00556"></a>00556       }
<a name="l00557"></a>00557       <span class="keywordflow">else</span> {
<a name="l00558"></a>00558         niter = n-&gt;erase(niter);
<a name="l00559"></a>00559         <span class="keywordflow">if</span> (niter !=n-&gt;begin())
<a name="l00560"></a>00560             niter --;
<a name="l00561"></a>00561       }
<a name="l00562"></a>00562     }
<a name="l00563"></a>00563   }
<a name="l00564"></a>00564   <span class="keywordflow">return</span> res;
<a name="l00565"></a>00565 }
<a name="l00566"></a>00566 
<a name="l00567"></a>00567   <span class="keywordtype">int</span>
<a name="l00568"></a><a class="code" href="classNuca.html#a36bdb223bc1d7b46c28a9310fbd343f5">00568</a> <a class="code" href="classNuca.html#a36bdb223bc1d7b46c28a9310fbd343f5">Nuca::check_nuca_org</a> (<a class="code" href="classnuca__org__t.html">nuca_org_t</a> *<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, <a class="code" href="classmin__values__t.html">min_values_t</a> *minval)
<a name="l00569"></a>00569 {
<a name="l00570"></a>00570   <span class="keywordflow">if</span> (((n-&gt;<a class="code" href="classnuca__org__t.html#adfbf859ff66fb9a8578756074f7394c4">nuca_pda</a>.<a class="code" href="classComponent.html#ada6524bc83a57cbaf53b78a459cef86b">delay</a> - minval-&gt;<a class="code" href="classmin__values__t.html#ab16da7a3fc27664c3725a2d06cbfe2d4">min_delay</a>)*100/minval-&gt;<a class="code" href="classmin__values__t.html#ab16da7a3fc27664c3725a2d06cbfe2d4">min_delay</a>) &gt; <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#aff782bd9b954cf562bbbe0ff9d17c0f6">delay_dev_nuca</a>) {
<a name="l00571"></a>00571     <span class="keywordflow">return</span> 0;
<a name="l00572"></a>00572   }
<a name="l00573"></a>00573   <span class="keywordflow">if</span> (((n-&gt;<a class="code" href="classnuca__org__t.html#adfbf859ff66fb9a8578756074f7394c4">nuca_pda</a>.<a class="code" href="classComponent.html#a78cbcea978fe7b69afafed36179f38ac">power</a>.<a class="code" href="classpowerDef.html#ab80f3c788fda52adc2265f931add66d7">readOp</a>.<a class="code" href="classpowerComponents.html#adbc9cc35c7bd7abc39074f473d653343">dynamic</a> - minval-&gt;<a class="code" href="classmin__values__t.html#a867a584f3d18d915426b0152684e5f57">min_dyn</a>)/minval-&gt;<a class="code" href="classmin__values__t.html#a867a584f3d18d915426b0152684e5f57">min_dyn</a>)*100 &gt;
<a name="l00574"></a>00574       <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#ac2d9ef899d253f7628919d49a23648c7">dynamic_power_dev_nuca</a>) {
<a name="l00575"></a>00575     <span class="keywordflow">return</span> 0;
<a name="l00576"></a>00576   }
<a name="l00577"></a>00577   <span class="keywordflow">if</span> (((n-&gt;<a class="code" href="classnuca__org__t.html#adfbf859ff66fb9a8578756074f7394c4">nuca_pda</a>.<a class="code" href="classComponent.html#a78cbcea978fe7b69afafed36179f38ac">power</a>.<a class="code" href="classpowerDef.html#ab80f3c788fda52adc2265f931add66d7">readOp</a>.<a class="code" href="classpowerComponents.html#aad6331445a7b816dbe209e93869a0e23">leakage</a> - minval-&gt;<a class="code" href="classmin__values__t.html#abeef132ff17ce810df3687ceba1c5695">min_leakage</a>)/minval-&gt;<a class="code" href="classmin__values__t.html#abeef132ff17ce810df3687ceba1c5695">min_leakage</a>)*100 &gt;
<a name="l00578"></a>00578       <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#af1a62165df55f2a15b8df4bf2ed2f9b4">leakage_power_dev_nuca</a>) {
<a name="l00579"></a>00579     <span class="keywordflow">return</span> 0;
<a name="l00580"></a>00580   }
<a name="l00581"></a>00581   <span class="keywordflow">if</span> (((n-&gt;<a class="code" href="classnuca__org__t.html#adfbf859ff66fb9a8578756074f7394c4">nuca_pda</a>.<a class="code" href="classComponent.html#abf1cc962a87f9dc7c8f04af980674c20">cycle_time</a> - minval-&gt;<a class="code" href="classmin__values__t.html#af98a6a821fccf5cb0fb30307d75f2742">min_cyc</a>)/minval-&gt;<a class="code" href="classmin__values__t.html#af98a6a821fccf5cb0fb30307d75f2742">min_cyc</a>)*100 &gt;
<a name="l00582"></a>00582       <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a3f590bbdb5c39e0d42edda3963c3f2fb">cycle_time_dev_nuca</a>) {
<a name="l00583"></a>00583     <span class="keywordflow">return</span> 0;
<a name="l00584"></a>00584   }
<a name="l00585"></a>00585   <span class="keywordflow">if</span> (((n-&gt;<a class="code" href="classnuca__org__t.html#adfbf859ff66fb9a8578756074f7394c4">nuca_pda</a>.<a class="code" href="classComponent.html#ab49a784742db060f4127df4459205e3f">area</a>.<a class="code" href="classArea.html#a200a4e54b5ef3e965b3837a78e95e4de">get_area</a>() - minval-&gt;<a class="code" href="classmin__values__t.html#ad86f16930983b246e53f1284299f7206">min_area</a>)/minval-&gt;<a class="code" href="classmin__values__t.html#ad86f16930983b246e53f1284299f7206">min_area</a>)*100 &gt;
<a name="l00586"></a>00586       <a class="code" href="parameter_8cc.html#a38c4d3d6fc09617ac7e49c136406a7a6">g_ip</a>-&gt;<a class="code" href="classInputParameter.html#a6492e87aa015e5cb9ace0b2e57ab1faa">area_dev_nuca</a>) {
<a name="l00587"></a>00587     <span class="keywordflow">return</span> 0;
<a name="l00588"></a>00588   }
<a name="l00589"></a>00589   <span class="keywordflow">return</span> 1;
<a name="l00590"></a>00590 }
<a name="l00591"></a>00591 
<a name="l00592"></a>00592   <span class="keywordtype">void</span>
<a name="l00593"></a><a class="code" href="classNuca.html#aabbc351d21236286d9e306e547039ba3">00593</a> <a class="code" href="classNuca.html#aabbc351d21236286d9e306e547039ba3">Nuca::calculate_nuca_area</a> (<a class="code" href="classnuca__org__t.html">nuca_org_t</a> *nuca)
<a name="l00594"></a>00594 {
<a name="l00595"></a>00595   nuca-&gt;<a class="code" href="classnuca__org__t.html#adfbf859ff66fb9a8578756074f7394c4">nuca_pda</a>.<a class="code" href="classComponent.html#ab49a784742db060f4127df4459205e3f">area</a>.<a class="code" href="classArea.html#acaf29e1b1248af18823cd02aa4396d6e">h</a>=
<a name="l00596"></a>00596     nuca-&gt;<a class="code" href="classnuca__org__t.html#a79afa5807f4906fb37ce41cd2b4a0a04">rows</a> * ((nuca-&gt;<a class="code" href="classnuca__org__t.html#a730486a25e927078267d3fa2fe657b13">h_wire</a>-&gt;<a class="code" href="classWire.html#af30178e73419921f1f055bb244f0d2f8">wire_width</a> +
<a name="l00597"></a>00597           nuca-&gt;<a class="code" href="classnuca__org__t.html#a730486a25e927078267d3fa2fe657b13">h_wire</a>-&gt;<a class="code" href="classWire.html#a774584c93b7d0c4594ae12b8fe2075e0">wire_spacing</a>)
<a name="l00598"></a>00598         * nuca-&gt;<a class="code" href="classnuca__org__t.html#a5c28dc23f75d9007525c6cadd5545fb7">router</a>-&gt;<a class="code" href="classMCPAT__Router.html#a8b1b8c3aba1abf7476a6cbbc255ab881">flit_size</a> +
<a name="l00599"></a>00599         nuca-&gt;<a class="code" href="classnuca__org__t.html#aa2f6bd00819018d674014548726737a0">bank_pda</a>.<a class="code" href="classComponent.html#ab49a784742db060f4127df4459205e3f">area</a>.<a class="code" href="classArea.html#acaf29e1b1248af18823cd02aa4396d6e">h</a>);
<a name="l00600"></a>00600 
<a name="l00601"></a>00601   nuca-&gt;<a class="code" href="classnuca__org__t.html#adfbf859ff66fb9a8578756074f7394c4">nuca_pda</a>.<a class="code" href="classComponent.html#ab49a784742db060f4127df4459205e3f">area</a>.<a class="code" href="classArea.html#a924ebcc555467c49cb26b546e9dea27b">w</a> =
<a name="l00602"></a>00602     nuca-&gt;<a class="code" href="classnuca__org__t.html#a4ef3b88d56b85910342465c55c6e2f9c">columns</a> * ((nuca-&gt;<a class="code" href="classnuca__org__t.html#aca31b7a014ae3277915506673045a144">v_wire</a>-&gt;<a class="code" href="classWire.html#af30178e73419921f1f055bb244f0d2f8">wire_width</a> +
<a name="l00603"></a>00603           nuca-&gt;<a class="code" href="classnuca__org__t.html#aca31b7a014ae3277915506673045a144">v_wire</a>-&gt;<a class="code" href="classWire.html#a774584c93b7d0c4594ae12b8fe2075e0">wire_spacing</a>)
<a name="l00604"></a>00604         * nuca-&gt;<a class="code" href="classnuca__org__t.html#a5c28dc23f75d9007525c6cadd5545fb7">router</a>-&gt;<a class="code" href="classMCPAT__Router.html#a8b1b8c3aba1abf7476a6cbbc255ab881">flit_size</a> +
<a name="l00605"></a>00605         nuca-&gt;<a class="code" href="classnuca__org__t.html#aa2f6bd00819018d674014548726737a0">bank_pda</a>.<a class="code" href="classComponent.html#ab49a784742db060f4127df4459205e3f">area</a>.<a class="code" href="classArea.html#a924ebcc555467c49cb26b546e9dea27b">w</a>);
<a name="l00606"></a>00606 }
<a name="l00607"></a>00607 
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 13 May 2014 for GPGPU-Sim by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
