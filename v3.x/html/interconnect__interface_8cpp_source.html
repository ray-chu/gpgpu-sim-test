<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GPGPU-Sim: v3.x/src/intersim/interconnect_interface.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_c934b74ccb33d6b9bfd1e576787940d8.html">v3.x</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_da58ad9beee6988f697f1a76e412a52a.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_fa6ba10d8e23e1d8c8ce4b633588e39b.html">intersim</a>
  </div>
</div>
<div class="contents">
<h1>interconnect_interface.cpp</h1><a href="interconnect__interface_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;booksim.hpp&quot;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &lt;string&gt;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;assert.h&gt;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;queue&gt;</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="preprocessor">#include &quot;routefunc.hpp&quot;</span>
<a name="l00009"></a>00009 <span class="preprocessor">#include &quot;traffic.hpp&quot;</span>
<a name="l00010"></a>00010 <span class="preprocessor">#include &quot;booksim_config.hpp&quot;</span>
<a name="l00011"></a>00011 <span class="preprocessor">#include &quot;trafficmanager.hpp&quot;</span>
<a name="l00012"></a>00012 <span class="preprocessor">#include &quot;random_utils.hpp&quot;</span>
<a name="l00013"></a>00013 <span class="preprocessor">#include &quot;network.hpp&quot;</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include &quot;<a class="code" href="singlenet_8hpp.html">singlenet.hpp</a>&quot;</span>
<a name="l00015"></a>00015 <span class="preprocessor">#include &quot;kncube.hpp&quot;</span>
<a name="l00016"></a>00016 <span class="preprocessor">#include &quot;fly.hpp&quot;</span>
<a name="l00017"></a>00017 <span class="preprocessor">#include &quot;injection.hpp&quot;</span>
<a name="l00018"></a>00018 <span class="preprocessor">#include &quot;<a class="code" href="interconnect__interface_8h.html">interconnect_interface.h</a>&quot;</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include &quot;../gpgpu-sim/mem_fetch.h&quot;</span>
<a name="l00020"></a>00020 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &lt;math.h&gt;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a><a class="code" href="interconnect__interface_8cpp.html#a98fdc7383fb9f2610ba086a10f8727f8">00023</a> <span class="keywordtype">int</span> <a class="code" href="interconnect__interface_8cpp.html#a98fdc7383fb9f2610ba086a10f8727f8">_flit_size</a> ;
<a name="l00024"></a>00024 
<a name="l00025"></a><a class="code" href="interconnect__interface_8cpp.html#a76a268fa7b429245daf24ca3f990bf9d">00025</a> <span class="keywordtype">bool</span> <a class="code" href="interconnect__interface_8cpp.html#a76a268fa7b429245daf24ca3f990bf9d">doub_net</a> = <span class="keyword">false</span>; <span class="comment">//double networks disabled by default</span>
<a name="l00026"></a>00026 
<a name="l00027"></a><a class="code" href="interconnect__interface_8cpp.html#a4a6db8b1a3e052b03474953b7d73db7f">00027</a> <a class="code" href="classBookSimConfig.html">BookSimConfig</a> <a class="code" href="interconnect__interface_8cpp.html#a4a6db8b1a3e052b03474953b7d73db7f">icnt_config</a>; 
<a name="l00028"></a><a class="code" href="interconnect__interface_8cpp.html#a8b9162d39257e1f5c3b0770394008ec2">00028</a> <a class="code" href="classTrafficManager.html">TrafficManager</a>** <a class="code" href="interconnect__interface_8cpp.html#a8b9162d39257e1f5c3b0770394008ec2">traffic</a>;
<a name="l00029"></a><a class="code" href="interconnect__interface_8cpp.html#a4b2faf70049dd50fd3857200e63e722f">00029</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="interconnect__interface_8cpp.html#a4b2faf70049dd50fd3857200e63e722f">g_num_vcs</a>; <span class="comment">//number of virtual channels</span>
<a name="l00030"></a><a class="code" href="interconnect__interface_8cpp.html#acce9bb31708103e0d333817be61ccc82">00030</a> queue&lt;Flit *&gt; ** <a class="code" href="interconnect__interface_8cpp.html#acce9bb31708103e0d333817be61ccc82">ejection_buf</a>; 
<a name="l00031"></a><a class="code" href="interconnect__interface_8cpp.html#a4e471f91defdcfa06ef007b327cf9294">00031</a> vector&lt;int&gt; <a class="code" href="interconnect__interface_8cpp.html#a4e471f91defdcfa06ef007b327cf9294">round_robin_turn</a>; <span class="comment">//keep track of boundary_buf last used in icnt_pop </span>
<a name="l00032"></a><a class="code" href="interconnect__interface_8cpp.html#a5742db83c33321f3592813307be569e5">00032</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="interconnect__interface_8cpp.html#a5742db83c33321f3592813307be569e5">ejection_buffer_capacity</a> ;  
<a name="l00033"></a><a class="code" href="interconnect__interface_8cpp.html#a172fe4159bac3b768e2f57edcce8c531">00033</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="interconnect__interface_8cpp.html#a172fe4159bac3b768e2f57edcce8c531">boundary_buf_capacity</a> ;  
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="interconnect__interface_8cpp.html#ac356a00515cfba9507f9f036b3d0e667">00035</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="interconnect__interface_8cpp.html#ac356a00515cfba9507f9f036b3d0e667">input_buffer_capacity</a> ;
<a name="l00036"></a>00036 
<a name="l00037"></a><a class="code" href="classboundary__buf.html">00037</a> <span class="keyword">class </span><a class="code" href="classboundary__buf.html">boundary_buf</a>{
<a name="l00038"></a>00038 <span class="keyword">private</span>:
<a name="l00039"></a><a class="code" href="classboundary__buf.html#ad0a1f2a69fcea0ed034ca09b4fcae1e2">00039</a>    queue&lt;void *&gt; <a class="code" href="classboundary__buf.html#ad0a1f2a69fcea0ed034ca09b4fcae1e2">buf</a>;
<a name="l00040"></a><a class="code" href="classboundary__buf.html#a3f1f2da1c474b0a0aef45d864df5b014">00040</a>    queue&lt;bool&gt; <a class="code" href="classboundary__buf.html#a3f1f2da1c474b0a0aef45d864df5b014">tail_flag</a>;
<a name="l00041"></a><a class="code" href="classboundary__buf.html#a49ff79a580bf26dd4c7e46f5d4821f1e">00041</a>    <span class="keywordtype">int</span> <a class="code" href="classboundary__buf.html#a49ff79a580bf26dd4c7e46f5d4821f1e">packet_n</a>;
<a name="l00042"></a><a class="code" href="classboundary__buf.html#ae427e44b81900b9ac48bce3ce2a0958e">00042</a>    <span class="keywordtype">unsigned</span> <a class="code" href="classboundary__buf.html#ae427e44b81900b9ac48bce3ce2a0958e">capacity</a>;
<a name="l00043"></a>00043 <span class="keyword">public</span>:
<a name="l00044"></a><a class="code" href="classboundary__buf.html#af7bc4cb75a4f789cb15903ee9275421d">00044</a>    <a class="code" href="classboundary__buf.html#af7bc4cb75a4f789cb15903ee9275421d">boundary_buf</a>(){
<a name="l00045"></a>00045       <a class="code" href="classboundary__buf.html#ae427e44b81900b9ac48bce3ce2a0958e">capacity</a> = <a class="code" href="interconnect__interface_8cpp.html#a172fe4159bac3b768e2f57edcce8c531">boundary_buf_capacity</a>; <span class="comment">//maximum flits the buffer can hold</span>
<a name="l00046"></a>00046       <a class="code" href="classboundary__buf.html#a49ff79a580bf26dd4c7e46f5d4821f1e">packet_n</a>=0;
<a name="l00047"></a>00047    }
<a name="l00048"></a><a class="code" href="classboundary__buf.html#a189030fea3d96b719514051db572a847">00048</a>    <span class="keywordtype">bool</span> <a class="code" href="classboundary__buf.html#a189030fea3d96b719514051db572a847">is_full</a>(<span class="keywordtype">void</span>){
<a name="l00049"></a>00049       <span class="keywordflow">return</span> (<a class="code" href="classboundary__buf.html#ad0a1f2a69fcea0ed034ca09b4fcae1e2">buf</a>.size()&gt;=<a class="code" href="classboundary__buf.html#ae427e44b81900b9ac48bce3ce2a0958e">capacity</a>);
<a name="l00050"></a>00050    }
<a name="l00051"></a><a class="code" href="classboundary__buf.html#a46e5854a5e86e83c5a1bafb67e391c15">00051</a>    <span class="keywordtype">bool</span> <a class="code" href="classboundary__buf.html#a46e5854a5e86e83c5a1bafb67e391c15">has_packet</a>() {
<a name="l00052"></a>00052       <span class="keywordflow">return</span> (<a class="code" href="classboundary__buf.html#a49ff79a580bf26dd4c7e46f5d4821f1e">packet_n</a>);
<a name="l00053"></a>00053    }
<a name="l00054"></a><a class="code" href="classboundary__buf.html#ad42ccb610cc52aad198311e701ecac09">00054</a>    <span class="keywordtype">void</span> * <a class="code" href="classboundary__buf.html#ad42ccb610cc52aad198311e701ecac09">pop_packet</a>(){
<a name="l00055"></a>00055       assert (<a class="code" href="classboundary__buf.html#a49ff79a580bf26dd4c7e46f5d4821f1e">packet_n</a>);
<a name="l00056"></a>00056       <span class="keywordtype">void</span> * data = NULL;
<a name="l00057"></a>00057       <span class="keywordtype">void</span> * temp_d = <a class="code" href="classboundary__buf.html#ad0a1f2a69fcea0ed034ca09b4fcae1e2">buf</a>.front();
<a name="l00058"></a>00058       <span class="keywordflow">while</span> (data==NULL) {
<a name="l00059"></a>00059          <span class="keywordflow">if</span> (<a class="code" href="classboundary__buf.html#a3f1f2da1c474b0a0aef45d864df5b014">tail_flag</a>.front()) {
<a name="l00060"></a>00060             data = <a class="code" href="classboundary__buf.html#ad0a1f2a69fcea0ed034ca09b4fcae1e2">buf</a>.front();
<a name="l00061"></a>00061             <a class="code" href="classboundary__buf.html#a49ff79a580bf26dd4c7e46f5d4821f1e">packet_n</a>--;
<a name="l00062"></a>00062          }
<a name="l00063"></a>00063          assert(temp_d == <a class="code" href="classboundary__buf.html#ad0a1f2a69fcea0ed034ca09b4fcae1e2">buf</a>.front()); <span class="comment">//all flits must belong to the same packet</span>
<a name="l00064"></a>00064          <a class="code" href="classboundary__buf.html#ad0a1f2a69fcea0ed034ca09b4fcae1e2">buf</a>.pop();
<a name="l00065"></a>00065          <a class="code" href="classboundary__buf.html#a3f1f2da1c474b0a0aef45d864df5b014">tail_flag</a>.pop();
<a name="l00066"></a>00066       }
<a name="l00067"></a>00067       <span class="keywordflow">return</span> data; 
<a name="l00068"></a>00068    }
<a name="l00069"></a><a class="code" href="classboundary__buf.html#a65ef3e5c879e575b92cc9b00499c2702">00069</a>    <span class="keywordtype">void</span> * <a class="code" href="classboundary__buf.html#a65ef3e5c879e575b92cc9b00499c2702">top_packet</a>(){
<a name="l00070"></a>00070       assert (<a class="code" href="classboundary__buf.html#a49ff79a580bf26dd4c7e46f5d4821f1e">packet_n</a>);
<a name="l00071"></a>00071       <span class="keywordtype">void</span> * data = NULL;
<a name="l00072"></a>00072       <span class="keywordtype">void</span> * temp_d = <a class="code" href="classboundary__buf.html#ad0a1f2a69fcea0ed034ca09b4fcae1e2">buf</a>.front();
<a name="l00073"></a>00073       <span class="keywordflow">while</span> (data==NULL) {
<a name="l00074"></a>00074          <span class="keywordflow">if</span> (<a class="code" href="classboundary__buf.html#a3f1f2da1c474b0a0aef45d864df5b014">tail_flag</a>.front()) {
<a name="l00075"></a>00075             data = <a class="code" href="classboundary__buf.html#ad0a1f2a69fcea0ed034ca09b4fcae1e2">buf</a>.front();
<a name="l00076"></a>00076          }
<a name="l00077"></a>00077          assert(temp_d == <a class="code" href="classboundary__buf.html#ad0a1f2a69fcea0ed034ca09b4fcae1e2">buf</a>.front()); <span class="comment">//all flits must belong to the same packet</span>
<a name="l00078"></a>00078       }
<a name="l00079"></a>00079       <span class="keywordflow">return</span> data; 
<a name="l00080"></a>00080    }
<a name="l00081"></a><a class="code" href="classboundary__buf.html#a6fa7e6a87212a7f7737fd067e41f4f5c">00081</a>    <span class="keywordtype">void</span> <a class="code" href="classboundary__buf.html#a6fa7e6a87212a7f7737fd067e41f4f5c">push_flit_data</a>(<span class="keywordtype">void</span>* data,<span class="keywordtype">bool</span> is_tail) {
<a name="l00082"></a>00082       <a class="code" href="classboundary__buf.html#ad0a1f2a69fcea0ed034ca09b4fcae1e2">buf</a>.push(data);
<a name="l00083"></a>00083       <a class="code" href="classboundary__buf.html#a3f1f2da1c474b0a0aef45d864df5b014">tail_flag</a>.push(is_tail);
<a name="l00084"></a>00084       <span class="keywordflow">if</span> (is_tail) {
<a name="l00085"></a>00085          <a class="code" href="classboundary__buf.html#a49ff79a580bf26dd4c7e46f5d4821f1e">packet_n</a>++;
<a name="l00086"></a>00086       }
<a name="l00087"></a>00087    }  
<a name="l00088"></a>00088 };
<a name="l00089"></a>00089 
<a name="l00090"></a><a class="code" href="interconnect__interface_8cpp.html#acfd082ac573c28dd8c932800fc64d1db">00090</a> <a class="code" href="classboundary__buf.html">boundary_buf</a>** <a class="code" href="interconnect__interface_8cpp.html#acfd082ac573c28dd8c932800fc64d1db">clock_boundary_buf</a>; 
<a name="l00091"></a>00091 
<a name="l00092"></a><a class="code" href="classmycomparison.html">00092</a> <span class="keyword">class </span><a class="code" href="classmycomparison.html">mycomparison</a> {
<a name="l00093"></a>00093 <span class="keyword">public</span>:
<a name="l00094"></a><a class="code" href="classmycomparison.html#a00d179914808d07d39c58de186a1ed20">00094</a>    <span class="keywordtype">bool</span> <a class="code" href="classmycomparison.html#a00d179914808d07d39c58de186a1ed20">operator() </a>(<span class="keyword">const</span> <span class="keywordtype">void</span>* lhs, <span class="keyword">const</span> <span class="keywordtype">void</span>* rhs)<span class="keyword"> const</span>
<a name="l00095"></a>00095 <span class="keyword">   </span>{
<a name="l00096"></a>00096       <span class="keywordflow">return</span>( ((<a class="code" href="classmem__fetch.html">mem_fetch</a> *)lhs)-&gt;get_icnt_receive_time() &gt; ((<a class="code" href="classmem__fetch.html">mem_fetch</a> *) rhs)-&gt;get_icnt_receive_time());
<a name="l00097"></a>00097    }
<a name="l00098"></a>00098 };
<a name="l00099"></a>00099 
<a name="l00100"></a><a class="code" href="interconnect__interface_8cpp.html#a0c159f528c97d4b52aeeb43baaeea434">00100</a> <span class="keywordtype">bool</span> <a class="code" href="interconnect__interface_8cpp.html#a0c159f528c97d4b52aeeb43baaeea434">perfect_icnt</a> = 0;
<a name="l00101"></a><a class="code" href="interconnect__interface_8cpp.html#a79956105f4fd327edf9eea6ceefced93">00101</a> <span class="keywordtype">int</span> <a class="code" href="interconnect__interface_8cpp.html#a79956105f4fd327edf9eea6ceefced93">fixed_lat_icnt</a> = 0;
<a name="l00102"></a>00102 
<a name="l00103"></a><a class="code" href="interconnect__interface_8cpp.html#a1b90b5ec544a9475621f8c51d4c35a48">00103</a> priority_queue&lt;void * , vector&lt;void* &gt;, <a class="code" href="classmycomparison.html">mycomparison</a>&gt; * <a class="code" href="interconnect__interface_8cpp.html#a1b90b5ec544a9475621f8c51d4c35a48">out_buf_fixedlat_buf</a>; 
<a name="l00104"></a>00104 
<a name="l00105"></a>00105 
<a name="l00106"></a>00106 <span class="comment">//perfect icnt stats:</span>
<a name="l00107"></a><a class="code" href="interconnect__interface_8cpp.html#a68018176ed3df9dc9fff731284ce60c5">00107</a> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>* <a class="code" href="interconnect__interface_8cpp.html#a68018176ed3df9dc9fff731284ce60c5">max_fixedlat_buf_size</a>;
<a name="l00108"></a>00108 
<a name="l00109"></a><a class="code" href="interconnect__interface_8cpp.html#a1bbc0af458d118a36b2ac2730fcf559a">00109</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="interconnect__interface_8cpp.html#a1bbc0af458d118a36b2ac2730fcf559a">net_c</a>; <span class="comment">//number of interconnection networks</span>
<a name="l00110"></a>00110 
<a name="l00111"></a><a class="code" href="interconnect__interface_8cpp.html#a935e9ba6da567d38d9fa05096844c502">00111</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="interconnect__interface_8cpp.html#a935e9ba6da567d38d9fa05096844c502">_n_shader</a> = 0;
<a name="l00112"></a><a class="code" href="interconnect__interface_8cpp.html#a7edd82453748d40c234414fb2b9c5763">00112</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="interconnect__interface_8cpp.html#a7edd82453748d40c234414fb2b9c5763">_n_mem</a> = 0;
<a name="l00113"></a>00113 
<a name="l00114"></a><a class="code" href="interconnect__interface_8cpp.html#a640fbfeb393f210f6b090f82262f6222">00114</a> <span class="keyword">static</span> <span class="keywordtype">int</span> * <a class="code" href="interconnect__interface_8cpp.html#a640fbfeb393f210f6b090f82262f6222">node_map</a>;  <span class="comment">//deviceID to mesh location map</span>
<a name="l00115"></a>00115                         <span class="comment">//deviceID : Starts from 0 for shaders and then continues until mem nodes </span>
<a name="l00116"></a>00116                         <span class="comment">// which starts at location n_shader and then continues to n_shader+n_mem (last device)   </span>
<a name="l00117"></a><a class="code" href="interconnect__interface_8cpp.html#afe810a77a8f84ed1f7b70fab2867b0e3">00117</a> <span class="keyword">static</span> <span class="keywordtype">int</span> * <a class="code" href="interconnect__interface_8cpp.html#afe810a77a8f84ed1f7b70fab2867b0e3">reverse_map</a>; 
<a name="l00118"></a>00118 
<a name="l00119"></a><a class="code" href="interconnect__interface_8cpp.html#a9e90a48da1f681fd6835723009cbc797">00119</a> <span class="keywordtype">void</span> <a class="code" href="interconnect__interface_8cpp.html#a9e90a48da1f681fd6835723009cbc797">map_gen</a>(<span class="keywordtype">int</span> dim,<span class="keywordtype">int</span>  memcount, <span class="keywordtype">int</span> memnodes[])
<a name="l00120"></a>00120 {
<a name="l00121"></a>00121    <span class="keywordtype">int</span> k = 0;
<a name="l00122"></a>00122    <span class="keywordtype">int</span> i=0 ;
<a name="l00123"></a>00123    <span class="keywordtype">int</span> j=0 ;
<a name="l00124"></a>00124    <span class="keywordtype">int</span> memfound=0;
<a name="l00125"></a>00125    <span class="keywordflow">for</span> (i = 0; i &lt; dim*dim ; i++) {
<a name="l00126"></a>00126       memfound=0;
<a name="l00127"></a>00127       <span class="keywordflow">for</span> (j = 0; j&lt;memcount ; j++) {
<a name="l00128"></a>00128          <span class="keywordflow">if</span> (memnodes[j]==i) {
<a name="l00129"></a>00129             memfound=1;
<a name="l00130"></a>00130          }
<a name="l00131"></a>00131       }   
<a name="l00132"></a>00132       <span class="keywordflow">if</span> (!memfound) {
<a name="l00133"></a>00133          node_map[k]=i;
<a name="l00134"></a>00134          k++;
<a name="l00135"></a>00135       }
<a name="l00136"></a>00136    }
<a name="l00137"></a>00137    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j&lt;memcount ; j++) {
<a name="l00138"></a>00138       node_map[k]=memnodes[j];
<a name="l00139"></a>00139       k++;
<a name="l00140"></a>00140    }
<a name="l00141"></a>00141    assert(k==dim*dim);
<a name="l00142"></a>00142 }
<a name="l00143"></a>00143 
<a name="l00144"></a><a class="code" href="interconnect__interface_8cpp.html#a0f4d34f090f55efac5333e7acfab0b49">00144</a> <span class="keywordtype">void</span> <a class="code" href="interconnect__interface_8cpp.html#a0f4d34f090f55efac5333e7acfab0b49">display_map</a>(<span class="keywordtype">int</span> dim,<span class="keywordtype">int</span> count)
<a name="l00145"></a>00145 {
<a name="l00146"></a>00146     printf(<span class="stringliteral">&quot;GPGPU-Sim uArch: &quot;</span>);
<a name="l00147"></a>00147    <span class="keywordtype">int</span> i=0;
<a name="l00148"></a>00148    <span class="keywordflow">for</span> (i=0;i&lt;count;i++) {
<a name="l00149"></a>00149       printf(<span class="stringliteral">&quot;%3d &quot;</span>,node_map[i]);
<a name="l00150"></a>00150       <span class="keywordflow">if</span> (i%dim ==0) 
<a name="l00151"></a>00151          printf(<span class="stringliteral">&quot;\nGPGPU-Sim uArch: &quot;</span>);
<a name="l00152"></a>00152    }
<a name="l00153"></a>00153 }
<a name="l00154"></a>00154 
<a name="l00155"></a><a class="code" href="interconnect__interface_8cpp.html#a33f32999209745ffe5dcbfe0031fd438">00155</a> <span class="keywordtype">void</span> <a class="code" href="interconnect__interface_8cpp.html#a33f32999209745ffe5dcbfe0031fd438">create_node_map</a>(<span class="keywordtype">int</span> n_shader, <span class="keywordtype">int</span> n_mem, <span class="keywordtype">int</span> size, <span class="keywordtype">int</span> use_map) 
<a name="l00156"></a>00156 {
<a name="l00157"></a>00157    node_map = (<span class="keywordtype">int</span>*)malloc((size)*<span class="keyword">sizeof</span>(<a class="code" href="classint.html">int</a>));   
<a name="l00158"></a>00158    <span class="keywordflow">if</span> (use_map) {
<a name="l00159"></a>00159       <span class="keywordflow">switch</span> (size) {
<a name="l00160"></a>00160       <span class="keywordflow">case</span> 16 :
<a name="l00161"></a>00161          { <span class="comment">// good for 8 shaders and 8 memory cores</span>
<a name="l00162"></a>00162             <span class="keywordtype">int</span> newmap[]  = {  
<a name="l00163"></a>00163                0, 2, 5, 7,
<a name="l00164"></a>00164                8,10,13,15,
<a name="l00165"></a>00165                1, 3, 4, 6, <span class="comment">//memory nodes</span>
<a name="l00166"></a>00166                9,11,12,14   <span class="comment">//memory nodes</span>
<a name="l00167"></a>00167             }; 
<a name="l00168"></a>00168             memcpy (node_map, newmap,16*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00169"></a>00169             <span class="keywordflow">break</span>;
<a name="l00170"></a>00170          }
<a name="l00171"></a>00171       <span class="keywordflow">case</span> 64:
<a name="l00172"></a>00172          { <span class="comment">// good for 56 shaders and 8 memory cores</span>
<a name="l00173"></a>00173             <span class="keywordtype">int</span> newmap[]  = {  
<a name="l00174"></a>00174                0,  1,  2,  4,  5,  6,  7,  8,
<a name="l00175"></a>00175                9, 10, 11, 12, 13, 14, 16, 18,
<a name="l00176"></a>00176                19, 20, 21, 22, 23, 24, 25, 26,
<a name="l00177"></a>00177                27, 28, 30, 31, 32, 33, 34, 35,
<a name="l00178"></a>00178                37, 38, 39, 40, 41, 42, 43, 44,                    
<a name="l00179"></a>00179                45, 46, 48, 50, 51, 52, 53, 54,
<a name="l00180"></a>00180                55, 56, 57, 58, 59, 60, 62, 63, 
<a name="l00181"></a>00181                3, 15, 17, 29, 36, 47, 49, 61  <span class="comment">//memory nodes are in this line</span>
<a name="l00182"></a>00182             }; 
<a name="l00183"></a>00183             memcpy (node_map, newmap,64*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00184"></a>00184             <span class="keywordflow">break</span>;
<a name="l00185"></a>00185          }
<a name="l00186"></a>00186       <span class="keywordflow">case</span> 121:
<a name="l00187"></a>00187          { <span class="comment">// good for 110 shaders and 11 memory cores</span>
<a name="l00188"></a>00188             <span class="keywordtype">int</span> newmap[]  = {  
<a name="l00189"></a>00189                0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10,
<a name="l00190"></a>00190                11, 13, 14, 15, 16, 17, 18, 19, 21, 22, 23,
<a name="l00191"></a>00191                24, 26, 27, 29, 30, 31, 32, 33, 34, 35, 36,
<a name="l00192"></a>00192                37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47,
<a name="l00193"></a>00193                48, 49, 50, 51, 52, 53, 54, 55, 56, 58, 59,
<a name="l00194"></a>00194                61, 62, 64, 65, 66, 67, 68, 69, 70, 71, 72,
<a name="l00195"></a>00195                73, 74, 75, 76, 77, 78, 79, 80, 81, 82, 83,
<a name="l00196"></a>00196                84, 85, 86, 87, 88, 89, 90, 91, 93, 94, 96,
<a name="l00197"></a>00197                97, 98, 99,101,102,103,104,105,106,107,109,
<a name="l00198"></a>00198                110,111,112,113,114,115,116,117,118,119,120,  
<a name="l00199"></a>00199                12, 20, 25, 28, 57, 60, 63, 92, 95,100,108 <span class="comment">//memory nodes are in this line</span>
<a name="l00200"></a>00200             }; 
<a name="l00201"></a>00201             memcpy (node_map, newmap,121*<span class="keyword">sizeof</span>(<span class="keywordtype">int</span>));
<a name="l00202"></a>00202             <span class="keywordflow">break</span>;
<a name="l00203"></a>00203          }
<a name="l00204"></a>00204       <span class="keywordflow">case</span> 36:
<a name="l00205"></a>00205          {
<a name="l00206"></a>00206             <span class="keywordtype">int</span> memnodes[8]={3,7,10,12,23,25,28,32};
<a name="l00207"></a>00207             <a class="code" href="interconnect__interface_8cpp.html#a9e90a48da1f681fd6835723009cbc797">map_gen</a>(6<span class="comment">/*dim*/</span>,8<span class="comment">/*memcount*/</span>,memnodes);
<a name="l00208"></a>00208             <span class="keywordflow">break</span>;
<a name="l00209"></a>00209          }
<a name="l00210"></a>00210       <span class="keywordflow">default</span>: 
<a name="l00211"></a>00211          {
<a name="l00212"></a>00212             cout&lt;&lt;<span class="stringliteral">&quot;WARNING !!! NO MAPPING IMPLEMENTED YET FOR THIS CONFIG&quot;</span>&lt;&lt;endl;
<a name="l00213"></a>00213             <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;size;i++) {
<a name="l00214"></a>00214                node_map[i]=i;
<a name="l00215"></a>00215             }
<a name="l00216"></a>00216          }
<a name="l00217"></a>00217       }
<a name="l00218"></a>00218    } <span class="keywordflow">else</span> { <span class="comment">// !use_map</span>
<a name="l00219"></a>00219       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;size;i++) {
<a name="l00220"></a>00220          node_map[i]=i;
<a name="l00221"></a>00221       }
<a name="l00222"></a>00222    }
<a name="l00223"></a>00223    reverse_map = (<span class="keywordtype">int</span>*)malloc((size)*<span class="keyword">sizeof</span>(<a class="code" href="classint.html">int</a>));   
<a name="l00224"></a>00224    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; size ; i++) {
<a name="l00225"></a>00225       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> j = 0; j&lt;size ; j++) {
<a name="l00226"></a>00226          <span class="keywordflow">if</span> (node_map[j]==i) {
<a name="l00227"></a>00227             reverse_map[i]=j;
<a name="l00228"></a>00228             <span class="keywordflow">break</span>;
<a name="l00229"></a>00229          }
<a name="l00230"></a>00230       }
<a name="l00231"></a>00231    }
<a name="l00232"></a>00232    printf(<span class="stringliteral">&quot;GPGPU-Sim uArch: interconnect nodemap\n&quot;</span>);
<a name="l00233"></a>00233    <a class="code" href="interconnect__interface_8cpp.html#a0f4d34f090f55efac5333e7acfab0b49">display_map</a>((<span class="keywordtype">int</span>) sqrt(size),size);
<a name="l00234"></a>00234 
<a name="l00235"></a>00235 }
<a name="l00236"></a>00236 
<a name="l00237"></a><a class="code" href="interconnect__interface_8cpp.html#a7e010aebcd2c0b4b5c60d1a396b52c13">00237</a> <span class="keywordtype">int</span> <a class="code" href="interconnect__interface_8cpp.html#a7e010aebcd2c0b4b5c60d1a396b52c13">fixed_latency</a>(<span class="keywordtype">int</span> <a class="code" href="lex_8yy_8c.html#a171692544b8e065853e387755849a433">input</a>, <span class="keywordtype">int</span> <a class="code" href="cuobjdump__to__ptxplus_8cc.html#a850af8cfb632548b213ce5b365fedd1a">output</a>)
<a name="l00238"></a>00238 {
<a name="l00239"></a>00239    <span class="keywordtype">int</span> latency;
<a name="l00240"></a>00240    <span class="keywordflow">if</span> (<a class="code" href="interconnect__interface_8cpp.html#a0c159f528c97d4b52aeeb43baaeea434">perfect_icnt</a>) {
<a name="l00241"></a>00241       latency = 1; 
<a name="l00242"></a>00242    } <span class="keywordflow">else</span> {
<a name="l00243"></a>00243       <span class="keywordtype">int</span> dim = icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>( <span class="stringliteral">&quot;k&quot;</span> ); 
<a name="l00244"></a>00244       <span class="keywordtype">int</span> xhops = abs ( input%dim - output%dim);
<a name="l00245"></a>00245       <span class="keywordtype">int</span> yhops = abs ( input/dim - output/dim);
<a name="l00246"></a>00246       latency = ( (xhops+yhops)*fixed_lat_icnt ); 
<a name="l00247"></a>00247    }
<a name="l00248"></a>00248    <span class="keywordflow">return</span> latency;
<a name="l00249"></a>00249 }
<a name="l00250"></a>00250 
<a name="l00251"></a>00251 <span class="comment">//This function gets a mapped node number and tells if it is a shader node or a memory node</span>
<a name="l00252"></a><a class="code" href="interconnect__interface_8cpp.html#a86ed5facdc7e17f5cf39a498904311da">00252</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="interconnect__interface_8cpp.html#a86ed5facdc7e17f5cf39a498904311da">is_shd</a>(<span class="keywordtype">int</span> node)
<a name="l00253"></a>00253 {
<a name="l00254"></a>00254    <span class="keywordflow">if</span> (reverse_map[node] &lt; (<span class="keywordtype">int</span>) <a class="code" href="interconnect__interface_8cpp.html#a935e9ba6da567d38d9fa05096844c502">_n_shader</a>)
<a name="l00255"></a>00255       <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00256"></a>00256    <span class="keywordflow">else</span>
<a name="l00257"></a>00257       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00258"></a>00258 }
<a name="l00259"></a>00259 
<a name="l00260"></a><a class="code" href="interconnect__interface_8cpp.html#a1bfc7fc89c2559d678b10afdd39516c0">00260</a> <span class="keyword">static</span> <span class="keyword">inline</span> <span class="keywordtype">bool</span> <a class="code" href="interconnect__interface_8cpp.html#a1bfc7fc89c2559d678b10afdd39516c0">is_mem</a>(<span class="keywordtype">int</span> node)
<a name="l00261"></a>00261 {
<a name="l00262"></a>00262    <span class="keywordflow">return</span> !<a class="code" href="interconnect__interface_8cpp.html#a86ed5facdc7e17f5cf39a498904311da">is_shd</a>(node);
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 
<a name="l00266"></a><a class="code" href="interconnect__interface_8h.html#ad7237258c69cf1c3a5e5c193d228036c">00266</a> <span class="keywordtype">void</span> <a class="code" href="interconnect__interface_8cpp.html#ad7237258c69cf1c3a5e5c193d228036c">interconnect_stats</a>()
<a name="l00267"></a>00267 {
<a name="l00268"></a>00268    <span class="keywordflow">if</span> (!fixed_lat_icnt) {
<a name="l00269"></a>00269       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;<a class="code" href="interconnect__interface_8cpp.html#a1bbc0af458d118a36b2ac2730fcf559a">net_c</a>;i++) {
<a name="l00270"></a>00270          cout &lt;&lt;<span class="stringliteral">&quot;Traffic &quot;</span>&lt;&lt;i&lt;&lt; <span class="stringliteral">&quot; Stat&quot;</span> &lt;&lt; endl;
<a name="l00271"></a>00271          traffic[i]-&gt;<a class="code" href="classTrafficManager.html#a372fb36b80bf41334adfcd5e7eee9c95">ShowStats</a>();
<a name="l00272"></a>00272          <span class="keywordflow">if</span> (icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;enable_link_stats&quot;</span>)) {
<a name="l00273"></a>00273             cout &lt;&lt; <span class="stringliteral">&quot;%=================================&quot;</span> &lt;&lt; endl;
<a name="l00274"></a>00274             cout &lt;&lt;<span class="stringliteral">&quot;Traffic &quot;</span>&lt;&lt;i&lt;&lt; <span class="stringliteral">&quot;Link utilizations:&quot;</span> &lt;&lt; endl;
<a name="l00275"></a>00275             traffic[i]-&gt;<a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>-&gt;<a class="code" href="classNetwork.html#a0254df99f73eaa3f355bf1f45a7626b4">Display</a>();
<a name="l00276"></a>00276          }
<a name="l00277"></a>00277       }
<a name="l00278"></a>00278    } <span class="keywordflow">else</span> {
<a name="l00279"></a>00279       <span class="comment">//show max queue sizes</span>
<a name="l00280"></a>00280       cout&lt;&lt;<span class="stringliteral">&quot;Max Fixed Latency ICNT queue size for&quot;</span>&lt;&lt;endl;  
<a name="l00281"></a>00281       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;(<a class="code" href="interconnect__interface_8cpp.html#a7edd82453748d40c234414fb2b9c5763">_n_mem</a> + <a class="code" href="interconnect__interface_8cpp.html#a935e9ba6da567d38d9fa05096844c502">_n_shader</a>);i++) {
<a name="l00282"></a>00282          cout&lt;&lt;<span class="stringliteral">&quot; node[&quot;</span> &lt;&lt; i &lt;&lt;<span class="stringliteral">&quot;] is &quot;</span>&lt;&lt;<a class="code" href="interconnect__interface_8cpp.html#a68018176ed3df9dc9fff731284ce60c5">max_fixedlat_buf_size</a>[i];
<a name="l00283"></a>00283       }
<a name="l00284"></a>00284       cout&lt;&lt;endl;
<a name="l00285"></a>00285    }
<a name="l00286"></a>00286 }
<a name="l00287"></a>00287 
<a name="l00288"></a><a class="code" href="interconnect__interface_8h.html#abfd9ef918f831a76aaa422349fe378b6">00288</a> <span class="keywordtype">void</span> <a class="code" href="interconnect__interface_8cpp.html#abfd9ef918f831a76aaa422349fe378b6">icnt_overal_stat</a>() <span class="comment">//should be called upon simulation exit to give an overal stat</span>
<a name="l00289"></a>00289 {
<a name="l00290"></a>00290    <span class="keywordflow">if</span> (!fixed_lat_icnt) {
<a name="l00291"></a>00291       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;<a class="code" href="interconnect__interface_8cpp.html#a1bbc0af458d118a36b2ac2730fcf559a">net_c</a>;i++) {
<a name="l00292"></a>00292          traffic[i]-&gt;<a class="code" href="classTrafficManager.html#a6f114f8a8ef27e687899cba844ae9c7b">ShowOveralStat</a>();
<a name="l00293"></a>00293       }
<a name="l00294"></a>00294    }
<a name="l00295"></a>00295 }
<a name="l00296"></a>00296 
<a name="l00297"></a><a class="code" href="interconnect__interface_8h.html#a132c331222e518c552498a3bd8ed754a">00297</a> <span class="keywordtype">void</span> <a class="code" href="interconnect__interface_8cpp.html#a132c331222e518c552498a3bd8ed754a">icnt_init_grid</a> (){
<a name="l00298"></a>00298    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;<a class="code" href="interconnect__interface_8cpp.html#a1bbc0af458d118a36b2ac2730fcf559a">net_c</a>;i++) {
<a name="l00299"></a>00299       traffic[i]-&gt;<a class="code" href="classTrafficManager.html#a075d45b3f124af927a80531f4381f3bd">IcntInitPerGrid</a>(0<span class="comment">/*_time*/</span>); <span class="comment">//initialization before gpu grid start</span>
<a name="l00300"></a>00300    }
<a name="l00301"></a>00301 }
<a name="l00302"></a>00302 
<a name="l00303"></a><a class="code" href="interconnect__interface_8h.html#a5b28090a5709e40182fd2d6bfa8ab00a">00303</a> <span class="keywordtype">bool</span> <a class="code" href="interconnect__interface_8cpp.html#afb24bd87eb4f839f9d04094314191137">interconnect_has_buffer</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> input_node, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> tot_req_size) 
<a name="l00304"></a>00304 {
<a name="l00305"></a>00305 
<a name="l00306"></a>00306    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <a class="code" href="lex_8yy_8c.html#a171692544b8e065853e387755849a433">input</a> = node_map[input_node];   
<a name="l00307"></a>00307    <span class="keywordtype">bool</span> has_buffer = <span class="keyword">false</span>;
<a name="l00308"></a>00308    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_flits = tot_req_size / _flit_size + ((tot_req_size % _flit_size)? 1:0);
<a name="l00309"></a>00309    <span class="keywordflow">if</span> (!(fixed_lat_icnt || <a class="code" href="interconnect__interface_8cpp.html#a0c159f528c97d4b52aeeb43baaeea434">perfect_icnt</a>)) {
<a name="l00310"></a>00310       has_buffer = (traffic[0]-&gt;<a class="code" href="classTrafficManager.html#a874d663095760b20ec91b9884201c1ac">_partial_packets</a>[input][0].size() + n_flits) &lt;=  <a class="code" href="interconnect__interface_8cpp.html#ac356a00515cfba9507f9f036b3d0e667">input_buffer_capacity</a>; 
<a name="l00311"></a>00311       <span class="keywordflow">if</span> ((<a class="code" href="interconnect__interface_8cpp.html#a1bbc0af458d118a36b2ac2730fcf559a">net_c</a>&gt;1) &amp;&amp; <a class="code" href="interconnect__interface_8cpp.html#a1bfc7fc89c2559d678b10afdd39516c0">is_mem</a>(input)) 
<a name="l00312"></a>00312          has_buffer = (traffic[1]-&gt;_partial_packets[input][0].size() + n_flits) &lt;=  <a class="code" href="interconnect__interface_8cpp.html#ac356a00515cfba9507f9f036b3d0e667">input_buffer_capacity</a>; 
<a name="l00313"></a>00313    } <span class="keywordflow">else</span> {
<a name="l00314"></a>00314       has_buffer = <span class="keyword">true</span>; 
<a name="l00315"></a>00315    }
<a name="l00316"></a>00316    <span class="keywordflow">return</span> has_buffer;
<a name="l00317"></a>00317 }
<a name="l00318"></a>00318 
<a name="l00319"></a>00319 <span class="keyword">extern</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>  <a class="code" href="gpu-sim_8cc.html#a659fec271553d05e676c52314c8fcfe1">gpu_sim_cycle</a>;
<a name="l00320"></a>00320 <span class="keyword">extern</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">long</span>  <a class="code" href="gpu-sim_8cc.html#acef6bbfd6ec09fe29e2641cace785058">gpu_tot_sim_cycle</a>;
<a name="l00321"></a>00321 
<a name="l00322"></a><a class="code" href="interconnect__interface_8h.html#a45d9451e067dfc66537661d765e2c609">00322</a> <span class="keywordtype">void</span> <a class="code" href="interconnect__interface_8cpp.html#a5a0e9ddcce540935954bdd1835c44ef5">interconnect_push</a> ( <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> input_node, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> output_node, 
<a name="l00323"></a>00323                          <span class="keywordtype">void</span>* data, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size) 
<a name="l00324"></a>00324 { 
<a name="l00325"></a>00325    <span class="keywordtype">int</span> <a class="code" href="cuobjdump__to__ptxplus_8cc.html#a850af8cfb632548b213ce5b365fedd1a">output</a> = node_map[output_node];
<a name="l00326"></a>00326    <span class="keywordtype">int</span> <a class="code" href="lex_8yy_8c.html#a171692544b8e065853e387755849a433">input</a> = node_map[input_node];
<a name="l00327"></a>00327 
<a name="l00328"></a>00328 <span class="preprocessor">#if 0</span>
<a name="l00329"></a>00329 <span class="preprocessor"></span>   cout&lt;&lt;<span class="stringliteral">&quot;Call interconnect push input: &quot;</span>&lt;&lt;input&lt;&lt;<span class="stringliteral">&quot; output: &quot;</span>&lt;&lt;output&lt;&lt;endl;
<a name="l00330"></a>00330 <span class="preprocessor">#endif</span>
<a name="l00331"></a>00331 <span class="preprocessor"></span>
<a name="l00332"></a>00332    <span class="keywordflow">if</span> (fixed_lat_icnt) {
<a name="l00333"></a>00333       ((<a class="code" href="classmem__fetch.html">mem_fetch</a> *) data)-&gt;set_icnt_receive_time( <a class="code" href="gpu-sim_8cc.html#a659fec271553d05e676c52314c8fcfe1">gpu_sim_cycle</a> + <a class="code" href="interconnect__interface_8cpp.html#a7e010aebcd2c0b4b5c60d1a396b52c13">fixed_latency</a>(input,output) );  
<a name="l00334"></a>00334       <a class="code" href="interconnect__interface_8cpp.html#a1b90b5ec544a9475621f8c51d4c35a48">out_buf_fixedlat_buf</a>[output].push(data); <span class="comment">//deliver the whole packet to destination in zero cycles</span>
<a name="l00335"></a>00335       <span class="keywordflow">if</span> (<a class="code" href="interconnect__interface_8cpp.html#a1b90b5ec544a9475621f8c51d4c35a48">out_buf_fixedlat_buf</a>[output].size()  &gt; <a class="code" href="interconnect__interface_8cpp.html#a68018176ed3df9dc9fff731284ce60c5">max_fixedlat_buf_size</a>[output]) {
<a name="l00336"></a>00336          <a class="code" href="interconnect__interface_8cpp.html#a68018176ed3df9dc9fff731284ce60c5">max_fixedlat_buf_size</a>[output]= <a class="code" href="interconnect__interface_8cpp.html#a1b90b5ec544a9475621f8c51d4c35a48">out_buf_fixedlat_buf</a>[output].size();
<a name="l00337"></a>00337       }
<a name="l00338"></a>00338    } <span class="keywordflow">else</span> {
<a name="l00339"></a>00339 
<a name="l00340"></a>00340       <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_flits = size / _flit_size + ((size % _flit_size)? 1:0);
<a name="l00341"></a>00341       <span class="keywordtype">int</span> nc;
<a name="l00342"></a>00342       <span class="keywordflow">if</span> (!<a class="code" href="interconnect__interface_8cpp.html#a76a268fa7b429245daf24ca3f990bf9d">doub_net</a>) {
<a name="l00343"></a>00343          nc=0;
<a name="l00344"></a>00344       } <span class="keywordflow">else</span> <span class="comment">//doub_net enabled</span>
<a name="l00345"></a>00345          <span class="keywordflow">if</span> (<a class="code" href="interconnect__interface_8cpp.html#a86ed5facdc7e17f5cf39a498904311da">is_shd</a>(input) ) {
<a name="l00346"></a>00346          nc=0;
<a name="l00347"></a>00347       } <span class="keywordflow">else</span> {
<a name="l00348"></a>00348          nc=1;
<a name="l00349"></a>00349       }
<a name="l00350"></a>00350       traffic[nc]-&gt;<a class="code" href="classTrafficManager.html#a7c57d1fdea9391745cc42948168b0b6a">_GeneratePacket</a>( input, n_flits, 0 <span class="comment">/*class*/</span>, traffic[nc]-&gt;_time, data, output); 
<a name="l00351"></a>00351 <span class="preprocessor">#if DOUB</span>
<a name="l00352"></a>00352 <span class="preprocessor"></span>      cout &lt;&lt;<span class="stringliteral">&quot;Traffic[&quot;</span> &lt;&lt; nc &lt;&lt; <span class="stringliteral">&quot;] (mapped) sending form &quot;</span>&lt;&lt; input &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; output &lt;&lt;endl;
<a name="l00353"></a>00353 <span class="preprocessor">#endif</span>
<a name="l00354"></a>00354 <span class="preprocessor"></span>   }
<a name="l00355"></a>00355 
<a name="l00356"></a>00356 }
<a name="l00357"></a>00357 
<a name="l00358"></a><a class="code" href="interconnect__interface_8h.html#a8fd0126c02feacf83886789b379bf035">00358</a> <span class="keywordtype">void</span>* <a class="code" href="interconnect__interface_8cpp.html#a62cbe233b1632bb60135daaca135bccd">interconnect_pop</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> output_node) 
<a name="l00359"></a>00359 { 
<a name="l00360"></a>00360    <span class="keywordtype">int</span> <a class="code" href="cuobjdump__to__ptxplus_8cc.html#a850af8cfb632548b213ce5b365fedd1a">output</a> = node_map[output_node];
<a name="l00361"></a>00361 <span class="preprocessor">#if DEBUG</span>
<a name="l00362"></a>00362 <span class="preprocessor"></span>   cout&lt;&lt;<span class="stringliteral">&quot;Call interconnect POP  &quot;</span> &lt;&lt; output&lt;&lt;endl;
<a name="l00363"></a>00363 <span class="preprocessor">#endif</span>
<a name="l00364"></a>00364 <span class="preprocessor"></span>   <span class="keywordtype">void</span>* data = NULL;
<a name="l00365"></a>00365    <span class="keywordflow">if</span> (fixed_lat_icnt) {
<a name="l00366"></a>00366       <span class="keywordflow">if</span> (!<a class="code" href="interconnect__interface_8cpp.html#a1b90b5ec544a9475621f8c51d4c35a48">out_buf_fixedlat_buf</a>[output].empty()) {
<a name="l00367"></a>00367          <span class="keywordflow">if</span> (((<a class="code" href="classmem__fetch.html">mem_fetch</a> *)<a class="code" href="interconnect__interface_8cpp.html#a1b90b5ec544a9475621f8c51d4c35a48">out_buf_fixedlat_buf</a>[output].top())-&gt;get_icnt_receive_time() &lt;= <a class="code" href="gpu-sim_8cc.html#a659fec271553d05e676c52314c8fcfe1">gpu_sim_cycle</a>) {
<a name="l00368"></a>00368             data = <a class="code" href="interconnect__interface_8cpp.html#a1b90b5ec544a9475621f8c51d4c35a48">out_buf_fixedlat_buf</a>[output].top();
<a name="l00369"></a>00369             <a class="code" href="interconnect__interface_8cpp.html#a1b90b5ec544a9475621f8c51d4c35a48">out_buf_fixedlat_buf</a>[output].pop();
<a name="l00370"></a>00370             assert (((<a class="code" href="classmem__fetch.html">mem_fetch</a> *)data)-&gt;get_icnt_receive_time());
<a name="l00371"></a>00371          }
<a name="l00372"></a>00372       }
<a name="l00373"></a>00373    } <span class="keywordflow">else</span> {
<a name="l00374"></a>00374       <span class="keywordtype">unsigned</span> vc;
<a name="l00375"></a>00375       <span class="keywordtype">unsigned</span> turn = <a class="code" href="interconnect__interface_8cpp.html#a4e471f91defdcfa06ef007b327cf9294">round_robin_turn</a>[output];
<a name="l00376"></a>00376       <span class="keywordflow">for</span> (vc=0;(vc&lt;<a class="code" href="interconnect__interface_8cpp.html#a4b2faf70049dd50fd3857200e63e722f">g_num_vcs</a>) &amp;&amp; (data==NULL);vc++) {
<a name="l00377"></a>00377          <span class="keywordflow">if</span> (clock_boundary_buf[output][turn].has_packet()) {
<a name="l00378"></a>00378             data = clock_boundary_buf[output][turn].<a class="code" href="classboundary__buf.html#ad42ccb610cc52aad198311e701ecac09">pop_packet</a>();
<a name="l00379"></a>00379          }
<a name="l00380"></a>00380          turn++;
<a name="l00381"></a>00381          <span class="keywordflow">if</span> (turn == <a class="code" href="interconnect__interface_8cpp.html#a4b2faf70049dd50fd3857200e63e722f">g_num_vcs</a>) turn = 0;
<a name="l00382"></a>00382       }
<a name="l00383"></a>00383       <span class="keywordflow">if</span> (data) {
<a name="l00384"></a>00384          <a class="code" href="interconnect__interface_8cpp.html#a4e471f91defdcfa06ef007b327cf9294">round_robin_turn</a>[output] = turn;
<a name="l00385"></a>00385       }
<a name="l00386"></a>00386    }
<a name="l00387"></a>00387    <span class="keywordflow">return</span> data; 
<a name="l00388"></a>00388 }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="interconnect__interface_8cpp.html#a9111ae9ca77fffebbc29704cf5ae4109">MATLAB_OUTPUT</a>        ; 
<a name="l00391"></a>00391 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="interconnect__interface_8cpp.html#aac6dcf1be52e6f8e628fc0a1009d7fb5">DISPLAY_LAT_DIST</a>     ; 
<a name="l00392"></a>00392 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="interconnect__interface_8cpp.html#af1e8c15b9f2ad59a2e2f4dd9c071310e">DISPLAY_HOP_DIST</a>     ; 
<a name="l00393"></a>00393 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="interconnect__interface_8cpp.html#abd2e0d978c3c4c4e194d6e51b4c12817">DISPLAY_PAIR_LATENCY</a> ; 
<a name="l00394"></a>00394 
<a name="l00395"></a>00395 
<a name="l00396"></a><a class="code" href="interconnect__interface_8h.html#a6965ec63e3958c43b2eccfb64f70488b">00396</a> <span class="keywordtype">void</span> <a class="code" href="interconnect__interface_8cpp.html#a6965ec63e3958c43b2eccfb64f70488b">init_interconnect</a> (<span class="keywordtype">char</span>* config_file,
<a name="l00397"></a>00397                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_shader, 
<a name="l00398"></a>00398                         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n_mem )
<a name="l00399"></a>00399 {
<a name="l00400"></a>00400    <a class="code" href="interconnect__interface_8cpp.html#a935e9ba6da567d38d9fa05096844c502">_n_shader</a> = n_shader;
<a name="l00401"></a>00401    <a class="code" href="interconnect__interface_8cpp.html#a7edd82453748d40c234414fb2b9c5763">_n_mem</a> = n_mem;
<a name="l00402"></a>00402    <span class="keywordflow">if</span> (! config_file ) {
<a name="l00403"></a>00403       cout &lt;&lt; <span class="stringliteral">&quot;Interconnect Requires a configfile&quot;</span> &lt;&lt; endl;
<a name="l00404"></a>00404       exit (-1);
<a name="l00405"></a>00405    }
<a name="l00406"></a>00406    icnt_config.<a class="code" href="classConfiguration.html#aad821a0d5cd64ebc6d815440dc04c586">Parse</a>( config_file );
<a name="l00407"></a>00407 
<a name="l00408"></a>00408    <a class="code" href="interconnect__interface_8cpp.html#a1bbc0af458d118a36b2ac2730fcf559a">net_c</a> = icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>( <span class="stringliteral">&quot;network_count&quot;</span> );
<a name="l00409"></a>00409    <span class="keywordflow">if</span> (<a class="code" href="interconnect__interface_8cpp.html#a1bbc0af458d118a36b2ac2730fcf559a">net_c</a>==2) {
<a name="l00410"></a>00410       <a class="code" href="interconnect__interface_8cpp.html#a76a268fa7b429245daf24ca3f990bf9d">doub_net</a> = <span class="keyword">true</span>;    
<a name="l00411"></a>00411    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (net_c&lt;1 || net_c&gt;2) {
<a name="l00412"></a>00412       cout &lt;&lt;<a class="code" href="interconnect__interface_8cpp.html#a1bbc0af458d118a36b2ac2730fcf559a">net_c</a>&lt;&lt;<span class="stringliteral">&quot; Network_count less than 1 or more than 2 not supported.&quot;</span>&lt;&lt;endl;
<a name="l00413"></a>00413       abort();
<a name="l00414"></a>00414    }
<a name="l00415"></a>00415 
<a name="l00416"></a>00416    <a class="code" href="interconnect__interface_8cpp.html#a4b2faf70049dd50fd3857200e63e722f">g_num_vcs</a> = icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>( <span class="stringliteral">&quot;num_vcs&quot;</span> );
<a name="l00417"></a>00417    <a class="code" href="routefunc_8cpp.html#ae19889ca1f8ae8599156416beffab8e8">InitializeRoutingMap</a>( );
<a name="l00418"></a>00418    <a class="code" href="traffic_8cpp.html#a54ee49c5d902b9323a3963541fe6702a">InitializeTrafficMap</a>( );
<a name="l00419"></a>00419    <a class="code" href="injection_8cpp.html#ae06331b0c511db871896fa2f0b7dba30">InitializeInjectionMap</a>( );
<a name="l00420"></a>00420 
<a name="l00421"></a>00421    <a class="code" href="random__utils_8cpp.html#a1e2af25b6c71f0088af42078ca4cb006">RandomSeed</a>( icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;seed&quot;</span>) );
<a name="l00422"></a>00422 
<a name="l00423"></a>00423    <a class="code" href="classNetwork.html">Network</a> **net;
<a name="l00424"></a>00424 
<a name="l00425"></a>00425    traffic = <span class="keyword">new</span> <a class="code" href="classTrafficManager.html">TrafficManager</a> *[<a class="code" href="interconnect__interface_8cpp.html#a1bbc0af458d118a36b2ac2730fcf559a">net_c</a>];
<a name="l00426"></a>00426    net = <span class="keyword">new</span> <a class="code" href="classNetwork.html">Network</a> *[<a class="code" href="interconnect__interface_8cpp.html#a1bbc0af458d118a36b2ac2730fcf559a">net_c</a>];
<a name="l00427"></a>00427 
<a name="l00428"></a>00428    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;<a class="code" href="interconnect__interface_8cpp.html#a1bbc0af458d118a36b2ac2730fcf559a">net_c</a>;i++) {
<a name="l00429"></a>00429       <span class="keywordtype">string</span> topo;
<a name="l00430"></a>00430 
<a name="l00431"></a>00431       icnt_config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>( <span class="stringliteral">&quot;topology&quot;</span>, topo );
<a name="l00432"></a>00432 
<a name="l00433"></a>00433       <span class="keywordflow">if</span> ( topo == <span class="stringliteral">&quot;torus&quot;</span> ) {
<a name="l00434"></a>00434          net[i] = <span class="keyword">new</span> <a class="code" href="classKNCube.html">KNCube</a>( icnt_config, <span class="keyword">true</span> ); 
<a name="l00435"></a>00435       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (   topo ==<span class="stringliteral">&quot;mesh&quot;</span>  ) {
<a name="l00436"></a>00436          net[i] = <span class="keyword">new</span> <a class="code" href="classKNCube.html">KNCube</a>( icnt_config, <span class="keyword">false</span> );
<a name="l00437"></a>00437       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( topo == <span class="stringliteral">&quot;fly&quot;</span> ) {
<a name="l00438"></a>00438          net[i] = <span class="keyword">new</span> <a class="code" href="classKNFly.html">KNFly</a>( icnt_config );
<a name="l00439"></a>00439       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( topo == <span class="stringliteral">&quot;single&quot;</span> ) {
<a name="l00440"></a>00440          net[i] = <span class="keyword">new</span> <a class="code" href="classSingleNet.html">SingleNet</a>( icnt_config );
<a name="l00441"></a>00441       } <span class="keywordflow">else</span> {
<a name="l00442"></a>00442          cerr &lt;&lt; <span class="stringliteral">&quot;Unknown topology &quot;</span> &lt;&lt; topo &lt;&lt; endl;
<a name="l00443"></a>00443          exit(-1);
<a name="l00444"></a>00444       }
<a name="l00445"></a>00445 
<a name="l00446"></a>00446       <span class="keywordflow">if</span> ( icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>( <span class="stringliteral">&quot;link_failures&quot;</span> ) ) {
<a name="l00447"></a>00447          net[i]-&gt;InsertRandomFaults( icnt_config );
<a name="l00448"></a>00448       }
<a name="l00449"></a>00449 
<a name="l00450"></a>00450       traffic[i] = <span class="keyword">new</span> <a class="code" href="classTrafficManager.html">TrafficManager</a> ( icnt_config, net[i], i<span class="comment">/*id*/</span> );
<a name="l00451"></a>00451    }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453    fixed_lat_icnt = icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>( <span class="stringliteral">&quot;fixed_lat_per_hop&quot;</span> );
<a name="l00454"></a>00454 
<a name="l00455"></a>00455    <span class="keywordflow">if</span> (icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>( <span class="stringliteral">&quot;perfect_icnt&quot;</span> )) {
<a name="l00456"></a>00456       <a class="code" href="interconnect__interface_8cpp.html#a0c159f528c97d4b52aeeb43baaeea434">perfect_icnt</a> = <span class="keyword">true</span>;
<a name="l00457"></a>00457       fixed_lat_icnt = 1;  
<a name="l00458"></a>00458    }
<a name="l00459"></a>00459    _flit_size = icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>( <span class="stringliteral">&quot;flit_size&quot;</span> );
<a name="l00460"></a>00460    <span class="keywordflow">if</span> (icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;ejection_buf_size&quot;</span>)) {
<a name="l00461"></a>00461       <a class="code" href="interconnect__interface_8cpp.html#a5742db83c33321f3592813307be569e5">ejection_buffer_capacity</a> = icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>( <span class="stringliteral">&quot;ejection_buf_size&quot;</span> ) ;
<a name="l00462"></a>00462    } <span class="keywordflow">else</span> {
<a name="l00463"></a>00463       <a class="code" href="interconnect__interface_8cpp.html#a5742db83c33321f3592813307be569e5">ejection_buffer_capacity</a> = icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>( <span class="stringliteral">&quot;vc_buf_size&quot;</span> );
<a name="l00464"></a>00464    }
<a name="l00465"></a>00465    <a class="code" href="interconnect__interface_8cpp.html#a172fe4159bac3b768e2f57edcce8c531">boundary_buf_capacity</a> = icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>( <span class="stringliteral">&quot;boundary_buf_size&quot;</span> ) ;
<a name="l00466"></a>00466    <span class="keywordflow">if</span> (icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;input_buf_size&quot;</span>)) {
<a name="l00467"></a>00467       <a class="code" href="interconnect__interface_8cpp.html#ac356a00515cfba9507f9f036b3d0e667">input_buffer_capacity</a> = icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;input_buf_size&quot;</span>);
<a name="l00468"></a>00468    } <span class="keywordflow">else</span> {
<a name="l00469"></a>00469       <a class="code" href="interconnect__interface_8cpp.html#ac356a00515cfba9507f9f036b3d0e667">input_buffer_capacity</a> = 9;
<a name="l00470"></a>00470    }
<a name="l00471"></a>00471    <a class="code" href="interconnect__interface_8cpp.html#a64c1ffda54cfb09181c675389668c223">create_buf</a>(traffic[0]-&gt;_dests,<a class="code" href="interconnect__interface_8cpp.html#ac356a00515cfba9507f9f036b3d0e667">input_buffer_capacity</a>,icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>( <span class="stringliteral">&quot;num_vcs&quot;</span> )); 
<a name="l00472"></a>00472    MATLAB_OUTPUT        = icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;MATLAB_OUTPUT&quot;</span>);
<a name="l00473"></a>00473    DISPLAY_LAT_DIST     = icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;DISPLAY_LAT_DIST&quot;</span>);
<a name="l00474"></a>00474    DISPLAY_HOP_DIST     = icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;DISPLAY_HOP_DIST&quot;</span>);
<a name="l00475"></a>00475    DISPLAY_PAIR_LATENCY = icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;DISPLAY_PAIR_LATENCY&quot;</span>);
<a name="l00476"></a>00476    <a class="code" href="interconnect__interface_8cpp.html#a33f32999209745ffe5dcbfe0031fd438">create_node_map</a>(n_shader,n_mem,traffic[0]-&gt;_dests, icnt_config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;use_map&quot;</span>));
<a name="l00477"></a>00477    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;net_c;i++) {
<a name="l00478"></a>00478       traffic[i]-&gt;<a class="code" href="classTrafficManager.html#afb1b86befc404b033d3df5b67547d982">_FirstStep</a>();
<a name="l00479"></a>00479    }
<a name="l00480"></a>00480 }
<a name="l00481"></a>00481 
<a name="l00482"></a><a class="code" href="interconnect__interface_8h.html#aefbc6115d4d413944c73ae97ed52622a">00482</a> <span class="keywordtype">void</span> <a class="code" href="interconnect__interface_8cpp.html#aefbc6115d4d413944c73ae97ed52622a">advance_interconnect</a> () 
<a name="l00483"></a>00483 {
<a name="l00484"></a>00484    <span class="keywordflow">if</span> (!fixed_lat_icnt) {
<a name="l00485"></a>00485       <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0;i&lt;<a class="code" href="interconnect__interface_8cpp.html#a1bbc0af458d118a36b2ac2730fcf559a">net_c</a>;i++) {
<a name="l00486"></a>00486          traffic[i]-&gt;<a class="code" href="classTrafficManager.html#ae2f9ae1d30700cb03c2922b41b977c1d">_Step</a>( );
<a name="l00487"></a>00487       }
<a name="l00488"></a>00488    }
<a name="l00489"></a>00489 }
<a name="l00490"></a>00490 
<a name="l00491"></a><a class="code" href="interconnect__interface_8h.html#a00a1c307f83de75fad3c4af5024f56a4">00491</a> <span class="keywordtype">unsigned</span> <a class="code" href="interconnect__interface_8cpp.html#a00a1c307f83de75fad3c4af5024f56a4">interconnect_busy</a>()
<a name="l00492"></a>00492 {
<a name="l00493"></a>00493    <span class="keywordtype">unsigned</span> i,j;
<a name="l00494"></a>00494    <span class="keywordflow">for</span>(i=0; i&lt;<a class="code" href="interconnect__interface_8cpp.html#a1bbc0af458d118a36b2ac2730fcf559a">net_c</a>;i++) {
<a name="l00495"></a>00495       <span class="keywordflow">if</span> (traffic[i]-&gt;_measured_in_flight) {
<a name="l00496"></a>00496          <span class="keywordflow">return</span> 1;
<a name="l00497"></a>00497       }
<a name="l00498"></a>00498    }
<a name="l00499"></a>00499    <span class="keywordflow">for</span> ( i=0 ;i&lt;(<a class="code" href="interconnect__interface_8cpp.html#a935e9ba6da567d38d9fa05096844c502">_n_shader</a>+<a class="code" href="interconnect__interface_8cpp.html#a7edd82453748d40c234414fb2b9c5763">_n_mem</a>);i++ ) {
<a name="l00500"></a>00500         <span class="keywordflow">if</span> ( !traffic[0]-&gt;_partial_packets[i] [0].empty() ) {
<a name="l00501"></a>00501             <span class="keywordflow">return</span> 1;
<a name="l00502"></a>00502         }
<a name="l00503"></a>00503         <span class="keywordflow">if</span> ( <a class="code" href="interconnect__interface_8cpp.html#a76a268fa7b429245daf24ca3f990bf9d">doub_net</a> &amp;&amp; !traffic[1]-&gt;_partial_packets[i] [0].empty() ) {
<a name="l00504"></a>00504             <span class="keywordflow">return</span> 1;
<a name="l00505"></a>00505         }
<a name="l00506"></a>00506         <span class="keywordflow">for</span> ( j=0;j&lt;<a class="code" href="interconnect__interface_8cpp.html#a4b2faf70049dd50fd3857200e63e722f">g_num_vcs</a>;j++ ) {
<a name="l00507"></a>00507             <span class="keywordflow">if</span> ( !<a class="code" href="interconnect__interface_8cpp.html#acce9bb31708103e0d333817be61ccc82">ejection_buf</a>[i][j].empty() || clock_boundary_buf[i][j].<a class="code" href="classboundary__buf.html#a46e5854a5e86e83c5a1bafb67e391c15">has_packet</a>() ) {
<a name="l00508"></a>00508                 <span class="keywordflow">return</span> 1;
<a name="l00509"></a>00509             }
<a name="l00510"></a>00510         }
<a name="l00511"></a>00511     }
<a name="l00512"></a>00512     <span class="keywordflow">return</span> 0;
<a name="l00513"></a>00513 }
<a name="l00514"></a>00514 
<a name="l00515"></a><a class="code" href="interconnect__interface_8cpp.html#a05171610be1cbfca1e871a6bdb700630">00515</a> <span class="keywordtype">void</span> <a class="code" href="interconnect__interface_8cpp.html#a05171610be1cbfca1e871a6bdb700630">display_icnt_state</a>( FILE *fp )
<a name="l00516"></a>00516 {
<a name="l00517"></a>00517    fprintf(fp,<span class="stringliteral">&quot;GPGPU-Sim uArch: interconnect busy state\n&quot;</span>);
<a name="l00518"></a>00518    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0; i&lt;<a class="code" href="interconnect__interface_8cpp.html#a1bbc0af458d118a36b2ac2730fcf559a">net_c</a>;i++) {
<a name="l00519"></a>00519       <span class="keywordflow">if</span> (traffic[i]-&gt;_measured_in_flight) 
<a name="l00520"></a>00520          fprintf(fp,<span class="stringliteral">&quot;   Network %u has %u _measured_in_flight\n&quot;</span>, i, traffic[i]-&gt;_measured_in_flight );
<a name="l00521"></a>00521    }
<a name="l00522"></a>00522    
<a name="l00523"></a>00523    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> i=0 ;i&lt;(<a class="code" href="interconnect__interface_8cpp.html#a935e9ba6da567d38d9fa05096844c502">_n_shader</a>+<a class="code" href="interconnect__interface_8cpp.html#a7edd82453748d40c234414fb2b9c5763">_n_mem</a>);i++ ) {
<a name="l00524"></a>00524       <span class="keywordflow">if</span>( !traffic[0]-&gt;_partial_packets[i] [0].empty() ) 
<a name="l00525"></a>00525          fprintf(fp,<span class="stringliteral">&quot;   Network 0 has nonempty _partial_packets[%u][0]\n&quot;</span>, i);
<a name="l00526"></a>00526         <span class="keywordflow">if</span> ( <a class="code" href="interconnect__interface_8cpp.html#a76a268fa7b429245daf24ca3f990bf9d">doub_net</a> &amp;&amp; !traffic[1]-&gt;_partial_packets[i] [0].empty() ) 
<a name="l00527"></a>00527          fprintf(fp,<span class="stringliteral">&quot;   Network 1 has nonempty _partial_packets[%u][0]\n&quot;</span>, i);
<a name="l00528"></a>00528         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> j=0;j&lt;<a class="code" href="interconnect__interface_8cpp.html#a4b2faf70049dd50fd3857200e63e722f">g_num_vcs</a>;j++ ) {
<a name="l00529"></a>00529             <span class="keywordflow">if</span>( !<a class="code" href="interconnect__interface_8cpp.html#acce9bb31708103e0d333817be61ccc82">ejection_buf</a>[i][j].empty() )
<a name="l00530"></a>00530             fprintf(fp,<span class="stringliteral">&quot;   ejection_buf[%u][%u] is non-empty\n&quot;</span>, i, j);
<a name="l00531"></a>00531          <span class="keywordflow">if</span>( clock_boundary_buf[i][j].has_packet() )
<a name="l00532"></a>00532             fprintf(fp,<span class="stringliteral">&quot;   clock_boundary_buf[%u][%u] has packet\n&quot;</span>, i, j );
<a name="l00533"></a>00533         }
<a name="l00534"></a>00534     }
<a name="l00535"></a>00535 }
<a name="l00536"></a>00536 
<a name="l00537"></a>00537 <span class="comment">//create buffers for src_n nodes   </span>
<a name="l00538"></a><a class="code" href="interconnect__interface_8h.html#a64c1ffda54cfb09181c675389668c223">00538</a> <span class="keywordtype">void</span> <a class="code" href="interconnect__interface_8cpp.html#a64c1ffda54cfb09181c675389668c223">create_buf</a>(<span class="keywordtype">int</span> src_n,<span class="keywordtype">int</span> warp_n,<span class="keywordtype">int</span> vc_n)
<a name="l00539"></a>00539 {
<a name="l00540"></a>00540    <span class="keywordtype">int</span> i;
<a name="l00541"></a>00541    <a class="code" href="interconnect__interface_8cpp.html#acce9bb31708103e0d333817be61ccc82">ejection_buf</a>   = <span class="keyword">new</span> queue&lt;Flit *&gt;* [src_n];
<a name="l00542"></a>00542    clock_boundary_buf = <span class="keyword">new</span> <a class="code" href="classboundary__buf.html">boundary_buf</a>* [src_n];
<a name="l00543"></a>00543    <a class="code" href="interconnect__interface_8cpp.html#a4e471f91defdcfa06ef007b327cf9294">round_robin_turn</a>.resize( src_n );
<a name="l00544"></a>00544    <span class="keywordflow">for</span> (i=0;i&lt;src_n;i++){
<a name="l00545"></a>00545          <a class="code" href="interconnect__interface_8cpp.html#acce9bb31708103e0d333817be61ccc82">ejection_buf</a>[i]= <span class="keyword">new</span> queue&lt;Flit *&gt;[vc_n];
<a name="l00546"></a>00546          clock_boundary_buf[i]= <span class="keyword">new</span> <a class="code" href="classboundary__buf.html">boundary_buf</a>[vc_n];
<a name="l00547"></a>00547          <a class="code" href="interconnect__interface_8cpp.html#a4e471f91defdcfa06ef007b327cf9294">round_robin_turn</a>[vc_n-1];
<a name="l00548"></a>00548    } 
<a name="l00549"></a>00549    <span class="keywordflow">if</span> (fixed_lat_icnt) {
<a name="l00550"></a>00550       <a class="code" href="interconnect__interface_8cpp.html#a1b90b5ec544a9475621f8c51d4c35a48">out_buf_fixedlat_buf</a>  = <span class="keyword">new</span> priority_queue&lt;void * , vector&lt;void* &gt;, <a class="code" href="classmycomparison.html">mycomparison</a>&gt; [src_n];  
<a name="l00551"></a>00551       <a class="code" href="interconnect__interface_8cpp.html#a68018176ed3df9dc9fff731284ce60c5">max_fixedlat_buf_size</a>    = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> [src_n];
<a name="l00552"></a>00552       <span class="keywordflow">for</span> (i=0;i&lt;src_n;i++) {
<a name="l00553"></a>00553          <a class="code" href="interconnect__interface_8cpp.html#a68018176ed3df9dc9fff731284ce60c5">max_fixedlat_buf_size</a>[i]=0;
<a name="l00554"></a>00554       }
<a name="l00555"></a>00555    }
<a name="l00556"></a>00556 
<a name="l00557"></a>00557 }
<a name="l00558"></a>00558 
<a name="l00559"></a><a class="code" href="interconnect__interface_8h.html#a7ee4d231fe6ace6fa7f1ca5941809a26">00559</a> <span class="keywordtype">void</span> <a class="code" href="interconnect__interface_8cpp.html#ac961933655062538cf125fb64a58082c">write_out_buf</a>(<span class="keywordtype">int</span> <a class="code" href="cuobjdump__to__ptxplus_8cc.html#a850af8cfb632548b213ce5b365fedd1a">output</a>, <a class="code" href="structFlit.html">Flit</a> *flit) {
<a name="l00560"></a>00560    <span class="keywordtype">int</span> vc = flit-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>;
<a name="l00561"></a>00561    assert (<a class="code" href="interconnect__interface_8cpp.html#acce9bb31708103e0d333817be61ccc82">ejection_buf</a>[output][vc].size() &lt; <a class="code" href="interconnect__interface_8cpp.html#a5742db83c33321f3592813307be569e5">ejection_buffer_capacity</a>);
<a name="l00562"></a>00562    <a class="code" href="interconnect__interface_8cpp.html#acce9bb31708103e0d333817be61ccc82">ejection_buf</a>[output][vc].push(flit);
<a name="l00563"></a>00563 }
<a name="l00564"></a>00564 
<a name="l00565"></a><a class="code" href="interconnect__interface_8h.html#a05e0aee9416042dec51e022f22d0d58d">00565</a> <span class="keywordtype">void</span> <a class="code" href="interconnect__interface_8cpp.html#a05e0aee9416042dec51e022f22d0d58d">transfer2boundary_buf</a>(<span class="keywordtype">int</span> <a class="code" href="cuobjdump__to__ptxplus_8cc.html#a850af8cfb632548b213ce5b365fedd1a">output</a>) {
<a name="l00566"></a>00566     <a class="code" href="structFlit.html">Flit</a>* flit;
<a name="l00567"></a>00567    <span class="keywordtype">unsigned</span> vc;
<a name="l00568"></a>00568    <span class="keywordflow">for</span> (vc=0; vc&lt;<a class="code" href="interconnect__interface_8cpp.html#a4b2faf70049dd50fd3857200e63e722f">g_num_vcs</a>;vc++) {
<a name="l00569"></a>00569       <span class="keywordflow">if</span> ( !<a class="code" href="interconnect__interface_8cpp.html#acce9bb31708103e0d333817be61ccc82">ejection_buf</a>[output][vc].empty() &amp;&amp; !clock_boundary_buf[output][vc].is_full() ) {
<a name="l00570"></a>00570          flit = <a class="code" href="interconnect__interface_8cpp.html#acce9bb31708103e0d333817be61ccc82">ejection_buf</a>[output][vc].front();
<a name="l00571"></a>00571          <a class="code" href="interconnect__interface_8cpp.html#acce9bb31708103e0d333817be61ccc82">ejection_buf</a>[output][vc].pop();
<a name="l00572"></a>00572          clock_boundary_buf[output][vc].<a class="code" href="classboundary__buf.html#a6fa7e6a87212a7f7737fd067e41f4f5c">push_flit_data</a>( flit-&gt;<a class="code" href="structFlit.html#a7dc89003b27149a895ca7a7eace54e83">data</a>, flit-&gt;<a class="code" href="structFlit.html#aa0f32295d57acd313ddf257127b5c850">tail</a>);
<a name="l00573"></a>00573          traffic[flit-&gt;<a class="code" href="structFlit.html#ae9bd013a1c371289cf8ab358baeeb1d3">net_num</a>]-&gt;<a class="code" href="classTrafficManager.html#a464bfb6e004c4c03cad8b435c21cbe09">credit_return_queue</a>[output].push(flit); <span class="comment">//will send back credit        </span>
<a name="l00574"></a>00574          <span class="keywordflow">if</span> ( flit-&gt;<a class="code" href="structFlit.html#a784a6bcb041646c2b8c068b7de4bdc9a">head</a> ) {
<a name="l00575"></a>00575             assert (flit-&gt;<a class="code" href="structFlit.html#a89d05814b6f9dcd035ec002a7ea00c57">dest</a> == output);
<a name="l00576"></a>00576          }
<a name="l00577"></a>00577 <span class="preprocessor">#if DOUB</span>
<a name="l00578"></a>00578 <span class="preprocessor"></span>         cout &lt;&lt;<span class="stringliteral">&quot;Traffic &quot;</span> &lt;&lt;nc&lt;&lt;<span class="stringliteral">&quot; push out flit to (mapped)&quot;</span> &lt;&lt; output &lt;&lt;endl;
<a name="l00579"></a>00579 <span class="preprocessor">#endif</span>
<a name="l00580"></a>00580 <span class="preprocessor"></span>      }
<a name="l00581"></a>00581    }
<a name="l00582"></a>00582 }
<a name="l00583"></a>00583 
<a name="l00584"></a>00584 <span class="keywordtype">void</span> <a class="code" href="visualizer_8cc.html#af21cf6c37b603f08f42a7754fc022c66">time_vector_update</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> uid, <span class="keywordtype">int</span> slot , <span class="keywordtype">long</span> <span class="keywordtype">int</span> cycle, <span class="keywordtype">int</span> type);
<a name="l00585"></a>00585 
<a name="l00586"></a><a class="code" href="interconnect__interface_8h.html#a8ccd11b858fa26c9ed21a73cff9ce75c">00586</a> <span class="keywordtype">void</span> <a class="code" href="interconnect__interface_8cpp.html#a778af5d2e44e62524fe048c9307cf2c6">time_vector_update_icnt_injected</a>(<span class="keywordtype">void</span>* data, <span class="keywordtype">int</span> <a class="code" href="lex_8yy_8c.html#a171692544b8e065853e387755849a433">input</a>) 
<a name="l00587"></a>00587 {
<a name="l00588"></a>00588     <span class="comment">/*</span>
<a name="l00589"></a>00589 <span class="comment">    mem_fetch* mf = (mem_fetch*) data;</span>
<a name="l00590"></a>00590 <span class="comment">    if( mf-&gt;get_mshr() &amp;&amp; !mf-&gt;get_mshr()-&gt;isinst() ) {</span>
<a name="l00591"></a>00591 <span class="comment">        unsigned uid=mf-&gt;get_request_uid();</span>
<a name="l00592"></a>00592 <span class="comment">        long int cycle = gpu_sim_cycle + gpu_tot_sim_cycle;</span>
<a name="l00593"></a>00593 <span class="comment">        int req_type = mf-&gt;get_is_write()? WT_REQ : RD_REQ;</span>
<a name="l00594"></a>00594 <span class="comment">        if (is_mem(input)) {</span>
<a name="l00595"></a>00595 <span class="comment">           time_vector_update( uid, MR_2SH_ICNT_INJECTED, cycle, req_type );      </span>
<a name="l00596"></a>00596 <span class="comment">        } else { </span>
<a name="l00597"></a>00597 <span class="comment">           time_vector_update( uid, MR_ICNT_INJECTED, cycle,req_type );</span>
<a name="l00598"></a>00598 <span class="comment">        }</span>
<a name="l00599"></a>00599 <span class="comment">    }</span>
<a name="l00600"></a>00600 <span class="comment">    */</span>
<a name="l00601"></a>00601 }
<a name="l00602"></a>00602 
<a name="l00604"></a><a class="code" href="interconnect__interface_8h.html#a902251e0a9efa6d894ff288d8eb239a1">00604</a> <span class="keywordtype">unsigned</span> <a class="code" href="interconnect__interface_8cpp.html#a902251e0a9efa6d894ff288d8eb239a1" title="Returns size of flit.">interconnect_get_flit_size</a>(){
<a name="l00605"></a>00605     <span class="keywordflow">return</span> _flit_size;
<a name="l00606"></a>00606 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 13 May 2014 for GPGPU-Sim by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
