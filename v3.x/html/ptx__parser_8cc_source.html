<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GPGPU-Sim: v3.x/src/cuda-sim/ptx_parser.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_c934b74ccb33d6b9bfd1e576787940d8.html">v3.x</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_da58ad9beee6988f697f1a76e412a52a.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_2d77c6696a6548cf53989385b9967e1d.html">cuda-sim</a>
  </div>
</div>
<div class="contents">
<h1>ptx_parser.cc</h1><a href="ptx__parser_8cc.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// Copyright (c) 2009-2011, Tor M. Aamodt, Ali Bakhoda, Wilson W.L. Fung</span>
<a name="l00002"></a>00002 <span class="comment">// The University of British Columbia</span>
<a name="l00003"></a>00003 <span class="comment">// All rights reserved.</span>
<a name="l00004"></a>00004 <span class="comment">//</span>
<a name="l00005"></a>00005 <span class="comment">// Redistribution and use in source and binary forms, with or without</span>
<a name="l00006"></a>00006 <span class="comment">// modification, are permitted provided that the following conditions are met:</span>
<a name="l00007"></a>00007 <span class="comment">//</span>
<a name="l00008"></a>00008 <span class="comment">// Redistributions of source code must retain the above copyright notice, this</span>
<a name="l00009"></a>00009 <span class="comment">// list of conditions and the following disclaimer.</span>
<a name="l00010"></a>00010 <span class="comment">// Redistributions in binary form must reproduce the above copyright notice, this</span>
<a name="l00011"></a>00011 <span class="comment">// list of conditions and the following disclaimer in the documentation and/or</span>
<a name="l00012"></a>00012 <span class="comment">// other materials provided with the distribution.</span>
<a name="l00013"></a>00013 <span class="comment">// Neither the name of The University of British Columbia nor the names of its</span>
<a name="l00014"></a>00014 <span class="comment">// contributors may be used to endorse or promote products derived from this</span>
<a name="l00015"></a>00015 <span class="comment">// software without specific prior written permission.</span>
<a name="l00016"></a>00016 <span class="comment">//</span>
<a name="l00017"></a>00017 <span class="comment">// THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND</span>
<a name="l00018"></a>00018 <span class="comment">// ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span>
<a name="l00019"></a>00019 <span class="comment">// WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE</span>
<a name="l00020"></a>00020 <span class="comment">// DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE</span>
<a name="l00021"></a>00021 <span class="comment">// FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL</span>
<a name="l00022"></a>00022 <span class="comment">// DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR</span>
<a name="l00023"></a>00023 <span class="comment">// SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER</span>
<a name="l00024"></a>00024 <span class="comment">// CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY,</span>
<a name="l00025"></a>00025 <span class="comment">// OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE</span>
<a name="l00026"></a>00026 <span class="comment">// OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include &quot;ptx_parser.h&quot;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &quot;<a class="code" href="ptx__ir_8h.html">ptx_ir.h</a>&quot;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &quot;<a class="code" href="ptx_8tab_8h.html">ptx.tab.h</a>&quot;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;stdarg.h&gt;</span>
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="ptx__parser_8cc.html#a7c983281e08399b9881676630e50651b">ptx_error</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *s );
<a name="l00034"></a>00034 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="ptx__parser_8cc.html#a4414558a5f7dded6a102d46d656b9a39">ptx_lineno</a>;
<a name="l00035"></a>00035 
<a name="l00036"></a><a class="code" href="ptx__parser_8cc.html#a249cf9afc04a0775495d53644938bfa3">00036</a> <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span><a class="code" href="structcore__config.html">core_config</a> *<a class="code" href="ptx__parser_8cc.html#a249cf9afc04a0775495d53644938bfa3">g_shader_core_config</a>;
<a name="l00037"></a><a class="code" href="gpu-sim_8cc.html#adf535d8fe68e89347f67b88097ca9925">00037</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#adf535d8fe68e89347f67b88097ca9925">set_ptx_warp_size</a>(<span class="keyword">const</span> <span class="keyword">struct</span> <a class="code" href="structcore__config.html">core_config</a> * <a class="code" href="structcore__config.html#a13edb2e659903146089ba0e75ce36ed1">warp_size</a>)
<a name="l00038"></a>00038 {
<a name="l00039"></a>00039    g_shader_core_config=warp_size;
<a name="l00040"></a>00040 }
<a name="l00041"></a>00041 
<a name="l00042"></a><a class="code" href="ptx__parser_8cc.html#a9062d368e1a834b31ca99144a56b2928">00042</a> <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="ptx__parser_8cc.html#a9062d368e1a834b31ca99144a56b2928">g_debug_ir_generation</a>=<span class="keyword">false</span>;
<a name="l00043"></a><a class="code" href="ptx_8tab_8c.html#a122c21cc0a19e563d5343d255dbcf36c">00043</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ptx__parser_8cc.html#a122c21cc0a19e563d5343d255dbcf36c">g_filename</a>;
<a name="l00044"></a><a class="code" href="ptx__parser_8cc.html#a6a0e147c805f5ae57e45d138a7b6ce45">00044</a> <span class="keywordtype">unsigned</span> <a class="code" href="ptx__parser_8cc.html#a6a0e147c805f5ae57e45d138a7b6ce45">g_max_regs_per_thread</a> = 0;
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="comment">// the program intermediate representation...</span>
<a name="l00047"></a><a class="code" href="ptx__parser_8cc.html#a55b264b432e4f1c6643bac36e0bfc7b6">00047</a> <span class="keyword">static</span> <a class="code" href="classsymbol__table.html">symbol_table</a> *<a class="code" href="ptx__parser_8cc.html#a55b264b432e4f1c6643bac36e0bfc7b6">g_global_allfiles_symbol_table</a> = NULL;
<a name="l00048"></a><a class="code" href="ptx__parser_8cc.html#a231afe8848bbe7932158bdc814fb5a75">00048</a> <span class="keyword">static</span> <a class="code" href="classsymbol__table.html">symbol_table</a> *<a class="code" href="ptx__parser_8cc.html#a231afe8848bbe7932158bdc814fb5a75">g_global_symbol_table</a> = NULL;
<a name="l00049"></a><a class="code" href="ptx__parser_8cc.html#aeef56c6f09e0b8f05a6a6258ae7a24b4">00049</a> std::map&lt;std::string,symbol_table*&gt; <a class="code" href="ptx__ir_8h.html#aeef56c6f09e0b8f05a6a6258ae7a24b4">g_sym_name_to_symbol_table</a>;
<a name="l00050"></a><a class="code" href="ptx__parser_8cc.html#af1fe75c2eb84e1504b60cb594bf34f2f">00050</a> <span class="keyword">static</span> <a class="code" href="classsymbol__table.html">symbol_table</a> *<a class="code" href="ptx__parser_8cc.html#af1fe75c2eb84e1504b60cb594bf34f2f">g_current_symbol_table</a> = NULL;
<a name="l00051"></a><a class="code" href="ptx__parser_8cc.html#a2b3493af7af3b33be30f529ed90e8848">00051</a> <span class="keyword">static</span> std::list&lt;ptx_instruction*&gt; <a class="code" href="ptx__parser_8cc.html#a2b3493af7af3b33be30f529ed90e8848">g_instructions</a>;
<a name="l00052"></a><a class="code" href="ptx__parser_8cc.html#a011961195a9814227803a83e02d9594e">00052</a> <span class="keyword">static</span> <a class="code" href="classsymbol.html">symbol</a> *<a class="code" href="ptx__parser_8cc.html#a011961195a9814227803a83e02d9594e">g_last_symbol</a> = NULL;
<a name="l00053"></a>00053 
<a name="l00054"></a><a class="code" href="lex_8ptx___8c.html#a910eae0cd5548c63c4cc99d4bd09ca49">00054</a> <span class="keywordtype">int</span> <a class="code" href="ptx__parser_8cc.html#a910eae0cd5548c63c4cc99d4bd09ca49">g_error_detected</a> = 0;
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 <span class="comment">// type specifier stuff:</span>
<a name="l00057"></a><a class="code" href="ptx__parser_8cc.html#a479bd2714bbf47fd065e5142c1f8ba9b">00057</a> <a class="code" href="classmemory__space__t.html">memory_space_t</a> <a class="code" href="ptx__parser_8cc.html#a479bd2714bbf47fd065e5142c1f8ba9b">g_space_spec</a> = <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca434a5fd1a70c9dcbe2de96e9c602d265">undefined_space</a>;
<a name="l00058"></a><a class="code" href="ptx__parser_8cc.html#acb081ca89aa57f5bdf38cb73b4613f2e">00058</a> <a class="code" href="classmemory__space__t.html">memory_space_t</a> <a class="code" href="ptx__parser_8cc.html#acb081ca89aa57f5bdf38cb73b4613f2e">g_ptr_spec</a> = <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca434a5fd1a70c9dcbe2de96e9c602d265">undefined_space</a>;
<a name="l00059"></a><a class="code" href="ptx__parser_8cc.html#a4a501e0f9d452014efc6a26dadf0bbfb">00059</a> <span class="keywordtype">int</span> <a class="code" href="ptx__parser_8cc.html#a4a501e0f9d452014efc6a26dadf0bbfb">g_scalar_type_spec</a> = -1;
<a name="l00060"></a><a class="code" href="ptx__parser_8cc.html#afd21f30b2cf0651bc2726ed8de8a385f">00060</a> <span class="keywordtype">int</span> <a class="code" href="ptx__parser_8cc.html#afd21f30b2cf0651bc2726ed8de8a385f">g_vector_spec</a> = -1;
<a name="l00061"></a><a class="code" href="ptx__parser_8cc.html#a3565273a1cd430c0c8b7e482a6d7fde9">00061</a> <span class="keywordtype">int</span> <a class="code" href="ptx__parser_8cc.html#a3565273a1cd430c0c8b7e482a6d7fde9">g_alignment_spec</a> = -1;
<a name="l00062"></a><a class="code" href="ptx__parser_8cc.html#a6bd9c6b23efc3160003e7763173c8c33">00062</a> <span class="keywordtype">int</span> <a class="code" href="ptx__parser_8cc.html#a6bd9c6b23efc3160003e7763173c8c33">g_extern_spec</a> = 0;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064 <span class="comment">// variable declaration stuff:</span>
<a name="l00065"></a><a class="code" href="ptx__parser_8cc.html#a9cea0491bc35a9c86684e01fbb036c07">00065</a> <a class="code" href="classtype__info.html">type_info</a> *<a class="code" href="ptx__parser_8cc.html#a9cea0491bc35a9c86684e01fbb036c07">g_var_type</a> = NULL;
<a name="l00066"></a>00066 
<a name="l00067"></a>00067 <span class="comment">// instruction definition stuff:</span>
<a name="l00068"></a><a class="code" href="ptx__parser_8cc.html#adf2ad05dae71c8dd084201685b2ee48f">00068</a> <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *<a class="code" href="ptx__parser_8cc.html#adf2ad05dae71c8dd084201685b2ee48f">g_pred</a>;
<a name="l00069"></a><a class="code" href="ptx__parser_8cc.html#add0578eceaf7d2c6062670b8216429b9">00069</a> <span class="keywordtype">int</span> <a class="code" href="ptx__parser_8cc.html#add0578eceaf7d2c6062670b8216429b9">g_neg_pred</a>;
<a name="l00070"></a><a class="code" href="ptx__parser_8cc.html#ad57cd442c2d6b8ba59db7078578fbe14">00070</a> <span class="keywordtype">int</span> <a class="code" href="ptx__parser_8cc.html#ad57cd442c2d6b8ba59db7078578fbe14">g_pred_mod</a>;
<a name="l00071"></a><a class="code" href="ptx__parser_8cc.html#a8fa8b12cadabc52f264fcd534db171bc">00071</a> <a class="code" href="classsymbol.html">symbol</a> *<a class="code" href="ptx__parser_8cc.html#a8fa8b12cadabc52f264fcd534db171bc">g_label</a>;
<a name="l00072"></a><a class="code" href="ptx__parser_8cc.html#aa26e5f44a82d9b18bd9084d7cd8ad998">00072</a> <span class="keywordtype">int</span> <a class="code" href="ptx__parser_8cc.html#aa26e5f44a82d9b18bd9084d7cd8ad998">g_opcode</a> = -1;
<a name="l00073"></a><a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">00073</a> std::list&lt;operand_info&gt; <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>;
<a name="l00074"></a><a class="code" href="ptx__parser_8cc.html#a8a0a82a1a278fd11d26c58674ddc099f">00074</a> std::list&lt;int&gt; <a class="code" href="ptx__parser_8cc.html#a8a0a82a1a278fd11d26c58674ddc099f">g_options</a>;
<a name="l00075"></a><a class="code" href="ptx__parser_8cc.html#af4e9516fa78492b091b59dda0810d597">00075</a> std::list&lt;int&gt; <a class="code" href="ptx__parser_8cc.html#af4e9516fa78492b091b59dda0810d597">g_scalar_type</a>;
<a name="l00076"></a>00076 
<a name="l00077"></a>00077 <span class="preprocessor">#define PTX_PARSE_DPRINTF(...) \</span>
<a name="l00078"></a>00078 <span class="preprocessor">   if( g_debug_ir_generation ) { \</span>
<a name="l00079"></a>00079 <span class="preprocessor">      printf(&quot; %s:%u =&gt; &quot;,g_filename,ptx_lineno); \</span>
<a name="l00080"></a>00080 <span class="preprocessor">      printf(&quot;   (%s:%u) &quot;, __FILE__, __LINE__); \</span>
<a name="l00081"></a>00081 <span class="preprocessor">      printf(__VA_ARGS__); \</span>
<a name="l00082"></a>00082 <span class="preprocessor">      printf(&quot;\n&quot;); \</span>
<a name="l00083"></a>00083 <span class="preprocessor">      fflush(stdout); \</span>
<a name="l00084"></a>00084 <span class="preprocessor">   }</span>
<a name="l00085"></a>00085 <span class="preprocessor"></span>
<a name="l00086"></a><a class="code" href="ptx__parser_8cc.html#a4a3a4497001b24a0e79634acb1756f2c">00086</a> <span class="keyword">static</span> <span class="keywordtype">unsigned</span> <a class="code" href="ptx__parser_8cc.html#a4a3a4497001b24a0e79634acb1756f2c">g_entry_func_param_index</a>=0;
<a name="l00087"></a><a class="code" href="ptx__parser_8cc.html#a7ed8c2daf40af5353415b3b26c2f6688">00087</a> <span class="keyword">static</span> <a class="code" href="classfunction__info.html">function_info</a> *<a class="code" href="ptx__parser_8cc.html#a7ed8c2daf40af5353415b3b26c2f6688">g_func_info</a> = NULL;
<a name="l00088"></a><a class="code" href="ptx__parser_8cc.html#a70364826f1a143dbf47909b0909ba6a5">00088</a> <span class="keyword">static</span> std::map&lt;unsigned,std::string&gt; <a class="code" href="ptx__parser_8cc.html#a70364826f1a143dbf47909b0909ba6a5">g_ptx_token_decode</a>;
<a name="l00089"></a><a class="code" href="ptx__parser_8cc.html#ace984a773a99789e84f16e95bfc3b4f0">00089</a> <span class="keyword">static</span> <a class="code" href="classoperand__info.html">operand_info</a> <a class="code" href="ptx__parser_8cc.html#ace984a773a99789e84f16e95bfc3b4f0">g_return_var</a>;
<a name="l00090"></a>00090 
<a name="l00091"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#ac8e4595c56173a795cdec1826fb2aa3e">00091</a> <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="ptx__parser_8cc.html#ac8e4595c56173a795cdec1826fb2aa3e">decode_token</a>( <span class="keywordtype">int</span> type )
<a name="l00092"></a>00092 {
<a name="l00093"></a>00093    <span class="keywordflow">return</span> <a class="code" href="ptx__parser_8cc.html#a70364826f1a143dbf47909b0909ba6a5">g_ptx_token_decode</a>[type].c_str();
<a name="l00094"></a>00094 }
<a name="l00095"></a>00095 
<a name="l00096"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#af46141c2aab060a6a36ca8fdd485d396">00096</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#af46141c2aab060a6a36ca8fdd485d396">read_parser_environment_variables</a>() 
<a name="l00097"></a>00097 {
<a name="l00098"></a>00098    <a class="code" href="ptx__parser_8cc.html#a122c21cc0a19e563d5343d255dbcf36c">g_filename</a> = getenv(<span class="stringliteral">&quot;PTX_SIM_KERNELFILE&quot;</span>); 
<a name="l00099"></a>00099    <span class="keywordtype">char</span> *dbg_level = getenv(<span class="stringliteral">&quot;PTX_SIM_DEBUG&quot;</span>);
<a name="l00100"></a>00100    <span class="keywordflow">if</span> ( dbg_level &amp;&amp; strlen(dbg_level) ) {
<a name="l00101"></a>00101       <span class="keywordtype">int</span> debug_execution=0;
<a name="l00102"></a>00102       sscanf(dbg_level,<span class="stringliteral">&quot;%d&quot;</span>, &amp;debug_execution);
<a name="l00103"></a>00103       <span class="keywordflow">if</span> ( debug_execution &gt;= 30 ) 
<a name="l00104"></a>00104          <a class="code" href="ptx__parser_8cc.html#a9062d368e1a834b31ca99144a56b2928">g_debug_ir_generation</a>=<span class="keyword">true</span>;
<a name="l00105"></a>00105    }
<a name="l00106"></a>00106 }
<a name="l00107"></a>00107 
<a name="l00108"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#aacaf91664c61eb904be1ffc887d03481">00108</a> <a class="code" href="classsymbol__table.html">symbol_table</a> *<a class="code" href="ptx__parser_8cc.html#a0c21549d11538c9fb165a08f6b696743">init_parser</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *ptx_filename )
<a name="l00109"></a>00109 {
<a name="l00110"></a>00110    <a class="code" href="ptx__parser_8cc.html#a122c21cc0a19e563d5343d255dbcf36c">g_filename</a> = strdup(ptx_filename);
<a name="l00111"></a>00111    <span class="keywordflow">if</span>  (g_global_allfiles_symbol_table == NULL) {
<a name="l00112"></a>00112        g_global_allfiles_symbol_table = <span class="keyword">new</span> <a class="code" href="classsymbol__table.html">symbol_table</a>(<span class="stringliteral">&quot;global_allfiles&quot;</span>, 0, NULL);
<a name="l00113"></a>00113        g_global_symbol_table = g_current_symbol_table = g_global_allfiles_symbol_table;
<a name="l00114"></a>00114    }
<a name="l00115"></a>00115    <span class="keywordflow">else</span> {
<a name="l00116"></a>00116        g_global_symbol_table = g_current_symbol_table = <span class="keyword">new</span> <a class="code" href="classsymbol__table.html">symbol_table</a>(<span class="stringliteral">&quot;global&quot;</span>,0,g_global_allfiles_symbol_table);
<a name="l00117"></a>00117    }
<a name="l00118"></a>00118    ptx_lineno = 1;
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 <span class="preprocessor">#define DEF(X,Y) g_ptx_token_decode[X] = Y;</span>
<a name="l00121"></a>00121 <span class="preprocessor"></span><span class="preprocessor">#include &quot;ptx_parser_decode.def&quot;</span>
<a name="l00122"></a>00122 <span class="preprocessor">#undef DEF</span>
<a name="l00123"></a>00123 <span class="preprocessor"></span>
<a name="l00124"></a>00124    <span class="keywordflow">return</span> g_global_symbol_table;
<a name="l00125"></a>00125 }
<a name="l00126"></a>00126 
<a name="l00127"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a5a1269e252f2cb6a4d00d474882d898a">00127</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a5a1269e252f2cb6a4d00d474882d898a">init_directive_state</a>()
<a name="l00128"></a>00128 {
<a name="l00129"></a>00129    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;init_directive_state&quot;</span>);
<a name="l00130"></a>00130    g_space_spec=<a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca434a5fd1a70c9dcbe2de96e9c602d265">undefined_space</a>;
<a name="l00131"></a>00131    g_ptr_spec=<a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca434a5fd1a70c9dcbe2de96e9c602d265">undefined_space</a>;
<a name="l00132"></a>00132    g_scalar_type_spec=-1;
<a name="l00133"></a>00133    g_vector_spec=-1;
<a name="l00134"></a>00134    g_opcode=-1;
<a name="l00135"></a>00135    g_alignment_spec = -1;
<a name="l00136"></a>00136    g_extern_spec = 0;
<a name="l00137"></a>00137    <a class="code" href="ptx__parser_8cc.html#af4e9516fa78492b091b59dda0810d597">g_scalar_type</a>.clear();
<a name="l00138"></a>00138    <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.clear();
<a name="l00139"></a>00139    g_last_symbol = NULL;
<a name="l00140"></a>00140 }
<a name="l00141"></a>00141 
<a name="l00142"></a><a class="code" href="ptx__parser_8cc.html#afcb4eb7e33114ec58bdc8632824e27b9">00142</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#afcb4eb7e33114ec58bdc8632824e27b9">init_instruction_state</a>()
<a name="l00143"></a>00143 {
<a name="l00144"></a>00144    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;init_instruction_state&quot;</span>);
<a name="l00145"></a>00145    g_pred = NULL;
<a name="l00146"></a>00146    g_neg_pred = 0;
<a name="l00147"></a>00147    g_pred_mod = -1;
<a name="l00148"></a>00148    g_label = NULL;
<a name="l00149"></a>00149    g_opcode = -1;
<a name="l00150"></a>00150    <a class="code" href="ptx__parser_8cc.html#a8a0a82a1a278fd11d26c58674ddc099f">g_options</a>.clear();
<a name="l00151"></a>00151    g_return_var = <a class="code" href="classoperand__info.html">operand_info</a>();
<a name="l00152"></a>00152    <a class="code" href="ptx__parser_8cc.html#a5a1269e252f2cb6a4d00d474882d898a">init_directive_state</a>();
<a name="l00153"></a>00153 }
<a name="l00154"></a>00154 
<a name="l00155"></a><a class="code" href="ptx__parser_8cc.html#ab22030c767606f4bc9f30ad31de7daec">00155</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="ptx__parser_8cc.html#ab22030c767606f4bc9f30ad31de7daec">g_entry_point</a>;
<a name="l00156"></a>00156 
<a name="l00157"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#aafdfdae99dae5ffb0b523ab5491e244c">00157</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#aafdfdae99dae5ffb0b523ab5491e244c">start_function</a>( <span class="keywordtype">int</span> entry_point ) 
<a name="l00158"></a>00158 {
<a name="l00159"></a>00159    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;start_function&quot;</span>);
<a name="l00160"></a>00160    <a class="code" href="ptx__parser_8cc.html#a5a1269e252f2cb6a4d00d474882d898a">init_directive_state</a>();
<a name="l00161"></a>00161    <a class="code" href="ptx__parser_8cc.html#afcb4eb7e33114ec58bdc8632824e27b9">init_instruction_state</a>();
<a name="l00162"></a>00162    g_entry_point = entry_point;
<a name="l00163"></a>00163    g_func_info = NULL;
<a name="l00164"></a>00164    <a class="code" href="ptx__parser_8cc.html#a4a3a4497001b24a0e79634acb1756f2c">g_entry_func_param_index</a>=0;
<a name="l00165"></a>00165 }
<a name="l00166"></a>00166 
<a name="l00167"></a><a class="code" href="ptx__parser_8cc.html#acd60c0c71e3767baa88be803ccf7857f">00167</a> <span class="keywordtype">char</span> *<a class="code" href="ptx__parser_8cc.html#acd60c0c71e3767baa88be803ccf7857f">g_add_identifier_cached__identifier</a> = NULL;
<a name="l00168"></a><a class="code" href="ptx__parser_8cc.html#a608d6860565a012757152500c87ae6b5">00168</a> <span class="keywordtype">int</span> <a class="code" href="ptx__parser_8cc.html#a608d6860565a012757152500c87ae6b5">g_add_identifier_cached__array_dim</a>;
<a name="l00169"></a><a class="code" href="ptx__parser_8cc.html#a8d0e8ccd58c0b65fe20710e1e4beeb3a">00169</a> <span class="keywordtype">int</span> <a class="code" href="ptx__parser_8cc.html#a8d0e8ccd58c0b65fe20710e1e4beeb3a">g_add_identifier_cached__array_ident</a>;
<a name="l00170"></a>00170 
<a name="l00171"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a03a9cdbfe5f4d26c8804951b72db1480">00171</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a17aa29ece1522e5fd512c66787fea9fd">add_function_name</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *name ) 
<a name="l00172"></a>00172 {
<a name="l00173"></a>00173    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_function_name %s %s&quot;</span>, name,  ((g_entry_point==1)?<span class="stringliteral">&quot;(entrypoint)&quot;</span>:((g_entry_point==2)?<span class="stringliteral">&quot;(extern)&quot;</span>:<span class="stringliteral">&quot;&quot;</span>)));
<a name="l00174"></a>00174    <span class="keywordtype">bool</span> prior_decl = g_global_symbol_table-&gt;<a class="code" href="classsymbol__table.html#aaa4e43298e66b1c909b5a809fc8eea10">add_function_decl</a>( name, g_entry_point, &amp;g_func_info, &amp;g_current_symbol_table );
<a name="l00175"></a>00175    <span class="keywordflow">if</span>( <a class="code" href="ptx__parser_8cc.html#acd60c0c71e3767baa88be803ccf7857f">g_add_identifier_cached__identifier</a> ) {
<a name="l00176"></a>00176       <a class="code" href="ptx__parser_8cc.html#aa1f68f16c663498d80159e7b95112fff">add_identifier</a>( <a class="code" href="ptx__parser_8cc.html#acd60c0c71e3767baa88be803ccf7857f">g_add_identifier_cached__identifier</a>,
<a name="l00177"></a>00177                       g_add_identifier_cached__array_dim,
<a name="l00178"></a>00178                       g_add_identifier_cached__array_ident );
<a name="l00179"></a>00179       <a class="code" href="y_8tab_8c.html#af07d89f5ceaea0c7c8252cc41fd75f37">free</a>( <a class="code" href="ptx__parser_8cc.html#acd60c0c71e3767baa88be803ccf7857f">g_add_identifier_cached__identifier</a> );
<a name="l00180"></a>00180       <a class="code" href="ptx__parser_8cc.html#acd60c0c71e3767baa88be803ccf7857f">g_add_identifier_cached__identifier</a> = NULL;
<a name="l00181"></a>00181       g_func_info-&gt;<a class="code" href="classfunction__info.html#a9017fec5866b73cb156b02aeb8d86f36">add_return_var</a>( g_last_symbol );
<a name="l00182"></a>00182       <a class="code" href="ptx__parser_8cc.html#a5a1269e252f2cb6a4d00d474882d898a">init_directive_state</a>();
<a name="l00183"></a>00183    }
<a name="l00184"></a>00184    <span class="keywordflow">if</span>( prior_decl ) {
<a name="l00185"></a>00185       g_func_info-&gt;<a class="code" href="classfunction__info.html#afadc1b2c5f1d5823a5bb8ef67b6ebf95">remove_args</a>();
<a name="l00186"></a>00186    }
<a name="l00187"></a>00187    g_global_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a0d4edb5ced7c2d8c328757966cc2103e">add_function</a>( g_func_info, <a class="code" href="ptx__parser_8cc.html#a122c21cc0a19e563d5343d255dbcf36c">g_filename</a>, ptx_lineno );
<a name="l00188"></a>00188 }
<a name="l00189"></a>00189 
<a name="l00190"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#ac0d8e7a380a9956f38314ef162f671ab">00190</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#ac0d8e7a380a9956f38314ef162f671ab">add_directive</a>() 
<a name="l00191"></a>00191 {
<a name="l00192"></a>00192    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_directive&quot;</span>);
<a name="l00193"></a>00193    <a class="code" href="ptx__parser_8cc.html#a5a1269e252f2cb6a4d00d474882d898a">init_directive_state</a>();
<a name="l00194"></a>00194 }
<a name="l00195"></a>00195 
<a name="l00196"></a>00196 <span class="preprocessor">#define mymax(a,b) ((a)&gt;(b)?(a):(b))</span>
<a name="l00197"></a>00197 <span class="preprocessor"></span>
<a name="l00198"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#aa50d761b31e98badccbe5434c83698d0">00198</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#aa50d761b31e98badccbe5434c83698d0">end_function</a>() 
<a name="l00199"></a>00199 {
<a name="l00200"></a>00200    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;end_function&quot;</span>);
<a name="l00201"></a>00201 
<a name="l00202"></a>00202    <a class="code" href="ptx__parser_8cc.html#a5a1269e252f2cb6a4d00d474882d898a">init_directive_state</a>();
<a name="l00203"></a>00203    <a class="code" href="ptx__parser_8cc.html#afcb4eb7e33114ec58bdc8632824e27b9">init_instruction_state</a>();
<a name="l00204"></a>00204    <a class="code" href="ptx__parser_8cc.html#a6a0e147c805f5ae57e45d138a7b6ce45">g_max_regs_per_thread</a> = mymax( <a class="code" href="ptx__parser_8cc.html#a6a0e147c805f5ae57e45d138a7b6ce45">g_max_regs_per_thread</a>, (g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#ac4e78ff0c366443560fd2cacc1e9c9d1">next_reg_num</a>()-1)); 
<a name="l00205"></a>00205    g_func_info-&gt;<a class="code" href="classfunction__info.html#abf02b88f022636be8b8724d539024abf">add_inst</a>( <a class="code" href="ptx__parser_8cc.html#a2b3493af7af3b33be30f529ed90e8848">g_instructions</a> );
<a name="l00206"></a>00206    <a class="code" href="ptx__parser_8cc.html#a2b3493af7af3b33be30f529ed90e8848">g_instructions</a>.clear();
<a name="l00207"></a>00207    <a class="code" href="ptx__ir_8cc.html#af44e28caa344c77475c7ad836cb33e88">gpgpu_ptx_assemble</a>( g_func_info-&gt;<a class="code" href="classfunction__info.html#a1c8bf33afe5a0aef76b9109214c96699">get_name</a>(), g_func_info );
<a name="l00208"></a>00208    g_current_symbol_table = g_global_symbol_table;
<a name="l00209"></a>00209 
<a name="l00210"></a>00210    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;function %s, PC = %d\n&quot;</span>, g_func_info-&gt;<a class="code" href="classfunction__info.html#a1c8bf33afe5a0aef76b9109214c96699">get_name</a>().c_str(), g_func_info-&gt;<a class="code" href="classfunction__info.html#a81965a35d326261838bdabb29da6aa88">get_start_PC</a>());
<a name="l00211"></a>00211 }
<a name="l00212"></a>00212 
<a name="l00213"></a>00213 <span class="preprocessor">#define parse_error(msg, ...) parse_error_impl(__FILE__,__LINE__, msg, ##__VA_ARGS__)</span>
<a name="l00214"></a>00214 <span class="preprocessor"></span><span class="preprocessor">#define parse_assert(cond,msg, ...) parse_assert_impl((cond),__FILE__,__LINE__, msg, ##__VA_ARGS__)</span>
<a name="l00215"></a>00215 <span class="preprocessor"></span>
<a name="l00216"></a><a class="code" href="ptx__parser_8cc.html#aa841326707d96eb59f5bacff2027de4a">00216</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#aa841326707d96eb59f5bacff2027de4a">parse_error_impl</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *file, <span class="keywordtype">unsigned</span> line, <span class="keyword">const</span> <span class="keywordtype">char</span> *msg, ... )
<a name="l00217"></a>00217 {
<a name="l00218"></a>00218    va_list ap;
<a name="l00219"></a>00219    <span class="keywordtype">char</span> buf[1024];
<a name="l00220"></a>00220    va_start(ap,msg);
<a name="l00221"></a>00221    vsnprintf(buf,1024,msg,ap);
<a name="l00222"></a>00222    va_end(ap);
<a name="l00223"></a>00223 
<a name="l00224"></a>00224    g_error_detected = 1;
<a name="l00225"></a>00225    printf(<span class="stringliteral">&quot;%s:%u: Parse error: %s (%s:%u)\n\n&quot;</span>, <a class="code" href="ptx__parser_8cc.html#a122c21cc0a19e563d5343d255dbcf36c">g_filename</a>, ptx_lineno, buf, file, line);
<a name="l00226"></a>00226    <a class="code" href="ptx__parser_8cc.html#a7c983281e08399b9881676630e50651b">ptx_error</a>(NULL);
<a name="l00227"></a>00227    abort();
<a name="l00228"></a>00228    exit(1);
<a name="l00229"></a>00229 }
<a name="l00230"></a>00230 
<a name="l00231"></a><a class="code" href="ptx__parser_8cc.html#a0e20b27170421a83030e3bf1a1b00da2">00231</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a0e20b27170421a83030e3bf1a1b00da2">parse_assert_impl</a>( <span class="keywordtype">int</span> test_value, <span class="keyword">const</span> <span class="keywordtype">char</span> *file, <span class="keywordtype">unsigned</span> line, <span class="keyword">const</span> <span class="keywordtype">char</span> *msg, ... )
<a name="l00232"></a>00232 {
<a name="l00233"></a>00233    va_list ap;
<a name="l00234"></a>00234    <span class="keywordtype">char</span> buf[1024];
<a name="l00235"></a>00235    va_start(ap,msg);
<a name="l00236"></a>00236    vsnprintf(buf,1024,msg,ap);
<a name="l00237"></a>00237    va_end(ap);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239    <span class="keywordflow">if</span> ( test_value == 0 )
<a name="l00240"></a>00240       <a class="code" href="ptx__parser_8cc.html#aa841326707d96eb59f5bacff2027de4a">parse_error_impl</a>(file,line, msg);
<a name="l00241"></a>00241 }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 <span class="keyword">extern</span> <span class="keywordtype">char</span> <a class="code" href="ptx__parser_8cc.html#a93410023298f168609cc433f56a38d95">linebuf</a>[1024];
<a name="l00244"></a>00244 
<a name="l00245"></a>00245 
<a name="l00246"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a2f82c6aa3c73d1ffa4399f4c8dc7e87b">00246</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a2f82c6aa3c73d1ffa4399f4c8dc7e87b">set_return</a>()
<a name="l00247"></a>00247 {
<a name="l00248"></a>00248    parse_assert( (g_opcode == CALL_OP || g_opcode == CALLP_OP), <span class="stringliteral">&quot;only call can have return value&quot;</span>);
<a name="l00249"></a>00249    <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.front().set_return();
<a name="l00250"></a>00250    g_return_var = <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.front();
<a name="l00251"></a>00251 }
<a name="l00252"></a>00252 
<a name="l00253"></a><a class="code" href="ptx__parser_8cc.html#ad39d8407f5424d6b5551e4b9a530a0da">00253</a> std::map&lt;std::string,std::map&lt;unsigned,const ptx_instruction*&gt; &gt; <a class="code" href="ptx__parser_8cc.html#ad39d8407f5424d6b5551e4b9a530a0da">g_inst_lookup</a>;
<a name="l00254"></a>00254 
<a name="l00255"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#ad8df6d32ffe19d7188be6510851eb5f0">00255</a> <span class="keyword">const</span> <a class="code" href="classptx__instruction.html">ptx_instruction</a> *<a class="code" href="ptx__parser_8cc.html#a55ec35ef40654463883c3e3946681c06">ptx_instruction_lookup</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="cuobjdump__parser_8c.html#a5482b27881397d5b87f54feab7471580">filename</a>, <span class="keywordtype">unsigned</span> linenumber )
<a name="l00256"></a>00256 {
<a name="l00257"></a>00257    std::map&lt;std::string,std::map&lt;unsigned,const ptx_instruction*&gt; &gt;::iterator f=<a class="code" href="ptx__parser_8cc.html#ad39d8407f5424d6b5551e4b9a530a0da">g_inst_lookup</a>.find(filename);
<a name="l00258"></a>00258    <span class="keywordflow">if</span>( f == <a class="code" href="ptx__parser_8cc.html#ad39d8407f5424d6b5551e4b9a530a0da">g_inst_lookup</a>.end() ) 
<a name="l00259"></a>00259       <span class="keywordflow">return</span> NULL;
<a name="l00260"></a>00260    std::map&lt;unsigned,const ptx_instruction*&gt;::iterator l=f-&gt;second.find(linenumber);
<a name="l00261"></a>00261    <span class="keywordflow">if</span>( l == f-&gt;second.end() ) 
<a name="l00262"></a>00262       <span class="keywordflow">return</span> NULL;
<a name="l00263"></a>00263    <span class="keywordflow">return</span> l-&gt;second; 
<a name="l00264"></a>00264 }
<a name="l00265"></a>00265 
<a name="l00266"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a89a7852cc5d9d54c2eac7f3b46b4759f">00266</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a89a7852cc5d9d54c2eac7f3b46b4759f">add_instruction</a>() 
<a name="l00267"></a>00267 {
<a name="l00268"></a>00268    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_instruction: %s&quot;</span>, ((g_opcode&gt;0)?<a class="code" href="instructions_8cc.html#a1597e561995f7994d795e77bd7b68e3a">g_opcode_string</a>[g_opcode]:<span class="stringliteral">&quot;&lt;label&gt;&quot;</span>) );
<a name="l00269"></a>00269    assert( g_shader_core_config != 0 );
<a name="l00270"></a>00270    <a class="code" href="classptx__instruction.html">ptx_instruction</a> *i = <span class="keyword">new</span> <a class="code" href="classptx__instruction.html">ptx_instruction</a>( g_opcode, 
<a name="l00271"></a>00271                                              g_pred, 
<a name="l00272"></a>00272                                              g_neg_pred,
<a name="l00273"></a>00273                                              g_pred_mod, 
<a name="l00274"></a>00274                                              g_label, 
<a name="l00275"></a>00275                                              <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>,
<a name="l00276"></a>00276                                              g_return_var,
<a name="l00277"></a>00277                                              <a class="code" href="ptx__parser_8cc.html#a8a0a82a1a278fd11d26c58674ddc099f">g_options</a>, 
<a name="l00278"></a>00278                                              <a class="code" href="ptx__parser_8cc.html#af4e9516fa78492b091b59dda0810d597">g_scalar_type</a>,
<a name="l00279"></a>00279                                              g_space_spec,
<a name="l00280"></a>00280                                              <a class="code" href="ptx__parser_8cc.html#a122c21cc0a19e563d5343d255dbcf36c">g_filename</a>,
<a name="l00281"></a>00281                                              ptx_lineno,
<a name="l00282"></a>00282                                              <a class="code" href="ptx__parser_8cc.html#a93410023298f168609cc433f56a38d95">linebuf</a>,
<a name="l00283"></a>00283                                              g_shader_core_config );
<a name="l00284"></a>00284    <a class="code" href="ptx__parser_8cc.html#a2b3493af7af3b33be30f529ed90e8848">g_instructions</a>.push_back(i);
<a name="l00285"></a>00285    <a class="code" href="ptx__parser_8cc.html#ad39d8407f5424d6b5551e4b9a530a0da">g_inst_lookup</a>[<a class="code" href="ptx__parser_8cc.html#a122c21cc0a19e563d5343d255dbcf36c">g_filename</a>][ptx_lineno] = i;
<a name="l00286"></a>00286    <a class="code" href="ptx__parser_8cc.html#afcb4eb7e33114ec58bdc8632824e27b9">init_instruction_state</a>();
<a name="l00287"></a>00287 }
<a name="l00288"></a>00288 
<a name="l00289"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a4ba6eef037ab0c888779b85c47b7a4e0">00289</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a4ba6eef037ab0c888779b85c47b7a4e0">add_variables</a>() 
<a name="l00290"></a>00290 {
<a name="l00291"></a>00291    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_variables&quot;</span>);
<a name="l00292"></a>00292    <span class="keywordflow">if</span> ( !<a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.empty() ) {
<a name="l00293"></a>00293       assert( g_last_symbol != NULL ); 
<a name="l00294"></a>00294       g_last_symbol-&gt;<a class="code" href="classsymbol.html#aadce2f9eaac87e476fcd4961af534a1b">add_initializer</a>(<a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>);
<a name="l00295"></a>00295    }
<a name="l00296"></a>00296    <a class="code" href="ptx__parser_8cc.html#a5a1269e252f2cb6a4d00d474882d898a">init_directive_state</a>();
<a name="l00297"></a>00297 }
<a name="l00298"></a>00298 
<a name="l00299"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a666f3dfd61739d8108dedd2ccb9ebc9e">00299</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a666f3dfd61739d8108dedd2ccb9ebc9e">set_variable_type</a>()
<a name="l00300"></a>00300 {
<a name="l00301"></a>00301    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;set_variable_type space_spec=%s scalar_type_spec=%s&quot;</span>, 
<a name="l00302"></a>00302            <a class="code" href="ptx__parser_8cc.html#a70364826f1a143dbf47909b0909ba6a5">g_ptx_token_decode</a>[g_space_spec.<a class="code" href="classmemory__space__t.html#a9aa8b2fabc2c16d1bfda090f27ab479c">get_type</a>()].c_str(), 
<a name="l00303"></a>00303            <a class="code" href="ptx__parser_8cc.html#a70364826f1a143dbf47909b0909ba6a5">g_ptx_token_decode</a>[g_scalar_type_spec].c_str() );
<a name="l00304"></a>00304    parse_assert( g_space_spec != <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca434a5fd1a70c9dcbe2de96e9c602d265">undefined_space</a>, <span class="stringliteral">&quot;variable has no space specification&quot;</span> );
<a name="l00305"></a>00305    parse_assert( g_scalar_type_spec != -1, <span class="stringliteral">&quot;variable has no type information&quot;</span> ); <span class="comment">// need to extend for structs?</span>
<a name="l00306"></a>00306    g_var_type = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a29b42e00c4b41dfb2fc4115fd34c9280">add_type</a>( g_space_spec, 
<a name="l00307"></a>00307                                                   g_scalar_type_spec, 
<a name="l00308"></a>00308                                                   g_vector_spec, 
<a name="l00309"></a>00309                                                   g_alignment_spec, 
<a name="l00310"></a>00310                                                   g_extern_spec );
<a name="l00311"></a>00311 }
<a name="l00312"></a>00312 
<a name="l00313"></a><a class="code" href="ptx__parser_8cc.html#aeef7b35d33a42087434fa660ba4b732b">00313</a> <span class="keywordtype">bool</span> <a class="code" href="ptx__parser_8cc.html#aeef7b35d33a42087434fa660ba4b732b">check_for_duplicates</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *identifier )
<a name="l00314"></a>00314 {
<a name="l00315"></a>00315    <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *s = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(identifier);
<a name="l00316"></a>00316    <span class="keywordflow">return</span> ( s != NULL );
<a name="l00317"></a>00317 }
<a name="l00318"></a>00318 
<a name="l00319"></a>00319 <span class="keyword">extern</span> std::set&lt;std::string&gt;   <a class="code" href="cuda-sim_8cc.html#a9075f732b5ba9a8431ac045f50475744">g_globals</a>;
<a name="l00320"></a>00320 <span class="keyword">extern</span> std::set&lt;std::string&gt;   <a class="code" href="cuda-sim_8cc.html#a70c3e9c59adb42cccc47b1c8e05b25e8">g_constants</a>;
<a name="l00321"></a>00321 
<a name="l00322"></a><a class="code" href="ptx_8tab_8c.html#afddf79d33a33c765ff44a6b8412e1ed8">00322</a> <span class="keywordtype">int</span> <a class="code" href="ptx__parser_8cc.html#afddf79d33a33c765ff44a6b8412e1ed8">g_func_decl</a> = 0;
<a name="l00323"></a><a class="code" href="ptx__parser_8cc.html#ac755f92989b94c57564ca4b66b7ce26f">00323</a> <span class="keywordtype">int</span> <a class="code" href="ptx__parser_8cc.html#ac755f92989b94c57564ca4b66b7ce26f">g_ident_add_uid</a> = 0;
<a name="l00324"></a><a class="code" href="ptx__parser_8cc.html#aa34d7e744d93bd8071e92387804f94e6">00324</a> <span class="keywordtype">unsigned</span> <a class="code" href="ptx__parser_8cc.html#aa34d7e744d93bd8071e92387804f94e6">g_const_alloc</a> = 1;
<a name="l00325"></a>00325 
<a name="l00326"></a>00326 <span class="comment">// Returns padding that needs to be inserted ahead of address to make it aligned to min(size, maxalign)</span>
<a name="l00327"></a>00327 <span class="comment">/*</span>
<a name="l00328"></a>00328 <span class="comment"> * @param address the address in bytes</span>
<a name="l00329"></a>00329 <span class="comment"> * @param size the size of the memory to be allocated in bytes</span>
<a name="l00330"></a>00330 <span class="comment"> * @param maximum alignment in bytes. i.e. if size is too big then align to this instead</span>
<a name="l00331"></a>00331 <span class="comment"> */</span>
<a name="l00332"></a><a class="code" href="ptx__parser_8cc.html#ad2502a0837c400e30861afce51c6ef22">00332</a> <span class="keywordtype">int</span> <a class="code" href="ptx__parser_8cc.html#ad2502a0837c400e30861afce51c6ef22">pad_address</a> (<a class="code" href="abstract__hardware__model_8h.html#adcde2e548bc855c5cb446e23e38bd12d">new_addr_type</a> address, <span class="keywordtype">unsigned</span> size, <span class="keywordtype">unsigned</span> maxalign) {
<a name="l00333"></a>00333     assert(size &gt;= 0);
<a name="l00334"></a>00334     assert(maxalign &gt; 0);
<a name="l00335"></a>00335     <span class="keywordtype">int</span> alignto = maxalign;
<a name="l00336"></a>00336     <span class="keywordflow">if</span> (size &lt; maxalign &amp;&amp;
<a name="l00337"></a>00337             (size &amp; (size-1)) == 0) { <span class="comment">//size is a power of 2</span>
<a name="l00338"></a>00338         alignto = size;
<a name="l00339"></a>00339     }
<a name="l00340"></a>00340     <span class="keywordflow">return</span> alignto ? ((alignto - (address % alignto)) % alignto) : 0;
<a name="l00341"></a>00341 }
<a name="l00342"></a>00342 
<a name="l00343"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a49cfd30c942afa3ae8fec04860f6f2b5">00343</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#aa1f68f16c663498d80159e7b95112fff">add_identifier</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *identifier, <span class="keywordtype">int</span> array_dim, <span class="keywordtype">unsigned</span> array_ident ) 
<a name="l00344"></a>00344 {
<a name="l00345"></a>00345    <span class="keywordflow">if</span>( g_func_decl &amp;&amp; (g_func_info == NULL) ) {
<a name="l00346"></a>00346       <span class="comment">// return variable decl...</span>
<a name="l00347"></a>00347       assert( <a class="code" href="ptx__parser_8cc.html#acd60c0c71e3767baa88be803ccf7857f">g_add_identifier_cached__identifier</a> == NULL );
<a name="l00348"></a>00348       <a class="code" href="ptx__parser_8cc.html#acd60c0c71e3767baa88be803ccf7857f">g_add_identifier_cached__identifier</a> = strdup(identifier);
<a name="l00349"></a>00349       g_add_identifier_cached__array_dim = array_dim;
<a name="l00350"></a>00350       g_add_identifier_cached__array_ident = array_ident;
<a name="l00351"></a>00351       <span class="keywordflow">return</span>;
<a name="l00352"></a>00352    }
<a name="l00353"></a>00353    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_identifier \&quot;%s\&quot; (%u)&quot;</span>, identifier, g_ident_add_uid);
<a name="l00354"></a>00354    g_ident_add_uid++;
<a name="l00355"></a>00355    <a class="code" href="classtype__info.html">type_info</a> *type = g_var_type;
<a name="l00356"></a>00356    <a class="code" href="classtype__info__key.html">type_info_key</a> ti = type-&gt;<a class="code" href="classtype__info.html#acf7d3f7834206cc07553246538e409b9">get_key</a>();
<a name="l00357"></a>00357    <span class="keywordtype">int</span> basic_type;
<a name="l00358"></a>00358    <span class="keywordtype">int</span> regnum;
<a name="l00359"></a>00359    <span class="keywordtype">size_t</span> num_bits;
<a name="l00360"></a>00360    <span class="keywordtype">unsigned</span> addr_pad;
<a name="l00361"></a>00361    <a class="code" href="abstract__hardware__model_8h.html#adcde2e548bc855c5cb446e23e38bd12d">new_addr_type</a> addr;
<a name="l00362"></a>00362    ti.<a class="code" href="classtype__info__key.html#a92d2640bdd38c080581f06f8d723426d">type_decode</a>(num_bits,basic_type);
<a name="l00363"></a>00363 
<a name="l00364"></a>00364    <span class="keywordtype">bool</span> duplicates = <a class="code" href="ptx__parser_8cc.html#aeef7b35d33a42087434fa660ba4b732b">check_for_duplicates</a>( identifier );
<a name="l00365"></a>00365    <span class="keywordflow">if</span>( duplicates ) {
<a name="l00366"></a>00366       <a class="code" href="classsymbol.html">symbol</a> *s = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(identifier);
<a name="l00367"></a>00367       g_last_symbol = s;
<a name="l00368"></a>00368       <span class="keywordflow">if</span>( g_func_decl ) 
<a name="l00369"></a>00369          <span class="keywordflow">return</span>;
<a name="l00370"></a>00370       std::string msg = std::string(identifier) + <span class="stringliteral">&quot; was declared previous at &quot;</span> + s-&gt;<a class="code" href="classsymbol.html#a4e16a3b76e33ca50012cbcd44a90f68e">decl_location</a>() + <span class="stringliteral">&quot; skipping new declaration&quot;</span>; 
<a name="l00371"></a>00371       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: Warning %s\n&quot;</span>, msg.c_str());
<a name="l00372"></a>00372       <span class="keywordflow">return</span>;
<a name="l00373"></a>00373    }
<a name="l00374"></a>00374 
<a name="l00375"></a>00375    assert( g_var_type != NULL );
<a name="l00376"></a>00376    <span class="keywordflow">switch</span> ( array_ident ) {
<a name="l00377"></a>00377    <span class="keywordflow">case</span> ARRAY_IDENTIFIER:
<a name="l00378"></a>00378       type = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a76ad690bd468003f6b481f3934d214c0">get_array_type</a>(type,array_dim);
<a name="l00379"></a>00379       num_bits = array_dim * num_bits;
<a name="l00380"></a>00380       <span class="keywordflow">break</span>;
<a name="l00381"></a>00381    <span class="keywordflow">case</span> ARRAY_IDENTIFIER_NO_DIM:
<a name="l00382"></a>00382       type = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a76ad690bd468003f6b481f3934d214c0">get_array_type</a>(type,(<span class="keywordtype">unsigned</span>)-1);
<a name="l00383"></a>00383       num_bits = 0;
<a name="l00384"></a>00384       <span class="keywordflow">break</span>;
<a name="l00385"></a>00385    <span class="keywordflow">default</span>:
<a name="l00386"></a>00386       <span class="keywordflow">break</span>;
<a name="l00387"></a>00387    }
<a name="l00388"></a>00388    g_last_symbol = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a9f654872467a1fc6ecfed51379b2b800">add_variable</a>(identifier,type,num_bits/8,<a class="code" href="ptx__parser_8cc.html#a122c21cc0a19e563d5343d255dbcf36c">g_filename</a>,ptx_lineno);
<a name="l00389"></a>00389    <span class="keywordflow">switch</span> ( ti.<a class="code" href="classtype__info__key.html#a78acf00e411a9ea56fc882ab660c9ba9">get_memory_space</a>().<a class="code" href="classmemory__space__t.html#a9aa8b2fabc2c16d1bfda090f27ab479c">get_type</a>() ) {
<a name="l00390"></a>00390    <span class="keywordflow">case</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58cace58c5048875c8c8dd13a7621631b436">reg_space</a>: {
<a name="l00391"></a>00391       regnum = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#ac4e78ff0c366443560fd2cacc1e9c9d1">next_reg_num</a>();
<a name="l00392"></a>00392       <span class="keywordtype">int</span> arch_regnum = -1;
<a name="l00393"></a>00393       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> d = 0; d &lt; strlen(identifier); d++) {
<a name="l00394"></a>00394          <span class="keywordflow">if</span> (isdigit(identifier[d])) {
<a name="l00395"></a>00395             sscanf(identifier + d, <span class="stringliteral">&quot;%d&quot;</span>, &amp;arch_regnum);
<a name="l00396"></a>00396             <span class="keywordflow">break</span>;
<a name="l00397"></a>00397          }
<a name="l00398"></a>00398       }
<a name="l00399"></a>00399       <span class="keywordflow">if</span> (strcmp(identifier, <span class="stringliteral">&quot;%sp&quot;</span>) == 0) {
<a name="l00400"></a>00400          arch_regnum = 0;
<a name="l00401"></a>00401       }
<a name="l00402"></a>00402       g_last_symbol-&gt;<a class="code" href="classsymbol.html#a36f4885b5c5a93b32190103f835e9563">set_regno</a>(regnum, arch_regnum);
<a name="l00403"></a>00403       } <span class="keywordflow">break</span>;
<a name="l00404"></a>00404    <span class="keywordflow">case</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58cae27eca92c2d1dbb9adb9010e3fb7991c">shared_space</a>:
<a name="l00405"></a>00405       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: allocating shared region for \&quot;%s\&quot; &quot;</span>,
<a name="l00406"></a>00406              identifier);
<a name="l00407"></a>00407       fflush(stdout);
<a name="l00408"></a>00408       assert( (num_bits%8) == 0  );
<a name="l00409"></a>00409       addr = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a7acf41bea7d0a4570b30b46ffcf360b3">get_shared_next</a>();
<a name="l00410"></a>00410       addr_pad = <a class="code" href="ptx__parser_8cc.html#ad2502a0837c400e30861afce51c6ef22">pad_address</a>(addr, num_bits/8, 128);
<a name="l00411"></a>00411       printf(<span class="stringliteral">&quot;from 0x%x to 0x%lx (shared memory space)\n&quot;</span>,
<a name="l00412"></a>00412               addr+addr_pad,
<a name="l00413"></a>00413               addr+addr_pad + num_bits/8);
<a name="l00414"></a>00414          fflush(stdout);
<a name="l00415"></a>00415       g_last_symbol-&gt;<a class="code" href="classsymbol.html#acfdf21a91c3583da6aa1d52dad32ce5c">set_address</a>( addr+addr_pad );
<a name="l00416"></a>00416       g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a60563f0f4cbf511f4b83a04e7ae13ff4">alloc_shared</a>( num_bits/8 + addr_pad );
<a name="l00417"></a>00417       <span class="keywordflow">break</span>;
<a name="l00418"></a>00418    <span class="keywordflow">case</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca445236c52ac314c07392ad430f155071">const_space</a>:
<a name="l00419"></a>00419       <span class="keywordflow">if</span>( array_ident == ARRAY_IDENTIFIER_NO_DIM ) {
<a name="l00420"></a>00420          printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: deferring allocation of constant region for \&quot;%s\&quot; (need size information)\n&quot;</span>, identifier );
<a name="l00421"></a>00421       } <span class="keywordflow">else</span> {
<a name="l00422"></a>00422          printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: allocating constant region for \&quot;%s\&quot; &quot;</span>,
<a name="l00423"></a>00423                 identifier);
<a name="l00424"></a>00424          fflush(stdout);
<a name="l00425"></a>00425          assert( (num_bits%8) == 0  ); 
<a name="l00426"></a>00426          addr = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#ad2566ace167dff9e80fb3df0e39058ee">get_global_next</a>();
<a name="l00427"></a>00427          addr_pad = <a class="code" href="ptx__parser_8cc.html#ad2502a0837c400e30861afce51c6ef22">pad_address</a>(addr, num_bits/8, 128);
<a name="l00428"></a>00428          printf(<span class="stringliteral">&quot;from 0x%x to 0x%lx (global memory space) %u\n&quot;</span>,
<a name="l00429"></a>00429               addr+addr_pad,
<a name="l00430"></a>00430               addr+addr_pad + num_bits/8,
<a name="l00431"></a>00431               <a class="code" href="ptx__parser_8cc.html#aa34d7e744d93bd8071e92387804f94e6">g_const_alloc</a>++);
<a name="l00432"></a>00432          fflush(stdout);
<a name="l00433"></a>00433          g_last_symbol-&gt;<a class="code" href="classsymbol.html#acfdf21a91c3583da6aa1d52dad32ce5c">set_address</a>( addr + addr_pad );
<a name="l00434"></a>00434          g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a76db4058089303c87586b6fd4526d119">alloc_global</a>( num_bits/8 + addr_pad ); 
<a name="l00435"></a>00435       }
<a name="l00436"></a>00436       <span class="keywordflow">if</span>( g_current_symbol_table == g_global_symbol_table ) { 
<a name="l00437"></a>00437          <a class="code" href="cuda-sim_8cc.html#a70c3e9c59adb42cccc47b1c8e05b25e8">g_constants</a>.insert( identifier ); 
<a name="l00438"></a>00438       }
<a name="l00439"></a>00439       assert( g_current_symbol_table != NULL );
<a name="l00440"></a>00440       <a class="code" href="ptx__ir_8h.html#aeef56c6f09e0b8f05a6a6258ae7a24b4">g_sym_name_to_symbol_table</a>[ identifier ] = g_current_symbol_table;
<a name="l00441"></a>00441       <span class="keywordflow">break</span>;
<a name="l00442"></a>00442    <span class="keywordflow">case</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58cade54d01d283e68c3e9c5b8d75b85e49e">global_space</a>:
<a name="l00443"></a>00443       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: allocating global region for \&quot;%s\&quot; &quot;</span>,
<a name="l00444"></a>00444              identifier);
<a name="l00445"></a>00445       fflush(stdout);
<a name="l00446"></a>00446       assert( (num_bits%8) == 0  );
<a name="l00447"></a>00447       addr = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#ad2566ace167dff9e80fb3df0e39058ee">get_global_next</a>();
<a name="l00448"></a>00448       addr_pad = <a class="code" href="ptx__parser_8cc.html#ad2502a0837c400e30861afce51c6ef22">pad_address</a>(addr, num_bits/8, 128);
<a name="l00449"></a>00449       printf(<span class="stringliteral">&quot;from 0x%x to 0x%lx (global memory space)\n&quot;</span>,
<a name="l00450"></a>00450               addr+addr_pad,
<a name="l00451"></a>00451               addr+addr_pad + num_bits/8);
<a name="l00452"></a>00452       fflush(stdout);
<a name="l00453"></a>00453       g_last_symbol-&gt;<a class="code" href="classsymbol.html#acfdf21a91c3583da6aa1d52dad32ce5c">set_address</a>( addr+addr_pad );
<a name="l00454"></a>00454       g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a76db4058089303c87586b6fd4526d119">alloc_global</a>( num_bits/8 + addr_pad );
<a name="l00455"></a>00455       <a class="code" href="cuda-sim_8cc.html#a9075f732b5ba9a8431ac045f50475744">g_globals</a>.insert( identifier );
<a name="l00456"></a>00456       assert( g_current_symbol_table != NULL );
<a name="l00457"></a>00457       <a class="code" href="ptx__ir_8h.html#aeef56c6f09e0b8f05a6a6258ae7a24b4">g_sym_name_to_symbol_table</a>[ identifier ] = g_current_symbol_table;
<a name="l00458"></a>00458       <span class="keywordflow">break</span>;
<a name="l00459"></a>00459    <span class="keywordflow">case</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca133ba819812b7d97221aed15cb830967">local_space</a>:
<a name="l00460"></a>00460       <span class="keywordflow">if</span>( g_func_info == NULL ) {
<a name="l00461"></a>00461           printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: allocating local region for \&quot;%s\&quot; &quot;</span>, identifier);
<a name="l00462"></a>00462          fflush(stdout);
<a name="l00463"></a>00463          assert( (num_bits%8) == 0  );
<a name="l00464"></a>00464          addr = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#ab98b81e97a7297cb518f2a8a14b88d9f">get_local_next</a>();
<a name="l00465"></a>00465          addr_pad = <a class="code" href="ptx__parser_8cc.html#ad2502a0837c400e30861afce51c6ef22">pad_address</a>(addr, num_bits/8, 128);
<a name="l00466"></a>00466          printf(<span class="stringliteral">&quot;from 0x%x to 0x%lx (local memory space)\n&quot;</span>,
<a name="l00467"></a>00467                  addr+addr_pad,
<a name="l00468"></a>00468                  addr+addr_pad + num_bits/8);
<a name="l00469"></a>00469          fflush(stdout);
<a name="l00470"></a>00470          g_last_symbol-&gt;<a class="code" href="classsymbol.html#acfdf21a91c3583da6aa1d52dad32ce5c">set_address</a>( addr+addr_pad);
<a name="l00471"></a>00471          g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#abd346a53814df826df6b7838847c953b">alloc_local</a>( num_bits/8 + addr_pad);
<a name="l00472"></a>00472       } <span class="keywordflow">else</span> {
<a name="l00473"></a>00473         printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: allocating stack frame region for .local \&quot;%s\&quot; &quot;</span>,
<a name="l00474"></a>00474                identifier);
<a name="l00475"></a>00475         fflush(stdout);
<a name="l00476"></a>00476         assert( (num_bits%8) == 0 );
<a name="l00477"></a>00477         addr = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#ab98b81e97a7297cb518f2a8a14b88d9f">get_local_next</a>();
<a name="l00478"></a>00478         addr_pad = <a class="code" href="ptx__parser_8cc.html#ad2502a0837c400e30861afce51c6ef22">pad_address</a>(addr, num_bits/8, 128);
<a name="l00479"></a>00479         printf(<span class="stringliteral">&quot;from 0x%x to 0x%lx\n&quot;</span>,
<a name="l00480"></a>00480                 addr+addr_pad,
<a name="l00481"></a>00481                 addr+addr_pad + num_bits/8);
<a name="l00482"></a>00482         fflush(stdout);
<a name="l00483"></a>00483         g_last_symbol-&gt;<a class="code" href="classsymbol.html#acfdf21a91c3583da6aa1d52dad32ce5c">set_address</a>( addr+addr_pad );
<a name="l00484"></a>00484         g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#abd346a53814df826df6b7838847c953b">alloc_local</a>( num_bits/8 + addr_pad);
<a name="l00485"></a>00485         g_func_info-&gt;<a class="code" href="classfunction__info.html#af80d0feb58520dee4bb470127926ed87">set_framesize</a>( g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#ab98b81e97a7297cb518f2a8a14b88d9f">get_local_next</a>() );
<a name="l00486"></a>00486       }
<a name="l00487"></a>00487       <span class="keywordflow">break</span>;
<a name="l00488"></a>00488    <span class="keywordflow">case</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58cadc0c390c9425eb280596cbf66b5d4d4f">tex_space</a>:
<a name="l00489"></a>00489       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: encountered texture directive %s.\n&quot;</span>, identifier);
<a name="l00490"></a>00490       <span class="keywordflow">break</span>;
<a name="l00491"></a>00491    <span class="keywordflow">case</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca2f594286872ffab4d06ed69f65f111ac">param_space_local</a>:
<a name="l00492"></a>00492       printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: allocating stack frame region for .param \&quot;%s\&quot; from 0x%x to 0x%lx\n&quot;</span>,
<a name="l00493"></a>00493              identifier,
<a name="l00494"></a>00494              g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#ab98b81e97a7297cb518f2a8a14b88d9f">get_local_next</a>(),
<a name="l00495"></a>00495              g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#ab98b81e97a7297cb518f2a8a14b88d9f">get_local_next</a>() + num_bits/8 );
<a name="l00496"></a>00496       fflush(stdout);
<a name="l00497"></a>00497       assert( (num_bits%8) == 0  );
<a name="l00498"></a>00498       g_last_symbol-&gt;<a class="code" href="classsymbol.html#acfdf21a91c3583da6aa1d52dad32ce5c">set_address</a>( g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#ab98b81e97a7297cb518f2a8a14b88d9f">get_local_next</a>() );
<a name="l00499"></a>00499       g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#abd346a53814df826df6b7838847c953b">alloc_local</a>( num_bits/8 );
<a name="l00500"></a>00500       g_func_info-&gt;<a class="code" href="classfunction__info.html#af80d0feb58520dee4bb470127926ed87">set_framesize</a>( g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#ab98b81e97a7297cb518f2a8a14b88d9f">get_local_next</a>() );
<a name="l00501"></a>00501       <span class="keywordflow">break</span>;
<a name="l00502"></a>00502    <span class="keywordflow">case</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca5448bfae061180e01eb15ce5fec7bdcc">param_space_kernel</a>:
<a name="l00503"></a>00503       <span class="keywordflow">break</span>;
<a name="l00504"></a>00504    <span class="keywordflow">default</span>:
<a name="l00505"></a>00505       abort();
<a name="l00506"></a>00506       <span class="keywordflow">break</span>;
<a name="l00507"></a>00507    }
<a name="l00508"></a>00508 
<a name="l00509"></a>00509    assert( !ti.<a class="code" href="classtype__info__key.html#acb1539579a9b0ba864ba0799a6691d8b">is_param_unclassified</a>() );
<a name="l00510"></a>00510    <span class="keywordflow">if</span> ( ti.<a class="code" href="classtype__info__key.html#ae1879cfd96269bd1ca2a652c92a73225">is_param_kernel</a>() ) {
<a name="l00511"></a>00511       <span class="keywordtype">bool</span> is_ptr = (g_ptr_spec != <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca434a5fd1a70c9dcbe2de96e9c602d265">undefined_space</a>); 
<a name="l00512"></a>00512       g_func_info-&gt;<a class="code" href="classfunction__info.html#af9fafceddcceccb6d0eeef221e1b7081">add_param_name_type_size</a>(<a class="code" href="ptx__parser_8cc.html#a4a3a4497001b24a0e79634acb1756f2c">g_entry_func_param_index</a>,identifier, ti.<a class="code" href="classtype__info__key.html#a33c88d79d5b6bb80356603bb031f9ceb">scalar_type</a>(), num_bits, is_ptr, g_ptr_spec);
<a name="l00513"></a>00513       <a class="code" href="ptx__parser_8cc.html#a4a3a4497001b24a0e79634acb1756f2c">g_entry_func_param_index</a>++;
<a name="l00514"></a>00514    }
<a name="l00515"></a>00515 }
<a name="l00516"></a>00516 
<a name="l00517"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#aa6332856bb8d179cc69d7001b77c6710">00517</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#aa6332856bb8d179cc69d7001b77c6710">add_constptr</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* identifier1, <span class="keyword">const</span> <span class="keywordtype">char</span>* identifier2, <span class="keywordtype">int</span> offset)
<a name="l00518"></a>00518 {
<a name="l00519"></a>00519    <a class="code" href="classsymbol.html">symbol</a> *s1 = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(identifier1);
<a name="l00520"></a>00520    <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *s2 = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(identifier2);
<a name="l00521"></a>00521    parse_assert( s1 != NULL, <span class="stringliteral">&quot;&apos;from&apos; constant identifier does not exist.&quot;</span>);
<a name="l00522"></a>00522    parse_assert( s1 != NULL, <span class="stringliteral">&quot;&apos;to&apos; constant identifier does not exist.&quot;</span>);
<a name="l00523"></a>00523 
<a name="l00524"></a>00524    <span class="keywordtype">unsigned</span> addr = s2-&gt;<a class="code" href="classsymbol.html#a8fc9a6e49bb901608ff0dab49538db09">get_address</a>();
<a name="l00525"></a>00525 
<a name="l00526"></a>00526    printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: moving \&quot;%s\&quot; from 0x%x to 0x%x (%s+%x)\n&quot;</span>,
<a name="l00527"></a>00527       identifier1, s1-&gt;<a class="code" href="classsymbol.html#a8fc9a6e49bb901608ff0dab49538db09">get_address</a>(), addr+offset, identifier2, offset);
<a name="l00528"></a>00528 
<a name="l00529"></a>00529    s1-&gt;<a class="code" href="classsymbol.html#acfdf21a91c3583da6aa1d52dad32ce5c">set_address</a>( addr + offset );
<a name="l00530"></a>00530 }
<a name="l00531"></a>00531 
<a name="l00532"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a16f867fda1dadc63d34a95112b178c9b">00532</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a16f867fda1dadc63d34a95112b178c9b">add_function_arg</a>()
<a name="l00533"></a>00533 {
<a name="l00534"></a>00534    <span class="keywordflow">if</span>( g_func_info ) {
<a name="l00535"></a>00535       PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_function_arg \&quot;%s\&quot;&quot;</span>, g_last_symbol-&gt;<a class="code" href="classsymbol.html#a280a3f1e3caffd94b10590dbb4259033">name</a>().c_str() );
<a name="l00536"></a>00536       g_func_info-&gt;<a class="code" href="classfunction__info.html#ab00201815f97c83ea15a889e54f03173">add_arg</a>(g_last_symbol);
<a name="l00537"></a>00537    }
<a name="l00538"></a>00538 }
<a name="l00539"></a>00539 
<a name="l00540"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#aaa2957faf03af61703473f699a3588bd">00540</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#aaa2957faf03af61703473f699a3588bd">add_extern_spec</a>() 
<a name="l00541"></a>00541 {
<a name="l00542"></a>00542    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_extern_spec&quot;</span>);
<a name="l00543"></a>00543    g_extern_spec = 1;
<a name="l00544"></a>00544 }
<a name="l00545"></a>00545 
<a name="l00546"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a529c9fe3032a791b264b385210f517b1">00546</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a529c9fe3032a791b264b385210f517b1">add_alignment_spec</a>( <span class="keywordtype">int</span> spec )
<a name="l00547"></a>00547 {
<a name="l00548"></a>00548    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_alignment_spec&quot;</span>);
<a name="l00549"></a>00549    parse_assert( g_alignment_spec == -1, <span class="stringliteral">&quot;multiple .align specifiers per variable declaration not allowed.&quot;</span> );
<a name="l00550"></a>00550    g_alignment_spec = spec;
<a name="l00551"></a>00551 }
<a name="l00552"></a>00552 
<a name="l00553"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a7300d04b7b4a86b85552f967b3025a09">00553</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a7300d04b7b4a86b85552f967b3025a09">add_ptr_spec</a>( <span class="keyword">enum</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58c">_memory_space_t</a> spec ) 
<a name="l00554"></a>00554 {
<a name="l00555"></a>00555    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_ptr_spec \&quot;%s\&quot;&quot;</span>, <a class="code" href="ptx__parser_8cc.html#a70364826f1a143dbf47909b0909ba6a5">g_ptx_token_decode</a>[spec].c_str() );
<a name="l00556"></a>00556    parse_assert( g_ptr_spec == <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca434a5fd1a70c9dcbe2de96e9c602d265">undefined_space</a>, <span class="stringliteral">&quot;multiple ptr space specifiers not allowed.&quot;</span> );
<a name="l00557"></a>00557    parse_assert( spec == <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58cade54d01d283e68c3e9c5b8d75b85e49e">global_space</a> or spec == <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca133ba819812b7d97221aed15cb830967">local_space</a> or spec == <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58cae27eca92c2d1dbb9adb9010e3fb7991c">shared_space</a>, <span class="stringliteral">&quot;invalid space for ptr directive.&quot;</span> );
<a name="l00558"></a>00558    g_ptr_spec = spec; 
<a name="l00559"></a>00559 }
<a name="l00560"></a>00560 
<a name="l00561"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a0cf2a36f3cc5cda3a22b9de151b256e7">00561</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a0cf2a36f3cc5cda3a22b9de151b256e7">add_space_spec</a>( <span class="keyword">enum</span> <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58c">_memory_space_t</a> spec, <span class="keywordtype">int</span> value ) 
<a name="l00562"></a>00562 {
<a name="l00563"></a>00563    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_space_spec \&quot;%s\&quot;&quot;</span>, <a class="code" href="ptx__parser_8cc.html#a70364826f1a143dbf47909b0909ba6a5">g_ptx_token_decode</a>[spec].c_str() );
<a name="l00564"></a>00564    parse_assert( g_space_spec == <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca434a5fd1a70c9dcbe2de96e9c602d265">undefined_space</a>, <span class="stringliteral">&quot;multiple space specifiers not allowed.&quot;</span> );
<a name="l00565"></a>00565    <span class="keywordflow">if</span>( spec == <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca397b6ec5c92b5f013d27f984ce50abea">param_space_unclassified</a> ) {
<a name="l00566"></a>00566       <span class="keywordflow">if</span>( g_func_decl ) {
<a name="l00567"></a>00567          <span class="keywordflow">if</span>( g_entry_point == 1) 
<a name="l00568"></a>00568             g_space_spec = <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca5448bfae061180e01eb15ce5fec7bdcc">param_space_kernel</a>;
<a name="l00569"></a>00569          <span class="keywordflow">else</span> 
<a name="l00570"></a>00570             g_space_spec = <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca2f594286872ffab4d06ed69f65f111ac">param_space_local</a>;
<a name="l00571"></a>00571       } <span class="keywordflow">else</span>
<a name="l00572"></a>00572          g_space_spec = <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca397b6ec5c92b5f013d27f984ce50abea">param_space_unclassified</a>;
<a name="l00573"></a>00573    } <span class="keywordflow">else</span> {
<a name="l00574"></a>00574       g_space_spec = spec;
<a name="l00575"></a>00575       <span class="keywordflow">if</span>( g_space_spec == <a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca445236c52ac314c07392ad430f155071">const_space</a> )
<a name="l00576"></a>00576          g_space_spec.<a class="code" href="classmemory__space__t.html#a9a4893deaa630a34a737a774fe3c737f">set_bank</a>((<span class="keywordtype">unsigned</span>)value);
<a name="l00577"></a>00577    }
<a name="l00578"></a>00578 }
<a name="l00579"></a>00579 
<a name="l00580"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a9af19e248f322211f351afca115cdd04">00580</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a9af19e248f322211f351afca115cdd04">add_vector_spec</a>(<span class="keywordtype">int</span> spec ) 
<a name="l00581"></a>00581 {
<a name="l00582"></a>00582    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_vector_spec&quot;</span>);
<a name="l00583"></a>00583    parse_assert( g_vector_spec == -1, <span class="stringliteral">&quot;multiple vector specifiers not allowed.&quot;</span> );
<a name="l00584"></a>00584    g_vector_spec = spec;
<a name="l00585"></a>00585 }
<a name="l00586"></a>00586 
<a name="l00587"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a70f56e282485d889492914aaa32641fe">00587</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a70f56e282485d889492914aaa32641fe">add_scalar_type_spec</a>( <span class="keywordtype">int</span> type_spec ) 
<a name="l00588"></a>00588 {
<a name="l00589"></a>00589    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_scalar_type_spec \&quot;%s\&quot;&quot;</span>, <a class="code" href="ptx__parser_8cc.html#a70364826f1a143dbf47909b0909ba6a5">g_ptx_token_decode</a>[type_spec].c_str());
<a name="l00590"></a>00590    <a class="code" href="ptx__parser_8cc.html#af4e9516fa78492b091b59dda0810d597">g_scalar_type</a>.push_back( type_spec );
<a name="l00591"></a>00591    <span class="keywordflow">if</span> ( <a class="code" href="ptx__parser_8cc.html#af4e9516fa78492b091b59dda0810d597">g_scalar_type</a>.size() &gt; 1 ) {
<a name="l00592"></a>00592       parse_assert( (g_opcode == -1) || (g_opcode == CVT_OP) || (g_opcode == SET_OP) || (g_opcode == SLCT_OP)
<a name="l00593"></a>00593                     || (g_opcode == TEX_OP), 
<a name="l00594"></a>00594                     <span class="stringliteral">&quot;only cvt, set, slct, and tex can have more than one type specifier.&quot;</span>);
<a name="l00595"></a>00595    }
<a name="l00596"></a>00596    g_scalar_type_spec = type_spec;
<a name="l00597"></a>00597 }
<a name="l00598"></a>00598 
<a name="l00599"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a881e0a89f63c011051c9f798041bf2df">00599</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a683533bbb223654fcdae7c4406f11470">add_label</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *identifier ) 
<a name="l00600"></a>00600 {
<a name="l00601"></a>00601    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_label&quot;</span>);
<a name="l00602"></a>00602    <a class="code" href="classsymbol.html">symbol</a> *s = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(identifier);
<a name="l00603"></a>00603    <span class="keywordflow">if</span> ( s != NULL ) {
<a name="l00604"></a>00604       g_label = s;
<a name="l00605"></a>00605    } <span class="keywordflow">else</span> {
<a name="l00606"></a>00606       g_label = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a9f654872467a1fc6ecfed51379b2b800">add_variable</a>(identifier,NULL,0,<a class="code" href="ptx__parser_8cc.html#a122c21cc0a19e563d5343d255dbcf36c">g_filename</a>,ptx_lineno);
<a name="l00607"></a>00607    }
<a name="l00608"></a>00608 }
<a name="l00609"></a>00609 
<a name="l00610"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#ae7e7681031ba3b13e3f4814fe1eade60">00610</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#ae7e7681031ba3b13e3f4814fe1eade60">add_opcode</a>( <span class="keywordtype">int</span> opcode ) 
<a name="l00611"></a>00611 {
<a name="l00612"></a>00612    g_opcode = opcode;
<a name="l00613"></a>00613 }
<a name="l00614"></a>00614 
<a name="l00615"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a945a6733a9a75d5d20f3bca14c064905">00615</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a3195fa264d5dd72a93790fa762cfb336">add_pred</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *identifier, <span class="keywordtype">int</span> neg, <span class="keywordtype">int</span> predModifier ) 
<a name="l00616"></a>00616 {
<a name="l00617"></a>00617    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_pred&quot;</span>);
<a name="l00618"></a>00618    <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *s = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(identifier);
<a name="l00619"></a>00619    <span class="keywordflow">if</span> ( s == NULL ) {
<a name="l00620"></a>00620       std::string msg = std::string(<span class="stringliteral">&quot;predicate \&quot;&quot;</span>) + identifier + <span class="stringliteral">&quot;\&quot; has no declaration.&quot;</span>;
<a name="l00621"></a>00621       parse_error( msg.c_str() );
<a name="l00622"></a>00622    }
<a name="l00623"></a>00623    g_pred = s;
<a name="l00624"></a>00624    g_neg_pred = neg;
<a name="l00625"></a>00625    g_pred_mod = predModifier;
<a name="l00626"></a>00626 }
<a name="l00627"></a>00627 
<a name="l00628"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a41400ca5c0733858cf27c8a45657114f">00628</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a41400ca5c0733858cf27c8a45657114f">add_option</a>( <span class="keywordtype">int</span> option ) 
<a name="l00629"></a>00629 {
<a name="l00630"></a>00630    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_option&quot;</span>);
<a name="l00631"></a>00631    <a class="code" href="ptx__parser_8cc.html#a8a0a82a1a278fd11d26c58674ddc099f">g_options</a>.push_back( option );
<a name="l00632"></a>00632 }
<a name="l00633"></a>00633 
<a name="l00634"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a2f2a776de5979eb02baffdcf478b70fc">00634</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a2f2a776de5979eb02baffdcf478b70fc">add_double_operand</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *d1, <span class="keyword">const</span> <span class="keywordtype">char</span> *d2 )
<a name="l00635"></a>00635 {
<a name="l00636"></a>00636    <span class="comment">//operands that access two variables.</span>
<a name="l00637"></a>00637    <span class="comment">//eg. s[$ofs1+$r0], g[$ofs1+=$r0]</span>
<a name="l00638"></a>00638    <span class="comment">//TODO: Not sure if I&apos;m going to use this for storing to two destinations or not.</span>
<a name="l00639"></a>00639 
<a name="l00640"></a>00640    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_double_operand&quot;</span>);
<a name="l00641"></a>00641    <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *s1 = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(d1);
<a name="l00642"></a>00642    <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *s2 = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(d2);
<a name="l00643"></a>00643    parse_assert( s1 != NULL &amp;&amp; s2 != NULL, <span class="stringliteral">&quot;component(s) missing declarations.&quot;</span>);
<a name="l00644"></a>00644    <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.push_back( <a class="code" href="classoperand__info.html">operand_info</a>(s1,s2) );
<a name="l00645"></a>00645 }
<a name="l00646"></a>00646 
<a name="l00647"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a11df772075024e33097dc7cde65017d9">00647</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a11df772075024e33097dc7cde65017d9">add_1vector_operand</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *d1 ) 
<a name="l00648"></a>00648 {
<a name="l00649"></a>00649    <span class="comment">// handles the single element vector operand ({%v1}) found in tex.1d instructions</span>
<a name="l00650"></a>00650    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_1vector_operand&quot;</span>);
<a name="l00651"></a>00651    <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *s1 = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(d1);
<a name="l00652"></a>00652    parse_assert( s1 != NULL, <span class="stringliteral">&quot;component(s) missing declarations.&quot;</span>);
<a name="l00653"></a>00653    <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.push_back( <a class="code" href="classoperand__info.html">operand_info</a>(s1,NULL,NULL,NULL) );
<a name="l00654"></a>00654 }
<a name="l00655"></a>00655 
<a name="l00656"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#aefae43d14c5f76b8f56090e24df1a178">00656</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#aefae43d14c5f76b8f56090e24df1a178">add_2vector_operand</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *d1, <span class="keyword">const</span> <span class="keywordtype">char</span> *d2 ) 
<a name="l00657"></a>00657 {
<a name="l00658"></a>00658    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_2vector_operand&quot;</span>);
<a name="l00659"></a>00659    <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *s1 = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(d1);
<a name="l00660"></a>00660    <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *s2 = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(d2);
<a name="l00661"></a>00661    parse_assert( s1 != NULL &amp;&amp; s2 != NULL, <span class="stringliteral">&quot;v2 component(s) missing declarations.&quot;</span>);
<a name="l00662"></a>00662    <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.push_back( <a class="code" href="classoperand__info.html">operand_info</a>(s1,s2,NULL,NULL) );
<a name="l00663"></a>00663 }
<a name="l00664"></a>00664 
<a name="l00665"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#ae3bbc99dd7fe3485ed1e86fed2cca8d8">00665</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#ae3bbc99dd7fe3485ed1e86fed2cca8d8">add_3vector_operand</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *d1, <span class="keyword">const</span> <span class="keywordtype">char</span> *d2, <span class="keyword">const</span> <span class="keywordtype">char</span> *d3 ) 
<a name="l00666"></a>00666 {
<a name="l00667"></a>00667    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_3vector_operand&quot;</span>);
<a name="l00668"></a>00668    <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *s1 = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(d1);
<a name="l00669"></a>00669    <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *s2 = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(d2);
<a name="l00670"></a>00670    <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *s3 = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(d3);
<a name="l00671"></a>00671    parse_assert( s1 != NULL &amp;&amp; s2 != NULL &amp;&amp; s3 != NULL, <span class="stringliteral">&quot;v3 component(s) missing declarations.&quot;</span>);
<a name="l00672"></a>00672    <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.push_back( <a class="code" href="classoperand__info.html">operand_info</a>(s1,s2,s3,NULL) );
<a name="l00673"></a>00673 }
<a name="l00674"></a>00674 
<a name="l00675"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#af793c6ad7015c8bdafabac3fd50ff080">00675</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#af793c6ad7015c8bdafabac3fd50ff080">add_4vector_operand</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *d1, <span class="keyword">const</span> <span class="keywordtype">char</span> *d2, <span class="keyword">const</span> <span class="keywordtype">char</span> *d3, <span class="keyword">const</span> <span class="keywordtype">char</span> *d4 ) 
<a name="l00676"></a>00676 {
<a name="l00677"></a>00677    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_4vector_operand&quot;</span>);
<a name="l00678"></a>00678    <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *s1 = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(d1);
<a name="l00679"></a>00679    <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *s2 = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(d2);
<a name="l00680"></a>00680    <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *s3 = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(d3);
<a name="l00681"></a>00681    <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *s4 = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(d4);
<a name="l00682"></a>00682    parse_assert( s1 != NULL &amp;&amp; s2 != NULL &amp;&amp; s3 != NULL &amp;&amp; s4 != NULL, <span class="stringliteral">&quot;v4 component(s) missing declarations.&quot;</span>);
<a name="l00683"></a>00683    <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *null_op = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(<span class="stringliteral">&quot;_&quot;</span>);
<a name="l00684"></a>00684    <span class="keywordflow">if</span> ( s2 == null_op ) s2 = NULL;
<a name="l00685"></a>00685    <span class="keywordflow">if</span> ( s3 == null_op ) s3 = NULL;
<a name="l00686"></a>00686    <span class="keywordflow">if</span> ( s4 == null_op ) s4 = NULL;
<a name="l00687"></a>00687    <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.push_back( <a class="code" href="classoperand__info.html">operand_info</a>(s1,s2,s3,s4) );
<a name="l00688"></a>00688 }
<a name="l00689"></a>00689 
<a name="l00690"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a11ccccefb0c2210e1dcc37c21be16933">00690</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a11ccccefb0c2210e1dcc37c21be16933">add_builtin_operand</a>( <span class="keywordtype">int</span> builtin, <span class="keywordtype">int</span> dim_modifier ) 
<a name="l00691"></a>00691 {
<a name="l00692"></a>00692    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_builtin_operand&quot;</span>);
<a name="l00693"></a>00693    <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.push_back( <a class="code" href="classoperand__info.html">operand_info</a>(builtin,dim_modifier) );
<a name="l00694"></a>00694 }
<a name="l00695"></a>00695 
<a name="l00696"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a129e7b8cc9174ca45816db4887651420">00696</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a129e7b8cc9174ca45816db4887651420">add_memory_operand</a>() 
<a name="l00697"></a>00697 {
<a name="l00698"></a>00698    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_memory_operand&quot;</span>);
<a name="l00699"></a>00699    assert( !<a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.empty() );
<a name="l00700"></a>00700    <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.back().make_memory_operand();
<a name="l00701"></a>00701 }
<a name="l00702"></a>00702 
<a name="l00703"></a>00703 <span class="comment">/*TODO: add other memory locations*/</span>
<a name="l00704"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a940792d305467a483c76b54b9e3cb9bc">00704</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a940792d305467a483c76b54b9e3cb9bc">change_memory_addr_space</a>(<span class="keyword">const</span> <span class="keywordtype">char</span> *identifier) 
<a name="l00705"></a>00705 {
<a name="l00706"></a>00706    <span class="comment">/*0 = N/A, not reading from memory</span>
<a name="l00707"></a>00707 <span class="comment">    *1 = global memory</span>
<a name="l00708"></a>00708 <span class="comment">    *2 = shared memory</span>
<a name="l00709"></a>00709 <span class="comment">    *3 = const memory segment</span>
<a name="l00710"></a>00710 <span class="comment">    *4 = local memory segment</span>
<a name="l00711"></a>00711 <span class="comment">    */</span>
<a name="l00712"></a>00712 
<a name="l00713"></a>00713    <span class="keywordtype">bool</span> recognizedType = <span class="keyword">false</span>;
<a name="l00714"></a>00714 
<a name="l00715"></a>00715    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;change_memory_addr_space&quot;</span>);
<a name="l00716"></a>00716    assert( !<a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.empty() );
<a name="l00717"></a>00717    <span class="keywordflow">if</span>(!strcmp(identifier, <span class="stringliteral">&quot;g&quot;</span>))
<a name="l00718"></a>00718    {
<a name="l00719"></a>00719        <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.back().set_addr_space(<a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58cade54d01d283e68c3e9c5b8d75b85e49e">global_space</a>);
<a name="l00720"></a>00720        recognizedType = <span class="keyword">true</span>;
<a name="l00721"></a>00721    }
<a name="l00722"></a>00722    <span class="keywordflow">if</span>(!strcmp(identifier, <span class="stringliteral">&quot;s&quot;</span>))
<a name="l00723"></a>00723    {
<a name="l00724"></a>00724        <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.back().set_addr_space(<a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58cae27eca92c2d1dbb9adb9010e3fb7991c">shared_space</a>);
<a name="l00725"></a>00725        recognizedType = <span class="keyword">true</span>;
<a name="l00726"></a>00726    }
<a name="l00727"></a>00727    <span class="comment">// For constants, check if the first character is &apos;c&apos;</span>
<a name="l00728"></a>00728    <span class="keywordtype">char</span> c[2];
<a name="l00729"></a>00729    strncpy(c, identifier, 1); c[1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00730"></a>00730    <span class="keywordflow">if</span>(!strcmp(c, <span class="stringliteral">&quot;c&quot;</span>))
<a name="l00731"></a>00731    {
<a name="l00732"></a>00732        <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.back().set_addr_space(<a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca445236c52ac314c07392ad430f155071">const_space</a>);
<a name="l00733"></a>00733        parse_assert(g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(identifier) != NULL, <span class="stringliteral">&quot;Constant was not defined.&quot;</span>);
<a name="l00734"></a>00734        <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.back().set_const_mem_offset(g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(identifier)-&gt;<a class="code" href="classsymbol.html#a8fc9a6e49bb901608ff0dab49538db09">get_address</a>());
<a name="l00735"></a>00735        recognizedType = <span class="keyword">true</span>;
<a name="l00736"></a>00736    }
<a name="l00737"></a>00737    <span class="comment">// For local memory, check if the first character is &apos;l&apos;</span>
<a name="l00738"></a>00738    <span class="keywordtype">char</span> l[2];
<a name="l00739"></a>00739    strncpy(l, identifier, 1); l[1] = <span class="charliteral">&apos;\0&apos;</span>;
<a name="l00740"></a>00740    <span class="keywordflow">if</span>(!strcmp(l, <span class="stringliteral">&quot;l&quot;</span>))
<a name="l00741"></a>00741    {
<a name="l00742"></a>00742        <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.back().set_addr_space(<a class="code" href="abstract__hardware__model_8h.html#a1ad2169aaa8924fcc552447f38a5b58ca133ba819812b7d97221aed15cb830967">local_space</a>);
<a name="l00743"></a>00743        <span class="comment">//parse_assert(g_current_symbol_table-&gt;lookup(identifier) != NULL, &quot;Local memory segment was not defined.&quot;);</span>
<a name="l00744"></a>00744        <span class="comment">//g_operands.back().set_const_mem_offset(g_current_symbol_table-&gt;lookup(identifier)-&gt;get_address());</span>
<a name="l00745"></a>00745        recognizedType = <span class="keyword">true</span>;
<a name="l00746"></a>00746    }
<a name="l00747"></a>00747 
<a name="l00748"></a>00748    parse_assert(recognizedType, <span class="stringliteral">&quot;Error: unrecognized memory type.&quot;</span>);
<a name="l00749"></a>00749 }
<a name="l00750"></a>00750 
<a name="l00751"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#af6d834041c71a764e1fba5c06875959a">00751</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#af6d834041c71a764e1fba5c06875959a">change_operand_lohi</a>( <span class="keywordtype">int</span> lohi )
<a name="l00752"></a>00752 {
<a name="l00753"></a>00753    <span class="comment">/*0 = N/A, read entire operand</span>
<a name="l00754"></a>00754 <span class="comment">    *1 = lo, reading from lowest bits</span>
<a name="l00755"></a>00755 <span class="comment">    *2 = hi, reading from highest bits</span>
<a name="l00756"></a>00756 <span class="comment">    */</span>
<a name="l00757"></a>00757 
<a name="l00758"></a>00758    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;change_operand_lohi&quot;</span>);
<a name="l00759"></a>00759    assert( !<a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.empty() );
<a name="l00760"></a>00760 
<a name="l00761"></a>00761    <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.back().set_operand_lohi(lohi);
<a name="l00762"></a>00762 
<a name="l00763"></a>00763 }
<a name="l00764"></a>00764 
<a name="l00765"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a5d2b5f6b4feda385389b877b5ca4e01a">00765</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a5d2b5f6b4feda385389b877b5ca4e01a">set_immediate_operand_type</a> ()
<a name="l00766"></a>00766 {
<a name="l00767"></a>00767      PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;set_immediate_operand_type&quot;</span>);
<a name="l00768"></a>00768      assert( !<a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.empty() );
<a name="l00769"></a>00769      <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.back().set_immediate_addr();
<a name="l00770"></a>00770 }
<a name="l00771"></a>00771 
<a name="l00772"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a7f1c8cdf13156b478f1b4972837883a3">00772</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a66a4bb50542ab8de316db28add0b6e56">change_double_operand_type</a>( <span class="keywordtype">int</span> <a class="code" href="ptx__ir_8h.html#a90e83ae77725d7ff8733276d9a1d19e4">operand_type</a> )
<a name="l00773"></a>00773 {
<a name="l00774"></a>00774    <span class="comment">/*</span>
<a name="l00775"></a>00775 <span class="comment">    *-3 = reg / reg (set instruction, but both get same value)</span>
<a name="l00776"></a>00776 <span class="comment">    *-2 = reg | reg (cvt instruction)</span>
<a name="l00777"></a>00777 <span class="comment">    *-1 = reg | reg (set instruction)</span>
<a name="l00778"></a>00778 <span class="comment">    *0 = N/A, default</span>
<a name="l00779"></a>00779 <span class="comment">    *1 = reg + reg</span>
<a name="l00780"></a>00780 <span class="comment">    *2 = reg += reg</span>
<a name="l00781"></a>00781 <span class="comment">    *3 = reg += immediate</span>
<a name="l00782"></a>00782 <span class="comment">    */</span>
<a name="l00783"></a>00783 
<a name="l00784"></a>00784    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;change_double_operand_type&quot;</span>);
<a name="l00785"></a>00785    assert( !<a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.empty() );
<a name="l00786"></a>00786 
<a name="l00787"></a>00787    <span class="comment">// For double destination operands, ensure valid instruction</span>
<a name="l00788"></a>00788    <span class="keywordflow">if</span>( operand_type == -1 || operand_type == -2 ) {
<a name="l00789"></a>00789       <span class="keywordflow">if</span>((g_opcode == SET_OP)||(g_opcode == SETP_OP))
<a name="l00790"></a>00790          <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.back().set_double_operand_type(-1);
<a name="l00791"></a>00791       <span class="keywordflow">else</span>
<a name="l00792"></a>00792          <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.back().set_double_operand_type(-2);
<a name="l00793"></a>00793    } <span class="keywordflow">else</span> <span class="keywordflow">if</span>( operand_type == -3 ) {
<a name="l00794"></a>00794       <span class="keywordflow">if</span>(g_opcode == SET_OP || g_opcode == MAD_OP)
<a name="l00795"></a>00795          <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.back().set_double_operand_type(operand_type);
<a name="l00796"></a>00796       <span class="keywordflow">else</span>
<a name="l00797"></a>00797          parse_assert(0, <span class="stringliteral">&quot;Error: Unsupported use of double destination operand.&quot;</span>);
<a name="l00798"></a>00798    } <span class="keywordflow">else</span> {
<a name="l00799"></a>00799       <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.back().set_double_operand_type(operand_type);
<a name="l00800"></a>00800    }
<a name="l00801"></a>00801 
<a name="l00802"></a>00802 }
<a name="l00803"></a>00803 
<a name="l00804"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#ab00e793470bf010bbf4e6c517a5dcd86">00804</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#ab00e793470bf010bbf4e6c517a5dcd86">change_operand_neg</a>( )
<a name="l00805"></a>00805 {
<a name="l00806"></a>00806    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;change_operand_neg&quot;</span>);
<a name="l00807"></a>00807    assert( !<a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.empty() );
<a name="l00808"></a>00808 
<a name="l00809"></a>00809    <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.back().set_operand_neg();
<a name="l00810"></a>00810 
<a name="l00811"></a>00811 }
<a name="l00812"></a>00812 
<a name="l00813"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a7fb5013c14fbff6829ee4e939b360bd2">00813</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a7fb5013c14fbff6829ee4e939b360bd2">add_literal_int</a>( <span class="keywordtype">int</span> value ) 
<a name="l00814"></a>00814 {
<a name="l00815"></a>00815    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_literal_int&quot;</span>);
<a name="l00816"></a>00816    <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.push_back( <a class="code" href="classoperand__info.html">operand_info</a>(value) );
<a name="l00817"></a>00817 }
<a name="l00818"></a>00818 
<a name="l00819"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a2a3e3f24f2424cf05706132873c0f0aa">00819</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a2a3e3f24f2424cf05706132873c0f0aa">add_literal_float</a>( <span class="keywordtype">float</span> value ) 
<a name="l00820"></a>00820 {
<a name="l00821"></a>00821    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_literal_float&quot;</span>);
<a name="l00822"></a>00822    <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.push_back( <a class="code" href="classoperand__info.html">operand_info</a>(value) );
<a name="l00823"></a>00823 }
<a name="l00824"></a>00824 
<a name="l00825"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#afad39846af3b9ba6ca283bfa37a9f800">00825</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#afad39846af3b9ba6ca283bfa37a9f800">add_literal_double</a>( <span class="keywordtype">double</span> value ) 
<a name="l00826"></a>00826 {
<a name="l00827"></a>00827    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_literal_double&quot;</span>);
<a name="l00828"></a>00828    <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.push_back( <a class="code" href="classoperand__info.html">operand_info</a>(value) );
<a name="l00829"></a>00829 }
<a name="l00830"></a>00830 
<a name="l00831"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a5873ff4425a3679403f2acd9b730ed64">00831</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a5873ff4425a3679403f2acd9b730ed64">add_scalar_operand</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *identifier ) 
<a name="l00832"></a>00832 {
<a name="l00833"></a>00833    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_scalar_operand&quot;</span>);
<a name="l00834"></a>00834    <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *s = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(identifier);
<a name="l00835"></a>00835    <span class="keywordflow">if</span> ( s == NULL ) {
<a name="l00836"></a>00836       <span class="keywordflow">if</span> ( g_opcode == BRA_OP || g_opcode == CALLP_OP) {
<a name="l00837"></a>00837          <span class="comment">// forward branch target...</span>
<a name="l00838"></a>00838          s = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a9f654872467a1fc6ecfed51379b2b800">add_variable</a>(identifier,NULL,0,<a class="code" href="ptx__parser_8cc.html#a122c21cc0a19e563d5343d255dbcf36c">g_filename</a>,ptx_lineno);
<a name="l00839"></a>00839       } <span class="keywordflow">else</span> {
<a name="l00840"></a>00840          std::string msg = std::string(<span class="stringliteral">&quot;operand \&quot;&quot;</span>) + identifier + <span class="stringliteral">&quot;\&quot; has no declaration.&quot;</span>;
<a name="l00841"></a>00841          parse_error( msg.c_str() );
<a name="l00842"></a>00842       }
<a name="l00843"></a>00843    }
<a name="l00844"></a>00844    <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.push_back( <a class="code" href="classoperand__info.html">operand_info</a>(s) );
<a name="l00845"></a>00845 }
<a name="l00846"></a>00846 
<a name="l00847"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a929ecfd41043ed17ff328ebcfd28ba05">00847</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a929ecfd41043ed17ff328ebcfd28ba05">add_neg_pred_operand</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *identifier ) 
<a name="l00848"></a>00848 {
<a name="l00849"></a>00849    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_neg_pred_operand&quot;</span>);
<a name="l00850"></a>00850    <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *s = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(identifier);
<a name="l00851"></a>00851    <span class="keywordflow">if</span> ( s == NULL ) {
<a name="l00852"></a>00852        s = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a9f654872467a1fc6ecfed51379b2b800">add_variable</a>(identifier,NULL,1,<a class="code" href="ptx__parser_8cc.html#a122c21cc0a19e563d5343d255dbcf36c">g_filename</a>,ptx_lineno);
<a name="l00853"></a>00853    }
<a name="l00854"></a>00854    <a class="code" href="classoperand__info.html">operand_info</a> op(s);
<a name="l00855"></a>00855    op.<a class="code" href="classoperand__info.html#a643bbeeab4b0560ac64b7abf99f51681">set_neg_pred</a>();
<a name="l00856"></a>00856    <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.push_back( op );
<a name="l00857"></a>00857 }
<a name="l00858"></a>00858 
<a name="l00859"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a455bb3b29f6753ca863f6c91442883ee">00859</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a455bb3b29f6753ca863f6c91442883ee">add_address_operand</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *identifier, <span class="keywordtype">int</span> offset ) 
<a name="l00860"></a>00860 {
<a name="l00861"></a>00861    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_address_operand&quot;</span>);
<a name="l00862"></a>00862    <span class="keyword">const</span> <a class="code" href="classsymbol.html">symbol</a> *s = g_current_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a85bce701e77966eb7c42b938b046d272">lookup</a>(identifier);
<a name="l00863"></a>00863    <span class="keywordflow">if</span> ( s == NULL ) {
<a name="l00864"></a>00864       std::string msg = std::string(<span class="stringliteral">&quot;operand \&quot;&quot;</span>) + identifier + <span class="stringliteral">&quot;\&quot; has no declaration.&quot;</span>;
<a name="l00865"></a>00865       parse_error( msg.c_str() );
<a name="l00866"></a>00866    }
<a name="l00867"></a>00867    <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.push_back( <a class="code" href="classoperand__info.html">operand_info</a>(s,offset) );
<a name="l00868"></a>00868 }
<a name="l00869"></a>00869 
<a name="l00870"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a40b9878e828ace32482627b82ce35923">00870</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a40b9878e828ace32482627b82ce35923">add_address_operand2</a>( <span class="keywordtype">int</span> offset )
<a name="l00871"></a>00871 {
<a name="l00872"></a>00872    PTX_PARSE_DPRINTF(<span class="stringliteral">&quot;add_address_operand&quot;</span>);
<a name="l00873"></a>00873    <a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>.push_back( <a class="code" href="classoperand__info.html">operand_info</a>((<span class="keywordtype">unsigned</span>)offset) );
<a name="l00874"></a>00874 }
<a name="l00875"></a>00875 
<a name="l00876"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a12213b65dff717a597ceee73fb585ed8">00876</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a12213b65dff717a597ceee73fb585ed8">add_array_initializer</a>()
<a name="l00877"></a>00877 {
<a name="l00878"></a>00878    g_last_symbol-&gt;<a class="code" href="classsymbol.html#aadce2f9eaac87e476fcd4961af534a1b">add_initializer</a>(<a class="code" href="ptx__parser_8cc.html#af2b3dc4132b89f2b814620b55fff1a28">g_operands</a>);
<a name="l00879"></a>00879 }
<a name="l00880"></a>00880 
<a name="l00881"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#abc258b80e70ab3189cae12804b53b8ad">00881</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#abc258b80e70ab3189cae12804b53b8ad">add_version_info</a>( <span class="keywordtype">float</span> ver, <span class="keywordtype">unsigned</span> ext )
<a name="l00882"></a>00882 {
<a name="l00883"></a>00883    g_global_symbol_table-&gt;<a class="code" href="classsymbol__table.html#ab2692848b48503b2fff44620d3d6a537">set_ptx_version</a>(ver,ext);
<a name="l00884"></a>00884 }
<a name="l00885"></a>00885 
<a name="l00886"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#abca9004c726ac10a62b4ab717811ffd6">00886</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#abca9004c726ac10a62b4ab717811ffd6">add_file</a>( <span class="keywordtype">unsigned</span> num, <span class="keyword">const</span> <span class="keywordtype">char</span> *<a class="code" href="cuobjdump__parser_8c.html#a5482b27881397d5b87f54feab7471580">filename</a> )
<a name="l00887"></a>00887 {
<a name="l00888"></a>00888    <span class="keywordflow">if</span>( <a class="code" href="ptx__parser_8cc.html#a122c21cc0a19e563d5343d255dbcf36c">g_filename</a> == NULL ) {
<a name="l00889"></a>00889       <span class="keywordtype">char</span> *b = strdup(filename);
<a name="l00890"></a>00890       <span class="keywordtype">char</span> *l=b;
<a name="l00891"></a>00891       <span class="keywordtype">char</span> *<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>=b;
<a name="l00892"></a>00892       <span class="keywordflow">while</span>( *n != <span class="charliteral">&apos;\0&apos;</span> ) {
<a name="l00893"></a>00893           <span class="keywordflow">if</span>( *n == <span class="charliteral">&apos;/&apos;</span> ) 
<a name="l00894"></a>00894               l = n+1;
<a name="l00895"></a>00895           n++;
<a name="l00896"></a>00896       }
<a name="l00897"></a>00897 
<a name="l00898"></a>00898       <span class="keywordtype">char</span> *p = strtok(l,<span class="stringliteral">&quot;.&quot;</span>);
<a name="l00899"></a>00899       <span class="keywordtype">char</span> buf[1024];
<a name="l00900"></a>00900       snprintf(buf,1024,<span class="stringliteral">&quot;%s.ptx&quot;</span>,p);
<a name="l00901"></a>00901 
<a name="l00902"></a>00902       <span class="keywordtype">char</span> *q = strtok(NULL,<span class="stringliteral">&quot;.&quot;</span>);
<a name="l00903"></a>00903       <span class="keywordflow">if</span>( q &amp;&amp; !strcmp(q,<span class="stringliteral">&quot;cu&quot;</span>) ) {
<a name="l00904"></a>00904           <a class="code" href="ptx__parser_8cc.html#a122c21cc0a19e563d5343d255dbcf36c">g_filename</a> = strdup(buf);
<a name="l00905"></a>00905       }
<a name="l00906"></a>00906 
<a name="l00907"></a>00907       <a class="code" href="y_8tab_8c.html#af07d89f5ceaea0c7c8252cc41fd75f37">free</a>( b );
<a name="l00908"></a>00908    }
<a name="l00909"></a>00909 
<a name="l00910"></a>00910    g_current_symbol_table = g_global_symbol_table;
<a name="l00911"></a>00911 }
<a name="l00912"></a>00912 
<a name="l00913"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a50905ff2b62cb06fe9a1ae91ac4eaa28">00913</a> <span class="keywordtype">void</span> *<a class="code" href="ptx__parser_8cc.html#a50905ff2b62cb06fe9a1ae91ac4eaa28">reset_symtab</a>()
<a name="l00914"></a>00914 {
<a name="l00915"></a>00915    <span class="keywordtype">void</span> *result = g_current_symbol_table;
<a name="l00916"></a>00916    g_current_symbol_table = g_global_symbol_table;
<a name="l00917"></a>00917    <span class="keywordflow">return</span> result;
<a name="l00918"></a>00918 }
<a name="l00919"></a>00919 
<a name="l00920"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#aa6407cef2f86ad1680bafc5947e7db76">00920</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#aa562ed8fffc1fba4759a7ad672a6a96e">set_symtab</a>(<span class="keywordtype">void</span>*symtab)
<a name="l00921"></a>00921 {
<a name="l00922"></a>00922    g_current_symbol_table = (<a class="code" href="classsymbol__table.html">symbol_table</a>*)symtab;
<a name="l00923"></a>00923 }
<a name="l00924"></a>00924 
<a name="l00925"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#ae58239ef4e22b594382c4f97b435ac02">00925</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#ae58239ef4e22b594382c4f97b435ac02">add_pragma</a>( <span class="keyword">const</span> <span class="keywordtype">char</span> *str )
<a name="l00926"></a>00926 {
<a name="l00927"></a>00927    printf(<span class="stringliteral">&quot;GPGPU-Sim PTX: Warning -- ignoring pragma &apos;%s&apos;\n&quot;</span>, str );
<a name="l00928"></a>00928 }
<a name="l00929"></a>00929 
<a name="l00930"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#afeaf80ed3ca07ed0533082e4d23a8ce4">00930</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#afeaf80ed3ca07ed0533082e4d23a8ce4">version_header</a>(<span class="keywordtype">double</span> a) {}  <span class="comment">//intentional dummy function</span>
<a name="l00931"></a>00931 
<a name="l00932"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#aa10a910beb73183076ce51d424f1f769">00932</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#aa10a910beb73183076ce51d424f1f769">target_header</a>(<span class="keywordtype">char</span>* a) 
<a name="l00933"></a>00933 {
<a name="l00934"></a>00934    g_global_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a6d2b8521ab189b64742790206d09cd63">set_sm_target</a>(a,NULL,NULL);
<a name="l00935"></a>00935 }
<a name="l00936"></a>00936 
<a name="l00937"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a2f394909630d0c4cfbe186bba60839a4">00937</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a2f394909630d0c4cfbe186bba60839a4">target_header2</a>(<span class="keywordtype">char</span>* a, <span class="keywordtype">char</span>* b) 
<a name="l00938"></a>00938 {
<a name="l00939"></a>00939    g_global_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a6d2b8521ab189b64742790206d09cd63">set_sm_target</a>(a,b,NULL);
<a name="l00940"></a>00940 }
<a name="l00941"></a>00941 
<a name="l00942"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a27f99e87aff908cdfba07275e24b8dd2">00942</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a27f99e87aff908cdfba07275e24b8dd2">target_header3</a>(<span class="keywordtype">char</span>* a, <span class="keywordtype">char</span>* b, <span class="keywordtype">char</span>* c) 
<a name="l00943"></a>00943 {
<a name="l00944"></a>00944    g_global_symbol_table-&gt;<a class="code" href="classsymbol__table.html#a6d2b8521ab189b64742790206d09cd63">set_sm_target</a>(a,b,c);
<a name="l00945"></a>00945 }
<a name="l00946"></a>00946 
<a name="l00947"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a1ea9f31e278762b40a9d189151b86977">00947</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a1ea9f31e278762b40a9d189151b86977">func_header</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* a) {} <span class="comment">//intentional dummy function</span>
<a name="l00948"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#a272b099352da40a296a990426cc03cef">00948</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#a272b099352da40a296a990426cc03cef">func_header_info</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* a) {} <span class="comment">//intentional dummy function</span>
<a name="l00949"></a><a class="code" href="src_2cuda-sim_2ptx__parser_8h.html#ac1e82baee529da8ffdd19541ed9118ea">00949</a> <span class="keywordtype">void</span> <a class="code" href="ptx__parser_8cc.html#ac1e82baee529da8ffdd19541ed9118ea">func_header_info_int</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* a, <span class="keywordtype">int</span> b) {} <span class="comment">//intentional dummy function</span>
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 13 May 2014 for GPGPU-Sim by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
