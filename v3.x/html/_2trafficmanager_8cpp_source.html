<!-- This comment will put IE 6, 7 and 8 in quirks mode -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>GPGPU-Sim: v3.x/src/intersim2/trafficmanager.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javaScript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <img id="MSearchSelect" src="search/search.png"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             alt=""/>
        <input type="text" id="MSearchField" value="Search" accesskey="S"
             onfocus="searchBox.OnSearchFieldFocus(true)" 
             onblur="searchBox.OnSearchFieldFocus(false)" 
             onkeyup="searchBox.OnSearchFieldChange(event)"/>
        <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
        </div>
      </li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
  <div class="navpath"><a class="el" href="dir_c934b74ccb33d6b9bfd1e576787940d8.html">v3.x</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_da58ad9beee6988f697f1a76e412a52a.html">src</a>&nbsp;&raquo&nbsp;<a class="el" href="dir_7e44b91c2d8bca2324eb4df0ed8bb374.html">intersim2</a>
  </div>
</div>
<div class="contents">
<h1>trafficmanager.cpp</h1><a href="_2trafficmanager_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">// $Id: trafficmanager.cpp 5506 2013-05-07 21:22:23Z qtedq $</span>
<a name="l00002"></a>00002 
<a name="l00003"></a>00003 <span class="comment">/*</span>
<a name="l00004"></a>00004 <span class="comment">  Copyright (c) 2007-2012, Trustees of The Leland Stanford Junior University</span>
<a name="l00005"></a>00005 <span class="comment">  All rights reserved.</span>
<a name="l00006"></a>00006 <span class="comment"></span>
<a name="l00007"></a>00007 <span class="comment">  Redistribution and use in source and binary forms, with or without</span>
<a name="l00008"></a>00008 <span class="comment">  modification, are permitted provided that the following conditions are met:</span>
<a name="l00009"></a>00009 <span class="comment"></span>
<a name="l00010"></a>00010 <span class="comment">  Redistributions of source code must retain the above copyright notice, this </span>
<a name="l00011"></a>00011 <span class="comment">  list of conditions and the following disclaimer.</span>
<a name="l00012"></a>00012 <span class="comment">  Redistributions in binary form must reproduce the above copyright notice, this</span>
<a name="l00013"></a>00013 <span class="comment">  list of conditions and the following disclaimer in the documentation and/or</span>
<a name="l00014"></a>00014 <span class="comment">  other materials provided with the distribution.</span>
<a name="l00015"></a>00015 <span class="comment"></span>
<a name="l00016"></a>00016 <span class="comment">  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND</span>
<a name="l00017"></a>00017 <span class="comment">  ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED</span>
<a name="l00018"></a>00018 <span class="comment">  WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE </span>
<a name="l00019"></a>00019 <span class="comment">  DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR</span>
<a name="l00020"></a>00020 <span class="comment">  ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES</span>
<a name="l00021"></a>00021 <span class="comment">  (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;</span>
<a name="l00022"></a>00022 <span class="comment">  LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON</span>
<a name="l00023"></a>00023 <span class="comment">  ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT</span>
<a name="l00024"></a>00024 <span class="comment">  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<a name="l00025"></a>00025 <span class="comment">  SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<a name="l00026"></a>00026 <span class="comment">*/</span>
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 <span class="preprocessor">#include &lt;sstream&gt;</span>
<a name="l00029"></a>00029 <span class="preprocessor">#include &lt;cmath&gt;</span>
<a name="l00030"></a>00030 <span class="preprocessor">#include &lt;fstream&gt;</span>
<a name="l00031"></a>00031 <span class="preprocessor">#include &lt;limits&gt;</span>
<a name="l00032"></a>00032 <span class="preprocessor">#include &lt;cstdlib&gt;</span>
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 <span class="preprocessor">#include &quot;booksim.hpp&quot;</span>
<a name="l00035"></a>00035 <span class="preprocessor">#include &quot;booksim_config.hpp&quot;</span>
<a name="l00036"></a>00036 <span class="preprocessor">#include &quot;trafficmanager.hpp&quot;</span>
<a name="l00037"></a>00037 <span class="preprocessor">#include &quot;<a class="code" href="batchtrafficmanager_8hpp.html">batchtrafficmanager.hpp</a>&quot;</span>
<a name="l00038"></a>00038 <span class="preprocessor">#include &quot;<a class="code" href="gputrafficmanager_8hpp.html">gputrafficmanager.hpp</a>&quot;</span>
<a name="l00039"></a>00039 <span class="preprocessor">#include &quot;random_utils.hpp&quot;</span> 
<a name="l00040"></a>00040 <span class="preprocessor">#include &quot;vc.hpp&quot;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="packet__reply__info_8hpp.html">packet_reply_info.hpp</a>&quot;</span>
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="classTrafficManager.html#ae5023ac53f1deb85540abe79a174db26">00043</a> <a class="code" href="classTrafficManager.html">TrafficManager</a> * <a class="code" href="classTrafficManager.html#ae5023ac53f1deb85540abe79a174db26">TrafficManager::New</a>(<a class="code" href="classConfiguration.html">Configuration</a> <span class="keyword">const</span> &amp; config,
<a name="l00044"></a>00044                                      vector&lt;Network *&gt; <span class="keyword">const</span> &amp; net)
<a name="l00045"></a>00045 {
<a name="l00046"></a>00046   <a class="code" href="classTrafficManager.html">TrafficManager</a> * result = NULL;
<a name="l00047"></a>00047   <span class="keywordtype">string</span> sim_type = config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>(<span class="stringliteral">&quot;sim_type&quot;</span>);
<a name="l00048"></a>00048   <span class="keywordflow">if</span>((sim_type == <span class="stringliteral">&quot;latency&quot;</span>) || (sim_type == <span class="stringliteral">&quot;throughput&quot;</span>)) {
<a name="l00049"></a>00049     result = <span class="keyword">new</span> <a class="code" href="classTrafficManager.html#a29f7913afe30e94b00d1dd409022e5bb">TrafficManager</a>(config, net);
<a name="l00050"></a>00050   } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(sim_type == <span class="stringliteral">&quot;batch&quot;</span>) {
<a name="l00051"></a>00051     result = <span class="keyword">new</span> <a class="code" href="classBatchTrafficManager.html">BatchTrafficManager</a>(config, net);
<a name="l00052"></a>00052   } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(sim_type == <span class="stringliteral">&quot;gpgpusim&quot;</span>) {
<a name="l00053"></a>00053     result = <span class="keyword">new</span> <a class="code" href="classGPUTrafficManager.html">GPUTrafficManager</a>(config, net);
<a name="l00054"></a>00054   }
<a name="l00055"></a>00055   <span class="keywordflow">else</span> {
<a name="l00056"></a>00056     cerr &lt;&lt; <span class="stringliteral">&quot;Unknown simulation type: &quot;</span> &lt;&lt; sim_type &lt;&lt; endl;
<a name="l00057"></a>00057   } 
<a name="l00058"></a>00058   <span class="keywordflow">return</span> result;
<a name="l00059"></a>00059 }
<a name="l00060"></a>00060 
<a name="l00061"></a><a class="code" href="classTrafficManager.html#aa64375ce3608406a0a50ea893301f38c">00061</a> <a class="code" href="classTrafficManager.html#a29f7913afe30e94b00d1dd409022e5bb">TrafficManager::TrafficManager</a>( <span class="keyword">const</span> <a class="code" href="classConfiguration.html">Configuration</a> &amp;config, <span class="keyword">const</span> vector&lt;Network *&gt; &amp; net )
<a name="l00062"></a>00062 : <a class="code" href="classModule.html">Module</a>( 0, <span class="stringliteral">&quot;traffic_manager&quot;</span> ), _net(net), _empty_network(false), _deadlock_timer(0), _reset_time(0), _drain_time(-1), _cur_id(0), _cur_pid(0), _time(0)
<a name="l00063"></a>00063 {
<a name="l00064"></a>00064   
<a name="l00065"></a>00065   <a class="code" href="classTrafficManager.html#a61ed65da53f0d0dac14cdf619e2d95af">_nodes</a> = <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[0]-&gt;<a class="code" href="classNetwork.html#ab44991665b3c7bf3d0d8499cb48c8012">NumNodes</a>( );
<a name="l00066"></a>00066   <a class="code" href="classTrafficManager.html#a60f79ec184e9dbd5ef5caa0a9b909558">_routers</a> = <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[0]-&gt;<a class="code" href="classNetwork.html#a2be047944bd1d793c713367609c5e93e">NumRouters</a>( );
<a name="l00067"></a>00067   
<a name="l00068"></a>00068   <a class="code" href="classTrafficManager.html#a4db1e48f0a35866bfc680c1544363511">_vcs</a> = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;num_vcs&quot;</span>);
<a name="l00069"></a>00069   <a class="code" href="classTrafficManager.html#adf0cc5d3d2377007a9471f73b1cf137a">_subnets</a> = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;subnets&quot;</span>);
<a name="l00070"></a>00070   
<a name="l00071"></a>00071   <a class="code" href="classTrafficManager.html#a5111853d7b5812a5e3b75fdf680dd6ed">_subnet</a>.resize(<a class="code" href="structFlit.html#ae259899197fe72be6c99aa737f408948">Flit::NUM_FLIT_TYPES</a>);
<a name="l00072"></a>00072   <a class="code" href="classTrafficManager.html#a5111853d7b5812a5e3b75fdf680dd6ed">_subnet</a>[<a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81ad47b8edbc7a6c26a34d782af584eeab0">Flit::READ_REQUEST</a>] = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;read_request_subnet&quot;</span>);
<a name="l00073"></a>00073   <a class="code" href="classTrafficManager.html#a5111853d7b5812a5e3b75fdf680dd6ed">_subnet</a>[<a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81a18d4c2af84d9556279434e5134b6c0bf">Flit::READ_REPLY</a>] = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;read_reply_subnet&quot;</span>);
<a name="l00074"></a>00074   <a class="code" href="classTrafficManager.html#a5111853d7b5812a5e3b75fdf680dd6ed">_subnet</a>[<a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81a74c1c54b3ebc54205b6a3e160ac2d0da">Flit::WRITE_REQUEST</a>] = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;write_request_subnet&quot;</span>);
<a name="l00075"></a>00075   <a class="code" href="classTrafficManager.html#a5111853d7b5812a5e3b75fdf680dd6ed">_subnet</a>[<a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81ae6c1481b97213d1e4476cbc48d40f615">Flit::WRITE_REPLY</a>] = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;write_reply_subnet&quot;</span>);
<a name="l00076"></a>00076   
<a name="l00077"></a>00077   <span class="comment">// ============ Message priorities ============</span>
<a name="l00078"></a>00078   
<a name="l00079"></a>00079   <span class="keywordtype">string</span> priority = config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>( <span class="stringliteral">&quot;priority&quot;</span> );
<a name="l00080"></a>00080   
<a name="l00081"></a>00081   <span class="keywordflow">if</span> ( priority == <span class="stringliteral">&quot;class&quot;</span> ) {
<a name="l00082"></a>00082     <a class="code" href="classTrafficManager.html#a23397b6a37ec6aab95391d2a6299b6b1">_pri_type</a> = <a class="code" href="classTrafficManager.html#ac706e7c128918cbe8dc015ca03c1a26da16fc1195598ced8197e9cf718ec9298b">class_based</a>;
<a name="l00083"></a>00083   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( priority == <span class="stringliteral">&quot;age&quot;</span> ) {
<a name="l00084"></a>00084     <a class="code" href="classTrafficManager.html#a23397b6a37ec6aab95391d2a6299b6b1">_pri_type</a> = <a class="code" href="classTrafficManager.html#ac706e7c128918cbe8dc015ca03c1a26daeda65575e2897f1be6462df7a45e21ad">age_based</a>;
<a name="l00085"></a>00085   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( priority == <span class="stringliteral">&quot;network_age&quot;</span> ) {
<a name="l00086"></a>00086     <a class="code" href="classTrafficManager.html#a23397b6a37ec6aab95391d2a6299b6b1">_pri_type</a> = <a class="code" href="classTrafficManager.html#ac706e7c128918cbe8dc015ca03c1a26da94465a3b3fa9a118ff7ba49ee559adc0">network_age_based</a>;
<a name="l00087"></a>00087   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( priority == <span class="stringliteral">&quot;local_age&quot;</span> ) {
<a name="l00088"></a>00088     <a class="code" href="classTrafficManager.html#a23397b6a37ec6aab95391d2a6299b6b1">_pri_type</a> = <a class="code" href="classTrafficManager.html#ac706e7c128918cbe8dc015ca03c1a26daea8a7a145b201b490ac103a7061f5a53">local_age_based</a>;
<a name="l00089"></a>00089   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( priority == <span class="stringliteral">&quot;queue_length&quot;</span> ) {
<a name="l00090"></a>00090     <a class="code" href="classTrafficManager.html#a23397b6a37ec6aab95391d2a6299b6b1">_pri_type</a> = <a class="code" href="classTrafficManager.html#ac706e7c128918cbe8dc015ca03c1a26dabef2e6b0c5564988b551b60a72d1747e">queue_length_based</a>;
<a name="l00091"></a>00091   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( priority == <span class="stringliteral">&quot;hop_count&quot;</span> ) {
<a name="l00092"></a>00092     <a class="code" href="classTrafficManager.html#a23397b6a37ec6aab95391d2a6299b6b1">_pri_type</a> = <a class="code" href="classTrafficManager.html#ac706e7c128918cbe8dc015ca03c1a26da79a729c77c0f55d6355f5732e991073f">hop_count_based</a>;
<a name="l00093"></a>00093   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( priority == <span class="stringliteral">&quot;sequence&quot;</span> ) {
<a name="l00094"></a>00094     <a class="code" href="classTrafficManager.html#a23397b6a37ec6aab95391d2a6299b6b1">_pri_type</a> = <a class="code" href="classTrafficManager.html#ac706e7c128918cbe8dc015ca03c1a26daa39a63afb93d7581b7ebc66932653aaa">sequence_based</a>;
<a name="l00095"></a>00095   } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( priority == <span class="stringliteral">&quot;none&quot;</span> ) {
<a name="l00096"></a>00096     <a class="code" href="classTrafficManager.html#a23397b6a37ec6aab95391d2a6299b6b1">_pri_type</a> = <a class="code" href="classTrafficManager.html#ac706e7c128918cbe8dc015ca03c1a26da4536f6fe3b647409345de5fe29c23158">none</a>;
<a name="l00097"></a>00097   } <span class="keywordflow">else</span> {
<a name="l00098"></a>00098     <a class="code" href="classModule.html#acfa9d0dc518853045e0d2356d138717f">Error</a>( <span class="stringliteral">&quot;Unkown priority value: &quot;</span> + priority );
<a name="l00099"></a>00099   }
<a name="l00100"></a>00100   
<a name="l00101"></a>00101   <span class="comment">// ============ Routing ============</span>
<a name="l00102"></a>00102   
<a name="l00103"></a>00103   <span class="keywordtype">string</span> rf = config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>(<span class="stringliteral">&quot;routing_function&quot;</span>) + <span class="stringliteral">&quot;_&quot;</span> + config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>(<span class="stringliteral">&quot;topology&quot;</span>);
<a name="l00104"></a>00104   map&lt;string, tRoutingFunction&gt;::const_iterator rf_iter = <a class="code" href="routefunc_8cpp.html#a0f29c5e50d61f6c53291c64c6e56ace4">gRoutingFunctionMap</a>.find(rf);
<a name="l00105"></a>00105   <span class="keywordflow">if</span>(rf_iter == <a class="code" href="routefunc_8cpp.html#a0f29c5e50d61f6c53291c64c6e56ace4">gRoutingFunctionMap</a>.end()) {
<a name="l00106"></a>00106     <a class="code" href="classModule.html#acfa9d0dc518853045e0d2356d138717f">Error</a>(<span class="stringliteral">&quot;Invalid routing function: &quot;</span> + rf);
<a name="l00107"></a>00107   }
<a name="l00108"></a>00108   <a class="code" href="classTrafficManager.html#a2d1cccd0f50ec0972bdb666e9b234b72">_rf</a> = rf_iter-&gt;second;
<a name="l00109"></a>00109   
<a name="l00110"></a>00110   <a class="code" href="classTrafficManager.html#a91a6036667c1793b9af0885329d4711d">_lookahead_routing</a> = !config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;routing_delay&quot;</span>);
<a name="l00111"></a>00111   <a class="code" href="classTrafficManager.html#a7d1ae95f37124ebfdd8f16613c207543">_noq</a> = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;noq&quot;</span>);
<a name="l00112"></a>00112   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a7d1ae95f37124ebfdd8f16613c207543">_noq</a>) {
<a name="l00113"></a>00113     <span class="keywordflow">if</span>(!<a class="code" href="classTrafficManager.html#a91a6036667c1793b9af0885329d4711d">_lookahead_routing</a>) {
<a name="l00114"></a>00114       <a class="code" href="classModule.html#acfa9d0dc518853045e0d2356d138717f">Error</a>(<span class="stringliteral">&quot;NOQ requires lookahead routing to be enabled.&quot;</span>);
<a name="l00115"></a>00115     }
<a name="l00116"></a>00116   }
<a name="l00117"></a>00117   
<a name="l00118"></a>00118   <span class="comment">// ============ Traffic ============</span>
<a name="l00119"></a>00119   
<a name="l00120"></a>00120   <a class="code" href="classTrafficManager.html#a9394ae83257275a40a9e1b62eb3a6247">_classes</a> = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;classes&quot;</span>);
<a name="l00121"></a>00121   
<a name="l00122"></a>00122   <a class="code" href="classTrafficManager.html#adfe9e24ec927025a9f94e55cba8516f5">_use_read_write</a> = config.<a class="code" href="classConfiguration.html#af10fd5d25270cdf2108aa67b40e84de3">GetIntArray</a>(<span class="stringliteral">&quot;use_read_write&quot;</span>);
<a name="l00123"></a>00123   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#adfe9e24ec927025a9f94e55cba8516f5">_use_read_write</a>.empty()) {
<a name="l00124"></a>00124     <a class="code" href="classTrafficManager.html#adfe9e24ec927025a9f94e55cba8516f5">_use_read_write</a>.push_back(config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;use_read_write&quot;</span>));
<a name="l00125"></a>00125   }
<a name="l00126"></a>00126   <a class="code" href="classTrafficManager.html#adfe9e24ec927025a9f94e55cba8516f5">_use_read_write</a>.resize(<a class="code" href="classTrafficManager.html#a9394ae83257275a40a9e1b62eb3a6247">_classes</a>, <a class="code" href="classTrafficManager.html#adfe9e24ec927025a9f94e55cba8516f5">_use_read_write</a>.back());
<a name="l00127"></a>00127   
<a name="l00128"></a>00128   <a class="code" href="classTrafficManager.html#a7aa253563e3198143f4219435063d465">_write_fraction</a> = config.<a class="code" href="classConfiguration.html#a51ee53209497969ee8d7257808efc270">GetFloatArray</a>(<span class="stringliteral">&quot;write_fraction&quot;</span>);
<a name="l00129"></a>00129   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a7aa253563e3198143f4219435063d465">_write_fraction</a>.empty()) {
<a name="l00130"></a>00130     <a class="code" href="classTrafficManager.html#a7aa253563e3198143f4219435063d465">_write_fraction</a>.push_back(config.<a class="code" href="classConfiguration.html#a028a68a59c43784e632c834182af6a10">GetFloat</a>(<span class="stringliteral">&quot;write_fraction&quot;</span>));
<a name="l00131"></a>00131   }
<a name="l00132"></a>00132   <a class="code" href="classTrafficManager.html#a7aa253563e3198143f4219435063d465">_write_fraction</a>.resize(<a class="code" href="classTrafficManager.html#a9394ae83257275a40a9e1b62eb3a6247">_classes</a>, <a class="code" href="classTrafficManager.html#a7aa253563e3198143f4219435063d465">_write_fraction</a>.back());
<a name="l00133"></a>00133   
<a name="l00134"></a>00134   <a class="code" href="classTrafficManager.html#a87535b1fdae24ddd88e7806c591cd124">_read_request_size</a> = config.<a class="code" href="classConfiguration.html#af10fd5d25270cdf2108aa67b40e84de3">GetIntArray</a>(<span class="stringliteral">&quot;read_request_size&quot;</span>);
<a name="l00135"></a>00135   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a87535b1fdae24ddd88e7806c591cd124">_read_request_size</a>.empty()) {
<a name="l00136"></a>00136     <a class="code" href="classTrafficManager.html#a87535b1fdae24ddd88e7806c591cd124">_read_request_size</a>.push_back(config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;read_request_size&quot;</span>));
<a name="l00137"></a>00137   }
<a name="l00138"></a>00138   <a class="code" href="classTrafficManager.html#a87535b1fdae24ddd88e7806c591cd124">_read_request_size</a>.resize(<a class="code" href="classTrafficManager.html#a9394ae83257275a40a9e1b62eb3a6247">_classes</a>, <a class="code" href="classTrafficManager.html#a87535b1fdae24ddd88e7806c591cd124">_read_request_size</a>.back());
<a name="l00139"></a>00139   
<a name="l00140"></a>00140   <a class="code" href="classTrafficManager.html#a9666144e4145b07dd1a1c48d77eadb65">_read_reply_size</a> = config.<a class="code" href="classConfiguration.html#af10fd5d25270cdf2108aa67b40e84de3">GetIntArray</a>(<span class="stringliteral">&quot;read_reply_size&quot;</span>);
<a name="l00141"></a>00141   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a9666144e4145b07dd1a1c48d77eadb65">_read_reply_size</a>.empty()) {
<a name="l00142"></a>00142     <a class="code" href="classTrafficManager.html#a9666144e4145b07dd1a1c48d77eadb65">_read_reply_size</a>.push_back(config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;read_reply_size&quot;</span>));
<a name="l00143"></a>00143   }
<a name="l00144"></a>00144   <a class="code" href="classTrafficManager.html#a9666144e4145b07dd1a1c48d77eadb65">_read_reply_size</a>.resize(<a class="code" href="classTrafficManager.html#a9394ae83257275a40a9e1b62eb3a6247">_classes</a>, <a class="code" href="classTrafficManager.html#a9666144e4145b07dd1a1c48d77eadb65">_read_reply_size</a>.back());
<a name="l00145"></a>00145   
<a name="l00146"></a>00146   <a class="code" href="classTrafficManager.html#a08692b9e9fc3303cf35b9d4a7ea92370">_write_request_size</a> = config.<a class="code" href="classConfiguration.html#af10fd5d25270cdf2108aa67b40e84de3">GetIntArray</a>(<span class="stringliteral">&quot;write_request_size&quot;</span>);
<a name="l00147"></a>00147   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a08692b9e9fc3303cf35b9d4a7ea92370">_write_request_size</a>.empty()) {
<a name="l00148"></a>00148     <a class="code" href="classTrafficManager.html#a08692b9e9fc3303cf35b9d4a7ea92370">_write_request_size</a>.push_back(config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;write_request_size&quot;</span>));
<a name="l00149"></a>00149   }
<a name="l00150"></a>00150   <a class="code" href="classTrafficManager.html#a08692b9e9fc3303cf35b9d4a7ea92370">_write_request_size</a>.resize(<a class="code" href="classTrafficManager.html#a9394ae83257275a40a9e1b62eb3a6247">_classes</a>, <a class="code" href="classTrafficManager.html#a08692b9e9fc3303cf35b9d4a7ea92370">_write_request_size</a>.back());
<a name="l00151"></a>00151   
<a name="l00152"></a>00152   <a class="code" href="classTrafficManager.html#a26e3fea3ea43158bc6488e84393ff7db">_write_reply_size</a> = config.<a class="code" href="classConfiguration.html#af10fd5d25270cdf2108aa67b40e84de3">GetIntArray</a>(<span class="stringliteral">&quot;write_reply_size&quot;</span>);
<a name="l00153"></a>00153   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a26e3fea3ea43158bc6488e84393ff7db">_write_reply_size</a>.empty()) {
<a name="l00154"></a>00154     <a class="code" href="classTrafficManager.html#a26e3fea3ea43158bc6488e84393ff7db">_write_reply_size</a>.push_back(config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;write_reply_size&quot;</span>));
<a name="l00155"></a>00155   }
<a name="l00156"></a>00156   <a class="code" href="classTrafficManager.html#a26e3fea3ea43158bc6488e84393ff7db">_write_reply_size</a>.resize(<a class="code" href="classTrafficManager.html#a9394ae83257275a40a9e1b62eb3a6247">_classes</a>, <a class="code" href="classTrafficManager.html#a26e3fea3ea43158bc6488e84393ff7db">_write_reply_size</a>.back());
<a name="l00157"></a>00157   
<a name="l00158"></a>00158   <span class="keywordtype">string</span> packet_size_str = config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>(<span class="stringliteral">&quot;packet_size&quot;</span>);
<a name="l00159"></a>00159   <span class="keywordflow">if</span>(packet_size_str.empty()) {
<a name="l00160"></a>00160     <a class="code" href="classTrafficManager.html#a9d132f9f6e9ea03ab7d4234091ea7f56">_packet_size</a>.push_back(vector&lt;int&gt;(1, config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;packet_size&quot;</span>)));
<a name="l00161"></a>00161   } <span class="keywordflow">else</span> {
<a name="l00162"></a>00162     vector&lt;string&gt; packet_size_strings = <a class="code" href="_2config__utils_8cpp.html#a91fefff3fe2019e20ddfe207251fc42d">tokenize_str</a>(packet_size_str);
<a name="l00163"></a>00163     <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; packet_size_strings.size(); ++i) {
<a name="l00164"></a>00164       <a class="code" href="classTrafficManager.html#a9d132f9f6e9ea03ab7d4234091ea7f56">_packet_size</a>.push_back(<a class="code" href="_2config__utils_8cpp.html#aacbfc12ac81c2e4a60c3e8b2b450fe85">tokenize_int</a>(packet_size_strings[i]));
<a name="l00165"></a>00165     }
<a name="l00166"></a>00166   }
<a name="l00167"></a>00167   <a class="code" href="classTrafficManager.html#a9d132f9f6e9ea03ab7d4234091ea7f56">_packet_size</a>.resize(<a class="code" href="classTrafficManager.html#a9394ae83257275a40a9e1b62eb3a6247">_classes</a>, <a class="code" href="classTrafficManager.html#a9d132f9f6e9ea03ab7d4234091ea7f56">_packet_size</a>.back());
<a name="l00168"></a>00168   
<a name="l00169"></a>00169   <span class="keywordtype">string</span> packet_size_rate_str = config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>(<span class="stringliteral">&quot;packet_size_rate&quot;</span>);
<a name="l00170"></a>00170   <span class="keywordflow">if</span>(packet_size_rate_str.empty()) {
<a name="l00171"></a>00171     <span class="keywordtype">int</span> rate = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;packet_size_rate&quot;</span>);
<a name="l00172"></a>00172     assert(rate &gt;= 0);
<a name="l00173"></a>00173     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; <a class="code" href="classTrafficManager.html#a9394ae83257275a40a9e1b62eb3a6247">_classes</a>; ++c) {
<a name="l00174"></a>00174       <span class="keywordtype">int</span> size = <a class="code" href="classTrafficManager.html#a9d132f9f6e9ea03ab7d4234091ea7f56">_packet_size</a>[c].size();
<a name="l00175"></a>00175       <a class="code" href="classTrafficManager.html#acbd94dd6163520a2468dfd4ad079170a">_packet_size_rate</a>.push_back(vector&lt;int&gt;(size, rate));
<a name="l00176"></a>00176       <a class="code" href="classTrafficManager.html#ab6e4665632db77e8239371b38d06cb50">_packet_size_max_val</a>.push_back(size * rate - 1);
<a name="l00177"></a>00177     }
<a name="l00178"></a>00178   } <span class="keywordflow">else</span> {
<a name="l00179"></a>00179     vector&lt;string&gt; packet_size_rate_strings = <a class="code" href="_2config__utils_8cpp.html#a91fefff3fe2019e20ddfe207251fc42d">tokenize_str</a>(packet_size_rate_str);
<a name="l00180"></a>00180     packet_size_rate_strings.resize(<a class="code" href="classTrafficManager.html#a9394ae83257275a40a9e1b62eb3a6247">_classes</a>, packet_size_rate_strings.back());
<a name="l00181"></a>00181     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; <a class="code" href="classTrafficManager.html#a9394ae83257275a40a9e1b62eb3a6247">_classes</a>; ++c) {
<a name="l00182"></a>00182       vector&lt;int&gt; rates = <a class="code" href="_2config__utils_8cpp.html#aacbfc12ac81c2e4a60c3e8b2b450fe85">tokenize_int</a>(packet_size_rate_strings[c]);
<a name="l00183"></a>00183       rates.resize(<a class="code" href="classTrafficManager.html#a9d132f9f6e9ea03ab7d4234091ea7f56">_packet_size</a>[c].size(), rates.back());
<a name="l00184"></a>00184       <a class="code" href="classTrafficManager.html#acbd94dd6163520a2468dfd4ad079170a">_packet_size_rate</a>.push_back(rates);
<a name="l00185"></a>00185       <span class="keywordtype">int</span> size = rates.size();
<a name="l00186"></a>00186       <span class="keywordtype">int</span> max_val = -1;
<a name="l00187"></a>00187       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; size; ++i) {
<a name="l00188"></a>00188         <span class="keywordtype">int</span> rate = rates[i];
<a name="l00189"></a>00189         assert(rate &gt;= 0);
<a name="l00190"></a>00190         max_val += rate;
<a name="l00191"></a>00191       }
<a name="l00192"></a>00192       <a class="code" href="classTrafficManager.html#ab6e4665632db77e8239371b38d06cb50">_packet_size_max_val</a>.push_back(max_val);
<a name="l00193"></a>00193     }
<a name="l00194"></a>00194   }
<a name="l00195"></a>00195   
<a name="l00196"></a>00196   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; <a class="code" href="classTrafficManager.html#a9394ae83257275a40a9e1b62eb3a6247">_classes</a>; ++c) {
<a name="l00197"></a>00197     <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#adfe9e24ec927025a9f94e55cba8516f5">_use_read_write</a>[c]) {
<a name="l00198"></a>00198       <a class="code" href="classTrafficManager.html#a9d132f9f6e9ea03ab7d4234091ea7f56">_packet_size</a>[c] =
<a name="l00199"></a>00199       vector&lt;int&gt;(1, (<a class="code" href="classTrafficManager.html#a87535b1fdae24ddd88e7806c591cd124">_read_request_size</a>[c] + <a class="code" href="classTrafficManager.html#a9666144e4145b07dd1a1c48d77eadb65">_read_reply_size</a>[c] +
<a name="l00200"></a>00200                       <a class="code" href="classTrafficManager.html#a08692b9e9fc3303cf35b9d4a7ea92370">_write_request_size</a>[c] + <a class="code" href="classTrafficManager.html#a26e3fea3ea43158bc6488e84393ff7db">_write_reply_size</a>[c]) / 2);
<a name="l00201"></a>00201       <a class="code" href="classTrafficManager.html#acbd94dd6163520a2468dfd4ad079170a">_packet_size_rate</a>[c] = vector&lt;int&gt;(1, 1);
<a name="l00202"></a>00202       <a class="code" href="classTrafficManager.html#ab6e4665632db77e8239371b38d06cb50">_packet_size_max_val</a>[c] = 0;
<a name="l00203"></a>00203     }
<a name="l00204"></a>00204   }
<a name="l00205"></a>00205   
<a name="l00206"></a>00206   <a class="code" href="classTrafficManager.html#aab883f710d03a1953c45b4ee1431aa80">_load</a> = config.<a class="code" href="classConfiguration.html#a51ee53209497969ee8d7257808efc270">GetFloatArray</a>(<span class="stringliteral">&quot;injection_rate&quot;</span>);
<a name="l00207"></a>00207   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#aab883f710d03a1953c45b4ee1431aa80">_load</a>.empty()) {
<a name="l00208"></a>00208     <a class="code" href="classTrafficManager.html#aab883f710d03a1953c45b4ee1431aa80">_load</a>.push_back(config.<a class="code" href="classConfiguration.html#a028a68a59c43784e632c834182af6a10">GetFloat</a>(<span class="stringliteral">&quot;injection_rate&quot;</span>));
<a name="l00209"></a>00209   }
<a name="l00210"></a>00210   <a class="code" href="classTrafficManager.html#aab883f710d03a1953c45b4ee1431aa80">_load</a>.resize(_classes, <a class="code" href="classTrafficManager.html#aab883f710d03a1953c45b4ee1431aa80">_load</a>.back());
<a name="l00211"></a>00211   
<a name="l00212"></a>00212   <span class="keywordflow">if</span>(config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;injection_rate_uses_flits&quot;</span>)) {
<a name="l00213"></a>00213     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; _classes; ++c)
<a name="l00214"></a>00214       <a class="code" href="classTrafficManager.html#aab883f710d03a1953c45b4ee1431aa80">_load</a>[c] /= <a class="code" href="classTrafficManager.html#a2606fffee4f6e888b8e7430200cf8a6d">_GetAveragePacketSize</a>(c);
<a name="l00215"></a>00215   }
<a name="l00216"></a>00216   
<a name="l00217"></a>00217   <a class="code" href="classTrafficManager.html#a1394f9957be48b86a2044d417c71e90e">_traffic</a> = config.<a class="code" href="classConfiguration.html#a0eec544bad026c0e161aa14eb867cae7">GetStrArray</a>(<span class="stringliteral">&quot;traffic&quot;</span>);
<a name="l00218"></a>00218   <a class="code" href="classTrafficManager.html#a1394f9957be48b86a2044d417c71e90e">_traffic</a>.resize(_classes, <a class="code" href="classTrafficManager.html#a1394f9957be48b86a2044d417c71e90e">_traffic</a>.back());
<a name="l00219"></a>00219   
<a name="l00220"></a>00220   <a class="code" href="classTrafficManager.html#a1f48f17401865b83fc5eefd4b5a34fca">_traffic_pattern</a>.resize(_classes);
<a name="l00221"></a>00221   
<a name="l00222"></a>00222   <a class="code" href="classTrafficManager.html#a4320e8a49ac25608ddaca297a99d8459">_class_priority</a> = config.<a class="code" href="classConfiguration.html#af10fd5d25270cdf2108aa67b40e84de3">GetIntArray</a>(<span class="stringliteral">&quot;class_priority&quot;</span>);
<a name="l00223"></a>00223   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a4320e8a49ac25608ddaca297a99d8459">_class_priority</a>.empty()) {
<a name="l00224"></a>00224     <a class="code" href="classTrafficManager.html#a4320e8a49ac25608ddaca297a99d8459">_class_priority</a>.push_back(config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;class_priority&quot;</span>));
<a name="l00225"></a>00225   }
<a name="l00226"></a>00226   <a class="code" href="classTrafficManager.html#a4320e8a49ac25608ddaca297a99d8459">_class_priority</a>.resize(_classes, <a class="code" href="classTrafficManager.html#a4320e8a49ac25608ddaca297a99d8459">_class_priority</a>.back());
<a name="l00227"></a>00227   
<a name="l00228"></a>00228   vector&lt;string&gt; injection_process = config.<a class="code" href="classConfiguration.html#a0eec544bad026c0e161aa14eb867cae7">GetStrArray</a>(<span class="stringliteral">&quot;injection_process&quot;</span>);
<a name="l00229"></a>00229   injection_process.resize(_classes, injection_process.back());
<a name="l00230"></a>00230   
<a name="l00231"></a>00231   <a class="code" href="classTrafficManager.html#a11776bff2e03ae2b4294c3d11e6b6406">_injection_process</a>.resize(_classes);
<a name="l00232"></a>00232   
<a name="l00233"></a>00233   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; _classes; ++c) {
<a name="l00234"></a>00234     <a class="code" href="classTrafficManager.html#a1f48f17401865b83fc5eefd4b5a34fca">_traffic_pattern</a>[c] = <a class="code" href="classTrafficManager.html#ae5023ac53f1deb85540abe79a174db26">TrafficPattern::New</a>(<a class="code" href="classTrafficManager.html#a1394f9957be48b86a2044d417c71e90e">_traffic</a>[c], <a class="code" href="classTrafficManager.html#a61ed65da53f0d0dac14cdf619e2d95af">_nodes</a>, &amp;config);
<a name="l00235"></a>00235     <a class="code" href="classTrafficManager.html#a11776bff2e03ae2b4294c3d11e6b6406">_injection_process</a>[c] = <a class="code" href="classTrafficManager.html#ae5023ac53f1deb85540abe79a174db26">InjectionProcess::New</a>(injection_process[c], <a class="code" href="classTrafficManager.html#a61ed65da53f0d0dac14cdf619e2d95af">_nodes</a>, <a class="code" href="classTrafficManager.html#aab883f710d03a1953c45b4ee1431aa80">_load</a>[c], &amp;config);
<a name="l00236"></a>00236   }
<a name="l00237"></a>00237   
<a name="l00238"></a>00238   <span class="comment">// ============ Injection VC states  ============</span>
<a name="l00239"></a>00239   
<a name="l00240"></a>00240   <a class="code" href="classTrafficManager.html#a26909b743654d9b10f7aedd16421506c">_buf_states</a>.resize(<a class="code" href="classTrafficManager.html#a61ed65da53f0d0dac14cdf619e2d95af">_nodes</a>);
<a name="l00241"></a>00241   <a class="code" href="classTrafficManager.html#aa7d75937add38ae15463b43499993725">_last_vc</a>.resize(<a class="code" href="classTrafficManager.html#a61ed65da53f0d0dac14cdf619e2d95af">_nodes</a>);
<a name="l00242"></a>00242   <a class="code" href="classTrafficManager.html#a6105ccff8bfd383dea19a3f8403e263f">_last_class</a>.resize(<a class="code" href="classTrafficManager.html#a61ed65da53f0d0dac14cdf619e2d95af">_nodes</a>);
<a name="l00243"></a>00243   
<a name="l00244"></a>00244   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> source = 0; source &lt; <a class="code" href="classTrafficManager.html#a61ed65da53f0d0dac14cdf619e2d95af">_nodes</a>; ++source ) {
<a name="l00245"></a>00245     <a class="code" href="classTrafficManager.html#a26909b743654d9b10f7aedd16421506c">_buf_states</a>[source].resize(<a class="code" href="classTrafficManager.html#adf0cc5d3d2377007a9471f73b1cf137a">_subnets</a>);
<a name="l00246"></a>00246     <a class="code" href="classTrafficManager.html#a6105ccff8bfd383dea19a3f8403e263f">_last_class</a>[source].resize(<a class="code" href="classTrafficManager.html#adf0cc5d3d2377007a9471f73b1cf137a">_subnets</a>, 0);
<a name="l00247"></a>00247     <a class="code" href="classTrafficManager.html#aa7d75937add38ae15463b43499993725">_last_vc</a>[source].resize(<a class="code" href="classTrafficManager.html#adf0cc5d3d2377007a9471f73b1cf137a">_subnets</a>);
<a name="l00248"></a>00248     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> subnet = 0; subnet &lt; <a class="code" href="classTrafficManager.html#adf0cc5d3d2377007a9471f73b1cf137a">_subnets</a>; ++subnet ) {
<a name="l00249"></a>00249       ostringstream tmp_name;
<a name="l00250"></a>00250       tmp_name &lt;&lt; <span class="stringliteral">&quot;terminal_buf_state_&quot;</span> &lt;&lt; source &lt;&lt; <span class="stringliteral">&quot;_&quot;</span> &lt;&lt; subnet;
<a name="l00251"></a>00251       <a class="code" href="classBufferState.html">BufferState</a> * bs = <span class="keyword">new</span> <a class="code" href="classBufferState.html">BufferState</a>( config, <span class="keyword">this</span>, tmp_name.str( ) );
<a name="l00252"></a>00252       <span class="keywordtype">int</span> vc_alloc_delay = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;vc_alloc_delay&quot;</span>);
<a name="l00253"></a>00253       <span class="keywordtype">int</span> sw_alloc_delay = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;sw_alloc_delay&quot;</span>);
<a name="l00254"></a>00254       <span class="keywordtype">int</span> router_latency = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;routing_delay&quot;</span>) + (config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;speculative&quot;</span>) ? max(vc_alloc_delay, sw_alloc_delay) : (vc_alloc_delay + sw_alloc_delay));
<a name="l00255"></a>00255       <span class="keywordtype">int</span> min_latency = 1 + <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#a3a1288b1369386753eccb1e00dbf8661">GetInject</a>(source)-&gt;GetLatency() + router_latency + <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#a64f704dfd093a456196704df166d160f">GetInjectCred</a>(source)-&gt;GetLatency();
<a name="l00256"></a>00256       bs-&gt;<a class="code" href="classBufferState.html#a57c8d4bba1f5bbffb9779050fb23c4ea">SetMinLatency</a>(min_latency);
<a name="l00257"></a>00257       <a class="code" href="classTrafficManager.html#a26909b743654d9b10f7aedd16421506c">_buf_states</a>[source][subnet] = bs;
<a name="l00258"></a>00258       <a class="code" href="classTrafficManager.html#aa7d75937add38ae15463b43499993725">_last_vc</a>[source][subnet].resize(_classes, -1);
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260   }
<a name="l00261"></a>00261   
<a name="l00262"></a>00262 <span class="preprocessor">#ifdef TRACK_FLOWS</span>
<a name="l00263"></a>00263 <span class="preprocessor"></span>  <a class="code" href="classTrafficManager.html#a5d2d639d839c07d750bc632b85a304c6">_outstanding_credits</a>.resize(_classes);
<a name="l00264"></a>00264   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; _classes; ++c) {
<a name="l00265"></a>00265     <a class="code" href="classTrafficManager.html#a5d2d639d839c07d750bc632b85a304c6">_outstanding_credits</a>[c].resize(<a class="code" href="classTrafficManager.html#adf0cc5d3d2377007a9471f73b1cf137a">_subnets</a>, vector&lt;int&gt;(_nodes, 0));
<a name="l00266"></a>00266   }
<a name="l00267"></a>00267   <a class="code" href="classTrafficManager.html#a35866d4b27b9edc686f0e94d3810c8ee">_outstanding_classes</a>.resize(_nodes);
<a name="l00268"></a>00268   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> = 0; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt; _nodes; ++<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) {
<a name="l00269"></a>00269     <a class="code" href="classTrafficManager.html#a35866d4b27b9edc686f0e94d3810c8ee">_outstanding_classes</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>].resize(<a class="code" href="classTrafficManager.html#adf0cc5d3d2377007a9471f73b1cf137a">_subnets</a>, vector&lt;queue&lt;int&gt; &gt;(<a class="code" href="classTrafficManager.html#a4db1e48f0a35866bfc680c1544363511">_vcs</a>));
<a name="l00270"></a>00270   }
<a name="l00271"></a>00271 <span class="preprocessor">#endif</span>
<a name="l00272"></a>00272 <span class="preprocessor"></span>  
<a name="l00273"></a>00273   <span class="comment">// ============ Injection queues ============</span>
<a name="l00274"></a>00274   
<a name="l00275"></a>00275   <a class="code" href="classTrafficManager.html#af4ee79a64ee0255447003b93fd9641e7">_qtime</a>.resize(_nodes);
<a name="l00276"></a>00276   <a class="code" href="classTrafficManager.html#a459f440795a908884f21277f0760d9e5">_qdrained</a>.resize(_nodes);
<a name="l00277"></a>00277   <a class="code" href="classTrafficManager.html#a874d663095760b20ec91b9884201c1ac">_partial_packets</a>.resize(_nodes);
<a name="l00278"></a>00278   
<a name="l00279"></a>00279   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> s = 0; s &lt; _nodes; ++s ) {
<a name="l00280"></a>00280     <a class="code" href="classTrafficManager.html#af4ee79a64ee0255447003b93fd9641e7">_qtime</a>[s].resize(_classes);
<a name="l00281"></a>00281     <a class="code" href="classTrafficManager.html#a459f440795a908884f21277f0760d9e5">_qdrained</a>[s].resize(_classes);
<a name="l00282"></a>00282     <a class="code" href="classTrafficManager.html#a874d663095760b20ec91b9884201c1ac">_partial_packets</a>[s].resize(_classes);
<a name="l00283"></a>00283   }
<a name="l00284"></a>00284   
<a name="l00285"></a>00285   <a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>.resize(_classes);
<a name="l00286"></a>00286   <a class="code" href="classTrafficManager.html#ab3f440b8929d778298a078fff4fe492f">_measured_in_flight_flits</a>.resize(_classes);
<a name="l00287"></a>00287   <a class="code" href="classTrafficManager.html#a66c40be042f5d5b3e5a35a441e4e4e60">_retired_packets</a>.resize(_classes);
<a name="l00288"></a>00288   
<a name="l00289"></a>00289   <a class="code" href="classTrafficManager.html#a4eabe4de474fc72131dd443509f364b8">_packet_seq_no</a>.resize(_nodes);
<a name="l00290"></a>00290   <a class="code" href="classTrafficManager.html#ae50acf81b3471ea19042d408d8c326db">_repliesPending</a>.resize(_nodes);
<a name="l00291"></a>00291   <a class="code" href="classTrafficManager.html#a1f014156c3e0c4d7531e3ec9f5204dc0">_requestsOutstanding</a>.resize(_nodes);
<a name="l00292"></a>00292   
<a name="l00293"></a>00293   <a class="code" href="classTrafficManager.html#a0310eaec5c862d3be54fa4987fdc1601">_hold_switch_for_packet</a> = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;hold_switch_for_packet&quot;</span>);
<a name="l00294"></a>00294   
<a name="l00295"></a>00295   <span class="comment">// ============ Simulation parameters ============</span>
<a name="l00296"></a>00296   
<a name="l00297"></a>00297   <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>( <span class="stringliteral">&quot;sim_count&quot;</span> );
<a name="l00298"></a>00298   
<a name="l00299"></a>00299   <a class="code" href="classTrafficManager.html#a4c45c20f60c464ef56243c16ec3a1681">_router</a>.resize(<a class="code" href="classTrafficManager.html#adf0cc5d3d2377007a9471f73b1cf137a">_subnets</a>);
<a name="l00300"></a>00300   <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0; i &lt; <a class="code" href="classTrafficManager.html#adf0cc5d3d2377007a9471f73b1cf137a">_subnets</a>; ++i) {
<a name="l00301"></a>00301     <a class="code" href="classTrafficManager.html#a4c45c20f60c464ef56243c16ec3a1681">_router</a>[i] = <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[i]-&gt;<a class="code" href="classNetwork.html#a44acfe99474aa2b555d33ab92821d8a2">GetRouters</a>();
<a name="l00302"></a>00302   }
<a name="l00303"></a>00303   
<a name="l00304"></a>00304   <span class="comment">//seed the network</span>
<a name="l00305"></a>00305   <a class="code" href="random__utils_8cpp.html#a1e2af25b6c71f0088af42078ca4cb006">RandomSeed</a>(config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;seed&quot;</span>));
<a name="l00306"></a>00306   
<a name="l00307"></a>00307   <a class="code" href="classTrafficManager.html#a8f2e82426a52fd9851be463915f256d7">_measure_latency</a> = (config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>(<span class="stringliteral">&quot;sim_type&quot;</span>) == <span class="stringliteral">&quot;latency&quot;</span>);
<a name="l00308"></a>00308   
<a name="l00309"></a>00309   <a class="code" href="classTrafficManager.html#a798efdfb2596e9248a88c1b294765aac">_sample_period</a> = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>( <span class="stringliteral">&quot;sample_period&quot;</span> );
<a name="l00310"></a>00310   <a class="code" href="classTrafficManager.html#ac8c1fb9e1e1ee41800ff75970ba20771">_max_samples</a>    = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>( <span class="stringliteral">&quot;max_samples&quot;</span> );
<a name="l00311"></a>00311   <a class="code" href="classTrafficManager.html#a522056dd2a33feaffe12f013eb5409d7">_warmup_periods</a> = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>( <span class="stringliteral">&quot;warmup_periods&quot;</span> );
<a name="l00312"></a>00312   
<a name="l00313"></a>00313   <a class="code" href="classTrafficManager.html#a549fe0af403657daf47db078f7f1814a">_measure_stats</a> = config.<a class="code" href="classConfiguration.html#af10fd5d25270cdf2108aa67b40e84de3">GetIntArray</a>( <span class="stringliteral">&quot;measure_stats&quot;</span> );
<a name="l00314"></a>00314   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a549fe0af403657daf47db078f7f1814a">_measure_stats</a>.empty()) {
<a name="l00315"></a>00315     <a class="code" href="classTrafficManager.html#a549fe0af403657daf47db078f7f1814a">_measure_stats</a>.push_back(config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;measure_stats&quot;</span>));
<a name="l00316"></a>00316   }
<a name="l00317"></a>00317   <a class="code" href="classTrafficManager.html#a549fe0af403657daf47db078f7f1814a">_measure_stats</a>.resize(_classes, <a class="code" href="classTrafficManager.html#a549fe0af403657daf47db078f7f1814a">_measure_stats</a>.back());
<a name="l00318"></a>00318   <a class="code" href="classTrafficManager.html#adf6295f17ea12f4e88790d2debdbc4d5">_pair_stats</a> = (config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>(<span class="stringliteral">&quot;pair_stats&quot;</span>)==1);
<a name="l00319"></a>00319   
<a name="l00320"></a>00320   <a class="code" href="classTrafficManager.html#aeb1705809e2804d8889c651d8a96a108">_latency_thres</a> = config.<a class="code" href="classConfiguration.html#a51ee53209497969ee8d7257808efc270">GetFloatArray</a>( <span class="stringliteral">&quot;latency_thres&quot;</span> );
<a name="l00321"></a>00321   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#aeb1705809e2804d8889c651d8a96a108">_latency_thres</a>.empty()) {
<a name="l00322"></a>00322     <a class="code" href="classTrafficManager.html#aeb1705809e2804d8889c651d8a96a108">_latency_thres</a>.push_back(config.<a class="code" href="classConfiguration.html#a028a68a59c43784e632c834182af6a10">GetFloat</a>(<span class="stringliteral">&quot;latency_thres&quot;</span>));
<a name="l00323"></a>00323   }
<a name="l00324"></a>00324   <a class="code" href="classTrafficManager.html#aeb1705809e2804d8889c651d8a96a108">_latency_thres</a>.resize(_classes, <a class="code" href="classTrafficManager.html#aeb1705809e2804d8889c651d8a96a108">_latency_thres</a>.back());
<a name="l00325"></a>00325   
<a name="l00326"></a>00326   <a class="code" href="classTrafficManager.html#a17552f4911c07e3de3846692e119d7c8">_warmup_threshold</a> = config.<a class="code" href="classConfiguration.html#a51ee53209497969ee8d7257808efc270">GetFloatArray</a>( <span class="stringliteral">&quot;warmup_thres&quot;</span> );
<a name="l00327"></a>00327   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a17552f4911c07e3de3846692e119d7c8">_warmup_threshold</a>.empty()) {
<a name="l00328"></a>00328     <a class="code" href="classTrafficManager.html#a17552f4911c07e3de3846692e119d7c8">_warmup_threshold</a>.push_back(config.<a class="code" href="classConfiguration.html#a028a68a59c43784e632c834182af6a10">GetFloat</a>(<span class="stringliteral">&quot;warmup_thres&quot;</span>));
<a name="l00329"></a>00329   }
<a name="l00330"></a>00330   <a class="code" href="classTrafficManager.html#a17552f4911c07e3de3846692e119d7c8">_warmup_threshold</a>.resize(_classes, <a class="code" href="classTrafficManager.html#a17552f4911c07e3de3846692e119d7c8">_warmup_threshold</a>.back());
<a name="l00331"></a>00331   
<a name="l00332"></a>00332   <a class="code" href="classTrafficManager.html#aeb82484af539d2c614a772100894b181">_acc_warmup_threshold</a> = config.<a class="code" href="classConfiguration.html#a51ee53209497969ee8d7257808efc270">GetFloatArray</a>( <span class="stringliteral">&quot;acc_warmup_thres&quot;</span> );
<a name="l00333"></a>00333   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#aeb82484af539d2c614a772100894b181">_acc_warmup_threshold</a>.empty()) {
<a name="l00334"></a>00334     <a class="code" href="classTrafficManager.html#aeb82484af539d2c614a772100894b181">_acc_warmup_threshold</a>.push_back(config.<a class="code" href="classConfiguration.html#a028a68a59c43784e632c834182af6a10">GetFloat</a>(<span class="stringliteral">&quot;acc_warmup_thres&quot;</span>));
<a name="l00335"></a>00335   }
<a name="l00336"></a>00336   <a class="code" href="classTrafficManager.html#aeb82484af539d2c614a772100894b181">_acc_warmup_threshold</a>.resize(_classes, <a class="code" href="classTrafficManager.html#aeb82484af539d2c614a772100894b181">_acc_warmup_threshold</a>.back());
<a name="l00337"></a>00337   
<a name="l00338"></a>00338   <a class="code" href="classTrafficManager.html#abf5b4d9b9d5cbf5004c49a2dc2fedb49">_stopping_threshold</a> = config.<a class="code" href="classConfiguration.html#a51ee53209497969ee8d7257808efc270">GetFloatArray</a>( <span class="stringliteral">&quot;stopping_thres&quot;</span> );
<a name="l00339"></a>00339   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#abf5b4d9b9d5cbf5004c49a2dc2fedb49">_stopping_threshold</a>.empty()) {
<a name="l00340"></a>00340     <a class="code" href="classTrafficManager.html#abf5b4d9b9d5cbf5004c49a2dc2fedb49">_stopping_threshold</a>.push_back(config.<a class="code" href="classConfiguration.html#a028a68a59c43784e632c834182af6a10">GetFloat</a>(<span class="stringliteral">&quot;stopping_thres&quot;</span>));
<a name="l00341"></a>00341   }
<a name="l00342"></a>00342   <a class="code" href="classTrafficManager.html#abf5b4d9b9d5cbf5004c49a2dc2fedb49">_stopping_threshold</a>.resize(_classes, <a class="code" href="classTrafficManager.html#abf5b4d9b9d5cbf5004c49a2dc2fedb49">_stopping_threshold</a>.back());
<a name="l00343"></a>00343   
<a name="l00344"></a>00344   <a class="code" href="classTrafficManager.html#ab738f4d5fdf15019f48b657202b51621">_acc_stopping_threshold</a> = config.<a class="code" href="classConfiguration.html#a51ee53209497969ee8d7257808efc270">GetFloatArray</a>( <span class="stringliteral">&quot;acc_stopping_thres&quot;</span> );
<a name="l00345"></a>00345   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#ab738f4d5fdf15019f48b657202b51621">_acc_stopping_threshold</a>.empty()) {
<a name="l00346"></a>00346     <a class="code" href="classTrafficManager.html#ab738f4d5fdf15019f48b657202b51621">_acc_stopping_threshold</a>.push_back(config.<a class="code" href="classConfiguration.html#a028a68a59c43784e632c834182af6a10">GetFloat</a>(<span class="stringliteral">&quot;acc_stopping_thres&quot;</span>));
<a name="l00347"></a>00347   }
<a name="l00348"></a>00348   <a class="code" href="classTrafficManager.html#ab738f4d5fdf15019f48b657202b51621">_acc_stopping_threshold</a>.resize(_classes, <a class="code" href="classTrafficManager.html#ab738f4d5fdf15019f48b657202b51621">_acc_stopping_threshold</a>.back());
<a name="l00349"></a>00349   
<a name="l00350"></a>00350   <a class="code" href="classTrafficManager.html#ad7de992687def7c090f4b96943094e3d">_include_queuing</a> = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>( <span class="stringliteral">&quot;include_queuing&quot;</span> );
<a name="l00351"></a>00351   
<a name="l00352"></a>00352   <a class="code" href="classTrafficManager.html#a02dae2988f6fc6d263911561b7138216">_print_csv_results</a> = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>( <span class="stringliteral">&quot;print_csv_results&quot;</span> );
<a name="l00353"></a>00353   <a class="code" href="classTrafficManager.html#af80003752f7d8fceb5e542fc86bc56c8">_deadlock_warn_timeout</a> = config.<a class="code" href="classConfiguration.html#a924090a06ca73bc53ed73c5f4f2cae27">GetInt</a>( <span class="stringliteral">&quot;deadlock_warn_timeout&quot;</span> );
<a name="l00354"></a>00354   
<a name="l00355"></a>00355   <span class="keywordtype">string</span> watch_file = config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>( <span class="stringliteral">&quot;watch_file&quot;</span> );
<a name="l00356"></a>00356   <span class="keywordflow">if</span>((watch_file != <span class="stringliteral">&quot;&quot;</span>) &amp;&amp; (watch_file != <span class="stringliteral">&quot;-&quot;</span>)) {
<a name="l00357"></a>00357     <a class="code" href="classTrafficManager.html#a33718f55e04cc389a7a28f1f2261b923">_LoadWatchList</a>(watch_file);
<a name="l00358"></a>00358   }
<a name="l00359"></a>00359   
<a name="l00360"></a>00360   vector&lt;int&gt; watch_flits = config.<a class="code" href="classConfiguration.html#af10fd5d25270cdf2108aa67b40e84de3">GetIntArray</a>(<span class="stringliteral">&quot;watch_flits&quot;</span>);
<a name="l00361"></a>00361   <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; watch_flits.size(); ++i) {
<a name="l00362"></a>00362     <a class="code" href="classTrafficManager.html#a58a8ea82d95bf82f0309d5f9ecda2e34">_flits_to_watch</a>.insert(watch_flits[i]);
<a name="l00363"></a>00363   }
<a name="l00364"></a>00364   
<a name="l00365"></a>00365   vector&lt;int&gt; watch_packets = config.<a class="code" href="classConfiguration.html#af10fd5d25270cdf2108aa67b40e84de3">GetIntArray</a>(<span class="stringliteral">&quot;watch_packets&quot;</span>);
<a name="l00366"></a>00366   <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; watch_packets.size(); ++i) {
<a name="l00367"></a>00367     <a class="code" href="classTrafficManager.html#af31f34fb4c338c9e27864d44f3abf3ea">_packets_to_watch</a>.insert(watch_packets[i]);
<a name="l00368"></a>00368   }
<a name="l00369"></a>00369   
<a name="l00370"></a>00370   <span class="keywordtype">string</span> stats_out_file = config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>( <span class="stringliteral">&quot;stats_out&quot;</span> );
<a name="l00371"></a>00371   <span class="keywordflow">if</span>(stats_out_file == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00372"></a>00372     <a class="code" href="classTrafficManager.html#abf955f7ff7445e6daa441ea4b7f635c9">_stats_out</a> = NULL;
<a name="l00373"></a>00373   } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(stats_out_file == <span class="stringliteral">&quot;-&quot;</span>) {
<a name="l00374"></a>00374     <a class="code" href="classTrafficManager.html#abf955f7ff7445e6daa441ea4b7f635c9">_stats_out</a> = &amp;cout;
<a name="l00375"></a>00375   } <span class="keywordflow">else</span> {
<a name="l00376"></a>00376     <a class="code" href="classTrafficManager.html#abf955f7ff7445e6daa441ea4b7f635c9">_stats_out</a> = <span class="keyword">new</span> ofstream(stats_out_file.c_str());
<a name="l00377"></a>00377     config.<a class="code" href="classConfiguration.html#a96a7cf206cd43c5743460521fd8b8748">WriteMatlabFile</a>(<a class="code" href="classTrafficManager.html#abf955f7ff7445e6daa441ea4b7f635c9">_stats_out</a>);
<a name="l00378"></a>00378   }
<a name="l00379"></a>00379   
<a name="l00380"></a>00380 <span class="preprocessor">#ifdef TRACK_FLOWS</span>
<a name="l00381"></a>00381 <span class="preprocessor"></span>  <a class="code" href="classTrafficManager.html#ab399ac65874834ae1ad6ce99939dfbea">_injected_flits</a>.resize(_classes, vector&lt;int&gt;(_nodes, 0));
<a name="l00382"></a>00382   <a class="code" href="classTrafficManager.html#a5750805ce26dfd96ae787a67886705e3">_ejected_flits</a>.resize(_classes, vector&lt;int&gt;(_nodes, 0));
<a name="l00383"></a>00383   <span class="keywordtype">string</span> injected_flits_out_file = config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>( <span class="stringliteral">&quot;injected_flits_out&quot;</span> );
<a name="l00384"></a>00384   <span class="keywordflow">if</span>(injected_flits_out_file == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00385"></a>00385     <a class="code" href="classTrafficManager.html#a60e297ef653cf18c18b59dd8903ada5e">_injected_flits_out</a> = NULL;
<a name="l00386"></a>00386   } <span class="keywordflow">else</span> {
<a name="l00387"></a>00387     <a class="code" href="classTrafficManager.html#a60e297ef653cf18c18b59dd8903ada5e">_injected_flits_out</a> = <span class="keyword">new</span> ofstream(injected_flits_out_file.c_str());
<a name="l00388"></a>00388   }
<a name="l00389"></a>00389   <span class="keywordtype">string</span> received_flits_out_file = config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>( <span class="stringliteral">&quot;received_flits_out&quot;</span> );
<a name="l00390"></a>00390   <span class="keywordflow">if</span>(received_flits_out_file == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00391"></a>00391     <a class="code" href="classTrafficManager.html#a19cc011b7cd07169ed7940898815d3ff">_received_flits_out</a> = NULL;
<a name="l00392"></a>00392   } <span class="keywordflow">else</span> {
<a name="l00393"></a>00393     <a class="code" href="classTrafficManager.html#a19cc011b7cd07169ed7940898815d3ff">_received_flits_out</a> = <span class="keyword">new</span> ofstream(received_flits_out_file.c_str());
<a name="l00394"></a>00394   }
<a name="l00395"></a>00395   <span class="keywordtype">string</span> stored_flits_out_file = config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>( <span class="stringliteral">&quot;stored_flits_out&quot;</span> );
<a name="l00396"></a>00396   <span class="keywordflow">if</span>(stored_flits_out_file == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00397"></a>00397     <a class="code" href="classTrafficManager.html#ac95b0e32d233d93d649e8491e770bd19">_stored_flits_out</a> = NULL;
<a name="l00398"></a>00398   } <span class="keywordflow">else</span> {
<a name="l00399"></a>00399     <a class="code" href="classTrafficManager.html#ac95b0e32d233d93d649e8491e770bd19">_stored_flits_out</a> = <span class="keyword">new</span> ofstream(stored_flits_out_file.c_str());
<a name="l00400"></a>00400   }
<a name="l00401"></a>00401   <span class="keywordtype">string</span> sent_flits_out_file = config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>( <span class="stringliteral">&quot;sent_flits_out&quot;</span> );
<a name="l00402"></a>00402   <span class="keywordflow">if</span>(sent_flits_out_file == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00403"></a>00403     <a class="code" href="classTrafficManager.html#a05f3fac882e7f60a9ed0d73e227caae4">_sent_flits_out</a> = NULL;
<a name="l00404"></a>00404   } <span class="keywordflow">else</span> {
<a name="l00405"></a>00405     <a class="code" href="classTrafficManager.html#a05f3fac882e7f60a9ed0d73e227caae4">_sent_flits_out</a> = <span class="keyword">new</span> ofstream(sent_flits_out_file.c_str());
<a name="l00406"></a>00406   }
<a name="l00407"></a>00407   <span class="keywordtype">string</span> outstanding_credits_out_file = config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>( <span class="stringliteral">&quot;outstanding_credits_out&quot;</span> );
<a name="l00408"></a>00408   <span class="keywordflow">if</span>(outstanding_credits_out_file == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00409"></a>00409     <a class="code" href="classTrafficManager.html#a02bf243c1a00b188df58b2aac299530a">_outstanding_credits_out</a> = NULL;
<a name="l00410"></a>00410   } <span class="keywordflow">else</span> {
<a name="l00411"></a>00411     <a class="code" href="classTrafficManager.html#a02bf243c1a00b188df58b2aac299530a">_outstanding_credits_out</a> = <span class="keyword">new</span> ofstream(outstanding_credits_out_file.c_str());
<a name="l00412"></a>00412   }
<a name="l00413"></a>00413   <span class="keywordtype">string</span> ejected_flits_out_file = config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>( <span class="stringliteral">&quot;ejected_flits_out&quot;</span> );
<a name="l00414"></a>00414   <span class="keywordflow">if</span>(ejected_flits_out_file == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00415"></a>00415     <a class="code" href="classTrafficManager.html#a1f9bb8ef5f9553a1e5417acddd18159f">_ejected_flits_out</a> = NULL;
<a name="l00416"></a>00416   } <span class="keywordflow">else</span> {
<a name="l00417"></a>00417     <a class="code" href="classTrafficManager.html#a1f9bb8ef5f9553a1e5417acddd18159f">_ejected_flits_out</a> = <span class="keyword">new</span> ofstream(ejected_flits_out_file.c_str());
<a name="l00418"></a>00418   }
<a name="l00419"></a>00419   <span class="keywordtype">string</span> active_packets_out_file = config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>( <span class="stringliteral">&quot;active_packets_out&quot;</span> );
<a name="l00420"></a>00420   <span class="keywordflow">if</span>(active_packets_out_file == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00421"></a>00421     <a class="code" href="classTrafficManager.html#a4f7eea17545e1fd80ba48ba9ca8a2fb7">_active_packets_out</a> = NULL;
<a name="l00422"></a>00422   } <span class="keywordflow">else</span> {
<a name="l00423"></a>00423     <a class="code" href="classTrafficManager.html#a4f7eea17545e1fd80ba48ba9ca8a2fb7">_active_packets_out</a> = <span class="keyword">new</span> ofstream(active_packets_out_file.c_str());
<a name="l00424"></a>00424   }
<a name="l00425"></a>00425 <span class="preprocessor">#endif</span>
<a name="l00426"></a>00426 <span class="preprocessor"></span>  
<a name="l00427"></a>00427 <span class="preprocessor">#ifdef TRACK_CREDITS</span>
<a name="l00428"></a>00428 <span class="preprocessor"></span>  <span class="keywordtype">string</span> used_credits_out_file = config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>( <span class="stringliteral">&quot;used_credits_out&quot;</span> );
<a name="l00429"></a>00429   <span class="keywordflow">if</span>(used_credits_out_file == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00430"></a>00430     <a class="code" href="classTrafficManager.html#ab91032ac7351823fcb7433a7ec815b36">_used_credits_out</a> = NULL;
<a name="l00431"></a>00431   } <span class="keywordflow">else</span> {
<a name="l00432"></a>00432     <a class="code" href="classTrafficManager.html#ab91032ac7351823fcb7433a7ec815b36">_used_credits_out</a> = <span class="keyword">new</span> ofstream(used_credits_out_file.c_str());
<a name="l00433"></a>00433   }
<a name="l00434"></a>00434   <span class="keywordtype">string</span> free_credits_out_file = config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>( <span class="stringliteral">&quot;free_credits_out&quot;</span> );
<a name="l00435"></a>00435   <span class="keywordflow">if</span>(free_credits_out_file == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00436"></a>00436     <a class="code" href="classTrafficManager.html#a0594ee276bbfbb6629e96be8af864ef7">_free_credits_out</a> = NULL;
<a name="l00437"></a>00437   } <span class="keywordflow">else</span> {
<a name="l00438"></a>00438     <a class="code" href="classTrafficManager.html#a0594ee276bbfbb6629e96be8af864ef7">_free_credits_out</a> = <span class="keyword">new</span> ofstream(free_credits_out_file.c_str());
<a name="l00439"></a>00439   }
<a name="l00440"></a>00440   <span class="keywordtype">string</span> max_credits_out_file = config.<a class="code" href="classConfiguration.html#a103c3ea43ae754ac4b0c15a53d86a48a">GetStr</a>( <span class="stringliteral">&quot;max_credits_out&quot;</span> );
<a name="l00441"></a>00441   <span class="keywordflow">if</span>(max_credits_out_file == <span class="stringliteral">&quot;&quot;</span>) {
<a name="l00442"></a>00442     <a class="code" href="classTrafficManager.html#aefd7305f60a0dfea91de3a4678701c69">_max_credits_out</a> = NULL;
<a name="l00443"></a>00443   } <span class="keywordflow">else</span> {
<a name="l00444"></a>00444     <a class="code" href="classTrafficManager.html#aefd7305f60a0dfea91de3a4678701c69">_max_credits_out</a> = <span class="keyword">new</span> ofstream(max_credits_out_file.c_str());
<a name="l00445"></a>00445   }
<a name="l00446"></a>00446 <span class="preprocessor">#endif</span>
<a name="l00447"></a>00447 <span class="preprocessor"></span>  
<a name="l00448"></a>00448   <span class="comment">// ============ Statistics ============</span>
<a name="l00449"></a>00449   
<a name="l00450"></a>00450   <a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>.resize(_classes);
<a name="l00451"></a>00451   <a class="code" href="classTrafficManager.html#a9396b27b8d314aedca6477fe7f03e0fb">_overall_min_plat</a>.resize(_classes, 0.0);
<a name="l00452"></a>00452   <a class="code" href="classTrafficManager.html#a33d2fac8e8898950df680e4026c99ecc">_overall_avg_plat</a>.resize(_classes, 0.0);
<a name="l00453"></a>00453   <a class="code" href="classTrafficManager.html#a26ca4cf3881f84c8d4c737ebe2f3b330">_overall_max_plat</a>.resize(_classes, 0.0);
<a name="l00454"></a>00454   
<a name="l00455"></a>00455   <a class="code" href="classTrafficManager.html#a9180e022d85c6388bfd7e58cbfc10b47">_nlat_stats</a>.resize(_classes);
<a name="l00456"></a>00456   <a class="code" href="classTrafficManager.html#a6a3841f0bd16509994037af9215e5985">_overall_min_nlat</a>.resize(_classes, 0.0);
<a name="l00457"></a>00457   <a class="code" href="classTrafficManager.html#a6265a966369698ffc482fffcb404a8b1">_overall_avg_nlat</a>.resize(_classes, 0.0);
<a name="l00458"></a>00458   <a class="code" href="classTrafficManager.html#a5f6f27514cbe0ae389f2dd51c08af05d">_overall_max_nlat</a>.resize(_classes, 0.0);
<a name="l00459"></a>00459   
<a name="l00460"></a>00460   <a class="code" href="classTrafficManager.html#ab435afa5236277ff8d6a1991860cf546">_flat_stats</a>.resize(_classes);
<a name="l00461"></a>00461   <a class="code" href="classTrafficManager.html#abaaf1b91fdea78eb0c53afa5b3b50709">_overall_min_flat</a>.resize(_classes, 0.0);
<a name="l00462"></a>00462   <a class="code" href="classTrafficManager.html#a6e1a9cc72c637afd54ac3e1aaf38f0ec">_overall_avg_flat</a>.resize(_classes, 0.0);
<a name="l00463"></a>00463   <a class="code" href="classTrafficManager.html#ab28f8c5f823e52c747d9e94a131236a3">_overall_max_flat</a>.resize(_classes, 0.0);
<a name="l00464"></a>00464   
<a name="l00465"></a>00465   <a class="code" href="classTrafficManager.html#a7f160ac254d3ceabd825f1c59f42b179">_frag_stats</a>.resize(_classes);
<a name="l00466"></a>00466   <a class="code" href="classTrafficManager.html#a5716fdc9d88c92bd754b12cd3f90548e">_overall_min_frag</a>.resize(_classes, 0.0);
<a name="l00467"></a>00467   <a class="code" href="classTrafficManager.html#a1f7bd1e0c88c5533db25f21c543171e7">_overall_avg_frag</a>.resize(_classes, 0.0);
<a name="l00468"></a>00468   <a class="code" href="classTrafficManager.html#a2e27b6106049bd42fbcc5175d2a68c15">_overall_max_frag</a>.resize(_classes, 0.0);
<a name="l00469"></a>00469   
<a name="l00470"></a>00470   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#adf6295f17ea12f4e88790d2debdbc4d5">_pair_stats</a>){
<a name="l00471"></a>00471     <a class="code" href="classTrafficManager.html#a4e8c501fc2d871203dc729ecea28b9bd">_pair_plat</a>.resize(_classes);
<a name="l00472"></a>00472     <a class="code" href="classTrafficManager.html#a03c78594e1d4a1145ea27816ef786bde">_pair_nlat</a>.resize(_classes);
<a name="l00473"></a>00473     <a class="code" href="classTrafficManager.html#a353557bf34f140be9b12f9e92c9f4006">_pair_flat</a>.resize(_classes);
<a name="l00474"></a>00474   }
<a name="l00475"></a>00475   
<a name="l00476"></a>00476   <a class="code" href="classTrafficManager.html#ac9385813fa2b42c908cdf532ec9405c6">_hop_stats</a>.resize(_classes);
<a name="l00477"></a>00477   <a class="code" href="classTrafficManager.html#a2a5ad817564086e123c30482e618b161">_overall_hop_stats</a>.resize(_classes, 0.0);
<a name="l00478"></a>00478   
<a name="l00479"></a>00479   <a class="code" href="classTrafficManager.html#a552ccfae3f5aad4c71b188d97614012d">_sent_packets</a>.resize(_classes);
<a name="l00480"></a>00480   <a class="code" href="classTrafficManager.html#aa1346fe8293a7cbb0c8ab377ef91b94a">_overall_min_sent_packets</a>.resize(_classes, 0.0);
<a name="l00481"></a>00481   <a class="code" href="classTrafficManager.html#aa3074d74ad3d6ecc67555b860a63d057">_overall_avg_sent_packets</a>.resize(_classes, 0.0);
<a name="l00482"></a>00482   <a class="code" href="classTrafficManager.html#a08a31f70886b7d439b49e5e34323ffd2">_overall_max_sent_packets</a>.resize(_classes, 0.0);
<a name="l00483"></a>00483   <a class="code" href="classTrafficManager.html#acec4c1294844394b7bf8008f5b920593">_accepted_packets</a>.resize(_classes);
<a name="l00484"></a>00484   <a class="code" href="classTrafficManager.html#aab17754eda186939996cb0f8c4e98ca9">_overall_min_accepted_packets</a>.resize(_classes, 0.0);
<a name="l00485"></a>00485   <a class="code" href="classTrafficManager.html#a685bfa1f07f24455554ba4ac3d23d234">_overall_avg_accepted_packets</a>.resize(_classes, 0.0);
<a name="l00486"></a>00486   <a class="code" href="classTrafficManager.html#a93c1c6bd29b8ce0f1bed4e8d2f11780d">_overall_max_accepted_packets</a>.resize(_classes, 0.0);
<a name="l00487"></a>00487   
<a name="l00488"></a>00488   <a class="code" href="classTrafficManager.html#a62c2881d71bd8a580c008cebf2753012">_sent_flits</a>.resize(_classes);
<a name="l00489"></a>00489   <a class="code" href="classTrafficManager.html#a2bf102d9ea1e22ad0b3f7e3dcfe7e563">_overall_min_sent</a>.resize(_classes, 0.0);
<a name="l00490"></a>00490   <a class="code" href="classTrafficManager.html#abc7df4963565ff43085f5d14efcf65fb">_overall_avg_sent</a>.resize(_classes, 0.0);
<a name="l00491"></a>00491   <a class="code" href="classTrafficManager.html#a4a5abf1deff55a87dc10117bff22e497">_overall_max_sent</a>.resize(_classes, 0.0);
<a name="l00492"></a>00492   <a class="code" href="classTrafficManager.html#a089e444802486d4e5092066d4c357c30">_accepted_flits</a>.resize(_classes);
<a name="l00493"></a>00493   <a class="code" href="classTrafficManager.html#a151b13006c1fef516d5aa42b6d4b6b97">_overall_min_accepted</a>.resize(_classes, 0.0);
<a name="l00494"></a>00494   <a class="code" href="classTrafficManager.html#aa20932dad1291e91a8d52c1bd57aff25">_overall_avg_accepted</a>.resize(_classes, 0.0);
<a name="l00495"></a>00495   <a class="code" href="classTrafficManager.html#aa87d9a9975984c42248559b2794e37b1">_overall_max_accepted</a>.resize(_classes, 0.0);
<a name="l00496"></a>00496   
<a name="l00497"></a>00497 <span class="preprocessor">#ifdef TRACK_STALLS</span>
<a name="l00498"></a>00498 <span class="preprocessor"></span>  <a class="code" href="classTrafficManager.html#a1c784a6d1925a67a090fdcd2d4ea69c1">_buffer_busy_stalls</a>.resize(_classes);
<a name="l00499"></a>00499   <a class="code" href="classTrafficManager.html#ae28ad10bf987f3edaea11411237c2da5">_buffer_conflict_stalls</a>.resize(_classes);
<a name="l00500"></a>00500   <a class="code" href="classTrafficManager.html#a9933b441d6750f35f7622e69c0baa0a0">_buffer_full_stalls</a>.resize(_classes);
<a name="l00501"></a>00501   <a class="code" href="classTrafficManager.html#aa1a62024edeb3fbcbcd12a4c15c75c1c">_buffer_reserved_stalls</a>.resize(_classes);
<a name="l00502"></a>00502   <a class="code" href="classTrafficManager.html#afb85e3761a4ff0c6a9330e6f47ea6314">_crossbar_conflict_stalls</a>.resize(_classes);
<a name="l00503"></a>00503   <a class="code" href="classTrafficManager.html#aa2cb008e7849e88b08017782112b1e25">_overall_buffer_busy_stalls</a>.resize(_classes, 0);
<a name="l00504"></a>00504   <a class="code" href="classTrafficManager.html#ad9052e0ca146f1de2558a8da70304a41">_overall_buffer_conflict_stalls</a>.resize(_classes, 0);
<a name="l00505"></a>00505   <a class="code" href="classTrafficManager.html#ac8157210498782084dcd8ccb070df5b3">_overall_buffer_full_stalls</a>.resize(_classes, 0);
<a name="l00506"></a>00506   <a class="code" href="classTrafficManager.html#ac8aef5fb9a0c62b9feb51e54911d7d21">_overall_buffer_reserved_stalls</a>.resize(_classes, 0);
<a name="l00507"></a>00507   <a class="code" href="classTrafficManager.html#a47397318e8ec5faa031e62696754d6e4">_overall_crossbar_conflict_stalls</a>.resize(_classes, 0);
<a name="l00508"></a>00508 <span class="preprocessor">#endif</span>
<a name="l00509"></a>00509 <span class="preprocessor"></span>  
<a name="l00510"></a>00510   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> c = 0; c &lt; _classes; ++c ) {
<a name="l00511"></a>00511     ostringstream tmp_name;
<a name="l00512"></a>00512     
<a name="l00513"></a>00513     tmp_name &lt;&lt; <span class="stringliteral">&quot;plat_stat_&quot;</span> &lt;&lt; c;
<a name="l00514"></a>00514     <a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[c] = <span class="keyword">new</span> <a class="code" href="classStats.html">Stats</a>( <span class="keyword">this</span>, tmp_name.str( ), 1.0, 1000 );
<a name="l00515"></a>00515     <a class="code" href="classTrafficManager.html#a8f7ceb7ab8fa50716ceb0e01574fc473">_stats</a>[tmp_name.str()] = <a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[c];
<a name="l00516"></a>00516     tmp_name.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00517"></a>00517     
<a name="l00518"></a>00518     tmp_name &lt;&lt; <span class="stringliteral">&quot;nlat_stat_&quot;</span> &lt;&lt; c;
<a name="l00519"></a>00519     <a class="code" href="classTrafficManager.html#a9180e022d85c6388bfd7e58cbfc10b47">_nlat_stats</a>[c] = <span class="keyword">new</span> <a class="code" href="classStats.html">Stats</a>( <span class="keyword">this</span>, tmp_name.str( ), 1.0, 1000 );
<a name="l00520"></a>00520     _stats[tmp_name.str()] = <a class="code" href="classTrafficManager.html#a9180e022d85c6388bfd7e58cbfc10b47">_nlat_stats</a>[c];
<a name="l00521"></a>00521     tmp_name.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00522"></a>00522     
<a name="l00523"></a>00523     tmp_name &lt;&lt; <span class="stringliteral">&quot;flat_stat_&quot;</span> &lt;&lt; c;
<a name="l00524"></a>00524     <a class="code" href="classTrafficManager.html#ab435afa5236277ff8d6a1991860cf546">_flat_stats</a>[c] = <span class="keyword">new</span> <a class="code" href="classStats.html">Stats</a>( <span class="keyword">this</span>, tmp_name.str( ), 1.0, 1000 );
<a name="l00525"></a>00525     _stats[tmp_name.str()] = <a class="code" href="classTrafficManager.html#ab435afa5236277ff8d6a1991860cf546">_flat_stats</a>[c];
<a name="l00526"></a>00526     tmp_name.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00527"></a>00527     
<a name="l00528"></a>00528     tmp_name &lt;&lt; <span class="stringliteral">&quot;frag_stat_&quot;</span> &lt;&lt; c;
<a name="l00529"></a>00529     <a class="code" href="classTrafficManager.html#a7f160ac254d3ceabd825f1c59f42b179">_frag_stats</a>[c] = <span class="keyword">new</span> <a class="code" href="classStats.html">Stats</a>( <span class="keyword">this</span>, tmp_name.str( ), 1.0, 100 );
<a name="l00530"></a>00530     _stats[tmp_name.str()] = <a class="code" href="classTrafficManager.html#a7f160ac254d3ceabd825f1c59f42b179">_frag_stats</a>[c];
<a name="l00531"></a>00531     tmp_name.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00532"></a>00532     
<a name="l00533"></a>00533     tmp_name &lt;&lt; <span class="stringliteral">&quot;hop_stat_&quot;</span> &lt;&lt; c;
<a name="l00534"></a>00534     <a class="code" href="classTrafficManager.html#ac9385813fa2b42c908cdf532ec9405c6">_hop_stats</a>[c] = <span class="keyword">new</span> <a class="code" href="classStats.html">Stats</a>( <span class="keyword">this</span>, tmp_name.str( ), 1.0, 20 );
<a name="l00535"></a>00535     _stats[tmp_name.str()] = <a class="code" href="classTrafficManager.html#ac9385813fa2b42c908cdf532ec9405c6">_hop_stats</a>[c];
<a name="l00536"></a>00536     tmp_name.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00537"></a>00537     
<a name="l00538"></a>00538     <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#adf6295f17ea12f4e88790d2debdbc4d5">_pair_stats</a>){
<a name="l00539"></a>00539       <a class="code" href="classTrafficManager.html#a4e8c501fc2d871203dc729ecea28b9bd">_pair_plat</a>[c].resize(_nodes*_nodes);
<a name="l00540"></a>00540       <a class="code" href="classTrafficManager.html#a03c78594e1d4a1145ea27816ef786bde">_pair_nlat</a>[c].resize(_nodes*_nodes);
<a name="l00541"></a>00541       <a class="code" href="classTrafficManager.html#a353557bf34f140be9b12f9e92c9f4006">_pair_flat</a>[c].resize(_nodes*_nodes);
<a name="l00542"></a>00542     }
<a name="l00543"></a>00543     
<a name="l00544"></a>00544     <a class="code" href="classTrafficManager.html#a552ccfae3f5aad4c71b188d97614012d">_sent_packets</a>[c].resize(_nodes, 0);
<a name="l00545"></a>00545     <a class="code" href="classTrafficManager.html#acec4c1294844394b7bf8008f5b920593">_accepted_packets</a>[c].resize(_nodes, 0);
<a name="l00546"></a>00546     <a class="code" href="classTrafficManager.html#a62c2881d71bd8a580c008cebf2753012">_sent_flits</a>[c].resize(_nodes, 0);
<a name="l00547"></a>00547     <a class="code" href="classTrafficManager.html#a089e444802486d4e5092066d4c357c30">_accepted_flits</a>[c].resize(_nodes, 0);
<a name="l00548"></a>00548     
<a name="l00549"></a>00549 <span class="preprocessor">#ifdef TRACK_STALLS</span>
<a name="l00550"></a>00550 <span class="preprocessor"></span>    <a class="code" href="classTrafficManager.html#a1c784a6d1925a67a090fdcd2d4ea69c1">_buffer_busy_stalls</a>[c].resize(_subnets*<a class="code" href="classTrafficManager.html#a60f79ec184e9dbd5ef5caa0a9b909558">_routers</a>, 0);
<a name="l00551"></a>00551     <a class="code" href="classTrafficManager.html#ae28ad10bf987f3edaea11411237c2da5">_buffer_conflict_stalls</a>[c].resize(_subnets*_routers, 0);
<a name="l00552"></a>00552     <a class="code" href="classTrafficManager.html#a9933b441d6750f35f7622e69c0baa0a0">_buffer_full_stalls</a>[c].resize(_subnets*_routers, 0);
<a name="l00553"></a>00553     <a class="code" href="classTrafficManager.html#aa1a62024edeb3fbcbcd12a4c15c75c1c">_buffer_reserved_stalls</a>[c].resize(_subnets*_routers, 0);
<a name="l00554"></a>00554     <a class="code" href="classTrafficManager.html#afb85e3761a4ff0c6a9330e6f47ea6314">_crossbar_conflict_stalls</a>[c].resize(_subnets*_routers, 0);
<a name="l00555"></a>00555 <span class="preprocessor">#endif</span>
<a name="l00556"></a>00556 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#adf6295f17ea12f4e88790d2debdbc4d5">_pair_stats</a>){
<a name="l00557"></a>00557       <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; _nodes; ++i ) {
<a name="l00558"></a>00558         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j = 0; j &lt; _nodes; ++j ) {
<a name="l00559"></a>00559           tmp_name &lt;&lt; <span class="stringliteral">&quot;pair_plat_stat_&quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;_&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;_&quot;</span> &lt;&lt; j;
<a name="l00560"></a>00560           <a class="code" href="classTrafficManager.html#a4e8c501fc2d871203dc729ecea28b9bd">_pair_plat</a>[c][i*_nodes+j] = <span class="keyword">new</span> <a class="code" href="classStats.html">Stats</a>( <span class="keyword">this</span>, tmp_name.str( ), 1.0, 250 );
<a name="l00561"></a>00561           _stats[tmp_name.str()] = <a class="code" href="classTrafficManager.html#a4e8c501fc2d871203dc729ecea28b9bd">_pair_plat</a>[c][i*_nodes+j];
<a name="l00562"></a>00562           tmp_name.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00563"></a>00563           
<a name="l00564"></a>00564           tmp_name &lt;&lt; <span class="stringliteral">&quot;pair_nlat_stat_&quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;_&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;_&quot;</span> &lt;&lt; j;
<a name="l00565"></a>00565           <a class="code" href="classTrafficManager.html#a03c78594e1d4a1145ea27816ef786bde">_pair_nlat</a>[c][i*_nodes+j] = <span class="keyword">new</span> <a class="code" href="classStats.html">Stats</a>( <span class="keyword">this</span>, tmp_name.str( ), 1.0, 250 );
<a name="l00566"></a>00566           _stats[tmp_name.str()] = <a class="code" href="classTrafficManager.html#a03c78594e1d4a1145ea27816ef786bde">_pair_nlat</a>[c][i*_nodes+j];
<a name="l00567"></a>00567           tmp_name.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00568"></a>00568           
<a name="l00569"></a>00569           tmp_name &lt;&lt; <span class="stringliteral">&quot;pair_flat_stat_&quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;_&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;_&quot;</span> &lt;&lt; j;
<a name="l00570"></a>00570           <a class="code" href="classTrafficManager.html#a353557bf34f140be9b12f9e92c9f4006">_pair_flat</a>[c][i*_nodes+j] = <span class="keyword">new</span> <a class="code" href="classStats.html">Stats</a>( <span class="keyword">this</span>, tmp_name.str( ), 1.0, 250 );
<a name="l00571"></a>00571           _stats[tmp_name.str()] = <a class="code" href="classTrafficManager.html#a353557bf34f140be9b12f9e92c9f4006">_pair_flat</a>[c][i*_nodes+j];
<a name="l00572"></a>00572           tmp_name.str(<span class="stringliteral">&quot;&quot;</span>);
<a name="l00573"></a>00573         }
<a name="l00574"></a>00574       }
<a name="l00575"></a>00575     }
<a name="l00576"></a>00576   }
<a name="l00577"></a>00577   
<a name="l00578"></a>00578   <a class="code" href="classTrafficManager.html#a4a883d0cafe388d38cbe80a40509a23c">_slowest_flit</a>.resize(_classes, -1);
<a name="l00579"></a>00579   <a class="code" href="classTrafficManager.html#abd64d715d45401f6306d9f512d50ae66">_slowest_packet</a>.resize(_classes, -1);
<a name="l00580"></a>00580   
<a name="l00581"></a>00581   
<a name="l00582"></a>00582   
<a name="l00583"></a>00583 }
<a name="l00584"></a>00584 
<a name="l00585"></a>00585 <a class="code" href="classTrafficManager.html#ae78523131bcf80c38294ddb32a5276ac">TrafficManager::~TrafficManager</a>( )
<a name="l00586"></a>00586 {
<a name="l00587"></a>00587   
<a name="l00588"></a>00588   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> source = 0; source &lt; <a class="code" href="classTrafficManager.html#a61ed65da53f0d0dac14cdf619e2d95af">_nodes</a>; ++source ) {
<a name="l00589"></a>00589     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> subnet = 0; subnet &lt; <a class="code" href="classTrafficManager.html#adf0cc5d3d2377007a9471f73b1cf137a">_subnets</a>; ++subnet ) {
<a name="l00590"></a>00590       <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#a26909b743654d9b10f7aedd16421506c">_buf_states</a>[source][subnet];
<a name="l00591"></a>00591     }
<a name="l00592"></a>00592   }
<a name="l00593"></a>00593   
<a name="l00594"></a>00594   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> c = 0; c &lt; <a class="code" href="classTrafficManager.html#a9394ae83257275a40a9e1b62eb3a6247">_classes</a>; ++c ) {
<a name="l00595"></a>00595     <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[c];
<a name="l00596"></a>00596     <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#a9180e022d85c6388bfd7e58cbfc10b47">_nlat_stats</a>[c];
<a name="l00597"></a>00597     <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#ab435afa5236277ff8d6a1991860cf546">_flat_stats</a>[c];
<a name="l00598"></a>00598     <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#a7f160ac254d3ceabd825f1c59f42b179">_frag_stats</a>[c];
<a name="l00599"></a>00599     <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#ac9385813fa2b42c908cdf532ec9405c6">_hop_stats</a>[c];
<a name="l00600"></a>00600     
<a name="l00601"></a>00601     <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#a1f48f17401865b83fc5eefd4b5a34fca">_traffic_pattern</a>[c];
<a name="l00602"></a>00602     <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#a11776bff2e03ae2b4294c3d11e6b6406">_injection_process</a>[c];
<a name="l00603"></a>00603     <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#adf6295f17ea12f4e88790d2debdbc4d5">_pair_stats</a>){
<a name="l00604"></a>00604       <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; _nodes; ++i ) {
<a name="l00605"></a>00605         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j = 0; j &lt; _nodes; ++j ) {
<a name="l00606"></a>00606           <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#a4e8c501fc2d871203dc729ecea28b9bd">_pair_plat</a>[c][i*_nodes+j];
<a name="l00607"></a>00607           <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#a03c78594e1d4a1145ea27816ef786bde">_pair_nlat</a>[c][i*_nodes+j];
<a name="l00608"></a>00608           <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#a353557bf34f140be9b12f9e92c9f4006">_pair_flat</a>[c][i*_nodes+j];
<a name="l00609"></a>00609         }
<a name="l00610"></a>00610       }
<a name="l00611"></a>00611     }
<a name="l00612"></a>00612   }
<a name="l00613"></a>00613   
<a name="l00614"></a>00614   <span class="keywordflow">if</span>(<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &amp;&amp; (<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> != &amp;cout)) <span class="keyword">delete</span> <a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a>;
<a name="l00615"></a>00615   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#abf955f7ff7445e6daa441ea4b7f635c9">_stats_out</a> &amp;&amp; (<a class="code" href="classTrafficManager.html#abf955f7ff7445e6daa441ea4b7f635c9">_stats_out</a> != &amp;cout)) <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#abf955f7ff7445e6daa441ea4b7f635c9">_stats_out</a>;
<a name="l00616"></a>00616   
<a name="l00617"></a>00617 <span class="preprocessor">#ifdef TRACK_FLOWS</span>
<a name="l00618"></a>00618 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a60e297ef653cf18c18b59dd8903ada5e">_injected_flits_out</a>) <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#a60e297ef653cf18c18b59dd8903ada5e">_injected_flits_out</a>;
<a name="l00619"></a>00619   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a19cc011b7cd07169ed7940898815d3ff">_received_flits_out</a>) <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#a19cc011b7cd07169ed7940898815d3ff">_received_flits_out</a>;
<a name="l00620"></a>00620   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#ac95b0e32d233d93d649e8491e770bd19">_stored_flits_out</a>) <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#ac95b0e32d233d93d649e8491e770bd19">_stored_flits_out</a>;
<a name="l00621"></a>00621   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a05f3fac882e7f60a9ed0d73e227caae4">_sent_flits_out</a>) <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#a05f3fac882e7f60a9ed0d73e227caae4">_sent_flits_out</a>;
<a name="l00622"></a>00622   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a02bf243c1a00b188df58b2aac299530a">_outstanding_credits_out</a>) <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#a02bf243c1a00b188df58b2aac299530a">_outstanding_credits_out</a>;
<a name="l00623"></a>00623   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a1f9bb8ef5f9553a1e5417acddd18159f">_ejected_flits_out</a>) <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#a1f9bb8ef5f9553a1e5417acddd18159f">_ejected_flits_out</a>;
<a name="l00624"></a>00624   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a4f7eea17545e1fd80ba48ba9ca8a2fb7">_active_packets_out</a>) <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#a4f7eea17545e1fd80ba48ba9ca8a2fb7">_active_packets_out</a>;
<a name="l00625"></a>00625 <span class="preprocessor">#endif</span>
<a name="l00626"></a>00626 <span class="preprocessor"></span>  
<a name="l00627"></a>00627 <span class="preprocessor">#ifdef TRACK_CREDITS</span>
<a name="l00628"></a>00628 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#ab91032ac7351823fcb7433a7ec815b36">_used_credits_out</a>) <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#ab91032ac7351823fcb7433a7ec815b36">_used_credits_out</a>;
<a name="l00629"></a>00629   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a0594ee276bbfbb6629e96be8af864ef7">_free_credits_out</a>) <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#a0594ee276bbfbb6629e96be8af864ef7">_free_credits_out</a>;
<a name="l00630"></a>00630   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#aefd7305f60a0dfea91de3a4678701c69">_max_credits_out</a>) <span class="keyword">delete</span> <a class="code" href="classTrafficManager.html#aefd7305f60a0dfea91de3a4678701c69">_max_credits_out</a>;
<a name="l00631"></a>00631 <span class="preprocessor">#endif</span>
<a name="l00632"></a>00632 <span class="preprocessor"></span>  
<a name="l00633"></a>00633   <a class="code" href="classPacketReplyInfo.html#a0b9637af7ed41c44e5f295bf7b1e0b1d">PacketReplyInfo::FreeAll</a>();
<a name="l00634"></a>00634   <a class="code" href="structFlit.html#a1987a075d78e492239bae31448f84764">Flit::FreeAll</a>();
<a name="l00635"></a>00635   <a class="code" href="classCredit.html#a0f330cdd02e183090cd232fbe99da8dd">Credit::FreeAll</a>();
<a name="l00636"></a>00636 }
<a name="l00637"></a>00637 
<a name="l00638"></a>00638 
<a name="l00639"></a>00639 <span class="keywordtype">void</span> <a class="code" href="classTrafficManager.html#a5a56d7a257db0dbfdf6e90f7dd85aac7">TrafficManager::_RetireFlit</a>( <a class="code" href="structFlit.html">Flit</a> *f, <span class="keywordtype">int</span> dest )
<a name="l00640"></a>00640 {
<a name="l00641"></a>00641   <a class="code" href="classTrafficManager.html#ab18f0d948c1a197663dee3c75429b9c8">_deadlock_timer</a> = 0;
<a name="l00642"></a>00642   
<a name="l00643"></a>00643   assert(<a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].count(f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>) &gt; 0);
<a name="l00644"></a>00644   <a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].erase(f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>);
<a name="l00645"></a>00645   
<a name="l00646"></a>00646   <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#a1fe2bb19983ae1ada717e13cd27efd3b">record</a>) {
<a name="l00647"></a>00647     assert(<a class="code" href="classTrafficManager.html#ab3f440b8929d778298a078fff4fe492f">_measured_in_flight_flits</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].count(f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>) &gt; 0);
<a name="l00648"></a>00648     <a class="code" href="classTrafficManager.html#ab3f440b8929d778298a078fff4fe492f">_measured_in_flight_flits</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].erase(f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>);
<a name="l00649"></a>00649   }
<a name="l00650"></a>00650   
<a name="l00651"></a>00651   <span class="keywordflow">if</span> ( f-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a> ) {
<a name="l00652"></a>00652     *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00653"></a>00653     &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; dest &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00654"></a>00654     &lt;&lt; <span class="stringliteral">&quot;Retiring flit &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l00655"></a>00655     &lt;&lt; <span class="stringliteral">&quot; (packet &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a8e105235b0116073df1d2d133f68c12a">pid</a>
<a name="l00656"></a>00656     &lt;&lt; <span class="stringliteral">&quot;, src = &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#afab57916724fd9bd87f2450f571a855f">src</a>
<a name="l00657"></a>00657     &lt;&lt; <span class="stringliteral">&quot;, dest = &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a89d05814b6f9dcd035ec002a7ea00c57">dest</a>
<a name="l00658"></a>00658     &lt;&lt; <span class="stringliteral">&quot;, hops = &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#aef504aeca60e130f76a997b6384ab8c7">hops</a>
<a name="l00659"></a>00659     &lt;&lt; <span class="stringliteral">&quot;, flat = &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - f-&gt;<a class="code" href="structFlit.html#ad021c9f024c254122d90482fafae5b0c">itime</a>
<a name="l00660"></a>00660     &lt;&lt; <span class="stringliteral">&quot;).&quot;</span> &lt;&lt; endl;
<a name="l00661"></a>00661   }
<a name="l00662"></a>00662   
<a name="l00663"></a>00663   <span class="keywordflow">if</span> ( f-&gt;<a class="code" href="structFlit.html#a784a6bcb041646c2b8c068b7de4bdc9a">head</a> &amp;&amp; ( f-&gt;<a class="code" href="structFlit.html#a89d05814b6f9dcd035ec002a7ea00c57">dest</a> != dest ) ) {
<a name="l00664"></a>00664     ostringstream err;
<a name="l00665"></a>00665     err &lt;&lt; <span class="stringliteral">&quot;Flit &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a> &lt;&lt; <span class="stringliteral">&quot; arrived at incorrect output &quot;</span> &lt;&lt; dest;
<a name="l00666"></a>00666     <a class="code" href="classModule.html#acfa9d0dc518853045e0d2356d138717f">Error</a>( err.str( ) );
<a name="l00667"></a>00667   }
<a name="l00668"></a>00668   
<a name="l00669"></a>00669   <span class="keywordflow">if</span>((<a class="code" href="classTrafficManager.html#a4a883d0cafe388d38cbe80a40509a23c">_slowest_flit</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>] &lt; 0) ||
<a name="l00670"></a>00670      (<a class="code" href="classTrafficManager.html#ab435afa5236277ff8d6a1991860cf546">_flat_stats</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>]-&gt;Max() &lt; (f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - f-&gt;<a class="code" href="structFlit.html#ad021c9f024c254122d90482fafae5b0c">itime</a>)))
<a name="l00671"></a>00671     <a class="code" href="classTrafficManager.html#a4a883d0cafe388d38cbe80a40509a23c">_slowest_flit</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>] = f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>;
<a name="l00672"></a>00672   <a class="code" href="classTrafficManager.html#ab435afa5236277ff8d6a1991860cf546">_flat_stats</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>]-&gt;AddSample( f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - f-&gt;<a class="code" href="structFlit.html#ad021c9f024c254122d90482fafae5b0c">itime</a>);
<a name="l00673"></a>00673   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#adf6295f17ea12f4e88790d2debdbc4d5">_pair_stats</a>){
<a name="l00674"></a>00674     <a class="code" href="classTrafficManager.html#a353557bf34f140be9b12f9e92c9f4006">_pair_flat</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>][f-&gt;<a class="code" href="structFlit.html#afab57916724fd9bd87f2450f571a855f">src</a>*_nodes+dest]-&gt;AddSample( f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - f-&gt;<a class="code" href="structFlit.html#ad021c9f024c254122d90482fafae5b0c">itime</a> );
<a name="l00675"></a>00675   }
<a name="l00676"></a>00676   
<a name="l00677"></a>00677   <span class="keywordflow">if</span> ( f-&gt;<a class="code" href="structFlit.html#aa0f32295d57acd313ddf257127b5c850">tail</a> ) {
<a name="l00678"></a>00678     <a class="code" href="structFlit.html">Flit</a> * head;
<a name="l00679"></a>00679     <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#a784a6bcb041646c2b8c068b7de4bdc9a">head</a>) {
<a name="l00680"></a>00680       head = f;
<a name="l00681"></a>00681     } <span class="keywordflow">else</span> {
<a name="l00682"></a>00682       map&lt;int, Flit *&gt;::iterator iter = <a class="code" href="classTrafficManager.html#a66c40be042f5d5b3e5a35a441e4e4e60">_retired_packets</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].find(f-&gt;<a class="code" href="structFlit.html#a8e105235b0116073df1d2d133f68c12a">pid</a>);
<a name="l00683"></a>00683       assert(iter != <a class="code" href="classTrafficManager.html#a66c40be042f5d5b3e5a35a441e4e4e60">_retired_packets</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].end());
<a name="l00684"></a>00684       head = iter-&gt;second;
<a name="l00685"></a>00685       <a class="code" href="classTrafficManager.html#a66c40be042f5d5b3e5a35a441e4e4e60">_retired_packets</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].erase(iter);
<a name="l00686"></a>00686       assert(head-&gt;head);
<a name="l00687"></a>00687       assert(f-&gt;<a class="code" href="structFlit.html#a8e105235b0116073df1d2d133f68c12a">pid</a> == head-&gt;pid);
<a name="l00688"></a>00688     }
<a name="l00689"></a>00689     <span class="keywordflow">if</span> ( f-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a> ) {
<a name="l00690"></a>00690       *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00691"></a>00691       &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; dest &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00692"></a>00692       &lt;&lt; <span class="stringliteral">&quot;Retiring packet &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a8e105235b0116073df1d2d133f68c12a">pid</a>
<a name="l00693"></a>00693       &lt;&lt; <span class="stringliteral">&quot; (plat = &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - head-&gt;ctime
<a name="l00694"></a>00694       &lt;&lt; <span class="stringliteral">&quot;, nlat = &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - head-&gt;itime
<a name="l00695"></a>00695       &lt;&lt; <span class="stringliteral">&quot;, frag = &quot;</span> &lt;&lt; (f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - head-&gt;atime) - (f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a> - head-&gt;id) <span class="comment">// NB: In the spirit of solving problems using ugly hacks, we compute the packet length by taking advantage of the fact that the IDs of flits within a packet are contiguous.</span>
<a name="l00696"></a>00696       &lt;&lt; <span class="stringliteral">&quot;, src = &quot;</span> &lt;&lt; head-&gt;src
<a name="l00697"></a>00697       &lt;&lt; <span class="stringliteral">&quot;, dest = &quot;</span> &lt;&lt; head-&gt;dest
<a name="l00698"></a>00698       &lt;&lt; <span class="stringliteral">&quot;).&quot;</span> &lt;&lt; endl;
<a name="l00699"></a>00699     }
<a name="l00700"></a>00700     
<a name="l00701"></a>00701     <span class="comment">//code the source of request, look carefully, its tricky ;)</span>
<a name="l00702"></a>00702     <span class="keywordflow">if</span> (f-&gt;<a class="code" href="structFlit.html#a4f56cca863f428c79260a517cadc244a">type</a> == <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81ad47b8edbc7a6c26a34d782af584eeab0">Flit::READ_REQUEST</a> || f-&gt;<a class="code" href="structFlit.html#a4f56cca863f428c79260a517cadc244a">type</a> == <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81a74c1c54b3ebc54205b6a3e160ac2d0da">Flit::WRITE_REQUEST</a>) {
<a name="l00703"></a>00703       <a class="code" href="classPacketReplyInfo.html">PacketReplyInfo</a>* rinfo = <a class="code" href="classTrafficManager.html#ae5023ac53f1deb85540abe79a174db26">PacketReplyInfo::New</a>();
<a name="l00704"></a>00704       rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#ad078088b08b123253f9e709a7a7308a2">source</a> = f-&gt;<a class="code" href="structFlit.html#afab57916724fd9bd87f2450f571a855f">src</a>;
<a name="l00705"></a>00705       rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#a36cbf988a3b1035871a18ace110df950">time</a> = f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a>;
<a name="l00706"></a>00706       rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#afa1849fb7eaf4d7d23114dfc625a0636">record</a> = f-&gt;<a class="code" href="structFlit.html#a1fe2bb19983ae1ada717e13cd27efd3b">record</a>;
<a name="l00707"></a>00707       rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#a2e6b5a03ba103ea139fe652943a147d4">type</a> = f-&gt;<a class="code" href="structFlit.html#a4f56cca863f428c79260a517cadc244a">type</a>;
<a name="l00708"></a>00708       <a class="code" href="classTrafficManager.html#ae50acf81b3471ea19042d408d8c326db">_repliesPending</a>[dest].push_back(rinfo);
<a name="l00709"></a>00709     } <span class="keywordflow">else</span> {
<a name="l00710"></a>00710       <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#a4f56cca863f428c79260a517cadc244a">type</a> == <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81a18d4c2af84d9556279434e5134b6c0bf">Flit::READ_REPLY</a> || f-&gt;<a class="code" href="structFlit.html#a4f56cca863f428c79260a517cadc244a">type</a> == <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81ae6c1481b97213d1e4476cbc48d40f615">Flit::WRITE_REPLY</a>  ){
<a name="l00711"></a>00711         <a class="code" href="classTrafficManager.html#a1f014156c3e0c4d7531e3ec9f5204dc0">_requestsOutstanding</a>[dest]--;
<a name="l00712"></a>00712       } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#a4f56cca863f428c79260a517cadc244a">type</a> == <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81ac8c04d812bdd08d5facd1ed16e194bdb">Flit::ANY_TYPE</a>) {
<a name="l00713"></a>00713         <a class="code" href="classTrafficManager.html#a1f014156c3e0c4d7531e3ec9f5204dc0">_requestsOutstanding</a>[f-&gt;<a class="code" href="structFlit.html#afab57916724fd9bd87f2450f571a855f">src</a>]--;
<a name="l00714"></a>00714       }
<a name="l00715"></a>00715       
<a name="l00716"></a>00716     }
<a name="l00717"></a>00717     
<a name="l00718"></a>00718     <span class="comment">// Only record statistics once per packet (at tail)</span>
<a name="l00719"></a>00719     <span class="comment">// and based on the simulation state</span>
<a name="l00720"></a>00720     <span class="keywordflow">if</span> ( ( <a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a0e1683a4848299c524150f6e6c7f6930">warming_up</a> ) || f-&gt;<a class="code" href="structFlit.html#a1fe2bb19983ae1ada717e13cd27efd3b">record</a> ) {
<a name="l00721"></a>00721       
<a name="l00722"></a>00722       <a class="code" href="classTrafficManager.html#ac9385813fa2b42c908cdf532ec9405c6">_hop_stats</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>]-&gt;<a class="code" href="classStats.html#a1812bcfd436f0975ed02f4a2ba2e9acf">AddSample</a>( f-&gt;<a class="code" href="structFlit.html#aef504aeca60e130f76a997b6384ab8c7">hops</a> );
<a name="l00723"></a>00723       
<a name="l00724"></a>00724       <span class="keywordflow">if</span>((<a class="code" href="classTrafficManager.html#abd64d715d45401f6306d9f512d50ae66">_slowest_packet</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>] &lt; 0) ||
<a name="l00725"></a>00725          (<a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>]-&gt;Max() &lt; (f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - head-&gt;itime)))
<a name="l00726"></a>00726         <a class="code" href="classTrafficManager.html#abd64d715d45401f6306d9f512d50ae66">_slowest_packet</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>] = f-&gt;<a class="code" href="structFlit.html#a8e105235b0116073df1d2d133f68c12a">pid</a>;
<a name="l00727"></a>00727       <a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>]-&gt;AddSample( f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - head-&gt;ctime);
<a name="l00728"></a>00728       <a class="code" href="classTrafficManager.html#a9180e022d85c6388bfd7e58cbfc10b47">_nlat_stats</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>]-&gt;AddSample( f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - head-&gt;itime);
<a name="l00729"></a>00729       <a class="code" href="classTrafficManager.html#a7f160ac254d3ceabd825f1c59f42b179">_frag_stats</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>]-&gt;AddSample( (f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - head-&gt;atime) - (f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a> - head-&gt;id) );
<a name="l00730"></a>00730       
<a name="l00731"></a>00731       <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#adf6295f17ea12f4e88790d2debdbc4d5">_pair_stats</a>){
<a name="l00732"></a>00732         <a class="code" href="classTrafficManager.html#a4e8c501fc2d871203dc729ecea28b9bd">_pair_plat</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>][f-&gt;<a class="code" href="structFlit.html#afab57916724fd9bd87f2450f571a855f">src</a>*_nodes+dest]-&gt;AddSample( f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - head-&gt;ctime );
<a name="l00733"></a>00733         <a class="code" href="classTrafficManager.html#a03c78594e1d4a1145ea27816ef786bde">_pair_nlat</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>][f-&gt;<a class="code" href="structFlit.html#afab57916724fd9bd87f2450f571a855f">src</a>*_nodes+dest]-&gt;AddSample( f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> - head-&gt;itime );
<a name="l00734"></a>00734       }
<a name="l00735"></a>00735     }
<a name="l00736"></a>00736     
<a name="l00737"></a>00737     <span class="keywordflow">if</span>(f != head) {
<a name="l00738"></a>00738       head-&gt;Free();
<a name="l00739"></a>00739     }
<a name="l00740"></a>00740     
<a name="l00741"></a>00741   }
<a name="l00742"></a>00742   
<a name="l00743"></a>00743   <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#a784a6bcb041646c2b8c068b7de4bdc9a">head</a> &amp;&amp; !f-&gt;<a class="code" href="structFlit.html#aa0f32295d57acd313ddf257127b5c850">tail</a>) {
<a name="l00744"></a>00744     <a class="code" href="classTrafficManager.html#a66c40be042f5d5b3e5a35a441e4e4e60">_retired_packets</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].insert(make_pair(f-&gt;<a class="code" href="structFlit.html#a8e105235b0116073df1d2d133f68c12a">pid</a>, f));
<a name="l00745"></a>00745   } <span class="keywordflow">else</span> {
<a name="l00746"></a>00746     f-&gt;<a class="code" href="structFlit.html#a53a3cb2df0d0913870099df51e3d9adb">Free</a>();
<a name="l00747"></a>00747   }
<a name="l00748"></a>00748 }
<a name="l00749"></a>00749 
<a name="l00750"></a><a class="code" href="classTrafficManager.html#aeb796cace52960b1a85187ed11d8eb4d">00750</a> <span class="keywordtype">int</span> <a class="code" href="classTrafficManager.html#a8d9f889ede3ff49e1ff1ad480c83456b">TrafficManager::_IssuePacket</a>( <span class="keywordtype">int</span> source, <span class="keywordtype">int</span> cl )
<a name="l00751"></a>00751 {
<a name="l00752"></a>00752   <span class="keywordtype">int</span> result = 0;
<a name="l00753"></a>00753   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#adfe9e24ec927025a9f94e55cba8516f5">_use_read_write</a>[cl]){ <span class="comment">//use read and write</span>
<a name="l00754"></a>00754     <span class="comment">//check queue for waiting replies.</span>
<a name="l00755"></a>00755     <span class="comment">//check to make sure it is on time yet</span>
<a name="l00756"></a>00756     <span class="keywordflow">if</span> (!<a class="code" href="classTrafficManager.html#ae50acf81b3471ea19042d408d8c326db">_repliesPending</a>[source].empty()) {
<a name="l00757"></a>00757       <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#ae50acf81b3471ea19042d408d8c326db">_repliesPending</a>[source].front()-&gt;time &lt;= <a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a>) {
<a name="l00758"></a>00758         result = -1;
<a name="l00759"></a>00759       }
<a name="l00760"></a>00760     } <span class="keywordflow">else</span> {
<a name="l00761"></a>00761       
<a name="l00762"></a>00762       <span class="comment">//produce a packet</span>
<a name="l00763"></a>00763       <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a11776bff2e03ae2b4294c3d11e6b6406">_injection_process</a>[cl]-&gt;test(source)) {
<a name="l00764"></a>00764         
<a name="l00765"></a>00765         <span class="comment">//coin toss to determine request type.</span>
<a name="l00766"></a>00766         result = (<a class="code" href="random__utils_8cpp.html#a23768b7652cc97d0458d0a032b13bd34">RandomFloat</a>() &lt; <a class="code" href="classTrafficManager.html#a7aa253563e3198143f4219435063d465">_write_fraction</a>[cl]) ? 2 : 1;
<a name="l00767"></a>00767         
<a name="l00768"></a>00768         <a class="code" href="classTrafficManager.html#a1f014156c3e0c4d7531e3ec9f5204dc0">_requestsOutstanding</a>[source]++;
<a name="l00769"></a>00769       }
<a name="l00770"></a>00770     }
<a name="l00771"></a>00771   } <span class="keywordflow">else</span> { <span class="comment">//normal mode</span>
<a name="l00772"></a>00772     result = <a class="code" href="classTrafficManager.html#a11776bff2e03ae2b4294c3d11e6b6406">_injection_process</a>[cl]-&gt;test(source) ? 1 : 0;
<a name="l00773"></a>00773     <a class="code" href="classTrafficManager.html#a1f014156c3e0c4d7531e3ec9f5204dc0">_requestsOutstanding</a>[source]++;
<a name="l00774"></a>00774   }
<a name="l00775"></a>00775   <span class="keywordflow">if</span>(result != 0) {
<a name="l00776"></a>00776     <a class="code" href="classTrafficManager.html#a4eabe4de474fc72131dd443509f364b8">_packet_seq_no</a>[source]++;
<a name="l00777"></a>00777   }
<a name="l00778"></a>00778   <span class="keywordflow">return</span> result;
<a name="l00779"></a>00779 }
<a name="l00780"></a>00780 
<a name="l00781"></a><a class="code" href="classTrafficManager.html#a98909da76a4db4906d7c839f7ed9c81b">00781</a> <span class="keywordtype">void</span> <a class="code" href="classTrafficManager.html#a7c57d1fdea9391745cc42948168b0b6a">TrafficManager::_GeneratePacket</a>( <span class="keywordtype">int</span> source, <span class="keywordtype">int</span> stype,
<a name="l00782"></a>00782                                      <span class="keywordtype">int</span> cl, <span class="keywordtype">int</span> time )
<a name="l00783"></a>00783 {
<a name="l00784"></a>00784   assert(stype!=0);
<a name="l00785"></a>00785   
<a name="l00786"></a>00786   <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81">Flit::FlitType</a> packet_type = <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81ac8c04d812bdd08d5facd1ed16e194bdb">Flit::ANY_TYPE</a>;
<a name="l00787"></a>00787   <span class="keywordtype">int</span> size = <a class="code" href="classTrafficManager.html#afed030de03a685dc0d9f9d7445af3803">_GetNextPacketSize</a>(cl); <span class="comment">//input size</span>
<a name="l00788"></a>00788   <span class="keywordtype">int</span> pid = <a class="code" href="classTrafficManager.html#aeab72f243f41009035b007fc42d00e21">_cur_pid</a>++;
<a name="l00789"></a>00789   assert(<a class="code" href="classTrafficManager.html#aeab72f243f41009035b007fc42d00e21">_cur_pid</a>);
<a name="l00790"></a>00790   <span class="keywordtype">int</span> packet_destination = <a class="code" href="classTrafficManager.html#a1f48f17401865b83fc5eefd4b5a34fca">_traffic_pattern</a>[cl]-&gt;dest(source);
<a name="l00791"></a>00791   <span class="keywordtype">bool</span> record = <span class="keyword">false</span>;
<a name="l00792"></a>00792   <span class="keywordtype">bool</span> watch = <a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &amp;&amp; (<a class="code" href="classTrafficManager.html#af31f34fb4c338c9e27864d44f3abf3ea">_packets_to_watch</a>.count(pid) &gt; 0);
<a name="l00793"></a>00793   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#adfe9e24ec927025a9f94e55cba8516f5">_use_read_write</a>[cl]){
<a name="l00794"></a>00794     <span class="keywordflow">if</span>(stype &gt; 0) {
<a name="l00795"></a>00795       <span class="keywordflow">if</span> (stype == 1) {
<a name="l00796"></a>00796         packet_type = <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81ad47b8edbc7a6c26a34d782af584eeab0">Flit::READ_REQUEST</a>;
<a name="l00797"></a>00797         size = <a class="code" href="classTrafficManager.html#a87535b1fdae24ddd88e7806c591cd124">_read_request_size</a>[cl];
<a name="l00798"></a>00798       } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (stype == 2) {
<a name="l00799"></a>00799         packet_type = <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81a74c1c54b3ebc54205b6a3e160ac2d0da">Flit::WRITE_REQUEST</a>;
<a name="l00800"></a>00800         size = <a class="code" href="classTrafficManager.html#a08692b9e9fc3303cf35b9d4a7ea92370">_write_request_size</a>[cl];
<a name="l00801"></a>00801       } <span class="keywordflow">else</span> {
<a name="l00802"></a>00802         ostringstream err;
<a name="l00803"></a>00803         err &lt;&lt; <span class="stringliteral">&quot;Invalid packet type: &quot;</span> &lt;&lt; packet_type;
<a name="l00804"></a>00804         <a class="code" href="classModule.html#acfa9d0dc518853045e0d2356d138717f">Error</a>( err.str( ) );
<a name="l00805"></a>00805       }
<a name="l00806"></a>00806     } <span class="keywordflow">else</span> {
<a name="l00807"></a>00807       <a class="code" href="classPacketReplyInfo.html">PacketReplyInfo</a>* rinfo = <a class="code" href="classTrafficManager.html#ae50acf81b3471ea19042d408d8c326db">_repliesPending</a>[source].front();
<a name="l00808"></a>00808       <span class="keywordflow">if</span> (rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#a2e6b5a03ba103ea139fe652943a147d4">type</a> == <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81ad47b8edbc7a6c26a34d782af584eeab0">Flit::READ_REQUEST</a>) {<span class="comment">//read reply</span>
<a name="l00809"></a>00809         size = <a class="code" href="classTrafficManager.html#a9666144e4145b07dd1a1c48d77eadb65">_read_reply_size</a>[cl];
<a name="l00810"></a>00810         packet_type = <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81a18d4c2af84d9556279434e5134b6c0bf">Flit::READ_REPLY</a>;
<a name="l00811"></a>00811       } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#a2e6b5a03ba103ea139fe652943a147d4">type</a> == <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81a74c1c54b3ebc54205b6a3e160ac2d0da">Flit::WRITE_REQUEST</a>) {  <span class="comment">//write reply</span>
<a name="l00812"></a>00812         size = <a class="code" href="classTrafficManager.html#a26e3fea3ea43158bc6488e84393ff7db">_write_reply_size</a>[cl];
<a name="l00813"></a>00813         packet_type = <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81ae6c1481b97213d1e4476cbc48d40f615">Flit::WRITE_REPLY</a>;
<a name="l00814"></a>00814       } <span class="keywordflow">else</span> {
<a name="l00815"></a>00815         ostringstream err;
<a name="l00816"></a>00816         err &lt;&lt; <span class="stringliteral">&quot;Invalid packet type: &quot;</span> &lt;&lt; rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#a2e6b5a03ba103ea139fe652943a147d4">type</a>;
<a name="l00817"></a>00817         <a class="code" href="classModule.html#acfa9d0dc518853045e0d2356d138717f">Error</a>( err.str( ) );
<a name="l00818"></a>00818       }
<a name="l00819"></a>00819       packet_destination = rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#ad078088b08b123253f9e709a7a7308a2">source</a>;
<a name="l00820"></a>00820       time = rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#a36cbf988a3b1035871a18ace110df950">time</a>;
<a name="l00821"></a>00821       record = rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#afa1849fb7eaf4d7d23114dfc625a0636">record</a>;
<a name="l00822"></a>00822       <a class="code" href="classTrafficManager.html#ae50acf81b3471ea19042d408d8c326db">_repliesPending</a>[source].pop_front();
<a name="l00823"></a>00823       rinfo-&gt;<a class="code" href="classPacketReplyInfo.html#a87f80ba63bfd8b6fb12705dc85c7fe99">Free</a>();
<a name="l00824"></a>00824     }
<a name="l00825"></a>00825   }
<a name="l00826"></a>00826   
<a name="l00827"></a>00827   <span class="keywordflow">if</span> ((packet_destination &lt;0) || (packet_destination &gt;= _nodes)) {
<a name="l00828"></a>00828     ostringstream err;
<a name="l00829"></a>00829     err &lt;&lt; <span class="stringliteral">&quot;Incorrect packet destination &quot;</span> &lt;&lt; packet_destination
<a name="l00830"></a>00830     &lt;&lt; <span class="stringliteral">&quot; for stype &quot;</span> &lt;&lt; packet_type;
<a name="l00831"></a>00831     <a class="code" href="classModule.html#acfa9d0dc518853045e0d2356d138717f">Error</a>( err.str( ) );
<a name="l00832"></a>00832   }
<a name="l00833"></a>00833   
<a name="l00834"></a>00834   <span class="keywordflow">if</span> ( ( <a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a45cd3e451a01f617c16a995cb7c6c9ac">running</a> ) ||
<a name="l00835"></a>00835       ( ( <a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a8fb168e417269911be683171fd918af3">draining</a> ) &amp;&amp; ( time &lt; <a class="code" href="classTrafficManager.html#ad9fa73d16a3cb111fc593970370deaa6">_drain_time</a> ) ) ) {
<a name="l00836"></a>00836     record = <a class="code" href="classTrafficManager.html#a549fe0af403657daf47db078f7f1814a">_measure_stats</a>[cl];
<a name="l00837"></a>00837   }
<a name="l00838"></a>00838   
<a name="l00839"></a>00839   <span class="keywordtype">int</span> subnetwork = ((packet_type == <a class="code" href="structFlit.html#a2ff557df3aca49c49a1e49e00cd3ec81ac8c04d812bdd08d5facd1ed16e194bdb">Flit::ANY_TYPE</a>) ?
<a name="l00840"></a>00840                     <a class="code" href="random__utils_8cpp.html#ac46ec4a8515ceccca7c472ee3687b83f">RandomInt</a>(<a class="code" href="classTrafficManager.html#adf0cc5d3d2377007a9471f73b1cf137a">_subnets</a>-1) :
<a name="l00841"></a>00841                     <a class="code" href="classTrafficManager.html#a5111853d7b5812a5e3b75fdf680dd6ed">_subnet</a>[packet_type]);
<a name="l00842"></a>00842   
<a name="l00843"></a>00843   <span class="keywordflow">if</span> ( watch ) {
<a name="l00844"></a>00844     *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00845"></a>00845     &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; source &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00846"></a>00846     &lt;&lt; <span class="stringliteral">&quot;Enqueuing packet &quot;</span> &lt;&lt; pid
<a name="l00847"></a>00847     &lt;&lt; <span class="stringliteral">&quot; at time &quot;</span> &lt;&lt; time
<a name="l00848"></a>00848     &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l00849"></a>00849   }
<a name="l00850"></a>00850   
<a name="l00851"></a>00851   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; size; ++i ) {
<a name="l00852"></a>00852     <a class="code" href="structFlit.html">Flit</a> * f  = <a class="code" href="classTrafficManager.html#ae5023ac53f1deb85540abe79a174db26">Flit::New</a>();
<a name="l00853"></a>00853     f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>     = <a class="code" href="classTrafficManager.html#adffda813e3742e357301b3fa142751cf">_cur_id</a>++;
<a name="l00854"></a>00854     assert(<a class="code" href="classTrafficManager.html#adffda813e3742e357301b3fa142751cf">_cur_id</a>);
<a name="l00855"></a>00855     f-&gt;<a class="code" href="structFlit.html#a8e105235b0116073df1d2d133f68c12a">pid</a>    = pid;
<a name="l00856"></a>00856     f-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>  = watch | (<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &amp;&amp; (<a class="code" href="classTrafficManager.html#a58a8ea82d95bf82f0309d5f9ecda2e34">_flits_to_watch</a>.count(f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>) &gt; 0));
<a name="l00857"></a>00857     f-&gt;<a class="code" href="structFlit.html#adb2b8310c7a44302a1ab07f4f7bec2a5">subnetwork</a> = subnetwork;
<a name="l00858"></a>00858     f-&gt;<a class="code" href="structFlit.html#afab57916724fd9bd87f2450f571a855f">src</a>    = source;
<a name="l00859"></a>00859     f-&gt;<a class="code" href="structFlit.html#a79051233092c355b8d01f2e5914c8eb0">ctime</a>  = time;
<a name="l00860"></a>00860     f-&gt;<a class="code" href="structFlit.html#a1fe2bb19983ae1ada717e13cd27efd3b">record</a> = record;
<a name="l00861"></a>00861     f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>     = cl;
<a name="l00862"></a>00862     
<a name="l00863"></a>00863     <a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].insert(make_pair(f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>, f));
<a name="l00864"></a>00864     <span class="keywordflow">if</span>(record) {
<a name="l00865"></a>00865       <a class="code" href="classTrafficManager.html#ab3f440b8929d778298a078fff4fe492f">_measured_in_flight_flits</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>].insert(make_pair(f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>, f));
<a name="l00866"></a>00866     }
<a name="l00867"></a>00867     
<a name="l00868"></a>00868     <span class="keywordflow">if</span>(<a class="code" href="globals_8hpp.html#a35b664146e55660800a67a648cf6748d">gTrace</a>){
<a name="l00869"></a>00869       cout&lt;&lt;<span class="stringliteral">&quot;New Flit &quot;</span>&lt;&lt;f-&gt;<a class="code" href="structFlit.html#afab57916724fd9bd87f2450f571a855f">src</a>&lt;&lt;endl;
<a name="l00870"></a>00870     }
<a name="l00871"></a>00871     f-&gt;<a class="code" href="structFlit.html#a4f56cca863f428c79260a517cadc244a">type</a> = packet_type;
<a name="l00872"></a>00872     
<a name="l00873"></a>00873     <span class="keywordflow">if</span> ( i == 0 ) { <span class="comment">// Head flit</span>
<a name="l00874"></a>00874       f-&gt;<a class="code" href="structFlit.html#a784a6bcb041646c2b8c068b7de4bdc9a">head</a> = <span class="keyword">true</span>;
<a name="l00875"></a>00875       <span class="comment">//packets are only generated to nodes smaller or equal to limit</span>
<a name="l00876"></a>00876       f-&gt;<a class="code" href="structFlit.html#a89d05814b6f9dcd035ec002a7ea00c57">dest</a> = packet_destination;
<a name="l00877"></a>00877     } <span class="keywordflow">else</span> {
<a name="l00878"></a>00878       f-&gt;<a class="code" href="structFlit.html#a784a6bcb041646c2b8c068b7de4bdc9a">head</a> = <span class="keyword">false</span>;
<a name="l00879"></a>00879       f-&gt;<a class="code" href="structFlit.html#a89d05814b6f9dcd035ec002a7ea00c57">dest</a> = -1;
<a name="l00880"></a>00880     }
<a name="l00881"></a>00881     <span class="keywordflow">switch</span>( <a class="code" href="classTrafficManager.html#a23397b6a37ec6aab95391d2a6299b6b1">_pri_type</a> ) {
<a name="l00882"></a>00882       <span class="keywordflow">case</span> <a class="code" href="classTrafficManager.html#ac706e7c128918cbe8dc015ca03c1a26da16fc1195598ced8197e9cf718ec9298b">class_based</a>:
<a name="l00883"></a>00883         f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> = <a class="code" href="classTrafficManager.html#a4320e8a49ac25608ddaca297a99d8459">_class_priority</a>[cl];
<a name="l00884"></a>00884         assert(f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> &gt;= 0);
<a name="l00885"></a>00885         <span class="keywordflow">break</span>;
<a name="l00886"></a>00886       <span class="keywordflow">case</span> <a class="code" href="classTrafficManager.html#ac706e7c128918cbe8dc015ca03c1a26daeda65575e2897f1be6462df7a45e21ad">age_based</a>:
<a name="l00887"></a>00887         f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> = numeric_limits&lt;int&gt;::max() - time;
<a name="l00888"></a>00888         assert(f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> &gt;= 0);
<a name="l00889"></a>00889         <span class="keywordflow">break</span>;
<a name="l00890"></a>00890       <span class="keywordflow">case</span> <a class="code" href="classTrafficManager.html#ac706e7c128918cbe8dc015ca03c1a26daa39a63afb93d7581b7ebc66932653aaa">sequence_based</a>:
<a name="l00891"></a>00891         f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> = numeric_limits&lt;int&gt;::max() - <a class="code" href="classTrafficManager.html#a4eabe4de474fc72131dd443509f364b8">_packet_seq_no</a>[source];
<a name="l00892"></a>00892         assert(f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> &gt;= 0);
<a name="l00893"></a>00893         <span class="keywordflow">break</span>;
<a name="l00894"></a>00894       <span class="keywordflow">default</span>:
<a name="l00895"></a>00895         f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> = 0;
<a name="l00896"></a>00896     }
<a name="l00897"></a>00897     <span class="keywordflow">if</span> ( i == ( size - 1 ) ) { <span class="comment">// Tail flit</span>
<a name="l00898"></a>00898       f-&gt;<a class="code" href="structFlit.html#aa0f32295d57acd313ddf257127b5c850">tail</a> = <span class="keyword">true</span>;
<a name="l00899"></a>00899     } <span class="keywordflow">else</span> {
<a name="l00900"></a>00900       f-&gt;<a class="code" href="structFlit.html#aa0f32295d57acd313ddf257127b5c850">tail</a> = <span class="keyword">false</span>;
<a name="l00901"></a>00901     }
<a name="l00902"></a>00902     
<a name="l00903"></a>00903     f-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>  = -1;
<a name="l00904"></a>00904     
<a name="l00905"></a>00905     <span class="keywordflow">if</span> ( f-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a> ) {
<a name="l00906"></a>00906       *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00907"></a>00907       &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; source &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00908"></a>00908       &lt;&lt; <span class="stringliteral">&quot;Enqueuing flit &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l00909"></a>00909       &lt;&lt; <span class="stringliteral">&quot; (packet &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a8e105235b0116073df1d2d133f68c12a">pid</a>
<a name="l00910"></a>00910       &lt;&lt; <span class="stringliteral">&quot;) at time &quot;</span> &lt;&lt; time
<a name="l00911"></a>00911       &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l00912"></a>00912     }
<a name="l00913"></a>00913     
<a name="l00914"></a>00914     <a class="code" href="classTrafficManager.html#a874d663095760b20ec91b9884201c1ac">_partial_packets</a>[source][cl].push_back( f );
<a name="l00915"></a>00915   }
<a name="l00916"></a>00916 }
<a name="l00917"></a>00917 
<a name="l00918"></a><a class="code" href="classTrafficManager.html#a61907c4a95eae350a20af03fb8dbcd03">00918</a> <span class="keywordtype">void</span> <a class="code" href="classTrafficManager.html#a61907c4a95eae350a20af03fb8dbcd03">TrafficManager::_Inject</a>(){
<a name="l00919"></a>00919   
<a name="l00920"></a>00920   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> <a class="code" href="lex_8yy_8c.html#a171692544b8e065853e387755849a433">input</a> = 0; <a class="code" href="lex_8yy_8c.html#a171692544b8e065853e387755849a433">input</a> &lt; _nodes; ++<a class="code" href="lex_8yy_8c.html#a171692544b8e065853e387755849a433">input</a> ) {
<a name="l00921"></a>00921     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> c = 0; c &lt; _classes; ++c ) {
<a name="l00922"></a>00922       <span class="comment">// Potentially generate packets for any (input,class)</span>
<a name="l00923"></a>00923       <span class="comment">// that is currently empty</span>
<a name="l00924"></a>00924       <span class="keywordflow">if</span> ( <a class="code" href="classTrafficManager.html#a874d663095760b20ec91b9884201c1ac">_partial_packets</a>[<a class="code" href="lex_8yy_8c.html#a171692544b8e065853e387755849a433">input</a>][c].empty() ) {
<a name="l00925"></a>00925         <span class="keywordtype">bool</span> generated = <span class="keyword">false</span>;
<a name="l00926"></a>00926         <span class="keywordflow">while</span>( !generated &amp;&amp; ( <a class="code" href="classTrafficManager.html#af4ee79a64ee0255447003b93fd9641e7">_qtime</a>[<a class="code" href="lex_8yy_8c.html#a171692544b8e065853e387755849a433">input</a>][c] &lt;= <a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a> ) ) {
<a name="l00927"></a>00927           <span class="keywordtype">int</span> stype = <a class="code" href="classTrafficManager.html#a8d9f889ede3ff49e1ff1ad480c83456b">_IssuePacket</a>( <a class="code" href="lex_8yy_8c.html#a171692544b8e065853e387755849a433">input</a>, c );
<a name="l00928"></a>00928           
<a name="l00929"></a>00929           <span class="keywordflow">if</span> ( stype != 0 ) { <span class="comment">//generate a packet</span>
<a name="l00930"></a>00930             <a class="code" href="classTrafficManager.html#a7c57d1fdea9391745cc42948168b0b6a">_GeneratePacket</a>( <a class="code" href="lex_8yy_8c.html#a171692544b8e065853e387755849a433">input</a>, stype, c,
<a name="l00931"></a>00931                             <a class="code" href="classTrafficManager.html#ad7de992687def7c090f4b96943094e3d">_include_queuing</a>==1 ?
<a name="l00932"></a>00932                             <a class="code" href="classTrafficManager.html#af4ee79a64ee0255447003b93fd9641e7">_qtime</a>[<a class="code" href="lex_8yy_8c.html#a171692544b8e065853e387755849a433">input</a>][c] : <a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a> );
<a name="l00933"></a>00933             generated = <span class="keyword">true</span>;
<a name="l00934"></a>00934           }
<a name="l00935"></a>00935           <span class="comment">// only advance time if this is not a reply packet</span>
<a name="l00936"></a>00936           <span class="keywordflow">if</span>(!<a class="code" href="classTrafficManager.html#adfe9e24ec927025a9f94e55cba8516f5">_use_read_write</a>[c] || (stype &gt;= 0)){
<a name="l00937"></a>00937             ++<a class="code" href="classTrafficManager.html#af4ee79a64ee0255447003b93fd9641e7">_qtime</a>[<a class="code" href="lex_8yy_8c.html#a171692544b8e065853e387755849a433">input</a>][c];
<a name="l00938"></a>00938           }
<a name="l00939"></a>00939         }
<a name="l00940"></a>00940         
<a name="l00941"></a>00941         <span class="keywordflow">if</span> ( ( <a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a8fb168e417269911be683171fd918af3">draining</a> ) &amp;&amp;
<a name="l00942"></a>00942             ( <a class="code" href="classTrafficManager.html#af4ee79a64ee0255447003b93fd9641e7">_qtime</a>[<a class="code" href="lex_8yy_8c.html#a171692544b8e065853e387755849a433">input</a>][c] &gt; <a class="code" href="classTrafficManager.html#ad9fa73d16a3cb111fc593970370deaa6">_drain_time</a> ) ) {
<a name="l00943"></a>00943           <a class="code" href="classTrafficManager.html#a459f440795a908884f21277f0760d9e5">_qdrained</a>[<a class="code" href="lex_8yy_8c.html#a171692544b8e065853e387755849a433">input</a>][c] = <span class="keyword">true</span>;
<a name="l00944"></a>00944         }
<a name="l00945"></a>00945       }
<a name="l00946"></a>00946     }
<a name="l00947"></a>00947   }
<a name="l00948"></a>00948 }
<a name="l00949"></a>00949 
<a name="l00950"></a>00950 <span class="keywordtype">void</span> <a class="code" href="classTrafficManager.html#ae2f9ae1d30700cb03c2922b41b977c1d">TrafficManager::_Step</a>( )
<a name="l00951"></a>00951 {
<a name="l00952"></a>00952   <span class="keywordtype">bool</span> flits_in_flight = <span class="keyword">false</span>;
<a name="l00953"></a>00953   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; _classes; ++c) {
<a name="l00954"></a>00954     flits_in_flight |= !<a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>[c].empty();
<a name="l00955"></a>00955   }
<a name="l00956"></a>00956   <span class="keywordflow">if</span>(flits_in_flight &amp;&amp; (<a class="code" href="classTrafficManager.html#ab18f0d948c1a197663dee3c75429b9c8">_deadlock_timer</a>++ &gt;= <a class="code" href="classTrafficManager.html#af80003752f7d8fceb5e542fc86bc56c8">_deadlock_warn_timeout</a>)){
<a name="l00957"></a>00957     <a class="code" href="classTrafficManager.html#ab18f0d948c1a197663dee3c75429b9c8">_deadlock_timer</a> = 0;
<a name="l00958"></a>00958     cout &lt;&lt; <span class="stringliteral">&quot;WARNING: Possible network deadlock.\n&quot;</span>;
<a name="l00959"></a>00959   }
<a name="l00960"></a>00960   
<a name="l00961"></a>00961   vector&lt;map&lt;int, Flit *&gt; &gt; flits(<a class="code" href="classTrafficManager.html#adf0cc5d3d2377007a9471f73b1cf137a">_subnets</a>);
<a name="l00962"></a>00962   
<a name="l00963"></a>00963   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> subnet = 0; subnet &lt; <a class="code" href="classTrafficManager.html#adf0cc5d3d2377007a9471f73b1cf137a">_subnets</a>; ++subnet ) {
<a name="l00964"></a>00964     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> = 0; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt; _nodes; ++<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> ) {
<a name="l00965"></a>00965       <a class="code" href="structFlit.html">Flit</a> * <span class="keyword">const</span> f = <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#abfe9bacf0de4b89c0f5d05b93bf11471">ReadFlit</a>( <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> );
<a name="l00966"></a>00966       <span class="keywordflow">if</span> ( f ) {
<a name="l00967"></a>00967         <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l00968"></a>00968           *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00969"></a>00969           &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l00970"></a>00970           &lt;&lt; <span class="stringliteral">&quot;Ejecting flit &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l00971"></a>00971           &lt;&lt; <span class="stringliteral">&quot; (packet &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a8e105235b0116073df1d2d133f68c12a">pid</a> &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>
<a name="l00972"></a>00972           &lt;&lt; <span class="stringliteral">&quot; from VC &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>
<a name="l00973"></a>00973           &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l00974"></a>00974         }
<a name="l00975"></a>00975         flits[subnet].insert(make_pair(<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>, f));
<a name="l00976"></a>00976         <span class="keywordflow">if</span>((<a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a0e1683a4848299c524150f6e6c7f6930">warming_up</a>) || (<a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a45cd3e451a01f617c16a995cb7c6c9ac">running</a>)) {
<a name="l00977"></a>00977           ++<a class="code" href="classTrafficManager.html#a089e444802486d4e5092066d4c357c30">_accepted_flits</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>];
<a name="l00978"></a>00978           <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#aa0f32295d57acd313ddf257127b5c850">tail</a>) {
<a name="l00979"></a>00979             ++<a class="code" href="classTrafficManager.html#acec4c1294844394b7bf8008f5b920593">_accepted_packets</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>];
<a name="l00980"></a>00980           }
<a name="l00981"></a>00981         }
<a name="l00982"></a>00982       }
<a name="l00983"></a>00983       
<a name="l00984"></a>00984       <a class="code" href="classCredit.html">Credit</a> * <span class="keyword">const</span> c = <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#a785ec4155e91008c7e0ade24d86536ca">ReadCredit</a>( <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> );
<a name="l00985"></a>00985       <span class="keywordflow">if</span> ( c ) {
<a name="l00986"></a>00986 <span class="preprocessor">#ifdef TRACK_FLOWS</span>
<a name="l00987"></a>00987 <span class="preprocessor"></span>        <span class="keywordflow">for</span>(set&lt;int&gt;::const_iterator iter = c-&gt;<a class="code" href="classCredit.html#af7898eb802885a65e5270096e0595abe">vc</a>.begin(); iter != c-&gt;<a class="code" href="classCredit.html#af7898eb802885a65e5270096e0595abe">vc</a>.end(); ++iter) {
<a name="l00988"></a>00988           <span class="keywordtype">int</span> <span class="keyword">const</span> vc = *iter;
<a name="l00989"></a>00989           assert(!<a class="code" href="classTrafficManager.html#a35866d4b27b9edc686f0e94d3810c8ee">_outstanding_classes</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet][vc].empty());
<a name="l00990"></a>00990           <span class="keywordtype">int</span> cl = <a class="code" href="classTrafficManager.html#a35866d4b27b9edc686f0e94d3810c8ee">_outstanding_classes</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet][vc].front();
<a name="l00991"></a>00991           <a class="code" href="classTrafficManager.html#a35866d4b27b9edc686f0e94d3810c8ee">_outstanding_classes</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet][vc].pop();
<a name="l00992"></a>00992           assert(<a class="code" href="classTrafficManager.html#a5d2d639d839c07d750bc632b85a304c6">_outstanding_credits</a>[cl][subnet][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>] &gt; 0);
<a name="l00993"></a>00993           --<a class="code" href="classTrafficManager.html#a5d2d639d839c07d750bc632b85a304c6">_outstanding_credits</a>[cl][subnet][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>];
<a name="l00994"></a>00994         }
<a name="l00995"></a>00995 <span class="preprocessor">#endif</span>
<a name="l00996"></a>00996 <span class="preprocessor"></span>        <a class="code" href="classTrafficManager.html#a26909b743654d9b10f7aedd16421506c">_buf_states</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet]-&gt;<a class="code" href="classBufferState.html#a4826b739959cb1a59dbe57a308f2cb61">ProcessCredit</a>(c);
<a name="l00997"></a>00997         c-&gt;<a class="code" href="classCredit.html#a59c66f81e134f42283da1690dc41bfea">Free</a>();
<a name="l00998"></a>00998       }
<a name="l00999"></a>00999     }
<a name="l01000"></a>01000     <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#afdb3b2cb6e0270fbd6b7acf5f5e4b28e">ReadInputs</a>( );
<a name="l01001"></a>01001   }
<a name="l01002"></a>01002   
<a name="l01003"></a>01003   <span class="keywordflow">if</span> ( !<a class="code" href="classTrafficManager.html#abeecbfb35b96c5e7bcf603fbda0d6e5c">_empty_network</a> ) {
<a name="l01004"></a>01004     <a class="code" href="classTrafficManager.html#a61907c4a95eae350a20af03fb8dbcd03">_Inject</a>();
<a name="l01005"></a>01005   }
<a name="l01006"></a>01006   
<a name="l01007"></a>01007   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> subnet = 0; subnet &lt; _subnets; ++subnet) {
<a name="l01008"></a>01008     
<a name="l01009"></a>01009     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> = 0; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt; _nodes; ++<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) {
<a name="l01010"></a>01010       
<a name="l01011"></a>01011       <a class="code" href="structFlit.html">Flit</a> * f = NULL;
<a name="l01012"></a>01012       
<a name="l01013"></a>01013       <a class="code" href="classBufferState.html">BufferState</a> * <span class="keyword">const</span> dest_buf = <a class="code" href="classTrafficManager.html#a26909b743654d9b10f7aedd16421506c">_buf_states</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet];
<a name="l01014"></a>01014       
<a name="l01015"></a>01015       <span class="keywordtype">int</span> <span class="keyword">const</span> last_class = <a class="code" href="classTrafficManager.html#a6105ccff8bfd383dea19a3f8403e263f">_last_class</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet];
<a name="l01016"></a>01016       
<a name="l01017"></a>01017       <span class="keywordtype">int</span> class_limit = _classes;
<a name="l01018"></a>01018       
<a name="l01019"></a>01019       <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a0310eaec5c862d3be54fa4987fdc1601">_hold_switch_for_packet</a>) {
<a name="l01020"></a>01020         list&lt;Flit *&gt; <span class="keyword">const</span> &amp; pp = <a class="code" href="classTrafficManager.html#a874d663095760b20ec91b9884201c1ac">_partial_packets</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][last_class];
<a name="l01021"></a>01021         <span class="keywordflow">if</span>(!pp.empty() &amp;&amp; !pp.front()-&gt;head &amp;&amp;
<a name="l01022"></a>01022            !dest_buf-&gt;<a class="code" href="classBufferState.html#a394b0fa81be8085b291b2768c487fafa">IsFullFor</a>(pp.front()-&gt;vc)) {
<a name="l01023"></a>01023           f = pp.front();
<a name="l01024"></a>01024           assert(f-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a> == <a class="code" href="classTrafficManager.html#aa7d75937add38ae15463b43499993725">_last_vc</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet][last_class]);
<a name="l01025"></a>01025           
<a name="l01026"></a>01026           <span class="comment">// if we&apos;re holding the connection, we don&apos;t need to check that class</span>
<a name="l01027"></a>01027           <span class="comment">// again in the for loop</span>
<a name="l01028"></a>01028           --class_limit;
<a name="l01029"></a>01029         }
<a name="l01030"></a>01030       }
<a name="l01031"></a>01031       
<a name="l01032"></a>01032       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt;= class_limit; ++i) {
<a name="l01033"></a>01033         
<a name="l01034"></a>01034         <span class="keywordtype">int</span> <span class="keyword">const</span> c = (last_class + i) % _classes;
<a name="l01035"></a>01035         
<a name="l01036"></a>01036         list&lt;Flit *&gt; <span class="keyword">const</span> &amp; pp = <a class="code" href="classTrafficManager.html#a874d663095760b20ec91b9884201c1ac">_partial_packets</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][c];
<a name="l01037"></a>01037         
<a name="l01038"></a>01038         <span class="keywordflow">if</span>(pp.empty()) {
<a name="l01039"></a>01039           <span class="keywordflow">continue</span>;
<a name="l01040"></a>01040         }
<a name="l01041"></a>01041         
<a name="l01042"></a>01042         <a class="code" href="structFlit.html">Flit</a> * <span class="keyword">const</span> cf = pp.front();
<a name="l01043"></a>01043         assert(cf);
<a name="l01044"></a>01044         assert(cf-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a> == c);
<a name="l01045"></a>01045         
<a name="l01046"></a>01046         <span class="keywordflow">if</span>(cf-&gt;<a class="code" href="structFlit.html#adb2b8310c7a44302a1ab07f4f7bec2a5">subnetwork</a> != subnet) {
<a name="l01047"></a>01047           <span class="keywordflow">continue</span>;
<a name="l01048"></a>01048         }
<a name="l01049"></a>01049         
<a name="l01050"></a>01050         <span class="keywordflow">if</span>(f &amp;&amp; (f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> &gt;= cf-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a>)) {
<a name="l01051"></a>01051           <span class="keywordflow">continue</span>;
<a name="l01052"></a>01052         }
<a name="l01053"></a>01053         
<a name="l01054"></a>01054         <span class="keywordflow">if</span>(cf-&gt;<a class="code" href="structFlit.html#a784a6bcb041646c2b8c068b7de4bdc9a">head</a> &amp;&amp; cf-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a> == -1) { <span class="comment">// Find first available VC</span>
<a name="l01055"></a>01055           
<a name="l01056"></a>01056           <a class="code" href="classOutputSet.html">OutputSet</a> route_set;
<a name="l01057"></a>01057           <a class="code" href="classTrafficManager.html#a2d1cccd0f50ec0972bdb666e9b234b72">_rf</a>(NULL, cf, -1, &amp;route_set, <span class="keyword">true</span>);
<a name="l01058"></a>01058           set&lt;OutputSet::sSetElement&gt; <span class="keyword">const</span> &amp; os = route_set.<a class="code" href="classOutputSet.html#aa9c96e3c171ac83d22a67d2ae9eef1c3">GetSet</a>();
<a name="l01059"></a>01059           assert(os.size() == 1);
<a name="l01060"></a>01060           <a class="code" href="structOutputSet_1_1sSetElement.html">OutputSet::sSetElement</a> <span class="keyword">const</span> &amp; se = *os.begin();
<a name="l01061"></a>01061           assert(se.output_port == -1);
<a name="l01062"></a>01062           <span class="keywordtype">int</span> vc_start = se.vc_start;
<a name="l01063"></a>01063           <span class="keywordtype">int</span> vc_end = se.vc_end;
<a name="l01064"></a>01064           <span class="keywordtype">int</span> vc_count = vc_end - vc_start + 1;
<a name="l01065"></a>01065           <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a7d1ae95f37124ebfdd8f16613c207543">_noq</a>) {
<a name="l01066"></a>01066             assert(<a class="code" href="classTrafficManager.html#a91a6036667c1793b9af0885329d4711d">_lookahead_routing</a>);
<a name="l01067"></a>01067             <span class="keyword">const</span> <a class="code" href="classFlitChannel.html">FlitChannel</a> * inject = <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#a3a1288b1369386753eccb1e00dbf8661">GetInject</a>(<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l01068"></a>01068             <span class="keyword">const</span> <a class="code" href="classRouter.html">Router</a> * router = inject-&gt;<a class="code" href="classFlitChannel.html#aebe1f93809d4b635f765e6aa0ed9e5e6">GetSink</a>();
<a name="l01069"></a>01069             assert(router);
<a name="l01070"></a>01070             <span class="keywordtype">int</span> in_channel = inject-&gt;<a class="code" href="classFlitChannel.html#af2750ab732b47425865e409ba149f1e5">GetSinkPort</a>();
<a name="l01071"></a>01071             
<a name="l01072"></a>01072             <span class="comment">// NOTE: Because the lookahead is not for injection, but for the</span>
<a name="l01073"></a>01073             <span class="comment">// first hop, we have to temporarily set cf&apos;s VC to be non-negative</span>
<a name="l01074"></a>01074             <span class="comment">// in order to avoid seting of an assertion in the routing function.</span>
<a name="l01075"></a>01075             cf-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a> = vc_start;
<a name="l01076"></a>01076             <a class="code" href="classTrafficManager.html#a2d1cccd0f50ec0972bdb666e9b234b72">_rf</a>(router, cf, in_channel, &amp;cf-&gt;<a class="code" href="structFlit.html#a165c0bf438da93ef32850f4d3c4e9a1c">la_route_set</a>, <span class="keyword">false</span>);
<a name="l01077"></a>01077             cf-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a> = -1;
<a name="l01078"></a>01078             
<a name="l01079"></a>01079             <span class="keywordflow">if</span>(cf-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l01080"></a>01080               *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l01081"></a>01081               &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l01082"></a>01082               &lt;&lt; <span class="stringliteral">&quot;Generating lookahead routing info for flit &quot;</span> &lt;&lt; cf-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l01083"></a>01083               &lt;&lt; <span class="stringliteral">&quot; (NOQ).&quot;</span> &lt;&lt; endl;
<a name="l01084"></a>01084             }
<a name="l01085"></a>01085             set&lt;OutputSet::sSetElement&gt; <span class="keyword">const</span> sl = cf-&gt;<a class="code" href="structFlit.html#a165c0bf438da93ef32850f4d3c4e9a1c">la_route_set</a>.<a class="code" href="classOutputSet.html#aa9c96e3c171ac83d22a67d2ae9eef1c3">GetSet</a>();
<a name="l01086"></a>01086             assert(sl.size() == 1);
<a name="l01087"></a>01087             <span class="keywordtype">int</span> next_output = sl.begin()-&gt;output_port;
<a name="l01088"></a>01088             vc_count /= router-&gt;<a class="code" href="classRouter.html#a02767ebb82a06ee4eb9f91c09d7b001d">NumOutputs</a>();
<a name="l01089"></a>01089             vc_start += next_output * vc_count;
<a name="l01090"></a>01090             vc_end = vc_start + vc_count - 1;
<a name="l01091"></a>01091             assert(vc_start &gt;= se.vc_start &amp;&amp; vc_start &lt;= se.vc_end);
<a name="l01092"></a>01092             assert(vc_end &gt;= se.vc_start &amp;&amp; vc_end &lt;= se.vc_end);
<a name="l01093"></a>01093             assert(vc_start &lt;= vc_end);
<a name="l01094"></a>01094           }
<a name="l01095"></a>01095           <span class="keywordflow">if</span>(cf-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l01096"></a>01096             *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; <a class="code" href="classModule.html#a0eeaa2b9a7d2ba88ab05682444898b08">FullName</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l01097"></a>01097             &lt;&lt; <span class="stringliteral">&quot;Finding output VC for flit &quot;</span> &lt;&lt; cf-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l01098"></a>01098             &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; endl;
<a name="l01099"></a>01099           }
<a name="l01100"></a>01100           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 1; i &lt;= vc_count; ++i) {
<a name="l01101"></a>01101             <span class="keywordtype">int</span> <span class="keyword">const</span> lvc = <a class="code" href="classTrafficManager.html#aa7d75937add38ae15463b43499993725">_last_vc</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet][c];
<a name="l01102"></a>01102             <span class="keywordtype">int</span> <span class="keyword">const</span> vc =
<a name="l01103"></a>01103             (lvc &lt; vc_start || lvc &gt; vc_end) ?
<a name="l01104"></a>01104             vc_start :
<a name="l01105"></a>01105             (vc_start + (lvc - vc_start + i) % vc_count);
<a name="l01106"></a>01106             assert((vc &gt;= vc_start) &amp;&amp; (vc &lt;= vc_end));
<a name="l01107"></a>01107             <span class="keywordflow">if</span>(!dest_buf-&gt;<a class="code" href="classBufferState.html#a4c32e440044fa0b238342278b69c8ee2">IsAvailableFor</a>(vc)) {
<a name="l01108"></a>01108               <span class="keywordflow">if</span>(cf-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l01109"></a>01109                 *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; <a class="code" href="classModule.html#a0eeaa2b9a7d2ba88ab05682444898b08">FullName</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l01110"></a>01110                 &lt;&lt; <span class="stringliteral">&quot;  Output VC &quot;</span> &lt;&lt; vc &lt;&lt; <span class="stringliteral">&quot; is busy.&quot;</span> &lt;&lt; endl;
<a name="l01111"></a>01111               }
<a name="l01112"></a>01112             } <span class="keywordflow">else</span> {
<a name="l01113"></a>01113               <span class="keywordflow">if</span>(dest_buf-&gt;<a class="code" href="classBufferState.html#a394b0fa81be8085b291b2768c487fafa">IsFullFor</a>(vc)) {
<a name="l01114"></a>01114                 <span class="keywordflow">if</span>(cf-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l01115"></a>01115                   *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; <a class="code" href="classModule.html#a0eeaa2b9a7d2ba88ab05682444898b08">FullName</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l01116"></a>01116                   &lt;&lt; <span class="stringliteral">&quot;  Output VC &quot;</span> &lt;&lt; vc &lt;&lt; <span class="stringliteral">&quot; is full.&quot;</span> &lt;&lt; endl;
<a name="l01117"></a>01117                 }
<a name="l01118"></a>01118               } <span class="keywordflow">else</span> {
<a name="l01119"></a>01119                 <span class="keywordflow">if</span>(cf-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l01120"></a>01120                   *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; <a class="code" href="classModule.html#a0eeaa2b9a7d2ba88ab05682444898b08">FullName</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l01121"></a>01121                   &lt;&lt; <span class="stringliteral">&quot;  Selected output VC &quot;</span> &lt;&lt; vc &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l01122"></a>01122                 }
<a name="l01123"></a>01123                 cf-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a> = vc;
<a name="l01124"></a>01124                 <span class="keywordflow">break</span>;
<a name="l01125"></a>01125               }
<a name="l01126"></a>01126             }
<a name="l01127"></a>01127           }
<a name="l01128"></a>01128         }
<a name="l01129"></a>01129         
<a name="l01130"></a>01130         <span class="keywordflow">if</span>(cf-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a> == -1) {
<a name="l01131"></a>01131           <span class="keywordflow">if</span>(cf-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l01132"></a>01132             *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; <a class="code" href="classModule.html#a0eeaa2b9a7d2ba88ab05682444898b08">FullName</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l01133"></a>01133             &lt;&lt; <span class="stringliteral">&quot;No output VC found for flit &quot;</span> &lt;&lt; cf-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l01134"></a>01134             &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l01135"></a>01135           }
<a name="l01136"></a>01136         } <span class="keywordflow">else</span> {
<a name="l01137"></a>01137           <span class="keywordflow">if</span>(dest_buf-&gt;<a class="code" href="classBufferState.html#a394b0fa81be8085b291b2768c487fafa">IsFullFor</a>(cf-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>)) {
<a name="l01138"></a>01138             <span class="keywordflow">if</span>(cf-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l01139"></a>01139               *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span> &lt;&lt; <a class="code" href="classModule.html#a0eeaa2b9a7d2ba88ab05682444898b08">FullName</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l01140"></a>01140               &lt;&lt; <span class="stringliteral">&quot;Selected output VC &quot;</span> &lt;&lt; cf-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>
<a name="l01141"></a>01141               &lt;&lt; <span class="stringliteral">&quot; is full for flit &quot;</span> &lt;&lt; cf-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l01142"></a>01142               &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l01143"></a>01143             }
<a name="l01144"></a>01144           } <span class="keywordflow">else</span> {
<a name="l01145"></a>01145             f = cf;
<a name="l01146"></a>01146           }
<a name="l01147"></a>01147         }
<a name="l01148"></a>01148       }
<a name="l01149"></a>01149       
<a name="l01150"></a>01150       <span class="keywordflow">if</span>(f) {
<a name="l01151"></a>01151         
<a name="l01152"></a>01152         assert(f-&gt;<a class="code" href="structFlit.html#adb2b8310c7a44302a1ab07f4f7bec2a5">subnetwork</a> == subnet);
<a name="l01153"></a>01153         
<a name="l01154"></a>01154         <span class="keywordtype">int</span> <span class="keyword">const</span> c = f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>;
<a name="l01155"></a>01155         
<a name="l01156"></a>01156         <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#a784a6bcb041646c2b8c068b7de4bdc9a">head</a>) {
<a name="l01157"></a>01157           
<a name="l01158"></a>01158           <span class="keywordflow">if</span> (<a class="code" href="classTrafficManager.html#a91a6036667c1793b9af0885329d4711d">_lookahead_routing</a>) {
<a name="l01159"></a>01159             <span class="keywordflow">if</span>(!<a class="code" href="classTrafficManager.html#a7d1ae95f37124ebfdd8f16613c207543">_noq</a>) {
<a name="l01160"></a>01160               <span class="keyword">const</span> <a class="code" href="classFlitChannel.html">FlitChannel</a> * inject = <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#a3a1288b1369386753eccb1e00dbf8661">GetInject</a>(<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l01161"></a>01161               <span class="keyword">const</span> <a class="code" href="classRouter.html">Router</a> * router = inject-&gt;<a class="code" href="classFlitChannel.html#aebe1f93809d4b635f765e6aa0ed9e5e6">GetSink</a>();
<a name="l01162"></a>01162               assert(router);
<a name="l01163"></a>01163               <span class="keywordtype">int</span> in_channel = inject-&gt;<a class="code" href="classFlitChannel.html#af2750ab732b47425865e409ba149f1e5">GetSinkPort</a>();
<a name="l01164"></a>01164               <a class="code" href="classTrafficManager.html#a2d1cccd0f50ec0972bdb666e9b234b72">_rf</a>(router, f, in_channel, &amp;f-&gt;<a class="code" href="structFlit.html#a165c0bf438da93ef32850f4d3c4e9a1c">la_route_set</a>, <span class="keyword">false</span>);
<a name="l01165"></a>01165               <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l01166"></a>01166                 *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l01167"></a>01167                 &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l01168"></a>01168                 &lt;&lt; <span class="stringliteral">&quot;Generating lookahead routing info for flit &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l01169"></a>01169                 &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l01170"></a>01170               }
<a name="l01171"></a>01171             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l01172"></a>01172               *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l01173"></a>01173               &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l01174"></a>01174               &lt;&lt; <span class="stringliteral">&quot;Already generated lookahead routing info for flit &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l01175"></a>01175               &lt;&lt; <span class="stringliteral">&quot; (NOQ).&quot;</span> &lt;&lt; endl;
<a name="l01176"></a>01176             }
<a name="l01177"></a>01177           } <span class="keywordflow">else</span> {
<a name="l01178"></a>01178             f-&gt;<a class="code" href="structFlit.html#a165c0bf438da93ef32850f4d3c4e9a1c">la_route_set</a>.<a class="code" href="classOutputSet.html#a6bfd3bb1f62d8fe65b981e6bc25fd241">Clear</a>();
<a name="l01179"></a>01179           }
<a name="l01180"></a>01180           
<a name="l01181"></a>01181           dest_buf-&gt;<a class="code" href="classBufferState.html#a8715055b64af2cb8fef29488ae5888a9">TakeBuffer</a>(f-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>);
<a name="l01182"></a>01182           <a class="code" href="classTrafficManager.html#aa7d75937add38ae15463b43499993725">_last_vc</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet][c] = f-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>;
<a name="l01183"></a>01183         }
<a name="l01184"></a>01184         
<a name="l01185"></a>01185         <a class="code" href="classTrafficManager.html#a6105ccff8bfd383dea19a3f8403e263f">_last_class</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet] = c;
<a name="l01186"></a>01186         
<a name="l01187"></a>01187         <a class="code" href="classTrafficManager.html#a874d663095760b20ec91b9884201c1ac">_partial_packets</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][c].pop_front();
<a name="l01188"></a>01188         
<a name="l01189"></a>01189 <span class="preprocessor">#ifdef TRACK_FLOWS</span>
<a name="l01190"></a>01190 <span class="preprocessor"></span>        ++<a class="code" href="classTrafficManager.html#a5d2d639d839c07d750bc632b85a304c6">_outstanding_credits</a>[c][subnet][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>];
<a name="l01191"></a>01191         <a class="code" href="classTrafficManager.html#a35866d4b27b9edc686f0e94d3810c8ee">_outstanding_classes</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][subnet][f-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>].push(c);
<a name="l01192"></a>01192 <span class="preprocessor">#endif</span>
<a name="l01193"></a>01193 <span class="preprocessor"></span>        
<a name="l01194"></a>01194         dest_buf-&gt;<a class="code" href="classBufferState.html#a1d09d10fe55b796a83839cb18df0c982">SendingFlit</a>(f);
<a name="l01195"></a>01195         
<a name="l01196"></a>01196         <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a23397b6a37ec6aab95391d2a6299b6b1">_pri_type</a> == <a class="code" href="classTrafficManager.html#ac706e7c128918cbe8dc015ca03c1a26da94465a3b3fa9a118ff7ba49ee559adc0">network_age_based</a>) {
<a name="l01197"></a>01197           f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> = numeric_limits&lt;int&gt;::max() - <a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a>;
<a name="l01198"></a>01198           assert(f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a> &gt;= 0);
<a name="l01199"></a>01199         }
<a name="l01200"></a>01200         
<a name="l01201"></a>01201         <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l01202"></a>01202           *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l01203"></a>01203           &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l01204"></a>01204           &lt;&lt; <span class="stringliteral">&quot;Injecting flit &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#aeae7d176eaa77ba7300abee6afbee8a4">id</a>
<a name="l01205"></a>01205           &lt;&lt; <span class="stringliteral">&quot; into subnet &quot;</span> &lt;&lt; subnet
<a name="l01206"></a>01206           &lt;&lt; <span class="stringliteral">&quot; at time &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a>
<a name="l01207"></a>01207           &lt;&lt; <span class="stringliteral">&quot; with priority &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a456dfde0b6f798ca6df5050ed6a36ca5">pri</a>
<a name="l01208"></a>01208           &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l01209"></a>01209         }
<a name="l01210"></a>01210         f-&gt;<a class="code" href="structFlit.html#ad021c9f024c254122d90482fafae5b0c">itime</a> = <a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a>;
<a name="l01211"></a>01211         
<a name="l01212"></a>01212         <span class="comment">// Pass VC &quot;back&quot;</span>
<a name="l01213"></a>01213         <span class="keywordflow">if</span>(!<a class="code" href="classTrafficManager.html#a874d663095760b20ec91b9884201c1ac">_partial_packets</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][c].empty() &amp;&amp; !f-&gt;<a class="code" href="structFlit.html#aa0f32295d57acd313ddf257127b5c850">tail</a>) {
<a name="l01214"></a>01214           <a class="code" href="structFlit.html">Flit</a> * <span class="keyword">const</span> nf = <a class="code" href="classTrafficManager.html#a874d663095760b20ec91b9884201c1ac">_partial_packets</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][c].front();
<a name="l01215"></a>01215           nf-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a> = f-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>;
<a name="l01216"></a>01216         }
<a name="l01217"></a>01217         
<a name="l01218"></a>01218         <span class="keywordflow">if</span>((<a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a0e1683a4848299c524150f6e6c7f6930">warming_up</a>) || (<a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a45cd3e451a01f617c16a995cb7c6c9ac">running</a>)) {
<a name="l01219"></a>01219           ++<a class="code" href="classTrafficManager.html#a62c2881d71bd8a580c008cebf2753012">_sent_flits</a>[c][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>];
<a name="l01220"></a>01220           <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#a784a6bcb041646c2b8c068b7de4bdc9a">head</a>) {
<a name="l01221"></a>01221             ++<a class="code" href="classTrafficManager.html#a552ccfae3f5aad4c71b188d97614012d">_sent_packets</a>[c][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>];
<a name="l01222"></a>01222           }
<a name="l01223"></a>01223         }
<a name="l01224"></a>01224         
<a name="l01225"></a>01225 <span class="preprocessor">#ifdef TRACK_FLOWS</span>
<a name="l01226"></a>01226 <span class="preprocessor"></span>        ++<a class="code" href="classTrafficManager.html#ab399ac65874834ae1ad6ce99939dfbea">_injected_flits</a>[c][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>];
<a name="l01227"></a>01227 <span class="preprocessor">#endif</span>
<a name="l01228"></a>01228 <span class="preprocessor"></span>        
<a name="l01229"></a>01229         <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#a6ae45fa6d6fb4a0c8bdd7f31436ead11">WriteFlit</a>(f, <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l01230"></a>01230         
<a name="l01231"></a>01231       }
<a name="l01232"></a>01232     }
<a name="l01233"></a>01233   }
<a name="l01234"></a>01234   
<a name="l01235"></a>01235   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> subnet = 0; subnet &lt; _subnets; ++subnet) {
<a name="l01236"></a>01236     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> = 0; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt; _nodes; ++<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) {
<a name="l01237"></a>01237       map&lt;int, Flit *&gt;::const_iterator iter = flits[subnet].find(<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l01238"></a>01238       <span class="keywordflow">if</span>(iter != flits[subnet].end()) {
<a name="l01239"></a>01239         <a class="code" href="structFlit.html">Flit</a> * <span class="keyword">const</span> f = iter-&gt;second;
<a name="l01240"></a>01240         
<a name="l01241"></a>01241         f-&gt;<a class="code" href="structFlit.html#a4e01e3acc8186654d2f97641e0a4c415">atime</a> = <a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a>;
<a name="l01242"></a>01242         <span class="keywordflow">if</span>(f-&gt;<a class="code" href="structFlit.html#aa5328bdf6d139ea1c8e503228bf8aae5">watch</a>) {
<a name="l01243"></a>01243           *<a class="code" href="globals_8hpp.html#a54233075d19c60edbe29257351f7fe3d">gWatchOut</a> &lt;&lt; <a class="code" href="globals_8hpp.html#ad223077827fd15227dc1bd007980a296">GetSimTime</a>() &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l01244"></a>01244           &lt;&lt; <span class="stringliteral">&quot;node&quot;</span> &lt;&lt; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt;&lt; <span class="stringliteral">&quot; | &quot;</span>
<a name="l01245"></a>01245           &lt;&lt; <span class="stringliteral">&quot;Injecting credit for VC &quot;</span> &lt;&lt; f-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>
<a name="l01246"></a>01246           &lt;&lt; <span class="stringliteral">&quot; into subnet &quot;</span> &lt;&lt; subnet
<a name="l01247"></a>01247           &lt;&lt; <span class="stringliteral">&quot;.&quot;</span> &lt;&lt; endl;
<a name="l01248"></a>01248         }
<a name="l01249"></a>01249         <a class="code" href="classCredit.html">Credit</a> * <span class="keyword">const</span> c = <a class="code" href="classTrafficManager.html#ae5023ac53f1deb85540abe79a174db26">Credit::New</a>();
<a name="l01250"></a>01250         c-&gt;<a class="code" href="classCredit.html#af7898eb802885a65e5270096e0595abe">vc</a>.insert(f-&gt;<a class="code" href="structFlit.html#a91f87fc20463a5fe6ea5e9e035991701">vc</a>);
<a name="l01251"></a>01251         <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#a29ed2215fd1bb54fa20e9429804a460f">WriteCredit</a>(c, <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l01252"></a>01252         
<a name="l01253"></a>01253 <span class="preprocessor">#ifdef TRACK_FLOWS</span>
<a name="l01254"></a>01254 <span class="preprocessor"></span>        ++<a class="code" href="classTrafficManager.html#a5750805ce26dfd96ae787a67886705e3">_ejected_flits</a>[f-&gt;<a class="code" href="structFlit.html#a83d53659b651973e2905fa92140e6ae8">cl</a>][<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>];
<a name="l01255"></a>01255 <span class="preprocessor">#endif</span>
<a name="l01256"></a>01256 <span class="preprocessor"></span>        
<a name="l01257"></a>01257         <a class="code" href="classTrafficManager.html#a5a56d7a257db0dbfdf6e90f7dd85aac7">_RetireFlit</a>(f, <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>);
<a name="l01258"></a>01258       }
<a name="l01259"></a>01259     }
<a name="l01260"></a>01260     flits[subnet].clear();
<a name="l01261"></a>01261     <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#a7c07ce3ba986fa4ece480d69e77bc306">Evaluate</a>( );
<a name="l01262"></a>01262     <a class="code" href="classTrafficManager.html#abe26d308dc81dff781787614fb6dc89c">_net</a>[subnet]-&gt;<a class="code" href="classNetwork.html#a263b74ad4788388f53820a69633f0e24">WriteOutputs</a>( );
<a name="l01263"></a>01263   }
<a name="l01264"></a>01264   
<a name="l01265"></a>01265   ++<a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a>;
<a name="l01266"></a>01266   assert(<a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a>);
<a name="l01267"></a>01267   <span class="keywordflow">if</span>(<a class="code" href="globals_8hpp.html#a35b664146e55660800a67a648cf6748d">gTrace</a>){
<a name="l01268"></a>01268     cout&lt;&lt;<span class="stringliteral">&quot;TIME &quot;</span>&lt;&lt;<a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a>&lt;&lt;endl;
<a name="l01269"></a>01269   }
<a name="l01270"></a>01270   
<a name="l01271"></a>01271 }
<a name="l01272"></a>01272 
<a name="l01273"></a>01273 <span class="keywordtype">bool</span> <a class="code" href="classTrafficManager.html#a74a95cab7775e95e7f081923b6849b87">TrafficManager::_PacketsOutstanding</a>( )<span class="keyword"> const</span>
<a name="l01274"></a>01274 <span class="keyword"></span>{
<a name="l01275"></a>01275   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> c = 0; c &lt; _classes; ++c ) {
<a name="l01276"></a>01276     <span class="keywordflow">if</span> ( <a class="code" href="classTrafficManager.html#a549fe0af403657daf47db078f7f1814a">_measure_stats</a>[c] ) {
<a name="l01277"></a>01277       <span class="keywordflow">if</span> ( <a class="code" href="classTrafficManager.html#ab3f440b8929d778298a078fff4fe492f">_measured_in_flight_flits</a>[c].empty() ) {
<a name="l01278"></a>01278         
<a name="l01279"></a>01279         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> s = 0; s &lt; _nodes; ++s ) {
<a name="l01280"></a>01280           <span class="keywordflow">if</span> ( !<a class="code" href="classTrafficManager.html#a459f440795a908884f21277f0760d9e5">_qdrained</a>[s][c] ) {
<a name="l01281"></a>01281 <span class="preprocessor">#ifdef DEBUG_DRAIN</span>
<a name="l01282"></a>01282 <span class="preprocessor"></span>            cout &lt;&lt; <span class="stringliteral">&quot;waiting on queue &quot;</span> &lt;&lt; s &lt;&lt; <span class="stringliteral">&quot; class &quot;</span> &lt;&lt; c;
<a name="l01283"></a>01283             cout &lt;&lt; <span class="stringliteral">&quot;, time = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a> &lt;&lt; <span class="stringliteral">&quot; qtime = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#af4ee79a64ee0255447003b93fd9641e7">_qtime</a>[s][c] &lt;&lt; endl;
<a name="l01284"></a>01284 <span class="preprocessor">#endif</span>
<a name="l01285"></a>01285 <span class="preprocessor"></span>            <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01286"></a>01286           }
<a name="l01287"></a>01287         }
<a name="l01288"></a>01288       } <span class="keywordflow">else</span> {
<a name="l01289"></a>01289 <span class="preprocessor">#ifdef DEBUG_DRAIN</span>
<a name="l01290"></a>01290 <span class="preprocessor"></span>        cout &lt;&lt; <span class="stringliteral">&quot;in flight = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ab3f440b8929d778298a078fff4fe492f">_measured_in_flight_flits</a>[c].size() &lt;&lt; endl;
<a name="l01291"></a>01291 <span class="preprocessor">#endif</span>
<a name="l01292"></a>01292 <span class="preprocessor"></span>        <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01293"></a>01293       }
<a name="l01294"></a>01294     }
<a name="l01295"></a>01295   }
<a name="l01296"></a>01296   <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01297"></a>01297 }
<a name="l01298"></a>01298 
<a name="l01299"></a>01299 <span class="keywordtype">void</span> <a class="code" href="classTrafficManager.html#a4c41f2d968cd1a84e4cc63dc32fb7d88">TrafficManager::_ClearStats</a>( )
<a name="l01300"></a>01300 {
<a name="l01301"></a>01301   <a class="code" href="classTrafficManager.html#a4a883d0cafe388d38cbe80a40509a23c">_slowest_flit</a>.assign(_classes, -1);
<a name="l01302"></a>01302   <a class="code" href="classTrafficManager.html#abd64d715d45401f6306d9f512d50ae66">_slowest_packet</a>.assign(_classes, -1);
<a name="l01303"></a>01303   
<a name="l01304"></a>01304   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> c = 0; c &lt; _classes; ++c ) {
<a name="l01305"></a>01305     
<a name="l01306"></a>01306     <a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[c]-&gt;Clear( );
<a name="l01307"></a>01307     <a class="code" href="classTrafficManager.html#a9180e022d85c6388bfd7e58cbfc10b47">_nlat_stats</a>[c]-&gt;Clear( );
<a name="l01308"></a>01308     <a class="code" href="classTrafficManager.html#ab435afa5236277ff8d6a1991860cf546">_flat_stats</a>[c]-&gt;Clear( );
<a name="l01309"></a>01309     
<a name="l01310"></a>01310     <a class="code" href="classTrafficManager.html#a7f160ac254d3ceabd825f1c59f42b179">_frag_stats</a>[c]-&gt;Clear( );
<a name="l01311"></a>01311     
<a name="l01312"></a>01312     <a class="code" href="classTrafficManager.html#a552ccfae3f5aad4c71b188d97614012d">_sent_packets</a>[c].assign(_nodes, 0);
<a name="l01313"></a>01313     <a class="code" href="classTrafficManager.html#acec4c1294844394b7bf8008f5b920593">_accepted_packets</a>[c].assign(_nodes, 0);
<a name="l01314"></a>01314     <a class="code" href="classTrafficManager.html#a62c2881d71bd8a580c008cebf2753012">_sent_flits</a>[c].assign(_nodes, 0);
<a name="l01315"></a>01315     <a class="code" href="classTrafficManager.html#a089e444802486d4e5092066d4c357c30">_accepted_flits</a>[c].assign(_nodes, 0);
<a name="l01316"></a>01316     
<a name="l01317"></a>01317 <span class="preprocessor">#ifdef TRACK_STALLS</span>
<a name="l01318"></a>01318 <span class="preprocessor"></span>    <a class="code" href="classTrafficManager.html#a1c784a6d1925a67a090fdcd2d4ea69c1">_buffer_busy_stalls</a>[c].assign(_subnets*<a class="code" href="classTrafficManager.html#a60f79ec184e9dbd5ef5caa0a9b909558">_routers</a>, 0);
<a name="l01319"></a>01319     <a class="code" href="classTrafficManager.html#ae28ad10bf987f3edaea11411237c2da5">_buffer_conflict_stalls</a>[c].assign(_subnets*_routers, 0);
<a name="l01320"></a>01320     <a class="code" href="classTrafficManager.html#a9933b441d6750f35f7622e69c0baa0a0">_buffer_full_stalls</a>[c].assign(_subnets*_routers, 0);
<a name="l01321"></a>01321     <a class="code" href="classTrafficManager.html#aa1a62024edeb3fbcbcd12a4c15c75c1c">_buffer_reserved_stalls</a>[c].assign(_subnets*_routers, 0);
<a name="l01322"></a>01322     <a class="code" href="classTrafficManager.html#afb85e3761a4ff0c6a9330e6f47ea6314">_crossbar_conflict_stalls</a>[c].assign(_subnets*_routers, 0);
<a name="l01323"></a>01323 <span class="preprocessor">#endif</span>
<a name="l01324"></a>01324 <span class="preprocessor"></span>    <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#adf6295f17ea12f4e88790d2debdbc4d5">_pair_stats</a>){
<a name="l01325"></a>01325       <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 0; i &lt; _nodes; ++i ) {
<a name="l01326"></a>01326         <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> j = 0; j &lt; _nodes; ++j ) {
<a name="l01327"></a>01327           <a class="code" href="classTrafficManager.html#a4e8c501fc2d871203dc729ecea28b9bd">_pair_plat</a>[c][i*_nodes+j]-&gt;Clear( );
<a name="l01328"></a>01328           <a class="code" href="classTrafficManager.html#a03c78594e1d4a1145ea27816ef786bde">_pair_nlat</a>[c][i*_nodes+j]-&gt;Clear( );
<a name="l01329"></a>01329           <a class="code" href="classTrafficManager.html#a353557bf34f140be9b12f9e92c9f4006">_pair_flat</a>[c][i*_nodes+j]-&gt;Clear( );
<a name="l01330"></a>01330         }
<a name="l01331"></a>01331       }
<a name="l01332"></a>01332     }
<a name="l01333"></a>01333     <a class="code" href="classTrafficManager.html#ac9385813fa2b42c908cdf532ec9405c6">_hop_stats</a>[c]-&gt;<a class="code" href="classStats.html#a164316bc5bead9a21a37f4a404e0751d">Clear</a>();
<a name="l01334"></a>01334     
<a name="l01335"></a>01335   }
<a name="l01336"></a>01336   
<a name="l01337"></a>01337   <a class="code" href="classTrafficManager.html#a056be33c6e4eaac14e7105f31e804748">_reset_time</a> = <a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a>;
<a name="l01338"></a>01338 }
<a name="l01339"></a>01339 
<a name="l01340"></a><a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">01340</a> <span class="keywordtype">void</span> <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">TrafficManager::_ComputeStats</a>( <span class="keyword">const</span> vector&lt;int&gt; &amp; stats, <span class="keywordtype">int</span> *sum, <span class="keywordtype">int</span> *min, <span class="keywordtype">int</span> *max, <span class="keywordtype">int</span> *min_pos, <span class="keywordtype">int</span> *max_pos )<span class="keyword"> const</span>
<a name="l01341"></a>01341 <span class="keyword"></span>{
<a name="l01342"></a>01342   <span class="keywordtype">int</span> <span class="keyword">const</span> count = stats.size();
<a name="l01343"></a>01343   assert(count &gt; 0);
<a name="l01344"></a>01344   
<a name="l01345"></a>01345   <span class="keywordflow">if</span>(min_pos) {
<a name="l01346"></a>01346     *min_pos = 0;
<a name="l01347"></a>01347   }
<a name="l01348"></a>01348   <span class="keywordflow">if</span>(max_pos) {
<a name="l01349"></a>01349     *max_pos = 0;
<a name="l01350"></a>01350   }
<a name="l01351"></a>01351   
<a name="l01352"></a>01352   <span class="keywordflow">if</span>(min) {
<a name="l01353"></a>01353     *min = stats[0];
<a name="l01354"></a>01354   }
<a name="l01355"></a>01355   <span class="keywordflow">if</span>(max) {
<a name="l01356"></a>01356     *max = stats[0];
<a name="l01357"></a>01357   }
<a name="l01358"></a>01358   
<a name="l01359"></a>01359   *sum = stats[0];
<a name="l01360"></a>01360   
<a name="l01361"></a>01361   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> i = 1; i &lt; count; ++i ) {
<a name="l01362"></a>01362     <span class="keywordtype">int</span> curr = stats[i];
<a name="l01363"></a>01363     <span class="keywordflow">if</span> ( min  &amp;&amp; ( curr &lt; *min ) ) {
<a name="l01364"></a>01364       *min = curr;
<a name="l01365"></a>01365       <span class="keywordflow">if</span> ( min_pos ) {
<a name="l01366"></a>01366         *min_pos = i;
<a name="l01367"></a>01367       }
<a name="l01368"></a>01368     }
<a name="l01369"></a>01369     <span class="keywordflow">if</span> ( max &amp;&amp; ( curr &gt; *max ) ) {
<a name="l01370"></a>01370       *max = curr;
<a name="l01371"></a>01371       <span class="keywordflow">if</span> ( max_pos ) {
<a name="l01372"></a>01372         *max_pos = i;
<a name="l01373"></a>01373       }
<a name="l01374"></a>01374     }
<a name="l01375"></a>01375     *sum += curr;
<a name="l01376"></a>01376   }
<a name="l01377"></a>01377 }
<a name="l01378"></a>01378 
<a name="l01379"></a><a class="code" href="classTrafficManager.html#aceee230773c71b41588c64aa4503b741">01379</a> <span class="keywordtype">void</span> <a class="code" href="classTrafficManager.html#a6c1c2eaa1cb0c9908d6eb3cc492f6d3e">TrafficManager::_DisplayRemaining</a>( ostream &amp; os )<span class="keyword"> const</span>
<a name="l01380"></a>01380 <span class="keyword"></span>{
<a name="l01381"></a>01381   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; _classes; ++c) {
<a name="l01382"></a>01382     
<a name="l01383"></a>01383     map&lt;int, Flit *&gt;::const_iterator iter;
<a name="l01384"></a>01384     <span class="keywordtype">int</span> i;
<a name="l01385"></a>01385     
<a name="l01386"></a>01386     os &lt;&lt; <span class="stringliteral">&quot;Class &quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; endl;
<a name="l01387"></a>01387     
<a name="l01388"></a>01388     os &lt;&lt; <span class="stringliteral">&quot;Remaining flits: &quot;</span>;
<a name="l01389"></a>01389     <span class="keywordflow">for</span> ( iter = <a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>[c].begin( ), i = 0;
<a name="l01390"></a>01390          ( iter != <a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>[c].end( ) ) &amp;&amp; ( i &lt; 10 );
<a name="l01391"></a>01391          iter++, i++ ) {
<a name="l01392"></a>01392       os &lt;&lt; iter-&gt;first &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l01393"></a>01393     }
<a name="l01394"></a>01394     <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>[c].size() &gt; 10)
<a name="l01395"></a>01395       os &lt;&lt; <span class="stringliteral">&quot;[...] &quot;</span>;
<a name="l01396"></a>01396     
<a name="l01397"></a>01397     os &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>[c].size() &lt;&lt; <span class="stringliteral">&quot; flits)&quot;</span> &lt;&lt; endl;
<a name="l01398"></a>01398     
<a name="l01399"></a>01399     os &lt;&lt; <span class="stringliteral">&quot;Measured flits: &quot;</span>;
<a name="l01400"></a>01400     <span class="keywordflow">for</span> ( iter = <a class="code" href="classTrafficManager.html#ab3f440b8929d778298a078fff4fe492f">_measured_in_flight_flits</a>[c].begin( ), i = 0;
<a name="l01401"></a>01401          ( iter != <a class="code" href="classTrafficManager.html#ab3f440b8929d778298a078fff4fe492f">_measured_in_flight_flits</a>[c].end( ) ) &amp;&amp; ( i &lt; 10 );
<a name="l01402"></a>01402          iter++, i++ ) {
<a name="l01403"></a>01403       os &lt;&lt; iter-&gt;first &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l01404"></a>01404     }
<a name="l01405"></a>01405     <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#ab3f440b8929d778298a078fff4fe492f">_measured_in_flight_flits</a>[c].size() &gt; 10)
<a name="l01406"></a>01406       os &lt;&lt; <span class="stringliteral">&quot;[...] &quot;</span>;
<a name="l01407"></a>01407     
<a name="l01408"></a>01408     os &lt;&lt; <span class="stringliteral">&quot;(&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ab3f440b8929d778298a078fff4fe492f">_measured_in_flight_flits</a>[c].size() &lt;&lt; <span class="stringliteral">&quot; flits)&quot;</span> &lt;&lt; endl;
<a name="l01409"></a>01409     
<a name="l01410"></a>01410   }
<a name="l01411"></a>01411 }
<a name="l01412"></a>01412 
<a name="l01413"></a>01413 <span class="keywordtype">bool</span> <a class="code" href="classTrafficManager.html#aa6088c57ad4c0f389931cc062ee6ad2b">TrafficManager::_SingleSim</a>( )
<a name="l01414"></a>01414 {
<a name="l01415"></a>01415   <span class="keywordtype">int</span> converged = 0;
<a name="l01416"></a>01416   
<a name="l01417"></a>01417   <span class="comment">//once warmed up, we require 3 converging runs to end the simulation</span>
<a name="l01418"></a>01418   vector&lt;double&gt; prev_latency(_classes, 0.0);
<a name="l01419"></a>01419   vector&lt;double&gt; prev_accepted(_classes, 0.0);
<a name="l01420"></a>01420   <span class="keywordtype">bool</span> clear_last = <span class="keyword">false</span>;
<a name="l01421"></a>01421   <span class="keywordtype">int</span> total_phases = 0;
<a name="l01422"></a>01422   <span class="keywordflow">while</span>( ( total_phases &lt; <a class="code" href="classTrafficManager.html#ac8c1fb9e1e1ee41800ff75970ba20771">_max_samples</a> ) &amp;&amp;
<a name="l01423"></a>01423         ( ( <a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> != <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a45cd3e451a01f617c16a995cb7c6c9ac">running</a> ) ||
<a name="l01424"></a>01424          ( converged &lt; 3 ) ) ) {
<a name="l01425"></a>01425           
<a name="l01426"></a>01426           <span class="keywordflow">if</span> ( clear_last || (( ( <a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a0e1683a4848299c524150f6e6c7f6930">warming_up</a> ) &amp;&amp; ( ( total_phases % 2 ) == 0 ) )) ) {
<a name="l01427"></a>01427             clear_last = <span class="keyword">false</span>;
<a name="l01428"></a>01428             <a class="code" href="classTrafficManager.html#a4c41f2d968cd1a84e4cc63dc32fb7d88">_ClearStats</a>( );
<a name="l01429"></a>01429           }
<a name="l01430"></a>01430           
<a name="l01431"></a>01431           
<a name="l01432"></a>01432           <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> iter = 0; iter &lt; <a class="code" href="classTrafficManager.html#a798efdfb2596e9248a88c1b294765aac">_sample_period</a>; ++iter )
<a name="l01433"></a>01433             <a class="code" href="classTrafficManager.html#ae2f9ae1d30700cb03c2922b41b977c1d">_Step</a>( );
<a name="l01434"></a>01434           
<a name="l01435"></a>01435           <span class="comment">//cout &lt;&lt; _sim_state &lt;&lt; endl;</span>
<a name="l01436"></a>01436           
<a name="l01437"></a>01437           <a class="code" href="classTrafficManager.html#aba8e9da5dab0aa24e22d3196c13e7408">UpdateStats</a>();
<a name="l01438"></a>01438           <a class="code" href="classTrafficManager.html#ad73e9b9cf6de7d0296c0b6aaab9c918c">DisplayStats</a>();
<a name="l01439"></a>01439           
<a name="l01440"></a>01440           <span class="keywordtype">int</span> lat_exc_class = -1;
<a name="l01441"></a>01441           <span class="keywordtype">int</span> lat_chg_exc_class = -1;
<a name="l01442"></a>01442           <span class="keywordtype">int</span> acc_chg_exc_class = -1;
<a name="l01443"></a>01443           
<a name="l01444"></a>01444           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; _classes; ++c) {
<a name="l01445"></a>01445             
<a name="l01446"></a>01446             <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a549fe0af403657daf47db078f7f1814a">_measure_stats</a>[c] == 0) {
<a name="l01447"></a>01447               <span class="keywordflow">continue</span>;
<a name="l01448"></a>01448             }
<a name="l01449"></a>01449             
<a name="l01450"></a>01450             <span class="keywordtype">double</span> cur_latency = <a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[c]-&gt;Average( );
<a name="l01451"></a>01451             
<a name="l01452"></a>01452             <span class="keywordtype">int</span> total_accepted_count;
<a name="l01453"></a>01453             <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">_ComputeStats</a>( <a class="code" href="classTrafficManager.html#a089e444802486d4e5092066d4c357c30">_accepted_flits</a>[c], &amp;total_accepted_count );
<a name="l01454"></a>01454             <span class="keywordtype">double</span> total_accepted_rate = (double)total_accepted_count / (<span class="keywordtype">double</span>)(<a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a> - <a class="code" href="classTrafficManager.html#a056be33c6e4eaac14e7105f31e804748">_reset_time</a>);
<a name="l01455"></a>01455             <span class="keywordtype">double</span> cur_accepted = total_accepted_rate / (double)_nodes;
<a name="l01456"></a>01456             
<a name="l01457"></a>01457             <span class="keywordtype">double</span> latency_change = fabs((cur_latency - prev_latency[c]) / cur_latency);
<a name="l01458"></a>01458             prev_latency[c] = cur_latency;
<a name="l01459"></a>01459             
<a name="l01460"></a>01460             <span class="keywordtype">double</span> accepted_change = fabs((cur_accepted - prev_accepted[c]) / cur_accepted);
<a name="l01461"></a>01461             prev_accepted[c] = cur_accepted;
<a name="l01462"></a>01462             
<a name="l01463"></a>01463             <span class="keywordtype">double</span> <a class="code" href="classTrafficManager.html#ae7f13c8e70532b1edd8779f6a16e2392a107854be2738f73a1c062a42d4981cba">latency</a> = (double)<a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[c]-&gt;Sum();
<a name="l01464"></a>01464             <span class="keywordtype">double</span> count = (double)<a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[c]-&gt;NumSamples();
<a name="l01465"></a>01465             
<a name="l01466"></a>01466             map&lt;int, Flit *&gt;::const_iterator iter;
<a name="l01467"></a>01467             <span class="keywordflow">for</span>(iter = <a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>[c].begin();
<a name="l01468"></a>01468                 iter != <a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>[c].end();
<a name="l01469"></a>01469                 iter++) {
<a name="l01470"></a>01470               latency += (double)(<a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a> - iter-&gt;second-&gt;ctime);
<a name="l01471"></a>01471               count++;
<a name="l01472"></a>01472             }
<a name="l01473"></a>01473             
<a name="l01474"></a>01474             <span class="keywordflow">if</span>((lat_exc_class &lt; 0) &amp;&amp;
<a name="l01475"></a>01475                (<a class="code" href="classTrafficManager.html#aeb1705809e2804d8889c651d8a96a108">_latency_thres</a>[c] &gt;= 0.0) &amp;&amp;
<a name="l01476"></a>01476                ((latency / count) &gt; <a class="code" href="classTrafficManager.html#aeb1705809e2804d8889c651d8a96a108">_latency_thres</a>[c])) {
<a name="l01477"></a>01477               lat_exc_class = c;
<a name="l01478"></a>01478             }
<a name="l01479"></a>01479             
<a name="l01480"></a>01480             cout &lt;&lt; <span class="stringliteral">&quot;latency change    = &quot;</span> &lt;&lt; latency_change &lt;&lt; endl;
<a name="l01481"></a>01481             <span class="keywordflow">if</span>(lat_chg_exc_class &lt; 0) {
<a name="l01482"></a>01482               <span class="keywordflow">if</span>((<a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a0e1683a4848299c524150f6e6c7f6930">warming_up</a>) &amp;&amp;
<a name="l01483"></a>01483                  (<a class="code" href="classTrafficManager.html#a17552f4911c07e3de3846692e119d7c8">_warmup_threshold</a>[c] &gt;= 0.0) &amp;&amp;
<a name="l01484"></a>01484                  (latency_change &gt; <a class="code" href="classTrafficManager.html#a17552f4911c07e3de3846692e119d7c8">_warmup_threshold</a>[c])) {
<a name="l01485"></a>01485                 lat_chg_exc_class = c;
<a name="l01486"></a>01486               } <span class="keywordflow">else</span> <span class="keywordflow">if</span>((<a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a45cd3e451a01f617c16a995cb7c6c9ac">running</a>) &amp;&amp;
<a name="l01487"></a>01487                         (<a class="code" href="classTrafficManager.html#abf5b4d9b9d5cbf5004c49a2dc2fedb49">_stopping_threshold</a>[c] &gt;= 0.0) &amp;&amp;
<a name="l01488"></a>01488                         (latency_change &gt; <a class="code" href="classTrafficManager.html#abf5b4d9b9d5cbf5004c49a2dc2fedb49">_stopping_threshold</a>[c])) {
<a name="l01489"></a>01489                 lat_chg_exc_class = c;
<a name="l01490"></a>01490               }
<a name="l01491"></a>01491             }
<a name="l01492"></a>01492             
<a name="l01493"></a>01493             cout &lt;&lt; <span class="stringliteral">&quot;throughput change = &quot;</span> &lt;&lt; accepted_change &lt;&lt; endl;
<a name="l01494"></a>01494             <span class="keywordflow">if</span>(acc_chg_exc_class &lt; 0) {
<a name="l01495"></a>01495               <span class="keywordflow">if</span>((<a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a0e1683a4848299c524150f6e6c7f6930">warming_up</a>) &amp;&amp;
<a name="l01496"></a>01496                  (<a class="code" href="classTrafficManager.html#aeb82484af539d2c614a772100894b181">_acc_warmup_threshold</a>[c] &gt;= 0.0) &amp;&amp;
<a name="l01497"></a>01497                  (accepted_change &gt; <a class="code" href="classTrafficManager.html#aeb82484af539d2c614a772100894b181">_acc_warmup_threshold</a>[c])) {
<a name="l01498"></a>01498                 acc_chg_exc_class = c;
<a name="l01499"></a>01499               } <span class="keywordflow">else</span> <span class="keywordflow">if</span>((<a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a45cd3e451a01f617c16a995cb7c6c9ac">running</a>) &amp;&amp;
<a name="l01500"></a>01500                         (<a class="code" href="classTrafficManager.html#ab738f4d5fdf15019f48b657202b51621">_acc_stopping_threshold</a>[c] &gt;= 0.0) &amp;&amp;
<a name="l01501"></a>01501                         (accepted_change &gt; <a class="code" href="classTrafficManager.html#ab738f4d5fdf15019f48b657202b51621">_acc_stopping_threshold</a>[c])) {
<a name="l01502"></a>01502                 acc_chg_exc_class = c;
<a name="l01503"></a>01503               }
<a name="l01504"></a>01504             }
<a name="l01505"></a>01505             
<a name="l01506"></a>01506           }
<a name="l01507"></a>01507           
<a name="l01508"></a>01508           <span class="comment">// Fail safe for latency mode, throughput will ust continue</span>
<a name="l01509"></a>01509           <span class="keywordflow">if</span> ( <a class="code" href="classTrafficManager.html#a8f2e82426a52fd9851be463915f256d7">_measure_latency</a> &amp;&amp; ( lat_exc_class &gt;= 0 ) ) {
<a name="l01510"></a>01510             
<a name="l01511"></a>01511             cout &lt;&lt; <span class="stringliteral">&quot;Average latency for class &quot;</span> &lt;&lt; lat_exc_class &lt;&lt; <span class="stringliteral">&quot; exceeded &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#aeb1705809e2804d8889c651d8a96a108">_latency_thres</a>[lat_exc_class] &lt;&lt; <span class="stringliteral">&quot; cycles. Aborting simulation.&quot;</span> &lt;&lt; endl;
<a name="l01512"></a>01512             converged = 0;
<a name="l01513"></a>01513             <a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> = <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a8fb168e417269911be683171fd918af3">draining</a>;
<a name="l01514"></a>01514             <a class="code" href="classTrafficManager.html#ad9fa73d16a3cb111fc593970370deaa6">_drain_time</a> = <a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a>;
<a name="l01515"></a>01515             <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#abf955f7ff7445e6daa441ea4b7f635c9">_stats_out</a>) {
<a name="l01516"></a>01516               <a class="code" href="classTrafficManager.html#a6077febc0598a6637ef7b2f22fbf0098">WriteStats</a>(*<a class="code" href="classTrafficManager.html#abf955f7ff7445e6daa441ea4b7f635c9">_stats_out</a>);
<a name="l01517"></a>01517             }
<a name="l01518"></a>01518             <span class="keywordflow">break</span>;
<a name="l01519"></a>01519             
<a name="l01520"></a>01520           }
<a name="l01521"></a>01521           
<a name="l01522"></a>01522           <span class="keywordflow">if</span> ( <a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a0e1683a4848299c524150f6e6c7f6930">warming_up</a> ) {
<a name="l01523"></a>01523             <span class="keywordflow">if</span> ( ( <a class="code" href="classTrafficManager.html#a522056dd2a33feaffe12f013eb5409d7">_warmup_periods</a> &gt; 0 ) ?
<a name="l01524"></a>01524                 ( total_phases + 1 &gt;= <a class="code" href="classTrafficManager.html#a522056dd2a33feaffe12f013eb5409d7">_warmup_periods</a> ) :
<a name="l01525"></a>01525                 ( ( !<a class="code" href="classTrafficManager.html#a8f2e82426a52fd9851be463915f256d7">_measure_latency</a> || ( lat_chg_exc_class &lt; 0 ) ) &amp;&amp;
<a name="l01526"></a>01526                  ( acc_chg_exc_class &lt; 0 ) ) ) {
<a name="l01527"></a>01527                   cout &lt;&lt; <span class="stringliteral">&quot;Warmed up ...&quot;</span> &lt;&lt;  <span class="stringliteral">&quot;Time used is &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a> &lt;&lt; <span class="stringliteral">&quot; cycles&quot;</span> &lt;&lt;endl;
<a name="l01528"></a>01528                   clear_last = <span class="keyword">true</span>;
<a name="l01529"></a>01529                   <a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> = <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a45cd3e451a01f617c16a995cb7c6c9ac">running</a>;
<a name="l01530"></a>01530                 }
<a name="l01531"></a>01531           } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a45cd3e451a01f617c16a995cb7c6c9ac">running</a>) {
<a name="l01532"></a>01532             <span class="keywordflow">if</span> ( ( !<a class="code" href="classTrafficManager.html#a8f2e82426a52fd9851be463915f256d7">_measure_latency</a> || ( lat_chg_exc_class &lt; 0 ) ) &amp;&amp;
<a name="l01533"></a>01533                 ( acc_chg_exc_class &lt; 0 ) ) {
<a name="l01534"></a>01534               ++converged;
<a name="l01535"></a>01535             } <span class="keywordflow">else</span> {
<a name="l01536"></a>01536               converged = 0;
<a name="l01537"></a>01537             }
<a name="l01538"></a>01538           }
<a name="l01539"></a>01539           ++total_phases;
<a name="l01540"></a>01540         }
<a name="l01541"></a>01541   
<a name="l01542"></a>01542   <span class="keywordflow">if</span> ( <a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> == <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a45cd3e451a01f617c16a995cb7c6c9ac">running</a> ) {
<a name="l01543"></a>01543     ++converged;
<a name="l01544"></a>01544     
<a name="l01545"></a>01545     <a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a>  = <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a8fb168e417269911be683171fd918af3">draining</a>;
<a name="l01546"></a>01546     <a class="code" href="classTrafficManager.html#ad9fa73d16a3cb111fc593970370deaa6">_drain_time</a> = <a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a>;
<a name="l01547"></a>01547     
<a name="l01548"></a>01548     <span class="keywordflow">if</span> ( <a class="code" href="classTrafficManager.html#a8f2e82426a52fd9851be463915f256d7">_measure_latency</a> ) {
<a name="l01549"></a>01549       cout &lt;&lt; <span class="stringliteral">&quot;Draining all recorded packets ...&quot;</span> &lt;&lt; endl;
<a name="l01550"></a>01550       <span class="keywordtype">int</span> empty_steps = 0;
<a name="l01551"></a>01551       <span class="keywordflow">while</span>( <a class="code" href="classTrafficManager.html#a74a95cab7775e95e7f081923b6849b87">_PacketsOutstanding</a>( ) ) {
<a name="l01552"></a>01552         <a class="code" href="classTrafficManager.html#ae2f9ae1d30700cb03c2922b41b977c1d">_Step</a>( );
<a name="l01553"></a>01553         
<a name="l01554"></a>01554         ++empty_steps;
<a name="l01555"></a>01555         
<a name="l01556"></a>01556         <span class="keywordflow">if</span> ( empty_steps % 1000 == 0 ) {
<a name="l01557"></a>01557           
<a name="l01558"></a>01558           <span class="keywordtype">int</span> lat_exc_class = -1;
<a name="l01559"></a>01559           
<a name="l01560"></a>01560           <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; _classes; c++) {
<a name="l01561"></a>01561             
<a name="l01562"></a>01562             <span class="keywordtype">double</span> threshold = <a class="code" href="classTrafficManager.html#aeb1705809e2804d8889c651d8a96a108">_latency_thres</a>[c];
<a name="l01563"></a>01563             
<a name="l01564"></a>01564             <span class="keywordflow">if</span>(threshold &lt; 0.0) {
<a name="l01565"></a>01565               <span class="keywordflow">continue</span>;
<a name="l01566"></a>01566             }
<a name="l01567"></a>01567             
<a name="l01568"></a>01568             <span class="keywordtype">double</span> acc_latency = <a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[c]-&gt;Sum();
<a name="l01569"></a>01569             <span class="keywordtype">double</span> acc_count = (double)<a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[c]-&gt;NumSamples();
<a name="l01570"></a>01570             
<a name="l01571"></a>01571             map&lt;int, Flit *&gt;::const_iterator iter;
<a name="l01572"></a>01572             <span class="keywordflow">for</span>(iter = <a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>[c].begin();
<a name="l01573"></a>01573                 iter != <a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>[c].end();
<a name="l01574"></a>01574                 iter++) {
<a name="l01575"></a>01575               acc_latency += (double)(<a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a> - iter-&gt;second-&gt;ctime);
<a name="l01576"></a>01576               acc_count++;
<a name="l01577"></a>01577             }
<a name="l01578"></a>01578             
<a name="l01579"></a>01579             <span class="keywordflow">if</span>((acc_latency / acc_count) &gt; threshold) {
<a name="l01580"></a>01580               lat_exc_class = c;
<a name="l01581"></a>01581               <span class="keywordflow">break</span>;
<a name="l01582"></a>01582             }
<a name="l01583"></a>01583           }
<a name="l01584"></a>01584           
<a name="l01585"></a>01585           <span class="keywordflow">if</span>(lat_exc_class &gt;= 0) {
<a name="l01586"></a>01586             cout &lt;&lt; <span class="stringliteral">&quot;Average latency for class &quot;</span> &lt;&lt; lat_exc_class &lt;&lt; <span class="stringliteral">&quot; exceeded &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#aeb1705809e2804d8889c651d8a96a108">_latency_thres</a>[lat_exc_class] &lt;&lt; <span class="stringliteral">&quot; cycles. Aborting simulation.&quot;</span> &lt;&lt; endl;
<a name="l01587"></a>01587             converged = 0;
<a name="l01588"></a>01588             <a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a> = <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a0e1683a4848299c524150f6e6c7f6930">warming_up</a>;
<a name="l01589"></a>01589             <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#abf955f7ff7445e6daa441ea4b7f635c9">_stats_out</a>) {
<a name="l01590"></a>01590               <a class="code" href="classTrafficManager.html#a6077febc0598a6637ef7b2f22fbf0098">WriteStats</a>(*<a class="code" href="classTrafficManager.html#abf955f7ff7445e6daa441ea4b7f635c9">_stats_out</a>);
<a name="l01591"></a>01591             }
<a name="l01592"></a>01592             <span class="keywordflow">break</span>;
<a name="l01593"></a>01593           }
<a name="l01594"></a>01594           
<a name="l01595"></a>01595           <a class="code" href="classTrafficManager.html#a6c1c2eaa1cb0c9908d6eb3cc492f6d3e">_DisplayRemaining</a>( );
<a name="l01596"></a>01596           
<a name="l01597"></a>01597         }
<a name="l01598"></a>01598       }
<a name="l01599"></a>01599     }
<a name="l01600"></a>01600   } <span class="keywordflow">else</span> {
<a name="l01601"></a>01601     cout &lt;&lt; <span class="stringliteral">&quot;Too many sample periods needed to converge&quot;</span> &lt;&lt; endl;
<a name="l01602"></a>01602   }
<a name="l01603"></a>01603   
<a name="l01604"></a>01604   <span class="keywordflow">return</span> ( converged &gt; 0 );
<a name="l01605"></a>01605 }
<a name="l01606"></a>01606 
<a name="l01607"></a><a class="code" href="classTrafficManager.html#ab3020391989b7f611ca2c8c7367fe3cd">01607</a> <span class="keywordtype">bool</span> <a class="code" href="classTrafficManager.html#ab3020391989b7f611ca2c8c7367fe3cd">TrafficManager::Run</a>( )
<a name="l01608"></a>01608 {
<a name="l01609"></a>01609   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> sim = 0; sim &lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>; ++sim ) {
<a name="l01610"></a>01610     
<a name="l01611"></a>01611     <a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a> = 0;
<a name="l01612"></a>01612     
<a name="l01613"></a>01613     <span class="comment">//remove any pending request from the previous simulations</span>
<a name="l01614"></a>01614     <a class="code" href="classTrafficManager.html#a1f014156c3e0c4d7531e3ec9f5204dc0">_requestsOutstanding</a>.assign(_nodes, 0);
<a name="l01615"></a>01615     <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;_nodes;i++) {
<a name="l01616"></a>01616       <span class="keywordflow">while</span>(!<a class="code" href="classTrafficManager.html#ae50acf81b3471ea19042d408d8c326db">_repliesPending</a>[i].empty()) {
<a name="l01617"></a>01617         <a class="code" href="classTrafficManager.html#ae50acf81b3471ea19042d408d8c326db">_repliesPending</a>[i].front()-&gt;Free();
<a name="l01618"></a>01618         <a class="code" href="classTrafficManager.html#ae50acf81b3471ea19042d408d8c326db">_repliesPending</a>[i].pop_front();
<a name="l01619"></a>01619       }
<a name="l01620"></a>01620     }
<a name="l01621"></a>01621     
<a name="l01622"></a>01622     <span class="comment">//reset queuetime for all sources</span>
<a name="l01623"></a>01623     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> s = 0; s &lt; _nodes; ++s ) {
<a name="l01624"></a>01624       <a class="code" href="classTrafficManager.html#af4ee79a64ee0255447003b93fd9641e7">_qtime</a>[s].assign(_classes, 0);
<a name="l01625"></a>01625       <a class="code" href="classTrafficManager.html#a459f440795a908884f21277f0760d9e5">_qdrained</a>[s].assign(_classes, <span class="keyword">false</span>);
<a name="l01626"></a>01626     }
<a name="l01627"></a>01627     
<a name="l01628"></a>01628     <span class="comment">// warm-up ...</span>
<a name="l01629"></a>01629     <span class="comment">// reset stats, all packets after warmup_time marked</span>
<a name="l01630"></a>01630     <span class="comment">// converge</span>
<a name="l01631"></a>01631     <span class="comment">// draing, wait until all packets finish</span>
<a name="l01632"></a>01632     <a class="code" href="classTrafficManager.html#a49d0e36c6699e110b6b78797f345715f">_sim_state</a>    = <a class="code" href="classTrafficManager.html#a7b8d445426805d17f5217c10b166f7a9a0e1683a4848299c524150f6e6c7f6930">warming_up</a>;
<a name="l01633"></a>01633     
<a name="l01634"></a>01634     <a class="code" href="classTrafficManager.html#a4c41f2d968cd1a84e4cc63dc32fb7d88">_ClearStats</a>( );
<a name="l01635"></a>01635     
<a name="l01636"></a>01636     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; _classes; ++c) {
<a name="l01637"></a>01637       <a class="code" href="classTrafficManager.html#a1f48f17401865b83fc5eefd4b5a34fca">_traffic_pattern</a>[c]-&gt;reset();
<a name="l01638"></a>01638       <a class="code" href="classTrafficManager.html#a11776bff2e03ae2b4294c3d11e6b6406">_injection_process</a>[c]-&gt;reset();
<a name="l01639"></a>01639     }
<a name="l01640"></a>01640     
<a name="l01641"></a>01641     <span class="keywordflow">if</span> ( !<a class="code" href="classTrafficManager.html#aa6088c57ad4c0f389931cc062ee6ad2b">_SingleSim</a>( ) ) {
<a name="l01642"></a>01642       cout &lt;&lt; <span class="stringliteral">&quot;Simulation unstable, ending ...&quot;</span> &lt;&lt; endl;
<a name="l01643"></a>01643       <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l01644"></a>01644     }
<a name="l01645"></a>01645     
<a name="l01646"></a>01646     <span class="comment">// Empty any remaining packets</span>
<a name="l01647"></a>01647     cout &lt;&lt; <span class="stringliteral">&quot;Draining remaining packets ...&quot;</span> &lt;&lt; endl;
<a name="l01648"></a>01648     <a class="code" href="classTrafficManager.html#abeecbfb35b96c5e7bcf603fbda0d6e5c">_empty_network</a> = <span class="keyword">true</span>;
<a name="l01649"></a>01649     <span class="keywordtype">int</span> empty_steps = 0;
<a name="l01650"></a>01650     
<a name="l01651"></a>01651     <span class="keywordtype">bool</span> packets_left = <span class="keyword">false</span>;
<a name="l01652"></a>01652     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; _classes; ++c) {
<a name="l01653"></a>01653       packets_left |= !<a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>[c].empty();
<a name="l01654"></a>01654     }
<a name="l01655"></a>01655     
<a name="l01656"></a>01656     <span class="keywordflow">while</span>( packets_left ) {
<a name="l01657"></a>01657       <a class="code" href="classTrafficManager.html#ae2f9ae1d30700cb03c2922b41b977c1d">_Step</a>( );
<a name="l01658"></a>01658       
<a name="l01659"></a>01659       ++empty_steps;
<a name="l01660"></a>01660       
<a name="l01661"></a>01661       <span class="keywordflow">if</span> ( empty_steps % 1000 == 0 ) {
<a name="l01662"></a>01662         <a class="code" href="classTrafficManager.html#a6c1c2eaa1cb0c9908d6eb3cc492f6d3e">_DisplayRemaining</a>( );
<a name="l01663"></a>01663       }
<a name="l01664"></a>01664       
<a name="l01665"></a>01665       packets_left = <span class="keyword">false</span>;
<a name="l01666"></a>01666       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; _classes; ++c) {
<a name="l01667"></a>01667         packets_left |= !<a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>[c].empty();
<a name="l01668"></a>01668       }
<a name="l01669"></a>01669     }
<a name="l01670"></a>01670     <span class="comment">//wait until all the credits are drained as well</span>
<a name="l01671"></a>01671     <span class="keywordflow">while</span>(<a class="code" href="classCredit.html#a3d320d6dbdbf7c417afb8f302f71b6a8">Credit::OutStanding</a>()!=0){
<a name="l01672"></a>01672       <a class="code" href="classTrafficManager.html#ae2f9ae1d30700cb03c2922b41b977c1d">_Step</a>();
<a name="l01673"></a>01673     }
<a name="l01674"></a>01674     <a class="code" href="classTrafficManager.html#abeecbfb35b96c5e7bcf603fbda0d6e5c">_empty_network</a> = <span class="keyword">false</span>;
<a name="l01675"></a>01675     
<a name="l01676"></a>01676     <span class="comment">//for the love of god don&apos;t ever say &quot;Time taken&quot; anywhere else</span>
<a name="l01677"></a>01677     <span class="comment">//the power script depend on it</span>
<a name="l01678"></a>01678     cout &lt;&lt; <span class="stringliteral">&quot;Time taken is &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a> &lt;&lt; <span class="stringliteral">&quot; cycles&quot;</span> &lt;&lt;endl;
<a name="l01679"></a>01679     
<a name="l01680"></a>01680     <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#abf955f7ff7445e6daa441ea4b7f635c9">_stats_out</a>) {
<a name="l01681"></a>01681       <a class="code" href="classTrafficManager.html#a6077febc0598a6637ef7b2f22fbf0098">WriteStats</a>(*<a class="code" href="classTrafficManager.html#abf955f7ff7445e6daa441ea4b7f635c9">_stats_out</a>);
<a name="l01682"></a>01682     }
<a name="l01683"></a>01683     <a class="code" href="classTrafficManager.html#ae1ec1e4e8391e1ef6bacbc4c1431b9b9">_UpdateOverallStats</a>();
<a name="l01684"></a>01684   }
<a name="l01685"></a>01685   
<a name="l01686"></a>01686   <a class="code" href="classTrafficManager.html#aa5bb4cff750b8cb1dbc0657d86d26dc1">DisplayOverallStats</a>();
<a name="l01687"></a>01687   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a02dae2988f6fc6d263911561b7138216">_print_csv_results</a>) {
<a name="l01688"></a>01688     <a class="code" href="classTrafficManager.html#a216abfdb2470d6a92b9362e09e9c87fd">DisplayOverallStatsCSV</a>();
<a name="l01689"></a>01689   }
<a name="l01690"></a>01690   
<a name="l01691"></a>01691   <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l01692"></a>01692 }
<a name="l01693"></a>01693 
<a name="l01694"></a><a class="code" href="classTrafficManager.html#ae1ec1e4e8391e1ef6bacbc4c1431b9b9">01694</a> <span class="keywordtype">void</span> <a class="code" href="classTrafficManager.html#ae1ec1e4e8391e1ef6bacbc4c1431b9b9">TrafficManager::_UpdateOverallStats</a>() {
<a name="l01695"></a>01695   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> c = 0; c &lt; _classes; ++c ) {
<a name="l01696"></a>01696     
<a name="l01697"></a>01697     <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a549fe0af403657daf47db078f7f1814a">_measure_stats</a>[c] == 0) {
<a name="l01698"></a>01698       <span class="keywordflow">continue</span>;
<a name="l01699"></a>01699     }
<a name="l01700"></a>01700     
<a name="l01701"></a>01701     <a class="code" href="classTrafficManager.html#a9396b27b8d314aedca6477fe7f03e0fb">_overall_min_plat</a>[c] += <a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[c]-&gt;Min();
<a name="l01702"></a>01702     <a class="code" href="classTrafficManager.html#a33d2fac8e8898950df680e4026c99ecc">_overall_avg_plat</a>[c] += <a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[c]-&gt;Average();
<a name="l01703"></a>01703     <a class="code" href="classTrafficManager.html#a26ca4cf3881f84c8d4c737ebe2f3b330">_overall_max_plat</a>[c] += <a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[c]-&gt;Max();
<a name="l01704"></a>01704     <a class="code" href="classTrafficManager.html#a6a3841f0bd16509994037af9215e5985">_overall_min_nlat</a>[c] += <a class="code" href="classTrafficManager.html#a9180e022d85c6388bfd7e58cbfc10b47">_nlat_stats</a>[c]-&gt;Min();
<a name="l01705"></a>01705     <a class="code" href="classTrafficManager.html#a6265a966369698ffc482fffcb404a8b1">_overall_avg_nlat</a>[c] += <a class="code" href="classTrafficManager.html#a9180e022d85c6388bfd7e58cbfc10b47">_nlat_stats</a>[c]-&gt;Average();
<a name="l01706"></a>01706     <a class="code" href="classTrafficManager.html#a5f6f27514cbe0ae389f2dd51c08af05d">_overall_max_nlat</a>[c] += <a class="code" href="classTrafficManager.html#a9180e022d85c6388bfd7e58cbfc10b47">_nlat_stats</a>[c]-&gt;Max();
<a name="l01707"></a>01707     <a class="code" href="classTrafficManager.html#abaaf1b91fdea78eb0c53afa5b3b50709">_overall_min_flat</a>[c] += <a class="code" href="classTrafficManager.html#ab435afa5236277ff8d6a1991860cf546">_flat_stats</a>[c]-&gt;Min();
<a name="l01708"></a>01708     <a class="code" href="classTrafficManager.html#a6e1a9cc72c637afd54ac3e1aaf38f0ec">_overall_avg_flat</a>[c] += <a class="code" href="classTrafficManager.html#ab435afa5236277ff8d6a1991860cf546">_flat_stats</a>[c]-&gt;Average();
<a name="l01709"></a>01709     <a class="code" href="classTrafficManager.html#ab28f8c5f823e52c747d9e94a131236a3">_overall_max_flat</a>[c] += <a class="code" href="classTrafficManager.html#ab435afa5236277ff8d6a1991860cf546">_flat_stats</a>[c]-&gt;Max();
<a name="l01710"></a>01710     
<a name="l01711"></a>01711     <a class="code" href="classTrafficManager.html#a5716fdc9d88c92bd754b12cd3f90548e">_overall_min_frag</a>[c] += <a class="code" href="classTrafficManager.html#a7f160ac254d3ceabd825f1c59f42b179">_frag_stats</a>[c]-&gt;Min();
<a name="l01712"></a>01712     <a class="code" href="classTrafficManager.html#a1f7bd1e0c88c5533db25f21c543171e7">_overall_avg_frag</a>[c] += <a class="code" href="classTrafficManager.html#a7f160ac254d3ceabd825f1c59f42b179">_frag_stats</a>[c]-&gt;Average();
<a name="l01713"></a>01713     <a class="code" href="classTrafficManager.html#a2e27b6106049bd42fbcc5175d2a68c15">_overall_max_frag</a>[c] += <a class="code" href="classTrafficManager.html#a7f160ac254d3ceabd825f1c59f42b179">_frag_stats</a>[c]-&gt;Max();
<a name="l01714"></a>01714     
<a name="l01715"></a>01715     <a class="code" href="classTrafficManager.html#a2a5ad817564086e123c30482e618b161">_overall_hop_stats</a>[c] += <a class="code" href="classTrafficManager.html#ac9385813fa2b42c908cdf532ec9405c6">_hop_stats</a>[c]-&gt;<a class="code" href="classStats.html#afae5e764ecf3ae19259faa7e539dc706">Average</a>();
<a name="l01716"></a>01716     
<a name="l01717"></a>01717     <span class="keywordtype">int</span> count_min, count_sum, count_max;
<a name="l01718"></a>01718     <span class="keywordtype">double</span> rate_min, rate_sum, rate_max;
<a name="l01719"></a>01719     <span class="keywordtype">double</span> rate_avg;
<a name="l01720"></a>01720     <span class="keywordtype">double</span> time_delta = (double)(<a class="code" href="classTrafficManager.html#ad9fa73d16a3cb111fc593970370deaa6">_drain_time</a> - <a class="code" href="classTrafficManager.html#a056be33c6e4eaac14e7105f31e804748">_reset_time</a>);
<a name="l01721"></a>01721     <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">_ComputeStats</a>( <a class="code" href="classTrafficManager.html#a62c2881d71bd8a580c008cebf2753012">_sent_flits</a>[c], &amp;count_sum, &amp;count_min, &amp;count_max );
<a name="l01722"></a>01722     rate_min = (double)count_min / time_delta;
<a name="l01723"></a>01723     rate_sum = (double)count_sum / time_delta;
<a name="l01724"></a>01724     rate_max = (double)count_max / time_delta;
<a name="l01725"></a>01725     rate_avg = rate_sum / (double)_nodes;
<a name="l01726"></a>01726     <a class="code" href="classTrafficManager.html#a2bf102d9ea1e22ad0b3f7e3dcfe7e563">_overall_min_sent</a>[c] += rate_min;
<a name="l01727"></a>01727     <a class="code" href="classTrafficManager.html#abc7df4963565ff43085f5d14efcf65fb">_overall_avg_sent</a>[c] += rate_avg;
<a name="l01728"></a>01728     <a class="code" href="classTrafficManager.html#a4a5abf1deff55a87dc10117bff22e497">_overall_max_sent</a>[c] += rate_max;
<a name="l01729"></a>01729     <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">_ComputeStats</a>( <a class="code" href="classTrafficManager.html#a552ccfae3f5aad4c71b188d97614012d">_sent_packets</a>[c], &amp;count_sum, &amp;count_min, &amp;count_max );
<a name="l01730"></a>01730     rate_min = (double)count_min / time_delta;
<a name="l01731"></a>01731     rate_sum = (double)count_sum / time_delta;
<a name="l01732"></a>01732     rate_max = (double)count_max / time_delta;
<a name="l01733"></a>01733     rate_avg = rate_sum / (double)_nodes;
<a name="l01734"></a>01734     <a class="code" href="classTrafficManager.html#aa1346fe8293a7cbb0c8ab377ef91b94a">_overall_min_sent_packets</a>[c] += rate_min;
<a name="l01735"></a>01735     <a class="code" href="classTrafficManager.html#aa3074d74ad3d6ecc67555b860a63d057">_overall_avg_sent_packets</a>[c] += rate_avg;
<a name="l01736"></a>01736     <a class="code" href="classTrafficManager.html#a08a31f70886b7d439b49e5e34323ffd2">_overall_max_sent_packets</a>[c] += rate_max;
<a name="l01737"></a>01737     <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">_ComputeStats</a>( <a class="code" href="classTrafficManager.html#a089e444802486d4e5092066d4c357c30">_accepted_flits</a>[c], &amp;count_sum, &amp;count_min, &amp;count_max );
<a name="l01738"></a>01738     rate_min = (double)count_min / time_delta;
<a name="l01739"></a>01739     rate_sum = (double)count_sum / time_delta;
<a name="l01740"></a>01740     rate_max = (double)count_max / time_delta;
<a name="l01741"></a>01741     rate_avg = rate_sum / (double)_nodes;
<a name="l01742"></a>01742     <a class="code" href="classTrafficManager.html#a151b13006c1fef516d5aa42b6d4b6b97">_overall_min_accepted</a>[c] += rate_min;
<a name="l01743"></a>01743     <a class="code" href="classTrafficManager.html#aa20932dad1291e91a8d52c1bd57aff25">_overall_avg_accepted</a>[c] += rate_avg;
<a name="l01744"></a>01744     <a class="code" href="classTrafficManager.html#aa87d9a9975984c42248559b2794e37b1">_overall_max_accepted</a>[c] += rate_max;
<a name="l01745"></a>01745     <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">_ComputeStats</a>( <a class="code" href="classTrafficManager.html#acec4c1294844394b7bf8008f5b920593">_accepted_packets</a>[c], &amp;count_sum, &amp;count_min, &amp;count_max );
<a name="l01746"></a>01746     rate_min = (double)count_min / time_delta;
<a name="l01747"></a>01747     rate_sum = (double)count_sum / time_delta;
<a name="l01748"></a>01748     rate_max = (double)count_max / time_delta;
<a name="l01749"></a>01749     rate_avg = rate_sum / (double)_nodes;
<a name="l01750"></a>01750     <a class="code" href="classTrafficManager.html#aab17754eda186939996cb0f8c4e98ca9">_overall_min_accepted_packets</a>[c] += rate_min;
<a name="l01751"></a>01751     <a class="code" href="classTrafficManager.html#a685bfa1f07f24455554ba4ac3d23d234">_overall_avg_accepted_packets</a>[c] += rate_avg;
<a name="l01752"></a>01752     <a class="code" href="classTrafficManager.html#a93c1c6bd29b8ce0f1bed4e8d2f11780d">_overall_max_accepted_packets</a>[c] += rate_max;
<a name="l01753"></a>01753     
<a name="l01754"></a>01754 <span class="preprocessor">#ifdef TRACK_STALLS</span>
<a name="l01755"></a>01755 <span class="preprocessor"></span>    <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">_ComputeStats</a>(<a class="code" href="classTrafficManager.html#a1c784a6d1925a67a090fdcd2d4ea69c1">_buffer_busy_stalls</a>[c], &amp;count_sum);
<a name="l01756"></a>01756     rate_sum = (double)count_sum / time_delta;
<a name="l01757"></a>01757     rate_avg = rate_sum / (double)(_subnets*_routers);
<a name="l01758"></a>01758     <a class="code" href="classTrafficManager.html#aa2cb008e7849e88b08017782112b1e25">_overall_buffer_busy_stalls</a>[c] += rate_avg;
<a name="l01759"></a>01759     <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">_ComputeStats</a>(<a class="code" href="classTrafficManager.html#ae28ad10bf987f3edaea11411237c2da5">_buffer_conflict_stalls</a>[c], &amp;count_sum);
<a name="l01760"></a>01760     rate_sum = (double)count_sum / time_delta;
<a name="l01761"></a>01761     rate_avg = rate_sum / (double)(_subnets*_routers);
<a name="l01762"></a>01762     <a class="code" href="classTrafficManager.html#ad9052e0ca146f1de2558a8da70304a41">_overall_buffer_conflict_stalls</a>[c] += rate_avg;
<a name="l01763"></a>01763     <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">_ComputeStats</a>(<a class="code" href="classTrafficManager.html#a9933b441d6750f35f7622e69c0baa0a0">_buffer_full_stalls</a>[c], &amp;count_sum);
<a name="l01764"></a>01764     rate_sum = (double)count_sum / time_delta;
<a name="l01765"></a>01765     rate_avg = rate_sum / (double)(_subnets*_routers);
<a name="l01766"></a>01766     <a class="code" href="classTrafficManager.html#ac8157210498782084dcd8ccb070df5b3">_overall_buffer_full_stalls</a>[c] += rate_avg;
<a name="l01767"></a>01767     <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">_ComputeStats</a>(<a class="code" href="classTrafficManager.html#aa1a62024edeb3fbcbcd12a4c15c75c1c">_buffer_reserved_stalls</a>[c], &amp;count_sum);
<a name="l01768"></a>01768     rate_sum = (double)count_sum / time_delta;
<a name="l01769"></a>01769     rate_avg = rate_sum / (double)(_subnets*_routers);
<a name="l01770"></a>01770     <a class="code" href="classTrafficManager.html#ac8aef5fb9a0c62b9feb51e54911d7d21">_overall_buffer_reserved_stalls</a>[c] += rate_avg;
<a name="l01771"></a>01771     <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">_ComputeStats</a>(<a class="code" href="classTrafficManager.html#afb85e3761a4ff0c6a9330e6f47ea6314">_crossbar_conflict_stalls</a>[c], &amp;count_sum);
<a name="l01772"></a>01772     rate_sum = (double)count_sum / time_delta;
<a name="l01773"></a>01773     rate_avg = rate_sum / (double)(_subnets*_routers);
<a name="l01774"></a>01774     <a class="code" href="classTrafficManager.html#a47397318e8ec5faa031e62696754d6e4">_overall_crossbar_conflict_stalls</a>[c] += rate_avg;
<a name="l01775"></a>01775 <span class="preprocessor">#endif</span>
<a name="l01776"></a>01776 <span class="preprocessor"></span>    
<a name="l01777"></a>01777   }
<a name="l01778"></a>01778 }
<a name="l01779"></a>01779 
<a name="l01780"></a><a class="code" href="classTrafficManager.html#a6077febc0598a6637ef7b2f22fbf0098">01780</a> <span class="keywordtype">void</span> <a class="code" href="classTrafficManager.html#a6077febc0598a6637ef7b2f22fbf0098">TrafficManager::WriteStats</a>(ostream &amp; os)<span class="keyword"> const </span>{
<a name="l01781"></a>01781   
<a name="l01782"></a>01782   os &lt;&lt; <span class="stringliteral">&quot;%=================================&quot;</span> &lt;&lt; endl;
<a name="l01783"></a>01783   
<a name="l01784"></a>01784   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; _classes; ++c) {
<a name="l01785"></a>01785     
<a name="l01786"></a>01786     <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a549fe0af403657daf47db078f7f1814a">_measure_stats</a>[c] == 0) {
<a name="l01787"></a>01787       <span class="keywordflow">continue</span>;
<a name="l01788"></a>01788     }
<a name="l01789"></a>01789     
<a name="l01790"></a>01790     <span class="comment">//c+1 due to matlab array starting at 1</span>
<a name="l01791"></a>01791     os &lt;&lt; <span class="stringliteral">&quot;plat(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;) = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[c]-&gt;Average() &lt;&lt; <span class="stringliteral">&quot;;&quot;</span> &lt;&lt; endl
<a name="l01792"></a>01792     &lt;&lt; <span class="stringliteral">&quot;plat_hist(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = &quot;</span> &lt;&lt; *<a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[c] &lt;&lt; <span class="stringliteral">&quot;;&quot;</span> &lt;&lt; endl
<a name="l01793"></a>01793     &lt;&lt; <span class="stringliteral">&quot;nlat(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;) = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a9180e022d85c6388bfd7e58cbfc10b47">_nlat_stats</a>[c]-&gt;Average() &lt;&lt; <span class="stringliteral">&quot;;&quot;</span> &lt;&lt; endl
<a name="l01794"></a>01794     &lt;&lt; <span class="stringliteral">&quot;nlat_hist(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = &quot;</span> &lt;&lt; *<a class="code" href="classTrafficManager.html#a9180e022d85c6388bfd7e58cbfc10b47">_nlat_stats</a>[c] &lt;&lt; <span class="stringliteral">&quot;;&quot;</span> &lt;&lt; endl
<a name="l01795"></a>01795     &lt;&lt; <span class="stringliteral">&quot;flat(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;) = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ab435afa5236277ff8d6a1991860cf546">_flat_stats</a>[c]-&gt;Average() &lt;&lt; <span class="stringliteral">&quot;;&quot;</span> &lt;&lt; endl
<a name="l01796"></a>01796     &lt;&lt; <span class="stringliteral">&quot;flat_hist(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = &quot;</span> &lt;&lt; *<a class="code" href="classTrafficManager.html#ab435afa5236277ff8d6a1991860cf546">_flat_stats</a>[c] &lt;&lt; <span class="stringliteral">&quot;;&quot;</span> &lt;&lt; endl
<a name="l01797"></a>01797     &lt;&lt; <span class="stringliteral">&quot;frag_hist(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = &quot;</span> &lt;&lt; *<a class="code" href="classTrafficManager.html#a7f160ac254d3ceabd825f1c59f42b179">_frag_stats</a>[c] &lt;&lt; <span class="stringliteral">&quot;;&quot;</span> &lt;&lt; endl
<a name="l01798"></a>01798     &lt;&lt; <span class="stringliteral">&quot;hops(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = &quot;</span> &lt;&lt; *<a class="code" href="classTrafficManager.html#ac9385813fa2b42c908cdf532ec9405c6">_hop_stats</a>[c] &lt;&lt; <span class="stringliteral">&quot;;&quot;</span> &lt;&lt; endl;
<a name="l01799"></a>01799     <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#adf6295f17ea12f4e88790d2debdbc4d5">_pair_stats</a>){
<a name="l01800"></a>01800       os&lt;&lt; <span class="stringliteral">&quot;pair_sent(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = [ &quot;</span>;
<a name="l01801"></a>01801       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; _nodes; ++i) {
<a name="l01802"></a>01802         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; _nodes; ++j) {
<a name="l01803"></a>01803           os &lt;&lt; <a class="code" href="classTrafficManager.html#a4e8c501fc2d871203dc729ecea28b9bd">_pair_plat</a>[c][i*_nodes+j]-&gt;NumSamples() &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l01804"></a>01804         }
<a name="l01805"></a>01805       }
<a name="l01806"></a>01806       os &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; endl
<a name="l01807"></a>01807       &lt;&lt; <span class="stringliteral">&quot;pair_plat(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = [ &quot;</span>;
<a name="l01808"></a>01808       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; _nodes; ++i) {
<a name="l01809"></a>01809         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; _nodes; ++j) {
<a name="l01810"></a>01810           os &lt;&lt; <a class="code" href="classTrafficManager.html#a4e8c501fc2d871203dc729ecea28b9bd">_pair_plat</a>[c][i*_nodes+j]-&gt;Average( ) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l01811"></a>01811         }
<a name="l01812"></a>01812       }
<a name="l01813"></a>01813       os &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; endl
<a name="l01814"></a>01814       &lt;&lt; <span class="stringliteral">&quot;pair_nlat(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = [ &quot;</span>;
<a name="l01815"></a>01815       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; _nodes; ++i) {
<a name="l01816"></a>01816         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; _nodes; ++j) {
<a name="l01817"></a>01817           os &lt;&lt; <a class="code" href="classTrafficManager.html#a03c78594e1d4a1145ea27816ef786bde">_pair_nlat</a>[c][i*_nodes+j]-&gt;Average( ) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l01818"></a>01818         }
<a name="l01819"></a>01819       }
<a name="l01820"></a>01820       os &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; endl
<a name="l01821"></a>01821       &lt;&lt; <span class="stringliteral">&quot;pair_flat(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = [ &quot;</span>;
<a name="l01822"></a>01822       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; _nodes; ++i) {
<a name="l01823"></a>01823         <span class="keywordflow">for</span>(<span class="keywordtype">int</span> j = 0; j &lt; _nodes; ++j) {
<a name="l01824"></a>01824           os &lt;&lt; <a class="code" href="classTrafficManager.html#a353557bf34f140be9b12f9e92c9f4006">_pair_flat</a>[c][i*_nodes+j]-&gt;Average( ) &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l01825"></a>01825         }
<a name="l01826"></a>01826       }
<a name="l01827"></a>01827     }
<a name="l01828"></a>01828     
<a name="l01829"></a>01829     <span class="keywordtype">double</span> time_delta = (double)(<a class="code" href="classTrafficManager.html#ad9fa73d16a3cb111fc593970370deaa6">_drain_time</a> - <a class="code" href="classTrafficManager.html#a056be33c6e4eaac14e7105f31e804748">_reset_time</a>);
<a name="l01830"></a>01830     
<a name="l01831"></a>01831     os &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; endl
<a name="l01832"></a>01832     &lt;&lt; <span class="stringliteral">&quot;sent_packets(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = [ &quot;</span>;
<a name="l01833"></a>01833     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> d = 0; d &lt; _nodes; ++d ) {
<a name="l01834"></a>01834       os &lt;&lt; (double)<a class="code" href="classTrafficManager.html#a552ccfae3f5aad4c71b188d97614012d">_sent_packets</a>[c][d] / time_delta &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l01835"></a>01835     }
<a name="l01836"></a>01836     os &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; endl
<a name="l01837"></a>01837     &lt;&lt; <span class="stringliteral">&quot;accepted_packets(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = [ &quot;</span>;
<a name="l01838"></a>01838     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> d = 0; d &lt; _nodes; ++d ) {
<a name="l01839"></a>01839       os &lt;&lt; (double)<a class="code" href="classTrafficManager.html#acec4c1294844394b7bf8008f5b920593">_accepted_packets</a>[c][d] / time_delta &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l01840"></a>01840     }
<a name="l01841"></a>01841     os &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; endl
<a name="l01842"></a>01842     &lt;&lt; <span class="stringliteral">&quot;sent_flits(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = [ &quot;</span>;
<a name="l01843"></a>01843     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> d = 0; d &lt; _nodes; ++d ) {
<a name="l01844"></a>01844       os &lt;&lt; (double)<a class="code" href="classTrafficManager.html#a62c2881d71bd8a580c008cebf2753012">_sent_flits</a>[c][d] / time_delta &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l01845"></a>01845     }
<a name="l01846"></a>01846     os &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; endl
<a name="l01847"></a>01847     &lt;&lt; <span class="stringliteral">&quot;accepted_flits(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = [ &quot;</span>;
<a name="l01848"></a>01848     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> d = 0; d &lt; _nodes; ++d ) {
<a name="l01849"></a>01849       os &lt;&lt; (double)<a class="code" href="classTrafficManager.html#a089e444802486d4e5092066d4c357c30">_accepted_flits</a>[c][d] / time_delta &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l01850"></a>01850     }
<a name="l01851"></a>01851     os &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; endl
<a name="l01852"></a>01852     &lt;&lt; <span class="stringliteral">&quot;sent_packet_size(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = [ &quot;</span>;
<a name="l01853"></a>01853     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> d = 0; d &lt; _nodes; ++d ) {
<a name="l01854"></a>01854       os &lt;&lt; (double)<a class="code" href="classTrafficManager.html#a62c2881d71bd8a580c008cebf2753012">_sent_flits</a>[c][d] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#a552ccfae3f5aad4c71b188d97614012d">_sent_packets</a>[c][d] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l01855"></a>01855     }
<a name="l01856"></a>01856     os &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; endl
<a name="l01857"></a>01857     &lt;&lt; <span class="stringliteral">&quot;accepted_packet_size(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = [ &quot;</span>;
<a name="l01858"></a>01858     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> d = 0; d &lt; _nodes; ++d ) {
<a name="l01859"></a>01859       os &lt;&lt; (double)<a class="code" href="classTrafficManager.html#a089e444802486d4e5092066d4c357c30">_accepted_flits</a>[c][d] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#acec4c1294844394b7bf8008f5b920593">_accepted_packets</a>[c][d] &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l01860"></a>01860     }
<a name="l01861"></a>01861     os &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; endl;
<a name="l01862"></a>01862 <span class="preprocessor">#ifdef TRACK_STALLS</span>
<a name="l01863"></a>01863 <span class="preprocessor"></span>    os &lt;&lt; <span class="stringliteral">&quot;buffer_busy_stalls(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = [ &quot;</span>;
<a name="l01864"></a>01864     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> d = 0; d &lt; _subnets*_routers; ++d ) {
<a name="l01865"></a>01865       os &lt;&lt; (double)<a class="code" href="classTrafficManager.html#a1c784a6d1925a67a090fdcd2d4ea69c1">_buffer_busy_stalls</a>[c][d] / time_delta &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l01866"></a>01866     }
<a name="l01867"></a>01867     os &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; endl
<a name="l01868"></a>01868     &lt;&lt; <span class="stringliteral">&quot;buffer_conflict_stalls(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = [ &quot;</span>;
<a name="l01869"></a>01869     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> d = 0; d &lt; _subnets*_routers; ++d ) {
<a name="l01870"></a>01870       os &lt;&lt; (double)<a class="code" href="classTrafficManager.html#ae28ad10bf987f3edaea11411237c2da5">_buffer_conflict_stalls</a>[c][d] / time_delta &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l01871"></a>01871     }
<a name="l01872"></a>01872     os &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; endl
<a name="l01873"></a>01873     &lt;&lt; <span class="stringliteral">&quot;buffer_full_stalls(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = [ &quot;</span>;
<a name="l01874"></a>01874     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> d = 0; d &lt; _subnets*_routers; ++d ) {
<a name="l01875"></a>01875       os &lt;&lt; (double)<a class="code" href="classTrafficManager.html#a9933b441d6750f35f7622e69c0baa0a0">_buffer_full_stalls</a>[c][d] / time_delta &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l01876"></a>01876     }
<a name="l01877"></a>01877     os &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; endl
<a name="l01878"></a>01878     &lt;&lt; <span class="stringliteral">&quot;buffer_reserved_stalls(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = [ &quot;</span>;
<a name="l01879"></a>01879     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> d = 0; d &lt; _subnets*_routers; ++d ) {
<a name="l01880"></a>01880       os &lt;&lt; (double)<a class="code" href="classTrafficManager.html#aa1a62024edeb3fbcbcd12a4c15c75c1c">_buffer_reserved_stalls</a>[c][d] / time_delta &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l01881"></a>01881     }
<a name="l01882"></a>01882     os &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; endl
<a name="l01883"></a>01883     &lt;&lt; <span class="stringliteral">&quot;crossbar_conflict_stalls(&quot;</span> &lt;&lt; c+1 &lt;&lt; <span class="stringliteral">&quot;,:) = [ &quot;</span>;
<a name="l01884"></a>01884     <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> d = 0; d &lt; _subnets*_routers; ++d ) {
<a name="l01885"></a>01885       os &lt;&lt; (double)<a class="code" href="classTrafficManager.html#afb85e3761a4ff0c6a9330e6f47ea6314">_crossbar_conflict_stalls</a>[c][d] / time_delta &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;
<a name="l01886"></a>01886     }
<a name="l01887"></a>01887     os &lt;&lt; <span class="stringliteral">&quot;];&quot;</span> &lt;&lt; endl;
<a name="l01888"></a>01888 <span class="preprocessor">#endif</span>
<a name="l01889"></a>01889 <span class="preprocessor"></span>  }
<a name="l01890"></a>01890 }
<a name="l01891"></a>01891 
<a name="l01892"></a><a class="code" href="classTrafficManager.html#aba8e9da5dab0aa24e22d3196c13e7408">01892</a> <span class="keywordtype">void</span> <a class="code" href="classTrafficManager.html#aba8e9da5dab0aa24e22d3196c13e7408">TrafficManager::UpdateStats</a>() {
<a name="l01893"></a>01893 <span class="preprocessor">#if defined(TRACK_FLOWS) || defined(TRACK_STALLS)</span>
<a name="l01894"></a>01894 <span class="preprocessor"></span>  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; _classes; ++c) {
<a name="l01895"></a>01895 <span class="preprocessor">#ifdef TRACK_FLOWS</span>
<a name="l01896"></a>01896 <span class="preprocessor"></span>    {
<a name="l01897"></a>01897       <span class="keywordtype">char</span> trail_char = (c == _classes - 1) ? <span class="charliteral">&apos;\n&apos;</span> : <span class="charliteral">&apos;,&apos;</span>;
<a name="l01898"></a>01898       <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a60e297ef653cf18c18b59dd8903ada5e">_injected_flits_out</a>) *<a class="code" href="classTrafficManager.html#a60e297ef653cf18c18b59dd8903ada5e">_injected_flits_out</a> &lt;&lt; <a class="code" href="classTrafficManager.html#ab399ac65874834ae1ad6ce99939dfbea">_injected_flits</a>[c] &lt;&lt; trail_char;
<a name="l01899"></a>01899       <a class="code" href="classTrafficManager.html#ab399ac65874834ae1ad6ce99939dfbea">_injected_flits</a>[c].assign(_nodes, 0);
<a name="l01900"></a>01900       <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a1f9bb8ef5f9553a1e5417acddd18159f">_ejected_flits_out</a>) *<a class="code" href="classTrafficManager.html#a1f9bb8ef5f9553a1e5417acddd18159f">_ejected_flits_out</a> &lt;&lt; <a class="code" href="classTrafficManager.html#a5750805ce26dfd96ae787a67886705e3">_ejected_flits</a>[c] &lt;&lt; trail_char;
<a name="l01901"></a>01901       <a class="code" href="classTrafficManager.html#a5750805ce26dfd96ae787a67886705e3">_ejected_flits</a>[c].assign(_nodes, 0);
<a name="l01902"></a>01902     }
<a name="l01903"></a>01903 <span class="preprocessor">#endif</span>
<a name="l01904"></a>01904 <span class="preprocessor"></span>    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> subnet = 0; subnet &lt; _subnets; ++subnet) {
<a name="l01905"></a>01905 <span class="preprocessor">#ifdef TRACK_FLOWS</span>
<a name="l01906"></a>01906 <span class="preprocessor"></span>      <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a02bf243c1a00b188df58b2aac299530a">_outstanding_credits_out</a>) *<a class="code" href="classTrafficManager.html#a02bf243c1a00b188df58b2aac299530a">_outstanding_credits_out</a> &lt;&lt; <a class="code" href="classTrafficManager.html#a5d2d639d839c07d750bc632b85a304c6">_outstanding_credits</a>[c][subnet] &lt;&lt; <span class="charliteral">&apos;,&apos;</span>;
<a name="l01907"></a>01907       <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#ac95b0e32d233d93d649e8491e770bd19">_stored_flits_out</a>) *_stored_flits_out &lt;&lt; vector&lt;int&gt;(_nodes, 0) &lt;&lt; <span class="charliteral">&apos;,&apos;</span>;
<a name="l01908"></a>01908 <span class="preprocessor">#endif</span>
<a name="l01909"></a>01909 <span class="preprocessor"></span>      <span class="keywordflow">for</span>(<span class="keywordtype">int</span> router = 0; router &lt; _routers; ++router) {
<a name="l01910"></a>01910         <a class="code" href="classRouter.html">Router</a> * <span class="keyword">const</span> r = <a class="code" href="classTrafficManager.html#a4c45c20f60c464ef56243c16ec3a1681">_router</a>[subnet][router];
<a name="l01911"></a>01911 <span class="preprocessor">#ifdef TRACK_FLOWS</span>
<a name="l01912"></a>01912 <span class="preprocessor"></span>        <span class="keywordtype">char</span> trail_char =
<a name="l01913"></a>01913         ((router == _routers - 1) &amp;&amp; (subnet == _subnets - 1) &amp;&amp; (c == _classes - 1)) ? <span class="charliteral">&apos;\n&apos;</span> : <span class="charliteral">&apos;,&apos;</span>;
<a name="l01914"></a>01914         <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a19cc011b7cd07169ed7940898815d3ff">_received_flits_out</a>) *<a class="code" href="classTrafficManager.html#a19cc011b7cd07169ed7940898815d3ff">_received_flits_out</a> &lt;&lt; r-&gt;<a class="code" href="classRouter.html#a3c670c0e7ed7048935a12a510fcf330b">GetReceivedFlits</a>(c) &lt;&lt; trail_char;
<a name="l01915"></a>01915         <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#ac95b0e32d233d93d649e8491e770bd19">_stored_flits_out</a>) *<a class="code" href="classTrafficManager.html#ac95b0e32d233d93d649e8491e770bd19">_stored_flits_out</a> &lt;&lt; r-&gt;<a class="code" href="classRouter.html#a61899a4f8cc4d8f43c0b2e81de0609a1">GetStoredFlits</a>(c) &lt;&lt; trail_char;
<a name="l01916"></a>01916         <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a05f3fac882e7f60a9ed0d73e227caae4">_sent_flits_out</a>) *<a class="code" href="classTrafficManager.html#a05f3fac882e7f60a9ed0d73e227caae4">_sent_flits_out</a> &lt;&lt; r-&gt;<a class="code" href="classRouter.html#ab12c27748174c05fff2352cbaefb0258">GetSentFlits</a>(c) &lt;&lt; trail_char;
<a name="l01917"></a>01917         <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a02bf243c1a00b188df58b2aac299530a">_outstanding_credits_out</a>) *<a class="code" href="classTrafficManager.html#a02bf243c1a00b188df58b2aac299530a">_outstanding_credits_out</a> &lt;&lt; r-&gt;<a class="code" href="classRouter.html#aa2f1a3138b370f77f929ac2effc59630">GetOutstandingCredits</a>(c) &lt;&lt; trail_char;
<a name="l01918"></a>01918         <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a4f7eea17545e1fd80ba48ba9ca8a2fb7">_active_packets_out</a>) *<a class="code" href="classTrafficManager.html#a4f7eea17545e1fd80ba48ba9ca8a2fb7">_active_packets_out</a> &lt;&lt; r-&gt;<a class="code" href="classRouter.html#a8686c16239859824175317c112bbb27a">GetActivePackets</a>(c) &lt;&lt; trail_char;
<a name="l01919"></a>01919         r-&gt;<a class="code" href="classRouter.html#a6f277baa099630cd64a4b7d83507ebf9">ResetFlowStats</a>(c);
<a name="l01920"></a>01920 <span class="preprocessor">#endif</span>
<a name="l01921"></a>01921 <span class="preprocessor"></span><span class="preprocessor">#ifdef TRACK_STALLS</span>
<a name="l01922"></a>01922 <span class="preprocessor"></span>        <a class="code" href="classTrafficManager.html#a1c784a6d1925a67a090fdcd2d4ea69c1">_buffer_busy_stalls</a>[c][subnet*_routers+router] += r-&gt;<a class="code" href="classRouter.html#a0951f720e83668772eb443e166631f4f">GetBufferBusyStalls</a>(c);
<a name="l01923"></a>01923         <a class="code" href="classTrafficManager.html#ae28ad10bf987f3edaea11411237c2da5">_buffer_conflict_stalls</a>[c][subnet*_routers+router] += r-&gt;<a class="code" href="classRouter.html#aa6a96de312bf90fa12e76618d2064ac8">GetBufferConflictStalls</a>(c);
<a name="l01924"></a>01924         <a class="code" href="classTrafficManager.html#a9933b441d6750f35f7622e69c0baa0a0">_buffer_full_stalls</a>[c][subnet*_routers+router] += r-&gt;<a class="code" href="classRouter.html#a7ccf0ff7a78db01be211e34169d9c7f0">GetBufferFullStalls</a>(c);
<a name="l01925"></a>01925         <a class="code" href="classTrafficManager.html#aa1a62024edeb3fbcbcd12a4c15c75c1c">_buffer_reserved_stalls</a>[c][subnet*_routers+router] += r-&gt;<a class="code" href="classRouter.html#ac939e7f689d66e62eb34ec87523fbc74">GetBufferReservedStalls</a>(c);
<a name="l01926"></a>01926         <a class="code" href="classTrafficManager.html#afb85e3761a4ff0c6a9330e6f47ea6314">_crossbar_conflict_stalls</a>[c][subnet*_routers+router] += r-&gt;<a class="code" href="classRouter.html#a0c55190b239e9551f581208aa7180ad4">GetCrossbarConflictStalls</a>(c);
<a name="l01927"></a>01927         r-&gt;<a class="code" href="classRouter.html#ac2f07cb16550c8bf183ea71b7c2d5c47">ResetStallStats</a>(c);
<a name="l01928"></a>01928 <span class="preprocessor">#endif</span>
<a name="l01929"></a>01929 <span class="preprocessor"></span>      }
<a name="l01930"></a>01930     }
<a name="l01931"></a>01931   }
<a name="l01932"></a>01932 <span class="preprocessor">#ifdef TRACK_FLOWS</span>
<a name="l01933"></a>01933 <span class="preprocessor"></span>  <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a60e297ef653cf18c18b59dd8903ada5e">_injected_flits_out</a>) *<a class="code" href="classTrafficManager.html#a60e297ef653cf18c18b59dd8903ada5e">_injected_flits_out</a> &lt;&lt; flush;
<a name="l01934"></a>01934   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a19cc011b7cd07169ed7940898815d3ff">_received_flits_out</a>) *<a class="code" href="classTrafficManager.html#a19cc011b7cd07169ed7940898815d3ff">_received_flits_out</a> &lt;&lt; flush;
<a name="l01935"></a>01935   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#ac95b0e32d233d93d649e8491e770bd19">_stored_flits_out</a>) *<a class="code" href="classTrafficManager.html#ac95b0e32d233d93d649e8491e770bd19">_stored_flits_out</a> &lt;&lt; flush;
<a name="l01936"></a>01936   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a05f3fac882e7f60a9ed0d73e227caae4">_sent_flits_out</a>) *<a class="code" href="classTrafficManager.html#a05f3fac882e7f60a9ed0d73e227caae4">_sent_flits_out</a> &lt;&lt; flush;
<a name="l01937"></a>01937   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a02bf243c1a00b188df58b2aac299530a">_outstanding_credits_out</a>) *<a class="code" href="classTrafficManager.html#a02bf243c1a00b188df58b2aac299530a">_outstanding_credits_out</a> &lt;&lt; flush;
<a name="l01938"></a>01938   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a1f9bb8ef5f9553a1e5417acddd18159f">_ejected_flits_out</a>) *<a class="code" href="classTrafficManager.html#a1f9bb8ef5f9553a1e5417acddd18159f">_ejected_flits_out</a> &lt;&lt; flush;
<a name="l01939"></a>01939   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a4f7eea17545e1fd80ba48ba9ca8a2fb7">_active_packets_out</a>) *<a class="code" href="classTrafficManager.html#a4f7eea17545e1fd80ba48ba9ca8a2fb7">_active_packets_out</a> &lt;&lt; flush;
<a name="l01940"></a>01940 <span class="preprocessor">#endif</span>
<a name="l01941"></a>01941 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l01942"></a>01942 <span class="preprocessor"></span>  
<a name="l01943"></a>01943 <span class="preprocessor">#ifdef TRACK_CREDITS</span>
<a name="l01944"></a>01944 <span class="preprocessor"></span>  <span class="keywordflow">for</span>(<span class="keywordtype">int</span> s = 0; s &lt; _subnets; ++s) {
<a name="l01945"></a>01945     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> = 0; <a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a> &lt; _nodes; ++<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>) {
<a name="l01946"></a>01946       <a class="code" href="classBufferState.html">BufferState</a> <span class="keyword">const</span> * <span class="keyword">const</span> bs = <a class="code" href="classTrafficManager.html#a26909b743654d9b10f7aedd16421506c">_buf_states</a>[<a class="code" href="rng_8cpp.html#a76f11d9a0a47b94f72c2d0e77fb32240">n</a>][s];
<a name="l01947"></a>01947       <span class="keywordflow">for</span>(<span class="keywordtype">int</span> v = 0; v &lt; <a class="code" href="classTrafficManager.html#a4db1e48f0a35866bfc680c1544363511">_vcs</a>; ++v) {
<a name="l01948"></a>01948         <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#ab91032ac7351823fcb7433a7ec815b36">_used_credits_out</a>) *<a class="code" href="classTrafficManager.html#ab91032ac7351823fcb7433a7ec815b36">_used_credits_out</a> &lt;&lt; bs-&gt;<a class="code" href="classBufferState.html#a5e720db4003d1e050dfe4dcbfc791c26">OccupancyFor</a>(v) &lt;&lt; <span class="charliteral">&apos;,&apos;</span>;
<a name="l01949"></a>01949         <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a0594ee276bbfbb6629e96be8af864ef7">_free_credits_out</a>) *<a class="code" href="classTrafficManager.html#a0594ee276bbfbb6629e96be8af864ef7">_free_credits_out</a> &lt;&lt; bs-&gt;<a class="code" href="classBufferState.html#a433a1fca219613ac7b21ba4fe7d63283">AvailableFor</a>(v) &lt;&lt; <span class="charliteral">&apos;,&apos;</span>;
<a name="l01950"></a>01950         <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#aefd7305f60a0dfea91de3a4678701c69">_max_credits_out</a>) *<a class="code" href="classTrafficManager.html#aefd7305f60a0dfea91de3a4678701c69">_max_credits_out</a> &lt;&lt; bs-&gt;<a class="code" href="classBufferState.html#a18de67c9bdca219e5cc0b23118f81a55">LimitFor</a>(v) &lt;&lt; <span class="charliteral">&apos;,&apos;</span>;
<a name="l01951"></a>01951       }
<a name="l01952"></a>01952     }
<a name="l01953"></a>01953     <span class="keywordflow">for</span>(<span class="keywordtype">int</span> r = 0; r &lt; _routers; ++r) {
<a name="l01954"></a>01954       <a class="code" href="classRouter.html">Router</a> <span class="keyword">const</span> * <span class="keyword">const</span> rtr = <a class="code" href="classTrafficManager.html#a4c45c20f60c464ef56243c16ec3a1681">_router</a>[s][r];
<a name="l01955"></a>01955       <span class="keywordtype">char</span> trail_char =
<a name="l01956"></a>01956       ((r == _routers - 1) &amp;&amp; (s == _subnets - 1)) ? <span class="charliteral">&apos;\n&apos;</span> : <span class="charliteral">&apos;,&apos;</span>;
<a name="l01957"></a>01957       <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#ab91032ac7351823fcb7433a7ec815b36">_used_credits_out</a>) *<a class="code" href="classTrafficManager.html#ab91032ac7351823fcb7433a7ec815b36">_used_credits_out</a> &lt;&lt; rtr-&gt;<a class="code" href="classRouter.html#adb321acd2ddcdaa1b95646bc6f985092">UsedCredits</a>() &lt;&lt; trail_char;
<a name="l01958"></a>01958       <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a0594ee276bbfbb6629e96be8af864ef7">_free_credits_out</a>) *<a class="code" href="classTrafficManager.html#a0594ee276bbfbb6629e96be8af864ef7">_free_credits_out</a> &lt;&lt; rtr-&gt;<a class="code" href="classRouter.html#aca1404326139654bff51f1cab6986dee">FreeCredits</a>() &lt;&lt; trail_char;
<a name="l01959"></a>01959       <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#aefd7305f60a0dfea91de3a4678701c69">_max_credits_out</a>) *<a class="code" href="classTrafficManager.html#aefd7305f60a0dfea91de3a4678701c69">_max_credits_out</a> &lt;&lt; rtr-&gt;<a class="code" href="classRouter.html#a8fa1d7c7f212dc18ad92a59d777dce33">MaxCredits</a>() &lt;&lt; trail_char;
<a name="l01960"></a>01960     }
<a name="l01961"></a>01961   }
<a name="l01962"></a>01962   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#ab91032ac7351823fcb7433a7ec815b36">_used_credits_out</a>) *<a class="code" href="classTrafficManager.html#ab91032ac7351823fcb7433a7ec815b36">_used_credits_out</a> &lt;&lt; flush;
<a name="l01963"></a>01963   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a0594ee276bbfbb6629e96be8af864ef7">_free_credits_out</a>) *<a class="code" href="classTrafficManager.html#a0594ee276bbfbb6629e96be8af864ef7">_free_credits_out</a> &lt;&lt; flush;
<a name="l01964"></a>01964   <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#aefd7305f60a0dfea91de3a4678701c69">_max_credits_out</a>) *<a class="code" href="classTrafficManager.html#aefd7305f60a0dfea91de3a4678701c69">_max_credits_out</a> &lt;&lt; flush;
<a name="l01965"></a>01965 <span class="preprocessor">#endif</span>
<a name="l01966"></a>01966 <span class="preprocessor"></span>  
<a name="l01967"></a>01967 }
<a name="l01968"></a>01968 
<a name="l01969"></a><a class="code" href="classTrafficManager.html#ad73e9b9cf6de7d0296c0b6aaab9c918c">01969</a> <span class="keywordtype">void</span> <a class="code" href="classTrafficManager.html#ad73e9b9cf6de7d0296c0b6aaab9c918c">TrafficManager::DisplayStats</a>(ostream &amp; os)<span class="keyword"> const </span>{
<a name="l01970"></a>01970   
<a name="l01971"></a>01971   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; _classes; ++c) {
<a name="l01972"></a>01972     
<a name="l01973"></a>01973     <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a549fe0af403657daf47db078f7f1814a">_measure_stats</a>[c] == 0) {
<a name="l01974"></a>01974       <span class="keywordflow">continue</span>;
<a name="l01975"></a>01975     }
<a name="l01976"></a>01976     
<a name="l01977"></a>01977     cout &lt;&lt; <span class="stringliteral">&quot;Class &quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; endl;
<a name="l01978"></a>01978     
<a name="l01979"></a>01979     cout
<a name="l01980"></a>01980     &lt;&lt; <span class="stringliteral">&quot;Packet latency average = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[c]-&gt;Average() &lt;&lt; endl
<a name="l01981"></a>01981     &lt;&lt; <span class="stringliteral">&quot;\tminimum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[c]-&gt;Min() &lt;&lt; endl
<a name="l01982"></a>01982     &lt;&lt; <span class="stringliteral">&quot;\tmaximum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#aa956ddde5eb5181cce206ef0d5fb539b">_plat_stats</a>[c]-&gt;Max() &lt;&lt; endl
<a name="l01983"></a>01983     &lt;&lt; <span class="stringliteral">&quot;Network latency average = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a9180e022d85c6388bfd7e58cbfc10b47">_nlat_stats</a>[c]-&gt;Average() &lt;&lt; endl
<a name="l01984"></a>01984     &lt;&lt; <span class="stringliteral">&quot;\tminimum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a9180e022d85c6388bfd7e58cbfc10b47">_nlat_stats</a>[c]-&gt;Min() &lt;&lt; endl
<a name="l01985"></a>01985     &lt;&lt; <span class="stringliteral">&quot;\tmaximum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a9180e022d85c6388bfd7e58cbfc10b47">_nlat_stats</a>[c]-&gt;Max() &lt;&lt; endl
<a name="l01986"></a>01986     &lt;&lt; <span class="stringliteral">&quot;Slowest packet = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#abd64d715d45401f6306d9f512d50ae66">_slowest_packet</a>[c] &lt;&lt; endl
<a name="l01987"></a>01987     &lt;&lt; <span class="stringliteral">&quot;Flit latency average = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ab435afa5236277ff8d6a1991860cf546">_flat_stats</a>[c]-&gt;Average() &lt;&lt; endl
<a name="l01988"></a>01988     &lt;&lt; <span class="stringliteral">&quot;\tminimum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ab435afa5236277ff8d6a1991860cf546">_flat_stats</a>[c]-&gt;Min() &lt;&lt; endl
<a name="l01989"></a>01989     &lt;&lt; <span class="stringliteral">&quot;\tmaximum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ab435afa5236277ff8d6a1991860cf546">_flat_stats</a>[c]-&gt;Max() &lt;&lt; endl
<a name="l01990"></a>01990     &lt;&lt; <span class="stringliteral">&quot;Slowest flit = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a4a883d0cafe388d38cbe80a40509a23c">_slowest_flit</a>[c] &lt;&lt; endl
<a name="l01991"></a>01991     &lt;&lt; <span class="stringliteral">&quot;Fragmentation average = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a7f160ac254d3ceabd825f1c59f42b179">_frag_stats</a>[c]-&gt;Average() &lt;&lt; endl
<a name="l01992"></a>01992     &lt;&lt; <span class="stringliteral">&quot;\tminimum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a7f160ac254d3ceabd825f1c59f42b179">_frag_stats</a>[c]-&gt;Min() &lt;&lt; endl
<a name="l01993"></a>01993     &lt;&lt; <span class="stringliteral">&quot;\tmaximum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a7f160ac254d3ceabd825f1c59f42b179">_frag_stats</a>[c]-&gt;Max() &lt;&lt; endl;
<a name="l01994"></a>01994     
<a name="l01995"></a>01995     <span class="keywordtype">int</span> count_sum, count_min, count_max;
<a name="l01996"></a>01996     <span class="keywordtype">double</span> rate_sum, rate_min, rate_max;
<a name="l01997"></a>01997     <span class="keywordtype">double</span> rate_avg;
<a name="l01998"></a>01998     <span class="keywordtype">int</span> sent_packets, sent_flits, accepted_packets, accepted_flits;
<a name="l01999"></a>01999     <span class="keywordtype">int</span> min_pos, max_pos;
<a name="l02000"></a>02000     <span class="keywordtype">double</span> time_delta = (double)(<a class="code" href="classTrafficManager.html#ad6917af7fecdd4b35bcbbf73943a3b31">_time</a> - <a class="code" href="classTrafficManager.html#a056be33c6e4eaac14e7105f31e804748">_reset_time</a>);
<a name="l02001"></a>02001     <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">_ComputeStats</a>(<a class="code" href="classTrafficManager.html#a552ccfae3f5aad4c71b188d97614012d">_sent_packets</a>[c], &amp;count_sum, &amp;count_min, &amp;count_max, &amp;min_pos, &amp;max_pos);
<a name="l02002"></a>02002     rate_sum = (double)count_sum / time_delta;
<a name="l02003"></a>02003     rate_min = (double)count_min / time_delta;
<a name="l02004"></a>02004     rate_max = (double)count_max / time_delta;
<a name="l02005"></a>02005     rate_avg = rate_sum / (double)_nodes;
<a name="l02006"></a>02006     sent_packets = count_sum;
<a name="l02007"></a>02007     cout &lt;&lt; <span class="stringliteral">&quot;Injected packet rate average = &quot;</span> &lt;&lt; rate_avg &lt;&lt; endl
<a name="l02008"></a>02008     &lt;&lt; <span class="stringliteral">&quot;\tminimum = &quot;</span> &lt;&lt; rate_min
<a name="l02009"></a>02009     &lt;&lt; <span class="stringliteral">&quot; (at node &quot;</span> &lt;&lt; min_pos &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl
<a name="l02010"></a>02010     &lt;&lt; <span class="stringliteral">&quot;\tmaximum = &quot;</span> &lt;&lt; rate_max
<a name="l02011"></a>02011     &lt;&lt; <span class="stringliteral">&quot; (at node &quot;</span> &lt;&lt; max_pos &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l02012"></a>02012     <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">_ComputeStats</a>(<a class="code" href="classTrafficManager.html#acec4c1294844394b7bf8008f5b920593">_accepted_packets</a>[c], &amp;count_sum, &amp;count_min, &amp;count_max, &amp;min_pos, &amp;max_pos);
<a name="l02013"></a>02013     rate_sum = (double)count_sum / time_delta;
<a name="l02014"></a>02014     rate_min = (double)count_min / time_delta;
<a name="l02015"></a>02015     rate_max = (double)count_max / time_delta;
<a name="l02016"></a>02016     rate_avg = rate_sum / (double)_nodes;
<a name="l02017"></a>02017     accepted_packets = count_sum;
<a name="l02018"></a>02018     cout &lt;&lt; <span class="stringliteral">&quot;Accepted packet rate average = &quot;</span> &lt;&lt; rate_avg &lt;&lt; endl
<a name="l02019"></a>02019     &lt;&lt; <span class="stringliteral">&quot;\tminimum = &quot;</span> &lt;&lt; rate_min
<a name="l02020"></a>02020     &lt;&lt; <span class="stringliteral">&quot; (at node &quot;</span> &lt;&lt; min_pos &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl
<a name="l02021"></a>02021     &lt;&lt; <span class="stringliteral">&quot;\tmaximum = &quot;</span> &lt;&lt; rate_max
<a name="l02022"></a>02022     &lt;&lt; <span class="stringliteral">&quot; (at node &quot;</span> &lt;&lt; max_pos &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l02023"></a>02023     <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">_ComputeStats</a>(<a class="code" href="classTrafficManager.html#a62c2881d71bd8a580c008cebf2753012">_sent_flits</a>[c], &amp;count_sum, &amp;count_min, &amp;count_max, &amp;min_pos, &amp;max_pos);
<a name="l02024"></a>02024     rate_sum = (double)count_sum / time_delta;
<a name="l02025"></a>02025     rate_min = (double)count_min / time_delta;
<a name="l02026"></a>02026     rate_max = (double)count_max / time_delta;
<a name="l02027"></a>02027     rate_avg = rate_sum / (double)_nodes;
<a name="l02028"></a>02028     sent_flits = count_sum;
<a name="l02029"></a>02029     cout &lt;&lt; <span class="stringliteral">&quot;Injected flit rate average = &quot;</span> &lt;&lt; rate_avg &lt;&lt; endl
<a name="l02030"></a>02030     &lt;&lt; <span class="stringliteral">&quot;\tminimum = &quot;</span> &lt;&lt; rate_min
<a name="l02031"></a>02031     &lt;&lt; <span class="stringliteral">&quot; (at node &quot;</span> &lt;&lt; min_pos &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl
<a name="l02032"></a>02032     &lt;&lt; <span class="stringliteral">&quot;\tmaximum = &quot;</span> &lt;&lt; rate_max
<a name="l02033"></a>02033     &lt;&lt; <span class="stringliteral">&quot; (at node &quot;</span> &lt;&lt; max_pos &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l02034"></a>02034     <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">_ComputeStats</a>(<a class="code" href="classTrafficManager.html#a089e444802486d4e5092066d4c357c30">_accepted_flits</a>[c], &amp;count_sum, &amp;count_min, &amp;count_max, &amp;min_pos, &amp;max_pos);
<a name="l02035"></a>02035     rate_sum = (double)count_sum / time_delta;
<a name="l02036"></a>02036     rate_min = (double)count_min / time_delta;
<a name="l02037"></a>02037     rate_max = (double)count_max / time_delta;
<a name="l02038"></a>02038     rate_avg = rate_sum / (double)_nodes;
<a name="l02039"></a>02039     accepted_flits = count_sum;
<a name="l02040"></a>02040     cout &lt;&lt; <span class="stringliteral">&quot;Accepted flit rate average= &quot;</span> &lt;&lt; rate_avg &lt;&lt; endl
<a name="l02041"></a>02041     &lt;&lt; <span class="stringliteral">&quot;\tminimum = &quot;</span> &lt;&lt; rate_min
<a name="l02042"></a>02042     &lt;&lt; <span class="stringliteral">&quot; (at node &quot;</span> &lt;&lt; min_pos &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl
<a name="l02043"></a>02043     &lt;&lt; <span class="stringliteral">&quot;\tmaximum = &quot;</span> &lt;&lt; rate_max
<a name="l02044"></a>02044     &lt;&lt; <span class="stringliteral">&quot; (at node &quot;</span> &lt;&lt; max_pos &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l02045"></a>02045     
<a name="l02046"></a>02046     cout &lt;&lt; <span class="stringliteral">&quot;Injected packet length average = &quot;</span> &lt;&lt; (double)sent_flits / (<span class="keywordtype">double</span>)sent_packets &lt;&lt; endl
<a name="l02047"></a>02047     &lt;&lt; <span class="stringliteral">&quot;Accepted packet length average = &quot;</span> &lt;&lt; (double)accepted_flits / (<span class="keywordtype">double</span>)accepted_packets &lt;&lt; endl;
<a name="l02048"></a>02048     
<a name="l02049"></a>02049     cout &lt;&lt; <span class="stringliteral">&quot;Total in-flight flits = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a6475ddc0ca6ff8a7cae263585e651fb5">_total_in_flight_flits</a>[c].size()
<a name="l02050"></a>02050     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ab3f440b8929d778298a078fff4fe492f">_measured_in_flight_flits</a>[c].size() &lt;&lt; <span class="stringliteral">&quot; measured)&quot;</span>
<a name="l02051"></a>02051     &lt;&lt; endl;
<a name="l02052"></a>02052     
<a name="l02053"></a>02053 <span class="preprocessor">#ifdef TRACK_STALLS</span>
<a name="l02054"></a>02054 <span class="preprocessor"></span>    <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">_ComputeStats</a>(<a class="code" href="classTrafficManager.html#a1c784a6d1925a67a090fdcd2d4ea69c1">_buffer_busy_stalls</a>[c], &amp;count_sum);
<a name="l02055"></a>02055     rate_sum = (double)count_sum / time_delta;
<a name="l02056"></a>02056     rate_avg = rate_sum / (double)(_subnets*_routers);
<a name="l02057"></a>02057     os &lt;&lt; <span class="stringliteral">&quot;Buffer busy stall rate = &quot;</span> &lt;&lt; rate_avg &lt;&lt; endl;
<a name="l02058"></a>02058     <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">_ComputeStats</a>(<a class="code" href="classTrafficManager.html#ae28ad10bf987f3edaea11411237c2da5">_buffer_conflict_stalls</a>[c], &amp;count_sum);
<a name="l02059"></a>02059     rate_sum = (double)count_sum / time_delta;
<a name="l02060"></a>02060     rate_avg = rate_sum / (double)(_subnets*_routers);
<a name="l02061"></a>02061     os &lt;&lt; <span class="stringliteral">&quot;Buffer conflict stall rate = &quot;</span> &lt;&lt; rate_avg &lt;&lt; endl;
<a name="l02062"></a>02062     <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">_ComputeStats</a>(<a class="code" href="classTrafficManager.html#a9933b441d6750f35f7622e69c0baa0a0">_buffer_full_stalls</a>[c], &amp;count_sum);
<a name="l02063"></a>02063     rate_sum = (double)count_sum / time_delta;
<a name="l02064"></a>02064     rate_avg = rate_sum / (double)(_subnets*_routers);
<a name="l02065"></a>02065     os &lt;&lt; <span class="stringliteral">&quot;Buffer full stall rate = &quot;</span> &lt;&lt; rate_avg &lt;&lt; endl;
<a name="l02066"></a>02066     <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">_ComputeStats</a>(<a class="code" href="classTrafficManager.html#aa1a62024edeb3fbcbcd12a4c15c75c1c">_buffer_reserved_stalls</a>[c], &amp;count_sum);
<a name="l02067"></a>02067     rate_sum = (double)count_sum / time_delta;
<a name="l02068"></a>02068     rate_avg = rate_sum / (double)(_subnets*_routers);
<a name="l02069"></a>02069     os &lt;&lt; <span class="stringliteral">&quot;Buffer reserved stall rate = &quot;</span> &lt;&lt; rate_avg &lt;&lt; endl;
<a name="l02070"></a>02070     <a class="code" href="classTrafficManager.html#a64293ee9564095db66fb65cc089e012c">_ComputeStats</a>(<a class="code" href="classTrafficManager.html#afb85e3761a4ff0c6a9330e6f47ea6314">_crossbar_conflict_stalls</a>[c], &amp;count_sum);
<a name="l02071"></a>02071     rate_sum = (double)count_sum / time_delta;
<a name="l02072"></a>02072     rate_avg = rate_sum / (double)(_subnets*_routers);
<a name="l02073"></a>02073     os &lt;&lt; <span class="stringliteral">&quot;Crossbar conflict stall rate = &quot;</span> &lt;&lt; rate_avg &lt;&lt; endl;
<a name="l02074"></a>02074 <span class="preprocessor">#endif</span>
<a name="l02075"></a>02075 <span class="preprocessor"></span>    
<a name="l02076"></a>02076   }
<a name="l02077"></a>02077 }
<a name="l02078"></a>02078 
<a name="l02079"></a><a class="code" href="classTrafficManager.html#aa5bb4cff750b8cb1dbc0657d86d26dc1">02079</a> <span class="keywordtype">void</span> <a class="code" href="classTrafficManager.html#aa5bb4cff750b8cb1dbc0657d86d26dc1">TrafficManager::DisplayOverallStats</a>( ostream &amp; os )<span class="keyword"> const </span>{
<a name="l02080"></a>02080   
<a name="l02081"></a>02081   os &lt;&lt; <span class="stringliteral">&quot;====== Overall Traffic Statistics ======&quot;</span> &lt;&lt; endl;
<a name="l02082"></a>02082   <span class="keywordflow">for</span> ( <span class="keywordtype">int</span> c = 0; c &lt; _classes; ++c ) {
<a name="l02083"></a>02083     
<a name="l02084"></a>02084     <span class="keywordflow">if</span>(<a class="code" href="classTrafficManager.html#a549fe0af403657daf47db078f7f1814a">_measure_stats</a>[c] == 0) {
<a name="l02085"></a>02085       <span class="keywordflow">continue</span>;
<a name="l02086"></a>02086     }
<a name="l02087"></a>02087     
<a name="l02088"></a>02088     os &lt;&lt; <span class="stringliteral">&quot;====== Traffic class &quot;</span> &lt;&lt; c &lt;&lt; <span class="stringliteral">&quot; ======&quot;</span> &lt;&lt; endl;
<a name="l02089"></a>02089     
<a name="l02090"></a>02090     os &lt;&lt; <span class="stringliteral">&quot;Packet latency average = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a33d2fac8e8898950df680e4026c99ecc">_overall_avg_plat</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02091"></a>02091     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02092"></a>02092     os &lt;&lt; <span class="stringliteral">&quot;\tminimum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a9396b27b8d314aedca6477fe7f03e0fb">_overall_min_plat</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02093"></a>02093     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02094"></a>02094     os &lt;&lt; <span class="stringliteral">&quot;\tmaximum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a26ca4cf3881f84c8d4c737ebe2f3b330">_overall_max_plat</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02095"></a>02095     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02096"></a>02096     
<a name="l02097"></a>02097     os &lt;&lt; <span class="stringliteral">&quot;Network latency average = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a6265a966369698ffc482fffcb404a8b1">_overall_avg_nlat</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02098"></a>02098     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02099"></a>02099     os &lt;&lt; <span class="stringliteral">&quot;\tminimum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a6a3841f0bd16509994037af9215e5985">_overall_min_nlat</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02100"></a>02100     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02101"></a>02101     os &lt;&lt; <span class="stringliteral">&quot;\tmaximum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a5f6f27514cbe0ae389f2dd51c08af05d">_overall_max_nlat</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02102"></a>02102     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02103"></a>02103     
<a name="l02104"></a>02104     os &lt;&lt; <span class="stringliteral">&quot;Flit latency average = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a6e1a9cc72c637afd54ac3e1aaf38f0ec">_overall_avg_flat</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02105"></a>02105     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02106"></a>02106     os &lt;&lt; <span class="stringliteral">&quot;\tminimum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#abaaf1b91fdea78eb0c53afa5b3b50709">_overall_min_flat</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02107"></a>02107     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02108"></a>02108     os &lt;&lt; <span class="stringliteral">&quot;\tmaximum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ab28f8c5f823e52c747d9e94a131236a3">_overall_max_flat</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02109"></a>02109     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02110"></a>02110     
<a name="l02111"></a>02111     os &lt;&lt; <span class="stringliteral">&quot;Fragmentation average = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a1f7bd1e0c88c5533db25f21c543171e7">_overall_avg_frag</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02112"></a>02112     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02113"></a>02113     os &lt;&lt; <span class="stringliteral">&quot;\tminimum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a5716fdc9d88c92bd754b12cd3f90548e">_overall_min_frag</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02114"></a>02114     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02115"></a>02115     os &lt;&lt; <span class="stringliteral">&quot;\tmaximum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a2e27b6106049bd42fbcc5175d2a68c15">_overall_max_frag</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02116"></a>02116     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02117"></a>02117     
<a name="l02118"></a>02118     os &lt;&lt; <span class="stringliteral">&quot;Injected packet rate average = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#aa3074d74ad3d6ecc67555b860a63d057">_overall_avg_sent_packets</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02119"></a>02119     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02120"></a>02120     os &lt;&lt; <span class="stringliteral">&quot;\tminimum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#aa1346fe8293a7cbb0c8ab377ef91b94a">_overall_min_sent_packets</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02121"></a>02121     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02122"></a>02122     os &lt;&lt; <span class="stringliteral">&quot;\tmaximum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a08a31f70886b7d439b49e5e34323ffd2">_overall_max_sent_packets</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02123"></a>02123     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02124"></a>02124     
<a name="l02125"></a>02125     os &lt;&lt; <span class="stringliteral">&quot;Accepted packet rate average = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a685bfa1f07f24455554ba4ac3d23d234">_overall_avg_accepted_packets</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02126"></a>02126     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02127"></a>02127     os &lt;&lt; <span class="stringliteral">&quot;\tminimum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#aab17754eda186939996cb0f8c4e98ca9">_overall_min_accepted_packets</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02128"></a>02128     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02129"></a>02129     os &lt;&lt; <span class="stringliteral">&quot;\tmaximum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a93c1c6bd29b8ce0f1bed4e8d2f11780d">_overall_max_accepted_packets</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02130"></a>02130     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02131"></a>02131     
<a name="l02132"></a>02132     os &lt;&lt; <span class="stringliteral">&quot;Injected flit rate average = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#abc7df4963565ff43085f5d14efcf65fb">_overall_avg_sent</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02133"></a>02133     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02134"></a>02134     os &lt;&lt; <span class="stringliteral">&quot;\tminimum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a2bf102d9ea1e22ad0b3f7e3dcfe7e563">_overall_min_sent</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02135"></a>02135     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02136"></a>02136     os &lt;&lt; <span class="stringliteral">&quot;\tmaximum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a4a5abf1deff55a87dc10117bff22e497">_overall_max_sent</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02137"></a>02137     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02138"></a>02138     
<a name="l02139"></a>02139     os &lt;&lt; <span class="stringliteral">&quot;Accepted flit rate average = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#aa20932dad1291e91a8d52c1bd57aff25">_overall_avg_accepted</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02140"></a>02140     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02141"></a>02141     os &lt;&lt; <span class="stringliteral">&quot;\tminimum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a151b13006c1fef516d5aa42b6d4b6b97">_overall_min_accepted</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02142"></a>02142     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02143"></a>02143     os &lt;&lt; <span class="stringliteral">&quot;\tmaximum = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#aa87d9a9975984c42248559b2794e37b1">_overall_max_accepted</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02144"></a>02144     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02145"></a>02145     
<a name="l02146"></a>02146     os &lt;&lt; <span class="stringliteral">&quot;Injected packet size average = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#abc7df4963565ff43085f5d14efcf65fb">_overall_avg_sent</a>[c] / <a class="code" href="classTrafficManager.html#aa3074d74ad3d6ecc67555b860a63d057">_overall_avg_sent_packets</a>[c]
<a name="l02147"></a>02147     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02148"></a>02148     
<a name="l02149"></a>02149     os &lt;&lt; <span class="stringliteral">&quot;Accepted packet size average = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#aa20932dad1291e91a8d52c1bd57aff25">_overall_avg_accepted</a>[c] / <a class="code" href="classTrafficManager.html#a685bfa1f07f24455554ba4ac3d23d234">_overall_avg_accepted_packets</a>[c]
<a name="l02150"></a>02150     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02151"></a>02151     
<a name="l02152"></a>02152     os &lt;&lt; <span class="stringliteral">&quot;Hops average = &quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a2a5ad817564086e123c30482e618b161">_overall_hop_stats</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02153"></a>02153     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02154"></a>02154     
<a name="l02155"></a>02155 <span class="preprocessor">#ifdef TRACK_STALLS</span>
<a name="l02156"></a>02156 <span class="preprocessor"></span>    os &lt;&lt; <span class="stringliteral">&quot;Buffer busy stall rate = &quot;</span> &lt;&lt; (double)<a class="code" href="classTrafficManager.html#aa2cb008e7849e88b08017782112b1e25">_overall_buffer_busy_stalls</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02157"></a>02157     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl
<a name="l02158"></a>02158     &lt;&lt; <span class="stringliteral">&quot;Buffer conflict stall rate = &quot;</span> &lt;&lt; (double)<a class="code" href="classTrafficManager.html#ad9052e0ca146f1de2558a8da70304a41">_overall_buffer_conflict_stalls</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02159"></a>02159     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl
<a name="l02160"></a>02160     &lt;&lt; <span class="stringliteral">&quot;Buffer full stall rate = &quot;</span> &lt;&lt; (double)<a class="code" href="classTrafficManager.html#ac8157210498782084dcd8ccb070df5b3">_overall_buffer_full_stalls</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02161"></a>02161     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl
<a name="l02162"></a>02162     &lt;&lt; <span class="stringliteral">&quot;Buffer reserved stall rate = &quot;</span> &lt;&lt; (double)<a class="code" href="classTrafficManager.html#ac8aef5fb9a0c62b9feb51e54911d7d21">_overall_buffer_reserved_stalls</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02163"></a>02163     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl
<a name="l02164"></a>02164     &lt;&lt; <span class="stringliteral">&quot;Crossbar conflict stall rate = &quot;</span> &lt;&lt; (double)<a class="code" href="classTrafficManager.html#a47397318e8ec5faa031e62696754d6e4">_overall_crossbar_conflict_stalls</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02165"></a>02165     &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a> &lt;&lt; <span class="stringliteral">&quot; samples)&quot;</span> &lt;&lt; endl;
<a name="l02166"></a>02166 <span class="preprocessor">#endif</span>
<a name="l02167"></a>02167 <span class="preprocessor"></span>    
<a name="l02168"></a>02168   }
<a name="l02169"></a>02169   
<a name="l02170"></a>02170 }
<a name="l02171"></a>02171 
<a name="l02172"></a><a class="code" href="classTrafficManager.html#a8873de0322681829d41b183b013c1efb">02172</a> <span class="keywordtype">string</span> <a class="code" href="classTrafficManager.html#a8873de0322681829d41b183b013c1efb">TrafficManager::_OverallStatsCSV</a>(<span class="keywordtype">int</span> c)<span class="keyword"> const</span>
<a name="l02173"></a>02173 <span class="keyword"></span>{
<a name="l02174"></a>02174   ostringstream os;
<a name="l02175"></a>02175   os &lt;&lt; <a class="code" href="classTrafficManager.html#a1394f9957be48b86a2044d417c71e90e">_traffic</a>[c]
<a name="l02176"></a>02176   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#adfe9e24ec927025a9f94e55cba8516f5">_use_read_write</a>[c]
<a name="l02177"></a>02177   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#aab883f710d03a1953c45b4ee1431aa80">_load</a>[c]
<a name="l02178"></a>02178   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a9396b27b8d314aedca6477fe7f03e0fb">_overall_min_plat</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02179"></a>02179   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a33d2fac8e8898950df680e4026c99ecc">_overall_avg_plat</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02180"></a>02180   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a26ca4cf3881f84c8d4c737ebe2f3b330">_overall_max_plat</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02181"></a>02181   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a6a3841f0bd16509994037af9215e5985">_overall_min_nlat</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02182"></a>02182   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a6265a966369698ffc482fffcb404a8b1">_overall_avg_nlat</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02183"></a>02183   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a5f6f27514cbe0ae389f2dd51c08af05d">_overall_max_nlat</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02184"></a>02184   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#abaaf1b91fdea78eb0c53afa5b3b50709">_overall_min_flat</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02185"></a>02185   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a6e1a9cc72c637afd54ac3e1aaf38f0ec">_overall_avg_flat</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02186"></a>02186   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#ab28f8c5f823e52c747d9e94a131236a3">_overall_max_flat</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02187"></a>02187   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a5716fdc9d88c92bd754b12cd3f90548e">_overall_min_frag</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02188"></a>02188   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a1f7bd1e0c88c5533db25f21c543171e7">_overall_avg_frag</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02189"></a>02189   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a2e27b6106049bd42fbcc5175d2a68c15">_overall_max_frag</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02190"></a>02190   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#aa1346fe8293a7cbb0c8ab377ef91b94a">_overall_min_sent_packets</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02191"></a>02191   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#aa3074d74ad3d6ecc67555b860a63d057">_overall_avg_sent_packets</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02192"></a>02192   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a08a31f70886b7d439b49e5e34323ffd2">_overall_max_sent_packets</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02193"></a>02193   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#aab17754eda186939996cb0f8c4e98ca9">_overall_min_accepted_packets</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02194"></a>02194   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a685bfa1f07f24455554ba4ac3d23d234">_overall_avg_accepted_packets</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02195"></a>02195   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a93c1c6bd29b8ce0f1bed4e8d2f11780d">_overall_max_accepted_packets</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02196"></a>02196   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a2bf102d9ea1e22ad0b3f7e3dcfe7e563">_overall_min_sent</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02197"></a>02197   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#abc7df4963565ff43085f5d14efcf65fb">_overall_avg_sent</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02198"></a>02198   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a4a5abf1deff55a87dc10117bff22e497">_overall_max_sent</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02199"></a>02199   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a151b13006c1fef516d5aa42b6d4b6b97">_overall_min_accepted</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02200"></a>02200   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#aa20932dad1291e91a8d52c1bd57aff25">_overall_avg_accepted</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02201"></a>02201   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#aa87d9a9975984c42248559b2794e37b1">_overall_max_accepted</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02202"></a>02202   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#abc7df4963565ff43085f5d14efcf65fb">_overall_avg_sent</a>[c] / <a class="code" href="classTrafficManager.html#aa3074d74ad3d6ecc67555b860a63d057">_overall_avg_sent_packets</a>[c]
<a name="l02203"></a>02203   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#aa20932dad1291e91a8d52c1bd57aff25">_overall_avg_accepted</a>[c] / <a class="code" href="classTrafficManager.html#a685bfa1f07f24455554ba4ac3d23d234">_overall_avg_accepted_packets</a>[c]
<a name="l02204"></a>02204   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a2a5ad817564086e123c30482e618b161">_overall_hop_stats</a>[c] / (double)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>;
<a name="l02205"></a>02205   
<a name="l02206"></a>02206 <span class="preprocessor">#ifdef TRACK_STALLS</span>
<a name="l02207"></a>02207 <span class="preprocessor"></span>  os &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; (double)<a class="code" href="classTrafficManager.html#aa2cb008e7849e88b08017782112b1e25">_overall_buffer_busy_stalls</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02208"></a>02208   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; (double)<a class="code" href="classTrafficManager.html#ad9052e0ca146f1de2558a8da70304a41">_overall_buffer_conflict_stalls</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02209"></a>02209   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; (double)<a class="code" href="classTrafficManager.html#ac8157210498782084dcd8ccb070df5b3">_overall_buffer_full_stalls</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02210"></a>02210   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; (double)<a class="code" href="classTrafficManager.html#ac8aef5fb9a0c62b9feb51e54911d7d21">_overall_buffer_reserved_stalls</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>
<a name="l02211"></a>02211   &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; (double)<a class="code" href="classTrafficManager.html#a47397318e8ec5faa031e62696754d6e4">_overall_crossbar_conflict_stalls</a>[c] / (<span class="keywordtype">double</span>)<a class="code" href="classTrafficManager.html#ac9dc6e763fd416e121cc42b26f590192">_total_sims</a>;
<a name="l02212"></a>02212 <span class="preprocessor">#endif</span>
<a name="l02213"></a>02213 <span class="preprocessor"></span>  
<a name="l02214"></a>02214   <span class="keywordflow">return</span> os.str();
<a name="l02215"></a>02215 }
<a name="l02216"></a>02216 
<a name="l02217"></a><a class="code" href="classTrafficManager.html#a216abfdb2470d6a92b9362e09e9c87fd">02217</a> <span class="keywordtype">void</span> <a class="code" href="classTrafficManager.html#a216abfdb2470d6a92b9362e09e9c87fd">TrafficManager::DisplayOverallStatsCSV</a>(ostream &amp; os)<span class="keyword"> const </span>{
<a name="l02218"></a>02218   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> c = 0; c &lt; _classes; ++c) {
<a name="l02219"></a>02219     os &lt;&lt; <span class="stringliteral">&quot;results:&quot;</span> &lt;&lt; c &lt;&lt; <span class="charliteral">&apos;,&apos;</span> &lt;&lt; <a class="code" href="classTrafficManager.html#a8873de0322681829d41b183b013c1efb">_OverallStatsCSV</a>() &lt;&lt; endl;
<a name="l02220"></a>02220   }
<a name="l02221"></a>02221 }
<a name="l02222"></a>02222 
<a name="l02223"></a>02223 <span class="comment">//read the watchlist</span>
<a name="l02224"></a><a class="code" href="classTrafficManager.html#a33718f55e04cc389a7a28f1f2261b923">02224</a> <span class="keywordtype">void</span> <a class="code" href="classTrafficManager.html#a33718f55e04cc389a7a28f1f2261b923">TrafficManager::_LoadWatchList</a>(<span class="keyword">const</span> <span class="keywordtype">string</span> &amp; <a class="code" href="cuobjdump__parser_8c.html#a5482b27881397d5b87f54feab7471580">filename</a>){
<a name="l02225"></a>02225   ifstream watch_list;
<a name="l02226"></a>02226   watch_list.open(filename.c_str());
<a name="l02227"></a>02227   
<a name="l02228"></a>02228   <span class="keywordtype">string</span> line;
<a name="l02229"></a>02229   <span class="keywordflow">if</span>(watch_list.is_open()) {
<a name="l02230"></a>02230     <span class="keywordflow">while</span>(!watch_list.eof()) {
<a name="l02231"></a>02231       getline(watch_list, line);
<a name="l02232"></a>02232       <span class="keywordflow">if</span>(line != <span class="stringliteral">&quot;&quot;</span>) {
<a name="l02233"></a>02233         <span class="keywordflow">if</span>(line[0] == <span class="charliteral">&apos;p&apos;</span>) {
<a name="l02234"></a>02234           <a class="code" href="classTrafficManager.html#af31f34fb4c338c9e27864d44f3abf3ea">_packets_to_watch</a>.insert(atoi(line.c_str()+1));
<a name="l02235"></a>02235         } <span class="keywordflow">else</span> {
<a name="l02236"></a>02236           <a class="code" href="classTrafficManager.html#a58a8ea82d95bf82f0309d5f9ecda2e34">_flits_to_watch</a>.insert(atoi(line.c_str()));
<a name="l02237"></a>02237         }
<a name="l02238"></a>02238       }
<a name="l02239"></a>02239     }
<a name="l02240"></a>02240     
<a name="l02241"></a>02241   } <span class="keywordflow">else</span> {
<a name="l02242"></a>02242     <a class="code" href="classModule.html#acfa9d0dc518853045e0d2356d138717f">Error</a>(<span class="stringliteral">&quot;Unable to open flit watch file: &quot;</span> + filename);
<a name="l02243"></a>02243   }
<a name="l02244"></a>02244 }
<a name="l02245"></a>02245 
<a name="l02246"></a><a class="code" href="classTrafficManager.html#afed030de03a685dc0d9f9d7445af3803">02246</a> <span class="keywordtype">int</span> <a class="code" href="classTrafficManager.html#afed030de03a685dc0d9f9d7445af3803">TrafficManager::_GetNextPacketSize</a>(<span class="keywordtype">int</span> cl)<span class="keyword"> const</span>
<a name="l02247"></a>02247 <span class="keyword"></span>{
<a name="l02248"></a>02248   assert(cl &gt;= 0 &amp;&amp; cl &lt; _classes);
<a name="l02249"></a>02249   
<a name="l02250"></a>02250   vector&lt;int&gt; <span class="keyword">const</span> &amp; psize = <a class="code" href="classTrafficManager.html#a9d132f9f6e9ea03ab7d4234091ea7f56">_packet_size</a>[cl];
<a name="l02251"></a>02251   <span class="keywordtype">int</span> sizes = psize.size();
<a name="l02252"></a>02252   
<a name="l02253"></a>02253   <span class="keywordflow">if</span>(sizes == 1) {
<a name="l02254"></a>02254     <span class="keywordflow">return</span> psize[0];
<a name="l02255"></a>02255   }
<a name="l02256"></a>02256   
<a name="l02257"></a>02257   vector&lt;int&gt; <span class="keyword">const</span> &amp; prate = <a class="code" href="classTrafficManager.html#acbd94dd6163520a2468dfd4ad079170a">_packet_size_rate</a>[cl];
<a name="l02258"></a>02258   <span class="keywordtype">int</span> max_val = <a class="code" href="classTrafficManager.html#ab6e4665632db77e8239371b38d06cb50">_packet_size_max_val</a>[cl];
<a name="l02259"></a>02259   
<a name="l02260"></a>02260   <span class="keywordtype">int</span> pct = <a class="code" href="random__utils_8cpp.html#ac46ec4a8515ceccca7c472ee3687b83f">RandomInt</a>(max_val);
<a name="l02261"></a>02261   
<a name="l02262"></a>02262   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; (sizes - 1); ++i) {
<a name="l02263"></a>02263     <span class="keywordtype">int</span> <span class="keyword">const</span> limit = prate[i];
<a name="l02264"></a>02264     <span class="keywordflow">if</span>(limit &gt; pct) {
<a name="l02265"></a>02265       <span class="keywordflow">return</span> psize[i];
<a name="l02266"></a>02266     } <span class="keywordflow">else</span> {
<a name="l02267"></a>02267       pct -= limit;
<a name="l02268"></a>02268     }
<a name="l02269"></a>02269   }
<a name="l02270"></a>02270   assert(prate.back() &gt; pct);
<a name="l02271"></a>02271   <span class="keywordflow">return</span> psize.back();
<a name="l02272"></a>02272 }
<a name="l02273"></a>02273 
<a name="l02274"></a><a class="code" href="classTrafficManager.html#a2606fffee4f6e888b8e7430200cf8a6d">02274</a> <span class="keywordtype">double</span> <a class="code" href="classTrafficManager.html#a2606fffee4f6e888b8e7430200cf8a6d">TrafficManager::_GetAveragePacketSize</a>(<span class="keywordtype">int</span> cl)<span class="keyword"> const</span>
<a name="l02275"></a>02275 <span class="keyword"></span>{
<a name="l02276"></a>02276   vector&lt;int&gt; <span class="keyword">const</span> &amp; psize = <a class="code" href="classTrafficManager.html#a9d132f9f6e9ea03ab7d4234091ea7f56">_packet_size</a>[cl];
<a name="l02277"></a>02277   <span class="keywordtype">int</span> sizes = psize.size();
<a name="l02278"></a>02278   <span class="keywordflow">if</span>(sizes == 1) {
<a name="l02279"></a>02279     <span class="keywordflow">return</span> (<span class="keywordtype">double</span>)psize[0];
<a name="l02280"></a>02280   }
<a name="l02281"></a>02281   vector&lt;int&gt; <span class="keyword">const</span> &amp; prate = <a class="code" href="classTrafficManager.html#acbd94dd6163520a2468dfd4ad079170a">_packet_size_rate</a>[cl];
<a name="l02282"></a>02282   <span class="keywordtype">int</span> sum = 0;
<a name="l02283"></a>02283   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; sizes; ++i) {
<a name="l02284"></a>02284     sum += psize[i] * prate[i];
<a name="l02285"></a>02285   }
<a name="l02286"></a>02286   <span class="keywordflow">return</span> (<span class="keywordtype">double</span>)sum / (double)(<a class="code" href="classTrafficManager.html#ab6e4665632db77e8239371b38d06cb50">_packet_size_max_val</a>[cl] + 1);
<a name="l02287"></a>02287 }
</pre></div></div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&nbsp;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&nbsp;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&nbsp;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&nbsp;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&nbsp;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&nbsp;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&nbsp;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&nbsp;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&nbsp;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&nbsp;</span>Friends</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr size="1"/><address style="text-align: right;"><small>Generated on 13 May 2014 for GPGPU-Sim by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
